diff --git a/node_modules/@uniswap/universal-router-sdk/dist/entities/actions/across.d.ts b/node_modules/@uniswap/universal-router-sdk/dist/entities/actions/across.d.ts
new file mode 100644
index 0000000..5caf1f0
--- /dev/null
+++ b/node_modules/@uniswap/universal-router-sdk/dist/entities/actions/across.d.ts
@@ -0,0 +1,21 @@
+import { BigNumberish } from 'ethers';
+/**
+ * Parameters for Across V4 Deposit V3 command
+ * Used for cross-chain bridging via Across Protocol V3 SpokePool
+ */
+export declare type AcrossV4DepositV3Params = {
+    depositor: string;
+    recipient: string;
+    inputToken: string;
+    outputToken: string;
+    inputAmount: BigNumberish;
+    outputAmount: BigNumberish;
+    destinationChainId: number;
+    exclusiveRelayer: string;
+    quoteTimestamp: number;
+    fillDeadline: number;
+    exclusivityDeadline: number;
+    message: string;
+    useNative: boolean;
+};
+export { CONTRACT_BALANCE } from '../../utils/constants';
diff --git a/node_modules/@uniswap/universal-router-sdk/dist/entities/actions/index.d.ts b/node_modules/@uniswap/universal-router-sdk/dist/entities/actions/index.d.ts
index b258c3a..75e3a46 100644
--- a/node_modules/@uniswap/universal-router-sdk/dist/entities/actions/index.d.ts
+++ b/node_modules/@uniswap/universal-router-sdk/dist/entities/actions/index.d.ts
@@ -1,2 +1,3 @@
 export * from './uniswap';
 export * from './unwrapWETH';
+export * from './across';
diff --git a/node_modules/@uniswap/universal-router-sdk/dist/entities/actions/uniswap.d.ts b/node_modules/@uniswap/universal-router-sdk/dist/entities/actions/uniswap.d.ts
index c175163..92ebcaa 100644
--- a/node_modules/@uniswap/universal-router-sdk/dist/entities/actions/uniswap.d.ts
+++ b/node_modules/@uniswap/universal-router-sdk/dist/entities/actions/uniswap.d.ts
@@ -3,7 +3,7 @@ import { Trade as RouterTrade, SwapOptions as RouterSwapOptions } from '@uniswap
 import { Permit2Permit } from '../../utils/inputTokens';
 import { Currency, TradeType } from '@uniswap/sdk-core';
 import { Command, RouterActionType, TradeConfig } from '../Command';
-import { BigNumberish } from 'ethers';
+import { BigNumber, BigNumberish } from 'ethers';
 export declare type FlatFeeOptions = {
     amount: BigNumberish;
     recipient: string;
@@ -13,6 +13,7 @@ export declare type SwapOptions = Omit<RouterSwapOptions, 'inputTokenPermit'> &
     inputTokenPermit?: Permit2Permit;
     flatFee?: FlatFeeOptions;
     safeMode?: boolean;
+    maxHopSlippage?: BigNumber[];
 };
 export declare class UniswapTrade implements Command {
     trade: RouterTrade<Currency, Currency, TradeType>;
diff --git a/node_modules/@uniswap/universal-router-sdk/dist/index.d.ts b/node_modules/@uniswap/universal-router-sdk/dist/index.d.ts
index d58a6c0..e0059b4 100644
--- a/node_modules/@uniswap/universal-router-sdk/dist/index.d.ts
+++ b/node_modules/@uniswap/universal-router-sdk/dist/index.d.ts
@@ -1,5 +1,5 @@
 export { SwapRouter } from './swapRouter';
-export type { MigrateV3ToV4Options } from './swapRouter';
+export type { MigrateV3ToV4Options, SignedRouteOptions, EIP712Payload } from './swapRouter';
 export * from './entities';
 export * from './utils/routerTradeAdapter';
 export { RoutePlanner, CommandType, COMMAND_DEFINITION, Parser, Subparser } from './utils/routerCommands';
@@ -8,3 +8,4 @@ export { UNIVERSAL_ROUTER_CREATION_BLOCK, UNIVERSAL_ROUTER_ADDRESS, ROUTER_AS_RE
 export { CommandParser, GenericCommandParser } from './utils/commandParser';
 export type { UniversalRouterCommand, UniversalRouterCall, Param, CommandsDefinition } from './utils/commandParser';
 export type { Permit2Permit } from './utils/inputTokens';
+export { NONCE_SKIP_CHECK, generateNonce, EXECUTE_SIGNED_TYPES, getUniversalRouterDomain } from './utils/eip712';
diff --git a/node_modules/@uniswap/universal-router-sdk/dist/swapRouter.d.ts b/node_modules/@uniswap/universal-router-sdk/dist/swapRouter.d.ts
index 11095d9..621797e 100644
--- a/node_modules/@uniswap/universal-router-sdk/dist/swapRouter.d.ts
+++ b/node_modules/@uniswap/universal-router-sdk/dist/swapRouter.d.ts
@@ -1,14 +1,35 @@
 import { Interface } from '@ethersproject/abi';
-import { BigNumberish } from 'ethers';
+import { TypedDataDomain, TypedDataField } from '@ethersproject/abstract-signer';
+import { BigNumber, BigNumberish } from 'ethers';
 import { MethodParameters, Position as V3Position, RemoveLiquidityOptions as V3RemoveLiquidityOptions } from '@uniswap/v3-sdk';
 import { Position as V4Position, AddLiquidityOptions as V4AddLiquidityOptions } from '@uniswap/v4-sdk';
 import { Trade as RouterTrade } from '@uniswap/router-sdk';
 import { Currency, TradeType } from '@uniswap/sdk-core';
 import { SwapOptions } from './entities/actions/uniswap';
+import { AcrossV4DepositV3Params } from './entities/actions/across';
 export declare type SwapRouterConfig = {
     sender?: string;
     deadline?: BigNumberish;
 };
+export declare type SignedRouteOptions = {
+    intent: string;
+    data: string;
+    sender: string;
+    nonce?: string;
+};
+export declare type EIP712Payload = {
+    domain: TypedDataDomain;
+    types: Record<string, TypedDataField[]>;
+    value: {
+        commands: string;
+        inputs: string[];
+        intent: string;
+        data: string;
+        sender: string;
+        nonce: string;
+        deadline: string;
+    };
+};
 export interface MigrateV3ToV4Options {
     inputPosition: V3Position;
     outputPosition: V4Position;
@@ -17,7 +38,7 @@ export interface MigrateV3ToV4Options {
 }
 export declare abstract class SwapRouter {
     static INTERFACE: Interface;
-    static swapCallParameters(trades: RouterTrade<Currency, Currency, TradeType>, options: SwapOptions): MethodParameters;
+    static swapCallParameters(trades: RouterTrade<Currency, Currency, TradeType>, options: SwapOptions, bridgeOptions?: AcrossV4DepositV3Params[]): MethodParameters;
     /**
      * Builds the call parameters for a migration from a V3 position to a V4 position.
      * Some requirements of the parameters:
@@ -27,6 +48,8 @@ export declare abstract class SwapRouter {
      *   - V3 NFT must be approved, or valid inputV3NFTPermit must be provided with UR as spender
      */
     static migrateV3ToV4CallParameters(options: MigrateV3ToV4Options, positionManagerOverride?: string): MethodParameters;
+    static getExecuteSignedPayload(calldata: string, signedOptions: SignedRouteOptions, deadline: BigNumberish, chainId: number, routerAddress: string): EIP712Payload;
+    static encodeExecuteSigned(calldata: string, signature: string, signedOptions: SignedRouteOptions, deadline: BigNumberish, nativeCurrencyValue?: BigNumber): MethodParameters;
     /**
      * Encodes a planned route into a method name and parameters for the Router contract.
      * @param planner the planned route
diff --git a/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.development.js b/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.development.js
index af785ae..c0fc10b 100644
--- a/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.development.js
+++ b/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.development.js
@@ -94,6 +94,8 @@ var _COMMAND_DEFINITION;
   CommandType[CommandType["V4_INITIALIZE_POOL"] = 19] = "V4_INITIALIZE_POOL";
   CommandType[CommandType["V4_POSITION_MANAGER_CALL"] = 20] = "V4_POSITION_MANAGER_CALL";
   CommandType[CommandType["EXECUTE_SUB_PLAN"] = 33] = "EXECUTE_SUB_PLAN";
+  // 3rd party integrations
+  CommandType[CommandType["ACROSS_V4_DEPOSIT_V3"] = 64] = "ACROSS_V4_DEPOSIT_V3";
 })(exports.CommandType || (exports.CommandType = {}));
 (function (Subparser) {
   Subparser[Subparser["V3PathExactIn"] = 0] = "V3PathExactIn";
@@ -313,6 +315,48 @@ var COMMAND_DEFINITION = (_COMMAND_DEFINITION = {}, _COMMAND_DEFINITION[exports.
   parser: exports.Parser.V3Actions
 }, _COMMAND_DEFINITION[exports.CommandType.V4_POSITION_MANAGER_CALL] = {
   parser: exports.Parser.V4Actions
+}, _COMMAND_DEFINITION[exports.CommandType.ACROSS_V4_DEPOSIT_V3] = {
+  parser: exports.Parser.Abi,
+  params: [{
+    name: 'depositor',
+    type: 'address'
+  }, {
+    name: 'recipient',
+    type: 'address'
+  }, {
+    name: 'inputToken',
+    type: 'address'
+  }, {
+    name: 'outputToken',
+    type: 'address'
+  }, {
+    name: 'inputAmount',
+    type: 'uint256'
+  }, {
+    name: 'outputAmount',
+    type: 'uint256'
+  }, {
+    name: 'destinationChainId',
+    type: 'uint256'
+  }, {
+    name: 'exclusiveRelayer',
+    type: 'address'
+  }, {
+    name: 'quoteTimestamp',
+    type: 'uint32'
+  }, {
+    name: 'fillDeadline',
+    type: 'uint32'
+  }, {
+    name: 'exclusivityDeadline',
+    type: 'uint32'
+  }, {
+    name: 'message',
+    type: 'bytes'
+  }, {
+    name: 'useNative',
+    type: 'bool'
+  }]
 }, _COMMAND_DEFINITION);
 var RoutePlanner = /*#__PURE__*/function () {
   function RoutePlanner() {
@@ -324,6 +368,10 @@ var RoutePlanner = /*#__PURE__*/function () {
     this.addCommand(exports.CommandType.EXECUTE_SUB_PLAN, [subplan.commands, subplan.inputs], true);
     return this;
   };
+  _proto.addAcrossBridge = function addAcrossBridge(params) {
+    this.addCommand(exports.CommandType.ACROSS_V4_DEPOSIT_V3, [params.depositor, params.recipient, params.inputToken, params.outputToken, params.inputAmount, params.outputAmount, params.destinationChainId, params.exclusiveRelayer, params.quoteTimestamp, params.fillDeadline, params.exclusivityDeadline, params.message, params.useNative]);
+    return this;
+  };
   _proto.addCommand = function addCommand(type, parameters, allowRevert) {
     if (allowRevert === void 0) {
       allowRevert = false;
@@ -389,11 +437,16 @@ function getPathCurrency(currency, pool) {
   RouterActionType["UnwrapWETH"] = "UnwrapWETH";
 })(exports.RouterActionType || (exports.RouterActionType = {}));
 
-var _routerConfigs, _routerConfigs2, _routerConfigs3, _routerConfigs4, _routerConfigs5, _routerConfigs6, _routerConfigs7, _routerConfigs8, _routerConfigs9, _routerConfigs0, _routerConfigs1, _routerConfigs10, _routerConfigs11, _routerConfigs12, _routerConfigs13, _routerConfigs14, _routerConfigs15, _routerConfigs16, _routerConfigs17, _routerConfigs18, _routerConfigs19, _routerConfigs20, _routerConfigs21, _routerConfigs22, _routerConfigs23, _routerConfigs24, _CHAIN_CONFIGS;
+var _routerConfigs, _routerConfigs2, _routerConfigs3, _routerConfigs4, _routerConfigs5, _routerConfigs6, _routerConfigs7, _routerConfigs8, _routerConfigs9, _routerConfigs0, _routerConfigs1, _routerConfigs10, _routerConfigs11, _routerConfigs12, _routerConfigs13, _routerConfigs14, _routerConfigs15, _routerConfigs16, _routerConfigs17, _routerConfigs18, _routerConfigs19, _routerConfigs20, _routerConfigs21, _routerConfigs22, _routerConfigs23, _routerConfigs24, _routerConfigs25, _routerConfigs26, _CHAIN_CONFIGS;
 (function (UniversalRouterVersion) {
   UniversalRouterVersion["V1_2"] = "1.2";
   UniversalRouterVersion["V2_0"] = "2.0";
+  UniversalRouterVersion["V2_1"] = "2.1";
 })(exports.UniversalRouterVersion || (exports.UniversalRouterVersion = {}));
+var ZERO_ROUTER_CONFIG = {
+  address: '0x0000000000000000000000000000000000000000',
+  creationBlock: 1
+};
 var WETH_NOT_SUPPORTED_ON_CHAIN = '0x0000000000000000000000000000000000000000';
 // Todo: Change `CHAIN_CONFIGS` to pull the UR address with v4
 var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
@@ -403,7 +456,10 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
     creationBlock: 17143817
   }, _routerConfigs[exports.UniversalRouterVersion.V2_0] = {
     address: '0x66a9893cc07d91d95644aedd05d03f95e1dba8af',
-    creationBlock: 1737658355
+    creationBlock: 21689092
+  }, _routerConfigs[exports.UniversalRouterVersion.V2_1] = {
+    address: '0xd92a36b0000531ef3063ded4de20a0783308446c',
+    creationBlock: 23836348
   }, _routerConfigs)
 }, _CHAIN_CONFIGS[5] = {
   weth: '0xb4fbf271143f4fbf7b91a5ded31805e42b2208d6',
@@ -413,7 +469,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs2[exports.UniversalRouterVersion.V2_0] = {
     address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',
     creationBlock: 8940568
-  }, _routerConfigs2)
+  }, _routerConfigs2[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs2)
 }, _CHAIN_CONFIGS[11155111] = {
   weth: '0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14',
   routerConfigs: (_routerConfigs3 = {}, _routerConfigs3[exports.UniversalRouterVersion.V1_2] = {
@@ -422,6 +478,9 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs3[exports.UniversalRouterVersion.V2_0] = {
     address: '0x3a9d48ab9751398bbfa63ad67599bb04e4bdf98b',
     creationBlock: 7259601
+  }, _routerConfigs3[exports.UniversalRouterVersion.V2_1] = {
+    address: '0x470FFC67b1feEEC31D16C46AC7545C98716a194c',
+    creationBlock: 9664766
   }, _routerConfigs3)
 }, _CHAIN_CONFIGS[137] = {
   weth: '0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270',
@@ -430,7 +489,10 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
     creationBlock: 52210153
   }, _routerConfigs4[exports.UniversalRouterVersion.V2_0] = {
     address: '0x1095692a6237d83c6a72f3f5efedb9a670c49223',
-    creationBlock: 1737492197
+    creationBlock: 66980401
+  }, _routerConfigs4[exports.UniversalRouterVersion.V2_1] = {
+    address: '0xE27610fD9dD05FC061366bc9dA414CA6F948f204',
+    creationBlock: 79245524
   }, _routerConfigs4)
 }, _CHAIN_CONFIGS[80001] = {
   weth: '0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889',
@@ -440,7 +502,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs5[exports.UniversalRouterVersion.V2_0] = {
     address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',
     creationBlock: 35176052
-  }, _routerConfigs5)
+  }, _routerConfigs5[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs5)
 }, _CHAIN_CONFIGS[10] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs6 = {}, _routerConfigs6[exports.UniversalRouterVersion.V1_2] = {
@@ -448,7 +510,10 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
     creationBlock: 114702266
   }, _routerConfigs6[exports.UniversalRouterVersion.V2_0] = {
     address: '0x851116d9223fabed8e56c0e6b8ad0c31d98b3507',
-    creationBlock: 1737494278
+    creationBlock: 129906462
+  }, _routerConfigs6[exports.UniversalRouterVersion.V2_1] = {
+    address: '0xde20EEE5398D3790a4D356e8925bD21Ea65D99Af',
+    creationBlock: 134078764
   }, _routerConfigs6)
 }, _CHAIN_CONFIGS[420] = {
   weth: '0x4200000000000000000000000000000000000006',
@@ -458,7 +523,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs7[exports.UniversalRouterVersion.V2_0] = {
     address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',
     creationBlock: 8887728
-  }, _routerConfigs7)
+  }, _routerConfigs7[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs7)
 }, _CHAIN_CONFIGS[42161] = {
   weth: '0x82aF49447D8a07e3bd95BD0d56f35241523fBab1',
   routerConfigs: (_routerConfigs8 = {}, _routerConfigs8[exports.UniversalRouterVersion.V1_2] = {
@@ -466,7 +531,10 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
     creationBlock: 169472836
   }, _routerConfigs8[exports.UniversalRouterVersion.V2_0] = {
     address: '0xa51afafe0263b40edaef0df8781ea9aa03e381a3',
-    creationBlock: 1737487458
+    creationBlock: 290124593
+  }, _routerConfigs8[exports.UniversalRouterVersion.V2_1] = {
+    address: '0x96b2FD2F80e9428Daa65d859653117D453981AB4',
+    creationBlock: 329155034
   }, _routerConfigs8)
 }, _CHAIN_CONFIGS[421613] = {
   weth: '0xe39Ab88f8A4777030A534146A9Ca3B52bd5D43A3',
@@ -476,7 +544,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs9[exports.UniversalRouterVersion.V2_0] = {
     address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',
     creationBlock: 18815277
-  }, _routerConfigs9)
+  }, _routerConfigs9[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs9)
 }, _CHAIN_CONFIGS[42220] = {
   weth: WETH_NOT_SUPPORTED_ON_CHAIN,
   routerConfigs: (_routerConfigs0 = {}, _routerConfigs0[exports.UniversalRouterVersion.V1_2] = {
@@ -485,7 +553,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs0[exports.UniversalRouterVersion.V2_0] = {
     address: '0xcb695bc5D3Aa22cAD1E6DF07801b061a05A0233A',
     creationBlock: 47387857
-  }, _routerConfigs0)
+  }, _routerConfigs0[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs0)
 }, _CHAIN_CONFIGS[44787] = {
   weth: WETH_NOT_SUPPORTED_ON_CHAIN,
   routerConfigs: (_routerConfigs1 = {}, _routerConfigs1[exports.UniversalRouterVersion.V1_2] = {
@@ -494,7 +562,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs1[exports.UniversalRouterVersion.V2_0] = {
     address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',
     creationBlock: 17566658
-  }, _routerConfigs1)
+  }, _routerConfigs1[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs1)
 }, _CHAIN_CONFIGS[56] = {
   weth: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c',
   routerConfigs: (_routerConfigs10 = {}, _routerConfigs10[exports.UniversalRouterVersion.V1_2] = {
@@ -503,7 +571,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs10[exports.UniversalRouterVersion.V2_0] = {
     address: '0x1906c1d672b88cd1b9ac7593301ca990f94eae07',
     creationBlock: 1737493275
-  }, _routerConfigs10)
+  }, _routerConfigs10[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs10)
 }, _CHAIN_CONFIGS[43114] = {
   weth: '0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7',
   routerConfigs: (_routerConfigs11 = {}, _routerConfigs11[exports.UniversalRouterVersion.V1_2] = {
@@ -512,6 +580,9 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs11[exports.UniversalRouterVersion.V2_0] = {
     address: '0x94b75331ae8d42c1b61065089b7d48fe14aa73b7',
     creationBlock: 1737558236
+  }, _routerConfigs11[exports.UniversalRouterVersion.V2_1] = {
+    address: '0x0Cf1f86B331A03179646341D10A2A87515087221',
+    creationBlock: 58800800
   }, _routerConfigs11)
 }, _CHAIN_CONFIGS[84531] = {
   weth: '0x4200000000000000000000000000000000000006',
@@ -521,7 +592,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs12[exports.UniversalRouterVersion.V2_0] = {
     address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',
     creationBlock: 6915289
-  }, _routerConfigs12)
+  }, _routerConfigs12[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs12)
 }, _CHAIN_CONFIGS[8453] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs13 = {}, _routerConfigs13[exports.UniversalRouterVersion.V1_2] = {
@@ -530,6 +601,9 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs13[exports.UniversalRouterVersion.V2_0] = {
     address: '0x6ff5693b99212da76ad316178a184ab56d299b43',
     creationBlock: 1737491485
+  }, _routerConfigs13[exports.UniversalRouterVersion.V2_1] = {
+    address: '0xf3a4f4094bd2c6c06ca2f61789d8727b8d1e7259',
+    creationBlock: 28539210
   }, _routerConfigs13)
 }, _CHAIN_CONFIGS[81457] = {
   weth: '0x4300000000000000000000000000000000000004',
@@ -539,7 +613,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs14[exports.UniversalRouterVersion.V2_0] = {
     address: '0xeabbcb3e8e415306207ef514f660a3f820025be3',
     creationBlock: 1737564586
-  }, _routerConfigs14)
+  }, _routerConfigs14[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs14)
 }, _CHAIN_CONFIGS[7777777] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs15 = {}, _routerConfigs15[exports.UniversalRouterVersion.V1_2] = {
@@ -548,7 +622,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs15[exports.UniversalRouterVersion.V2_0] = {
     address: '0x3315ef7ca28db74abadc6c44570efdf06b04b020',
     creationBlock: 1737562927
-  }, _routerConfigs15)
+  }, _routerConfigs15[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs15)
 }, _CHAIN_CONFIGS[324] = {
   weth: '0x5aea5775959fbc2557cc8789bc1bf90a239d9a91',
   routerConfigs: (_routerConfigs16 = {}, _routerConfigs16[exports.UniversalRouterVersion.V1_2] = {
@@ -557,7 +631,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs16[exports.UniversalRouterVersion.V2_0] = {
     address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',
     creationBlock: 12640979
-  }, _routerConfigs16)
+  }, _routerConfigs16[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs16)
 }, _CHAIN_CONFIGS[480] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs17 = {}, _routerConfigs17[exports.UniversalRouterVersion.V1_2] = {
@@ -566,7 +640,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs17[exports.UniversalRouterVersion.V2_0] = {
     address: '0x8ac7bee993bb44dab564ea4bc9ea67bf9eb5e743',
     creationBlock: 1737559557
-  }, _routerConfigs17)
+  }, _routerConfigs17[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs17)
 }, _CHAIN_CONFIGS[1301] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs18 = {}, _routerConfigs18[exports.UniversalRouterVersion.V1_2] = {
@@ -575,7 +649,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs18[exports.UniversalRouterVersion.V2_0] = {
     address: '0xf70536b3bcc1bd1a972dc186a2cf84cc6da6be5d',
     creationBlock: 7100543
-  }, _routerConfigs18)
+  }, _routerConfigs18[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs18)
 }, _CHAIN_CONFIGS[130] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs19 = {}, _routerConfigs19[exports.UniversalRouterVersion.V1_2] = {
@@ -584,7 +658,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs19[exports.UniversalRouterVersion.V2_0] = {
     address: '0xef740bf23acae26f6492b10de645d6b98dc8eaf3',
     creationBlock: 1737568156
-  }, _routerConfigs19)
+  }, _routerConfigs19[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs19)
 }, _CHAIN_CONFIGS[10143] = {
   weth: '0x760AfE86e5de5fa0Ee542fc7B7B713e1c5425701',
   routerConfigs: (_routerConfigs20 = {}, _routerConfigs20[exports.UniversalRouterVersion.V1_2] = {
@@ -593,7 +667,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs20[exports.UniversalRouterVersion.V2_0] = {
     address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',
     creationBlock: 23678
-  }, _routerConfigs20)
+  }, _routerConfigs20[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs20)
 }, _CHAIN_CONFIGS[84532] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs21 = {}, _routerConfigs21[exports.UniversalRouterVersion.V1_2] = {
@@ -602,7 +676,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs21[exports.UniversalRouterVersion.V2_0] = {
     address: '0x492e6456d9528771018deb9e87ef7750ef184104',
     creationBlock: 20216585
-  }, _routerConfigs21)
+  }, _routerConfigs21[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs21)
 }, _CHAIN_CONFIGS[1868] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs22 = {}, _routerConfigs22[exports.UniversalRouterVersion.V1_2] = {
@@ -611,7 +685,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs22[exports.UniversalRouterVersion.V2_0] = {
     address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',
     creationBlock: 3254782
-  }, _routerConfigs22)
+  }, _routerConfigs22[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs22)
 }, _CHAIN_CONFIGS[143] = {
   weth: '0x3bd359C1119dA7Da1D913D1C4D2B7c461115433A',
   routerConfigs: (_routerConfigs23 = {}, _routerConfigs23[exports.UniversalRouterVersion.V1_2] = {
@@ -620,7 +694,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs23[exports.UniversalRouterVersion.V2_0] = {
     address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',
     creationBlock: 29255937
-  }, _routerConfigs23)
+  }, _routerConfigs23[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs23)
 }, _CHAIN_CONFIGS[196] = {
   weth: '0xe538905cf8410324e03A5A23C1c177a474D59b2b',
   routerConfigs: (_routerConfigs24 = {}, _routerConfigs24[exports.UniversalRouterVersion.V1_2] = {
@@ -629,7 +703,16 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs24[exports.UniversalRouterVersion.V2_0] = {
     address: '0x5507749f2c558bb3e162c6e90c314c092e7372ff',
     creationBlock: 47680350
-  }, _routerConfigs24)
+  }, _routerConfigs24[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs24)
+}, _CHAIN_CONFIGS[30] = {
+  weth: WETH_NOT_SUPPORTED_ON_CHAIN,
+  routerConfigs: (_routerConfigs25 = {}, _routerConfigs25[exports.UniversalRouterVersion.V1_2] = ZERO_ROUTER_CONFIG, _routerConfigs25[exports.UniversalRouterVersion.V2_0] = ZERO_ROUTER_CONFIG, _routerConfigs25[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs25)
+}, _CHAIN_CONFIGS[111557560] = {
+  weth: '0x4200000000000000000000000000000000000006',
+  routerConfigs: (_routerConfigs26 = {}, _routerConfigs26[exports.UniversalRouterVersion.V1_2] = ZERO_ROUTER_CONFIG, _routerConfigs26[exports.UniversalRouterVersion.V2_0] = {
+    address: '0x2D094CE21AE3431909e373207a2fCef4ba8871a9',
+    creationBlock: 6183303
+  }, _routerConfigs26[exports.UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs26)
 }, _CHAIN_CONFIGS);
 var UNIVERSAL_ROUTER_ADDRESS = function UNIVERSAL_ROUTER_ADDRESS(version, chainId) {
   if (!(chainId in CHAIN_CONFIGS)) throw new Error("Universal Router not deployed on chain " + chainId);
@@ -1080,6 +1163,56 @@ function encodeInputTokenOptions(planner, options) {
   }
 }
 
+var EIP712_DOMAIN_NAME = 'UniversalRouter';
+var EIP712_DOMAIN_VERSION = '2';
+var EXECUTE_SIGNED_TYPES = {
+  ExecuteSigned: [{
+    name: 'commands',
+    type: 'bytes'
+  }, {
+    name: 'inputs',
+    type: 'bytes[]'
+  }, {
+    name: 'intent',
+    type: 'bytes'
+  }, {
+    name: 'data',
+    type: 'bytes'
+  }, {
+    name: 'sender',
+    type: 'address'
+  }, {
+    name: 'nonce',
+    type: 'uint256'
+  }, {
+    name: 'deadline',
+    type: 'uint256'
+  }]
+};
+// When set as the nonce, the nonce check is skipped
+var NONCE_SKIP_CHECK = /*#__PURE__*/ethers.BigNumber.from('0x8000000000000000000000000000000000000000000000000000000000000000');
+/**
+ * Generate a random nonce for signed execution
+ */
+function generateNonce() {
+  var randomBytes = new Uint8Array(32);
+  for (var i = 0; i < 32; i++) {
+    randomBytes[i] = Math.floor(Math.random() * 256);
+  }
+  return ethers.BigNumber.from(randomBytes).toHexString();
+}
+/**
+ * Get the EIP712 domain for a Universal Router contract
+ */
+function getUniversalRouterDomain(chainId, routerAddress) {
+  return {
+    name: EIP712_DOMAIN_NAME,
+    version: EIP712_DOMAIN_VERSION,
+    chainId: chainId,
+    verifyingContract: routerAddress
+  };
+}
+
 function isMint(options) {
   return Object.keys(options).some(function (k) {
     return k === 'recipient';
@@ -1087,7 +1220,7 @@ function isMint(options) {
 }
 var SwapRouter = /*#__PURE__*/function () {
   function SwapRouter() {}
-  SwapRouter.swapCallParameters = function swapCallParameters(trades, options) {
+  SwapRouter.swapCallParameters = function swapCallParameters(trades, options, bridgeOptions) {
     // TODO: use permit if signature included in swapOptions
     var planner = new RoutePlanner();
     var trade = new UniswapTrade(trades, options);
@@ -1100,6 +1233,11 @@ var SwapRouter = /*#__PURE__*/function () {
     trade.encode(planner, {
       allowRevert: false
     });
+    if (bridgeOptions) {
+      bridgeOptions.forEach(function (bridge) {
+        return planner.addAcrossBridge(bridge);
+      });
+    }
     return SwapRouter.encodePlan(planner, nativeCurrencyValue, {
       deadline: options.deadlineOrPreviousBlockhash ? ethers.BigNumber.from(options.deadlineOrPreviousBlockhash) : undefined
     });
@@ -1167,6 +1305,39 @@ var SwapRouter = /*#__PURE__*/function () {
     return SwapRouter.encodePlan(planner, ethers.BigNumber.from(0), {
       deadline: ethers.BigNumber.from(options.v4AddLiquidityOptions.deadline)
     });
+  };
+  SwapRouter.getExecuteSignedPayload = function getExecuteSignedPayload(calldata, signedOptions, deadline, chainId, routerAddress) {
+    var iface = SwapRouter.INTERFACE;
+    var decoded = iface.decodeFunctionData('execute', calldata);
+    var commands = decoded[0];
+    var inputs = decoded[1];
+    var nonce = signedOptions.nonce || generateNonce();
+    var domain = getUniversalRouterDomain(chainId, routerAddress);
+    return {
+      domain: domain,
+      types: EXECUTE_SIGNED_TYPES,
+      value: {
+        commands: commands,
+        inputs: inputs,
+        intent: signedOptions.intent,
+        data: signedOptions.data,
+        sender: signedOptions.sender,
+        nonce: nonce,
+        deadline: deadline.toString()
+      }
+    };
+  };
+  SwapRouter.encodeExecuteSigned = function encodeExecuteSigned(calldata, signature, signedOptions, deadline, nativeCurrencyValue) {
+    var iface = SwapRouter.INTERFACE;
+    var decoded = iface.decodeFunctionData('execute', calldata);
+    var commands = decoded[0];
+    var inputs = decoded[1];
+    var nonce = signedOptions.nonce || generateNonce();
+    var executeSignedCalldata = iface.encodeFunctionData('executeSigned', [commands, inputs, signedOptions.intent, signedOptions.data, signedOptions.sender, nonce, ethers.BigNumber.from(deadline).toString(), signature]);
+    return {
+      calldata: executeSignedCalldata,
+      value: (nativeCurrencyValue || ethers.BigNumber.from(0)).toHexString()
+    };
   }
   /**
    * Encodes a planned route into a method name and parameters for the Router contract.
@@ -1508,8 +1679,11 @@ function v4RouterCallToParams(actions) {
 }
 
 exports.COMMAND_DEFINITION = COMMAND_DEFINITION;
+exports.CONTRACT_BALANCE = CONTRACT_BALANCE;
 exports.CommandParser = CommandParser;
+exports.EXECUTE_SIGNED_TYPES = EXECUTE_SIGNED_TYPES;
 exports.GenericCommandParser = GenericCommandParser;
+exports.NONCE_SKIP_CHECK = NONCE_SKIP_CHECK;
 exports.ROUTER_AS_RECIPIENT = ROUTER_AS_RECIPIENT;
 exports.RoutePlanner = RoutePlanner;
 exports.RouterTradeAdapter = RouterTradeAdapter;
@@ -1519,5 +1693,7 @@ exports.UNIVERSAL_ROUTER_CREATION_BLOCK = UNIVERSAL_ROUTER_CREATION_BLOCK;
 exports.UniswapTrade = UniswapTrade;
 exports.UnwrapWETH = UnwrapWETH;
 exports.WETH_ADDRESS = WETH_ADDRESS;
+exports.generateNonce = generateNonce;
+exports.getUniversalRouterDomain = getUniversalRouterDomain;
 exports.isNativeCurrency = isNativeCurrency;
 //# sourceMappingURL=universal-router-sdk.cjs.development.js.map
diff --git a/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.development.js.map b/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.development.js.map
index 166d9fa..3b446ec 100644
--- a/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.development.js.map
+++ b/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.development.js.map
@@ -1 +1 @@
-{"version":3,"file":"universal-router-sdk.cjs.development.js","sources":["../src/utils/routerCommands.ts","../src/utils/pathCurrency.ts","../src/entities/Command.ts","../src/utils/constants.ts","../src/utils/getCurrencyAddress.ts","../src/utils/numbers.ts","../src/entities/actions/uniswap.ts","../src/utils/inputTokens.ts","../src/swapRouter.ts","../src/entities/actions/unwrapWETH.ts","../src/utils/routerTradeAdapter.ts","../src/utils/commandParser.ts"],"sourcesContent":["import { defaultAbiCoder } from 'ethers/lib/utils'\n\n/**\n * CommandTypes\n * @description Flags that modify a command's execution\n * @enum {number}\n */\nexport enum CommandType {\n  V3_SWAP_EXACT_IN = 0x00,\n  V3_SWAP_EXACT_OUT = 0x01,\n  PERMIT2_TRANSFER_FROM = 0x02,\n  PERMIT2_PERMIT_BATCH = 0x03,\n  SWEEP = 0x04,\n  TRANSFER = 0x05,\n  PAY_PORTION = 0x06,\n\n  V2_SWAP_EXACT_IN = 0x08,\n  V2_SWAP_EXACT_OUT = 0x09,\n  PERMIT2_PERMIT = 0x0a,\n  WRAP_ETH = 0x0b,\n  UNWRAP_WETH = 0x0c,\n  PERMIT2_TRANSFER_FROM_BATCH = 0x0d,\n  BALANCE_CHECK_ERC20 = 0x0e,\n\n  V4_SWAP = 0x10,\n  V3_POSITION_MANAGER_PERMIT = 0x11,\n  V3_POSITION_MANAGER_CALL = 0x12,\n  V4_INITIALIZE_POOL = 0x13,\n  V4_POSITION_MANAGER_CALL = 0x14,\n\n  EXECUTE_SUB_PLAN = 0x21,\n}\n\nexport enum Subparser {\n  V3PathExactIn,\n  V3PathExactOut,\n}\n\nexport enum Parser {\n  Abi,\n  V4Actions,\n  V3Actions,\n}\n\nexport type ParamType = {\n  readonly name: string\n  readonly type: string\n  readonly subparser?: Subparser\n}\n\nexport type CommandDefinition =\n  | {\n      parser: Parser.Abi\n      params: ParamType[]\n    }\n  | {\n      parser: Parser.V4Actions\n    }\n  | {\n      parser: Parser.V3Actions\n    }\n\nconst ALLOW_REVERT_FLAG = 0x80\nconst REVERTIBLE_COMMANDS = new Set<CommandType>([CommandType.EXECUTE_SUB_PLAN])\n\nconst PERMIT_STRUCT =\n  '((address token,uint160 amount,uint48 expiration,uint48 nonce) details,address spender,uint256 sigDeadline)'\n\nconst PERMIT_BATCH_STRUCT =\n  '((address token,uint160 amount,uint48 expiration,uint48 nonce)[] details,address spender,uint256 sigDeadline)'\n\nconst POOL_KEY_STRUCT = '(address currency0,address currency1,uint24 fee,int24 tickSpacing,address hooks)'\n\nconst PERMIT2_TRANSFER_FROM_STRUCT = '(address from,address to,uint160 amount,address token)'\nconst PERMIT2_TRANSFER_FROM_BATCH_STRUCT = PERMIT2_TRANSFER_FROM_STRUCT + '[]'\n\nexport const COMMAND_DEFINITION: { [key in CommandType]: CommandDefinition } = {\n  // Batch Reverts\n  [CommandType.EXECUTE_SUB_PLAN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'commands', type: 'bytes' },\n      { name: 'inputs', type: 'bytes[]' },\n    ],\n  },\n\n  // Permit2 Actions\n  [CommandType.PERMIT2_PERMIT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'permit', type: PERMIT_STRUCT },\n      { name: 'signature', type: 'bytes' },\n    ],\n  },\n  [CommandType.PERMIT2_PERMIT_BATCH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'permit', type: PERMIT_BATCH_STRUCT },\n      { name: 'signature', type: 'bytes' },\n    ],\n  },\n  [CommandType.PERMIT2_TRANSFER_FROM]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'amount', type: 'uint160' },\n    ],\n  },\n  [CommandType.PERMIT2_TRANSFER_FROM_BATCH]: {\n    parser: Parser.Abi,\n    params: [\n      {\n        name: 'transferFrom',\n        type: PERMIT2_TRANSFER_FROM_BATCH_STRUCT,\n      },\n    ],\n  },\n\n  // Uniswap Actions\n  [CommandType.V3_SWAP_EXACT_IN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountIn', type: 'uint256' },\n      { name: 'amountOutMin', type: 'uint256' },\n      { name: 'path', subparser: Subparser.V3PathExactIn, type: 'bytes' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V3_SWAP_EXACT_OUT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountOut', type: 'uint256' },\n      { name: 'amountInMax', type: 'uint256' },\n      { name: 'path', subparser: Subparser.V3PathExactOut, type: 'bytes' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V2_SWAP_EXACT_IN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountIn', type: 'uint256' },\n      { name: 'amountOutMin', type: 'uint256' },\n      { name: 'path', type: 'address[]' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V2_SWAP_EXACT_OUT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountOut', type: 'uint256' },\n      { name: 'amountInMax', type: 'uint256' },\n      { name: 'path', type: 'address[]' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V4_SWAP]: { parser: Parser.V4Actions },\n\n  // Token Actions and Checks\n  [CommandType.WRAP_ETH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amount', type: 'uint256' },\n    ],\n  },\n  [CommandType.UNWRAP_WETH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountMin', type: 'uint256' },\n    ],\n  },\n  [CommandType.SWEEP]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'amountMin', type: 'uint256' },\n    ],\n  },\n  [CommandType.TRANSFER]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'value', type: 'uint256' },\n    ],\n  },\n  [CommandType.PAY_PORTION]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'bips', type: 'uint256' },\n    ],\n  },\n  [CommandType.BALANCE_CHECK_ERC20]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'owner', type: 'address' },\n      { name: 'token', type: 'address' },\n      { name: 'minBalance', type: 'uint256' },\n    ],\n  },\n  [CommandType.V4_INITIALIZE_POOL]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'poolKey', type: POOL_KEY_STRUCT },\n      { name: 'sqrtPriceX96', type: 'uint160' },\n    ],\n  },\n\n  // Position Actions\n  [CommandType.V3_POSITION_MANAGER_PERMIT]: { parser: Parser.V3Actions },\n  [CommandType.V3_POSITION_MANAGER_CALL]: { parser: Parser.V3Actions },\n  [CommandType.V4_POSITION_MANAGER_CALL]: { parser: Parser.V4Actions },\n}\n\nexport class RoutePlanner {\n  commands: string\n  inputs: string[]\n\n  constructor() {\n    this.commands = '0x'\n    this.inputs = []\n  }\n\n  addSubPlan(subplan: RoutePlanner): RoutePlanner {\n    this.addCommand(CommandType.EXECUTE_SUB_PLAN, [subplan.commands, subplan.inputs], true)\n    return this\n  }\n\n  addCommand(type: CommandType, parameters: any[], allowRevert = false): RoutePlanner {\n    let command = createCommand(type, parameters)\n    this.inputs.push(command.encodedInput)\n    if (allowRevert) {\n      if (!REVERTIBLE_COMMANDS.has(command.type)) {\n        throw new Error(`command type: ${command.type} cannot be allowed to revert`)\n      }\n      command.type = command.type | ALLOW_REVERT_FLAG\n    }\n\n    this.commands = this.commands.concat(command.type.toString(16).padStart(2, '0'))\n    return this\n  }\n}\n\nexport type RouterCommand = {\n  type: CommandType\n  encodedInput: string\n}\n\nexport function createCommand(type: CommandType, parameters: any[]): RouterCommand {\n  const commandDef = COMMAND_DEFINITION[type]\n  switch (commandDef.parser) {\n    case Parser.Abi:\n      const encodedInput = defaultAbiCoder.encode(\n        commandDef.params.map((abi) => abi.type),\n        parameters\n      )\n      return { type, encodedInput }\n    case Parser.V4Actions:\n      // v4 swap data comes pre-encoded at index 0\n      return { type, encodedInput: parameters[0] }\n    case Parser.V3Actions:\n      // v4 swap data comes pre-encoded at index 0\n      return { type, encodedInput: parameters[0] }\n  }\n}\n","import { Currency, Token } from '@uniswap/sdk-core'\nimport { Pool as V4Pool } from '@uniswap/v4-sdk'\nimport { TPool } from '@uniswap/router-sdk'\n\nexport function getPathCurrency(currency: Currency, pool: TPool): Currency {\n  // return currency if the currency matches a currency of the pool\n  if (pool.involvesToken(currency as Token)) {\n    return currency\n\n    // return if currency.wrapped if pool involves wrapped currency\n  } else if (pool.involvesToken(currency.wrapped as Token)) {\n    return currency.wrapped\n\n    // return native currency if pool involves native version of wrapped currency (only applies to V4)\n  } else if (pool instanceof V4Pool && pool.token0.wrapped.equals(currency)) {\n    return pool.token0\n  } else if (pool instanceof V4Pool && pool.token1.wrapped.equals(currency)) {\n    return pool.token1\n  } else {\n    throw new Error(`Expected currency ${currency.symbol} to be either ${pool.token0.symbol} or ${pool.token1.symbol}`)\n  }\n\n  return currency // this line needed for typescript to compile\n}\n","import { RoutePlanner } from '../utils/routerCommands'\n\nexport type TradeConfig = {\n  allowRevert: boolean\n}\n\nexport enum RouterActionType {\n  UniswapTrade = 'UniswapTrade',\n  UnwrapWETH = 'UnwrapWETH',\n}\n\n// interface for entities that can be encoded as a Universal Router command\nexport interface Command {\n  tradeType: RouterActionType\n  encode(planner: RoutePlanner, config: TradeConfig): void\n}\n","import { BigNumber } from 'ethers'\n\nexport enum UniversalRouterVersion {\n  V1_2 = '1.2',\n  V2_0 = '2.0',\n}\n\nexport type RouterConfig = {\n  address: string\n  creationBlock: number\n}\n\ntype ChainConfig = {\n  weth: string\n  routerConfigs: { [key in UniversalRouterVersion]: RouterConfig }\n}\n\nconst WETH_NOT_SUPPORTED_ON_CHAIN = '0x0000000000000000000000000000000000000000'\n\n// Todo: Change `CHAIN_CONFIGS` to pull the UR address with v4\nexport const CHAIN_CONFIGS: { [key: number]: ChainConfig } = {\n  // mainnet\n  [1]: {\n    weth: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17143817,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x66a9893cc07d91d95644aedd05d03f95e1dba8af',\n        creationBlock: 1737658355,\n      },\n    },\n  },\n  // goerli\n  [5]: {\n    weth: '0xb4fbf271143f4fbf7b91a5ded31805e42b2208d6',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8940568,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8940568,\n      },\n    },\n  },\n  // sepolia\n  [11155111]: {\n    weth: '0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 3543575,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3a9d48ab9751398bbfa63ad67599bb04e4bdf98b', // only update here and creation block below\n        creationBlock: 7259601,\n      },\n    },\n  },\n  // polygon\n  [137]: {\n    weth: '0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xec7BE89e9d109e7e3Fec59c222CF297125FEFda2',\n        creationBlock: 52210153,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x1095692a6237d83c6a72f3f5efedb9a670c49223',\n        creationBlock: 1737492197,\n      },\n    },\n  },\n  //polygon mumbai\n  [80001]: {\n    weth: '0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 35176052,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 35176052,\n      },\n    },\n  },\n  //optimism\n  [10]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xCb1355ff08Ab38bBCE60111F1bb2B784bE25D7e8',\n        creationBlock: 114702266,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x851116d9223fabed8e56c0e6b8ad0c31d98b3507',\n        creationBlock: 1737494278,\n      },\n    },\n  },\n  // optimism goerli\n  [420]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8887728,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8887728,\n      },\n    },\n  },\n  // arbitrum\n  [42161]: {\n    weth: '0x82aF49447D8a07e3bd95BD0d56f35241523fBab1',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x5E325eDA8064b456f4781070C0738d849c824258',\n        creationBlock: 169472836,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xa51afafe0263b40edaef0df8781ea9aa03e381a3',\n        creationBlock: 1737487458,\n      },\n    },\n  },\n  // arbitrum goerli\n  [421613]: {\n    weth: '0xe39Ab88f8A4777030A534146A9Ca3B52bd5D43A3',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 18815277,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 18815277,\n      },\n    },\n  },\n  // celo\n  [42220]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x643770e279d5d0733f21d6dc03a8efbabf3255b4',\n        creationBlock: 21407637,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xcb695bc5D3Aa22cAD1E6DF07801b061a05A0233A',\n        creationBlock: 47387857,\n      },\n    },\n  },\n  // celo alfajores\n  [44787]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17566658,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17566658,\n      },\n    },\n  },\n  // binance smart chain\n  [56]: {\n    weth: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4Dae2f939ACf50408e13d58534Ff8c2776d45265',\n        creationBlock: 35160263,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x1906c1d672b88cd1b9ac7593301ca990f94eae07',\n        creationBlock: 1737493275,\n      },\n    },\n  },\n  // avalanche\n  [43114]: {\n    weth: '0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4Dae2f939ACf50408e13d58534Ff8c2776d45265',\n        creationBlock: 40237257,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x94b75331ae8d42c1b61065089b7d48fe14aa73b7',\n        creationBlock: 1737558236,\n      },\n    },\n  },\n  // base goerli\n  [84531]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',\n        creationBlock: 6915289,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',\n        creationBlock: 6915289,\n      },\n    },\n  },\n  // base mainnet\n  [8453]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 9107268,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x6ff5693b99212da76ad316178a184ab56d299b43',\n        creationBlock: 1737491485,\n      },\n    },\n  },\n  // blast\n  [81457]: {\n    weth: '0x4300000000000000000000000000000000000004',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x643770E279d5D0733F21d6DC03A8efbABf3255B4',\n        creationBlock: 1116444,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xeabbcb3e8e415306207ef514f660a3f820025be3',\n        creationBlock: 1737564586,\n      },\n    },\n  },\n  // zora\n  [7777777]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x2986d9721A49838ab4297b695858aF7F17f38014',\n        creationBlock: 11832155,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3315ef7ca28db74abadc6c44570efdf06b04b020',\n        creationBlock: 1737562927,\n      },\n    },\n  },\n  [324]: {\n    weth: '0x5aea5775959fbc2557cc8789bc1bf90a239d9a91',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',\n        creationBlock: 12640979,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',\n        creationBlock: 12640979,\n      },\n    },\n  },\n  // worldchain\n  [480]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D',\n        creationBlock: 4063979,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x8ac7bee993bb44dab564ea4bc9ea67bf9eb5e743',\n        creationBlock: 1737559557,\n      },\n    },\n  },\n  [1301]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x8909Dc15e40173Ff4699343b6eB8132c65e18eC6',\n        creationBlock: 1241811,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xf70536b3bcc1bd1a972dc186a2cf84cc6da6be5d',\n        creationBlock: 7100543,\n      },\n    },\n  },\n  // unichain mainnet\n  [130]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4D73A4411CA1c660035e4AECC8270E5DdDEC8C17',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xef740bf23acae26f6492b10de645d6b98dc8eaf3',\n        creationBlock: 1737568156,\n      },\n    },\n  },\n  [10143]: {\n    weth: '0x760AfE86e5de5fa0Ee542fc7B7B713e1c5425701',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',\n        creationBlock: 23678,\n      },\n    },\n  },\n  [84532]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x492e6456d9528771018deb9e87ef7750ef184104',\n        creationBlock: 20216585,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x492e6456d9528771018deb9e87ef7750ef184104',\n        creationBlock: 20216585,\n      },\n    },\n  },\n  [1868]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',\n        creationBlock: 3254782,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',\n        creationBlock: 3254782,\n      },\n    },\n  },\n  [143]: {\n    weth: '0x3bd359C1119dA7Da1D913D1C4D2B7c461115433A',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',\n        creationBlock: 29255937,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',\n        creationBlock: 29255937,\n      },\n    },\n  },\n  [196]: {\n    weth: '0xe538905cf8410324e03A5A23C1c177a474D59b2b',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0000000000000000000000000000000000000000',\n        creationBlock: 1,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x5507749f2c558bb3e162c6e90c314c092e7372ff',\n        creationBlock: 47680350,\n      },\n    },\n  },\n}\n\nexport const UNIVERSAL_ROUTER_ADDRESS = (version: UniversalRouterVersion, chainId: number): string => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n  return CHAIN_CONFIGS[chainId].routerConfigs[version].address\n}\n\nexport const UNIVERSAL_ROUTER_CREATION_BLOCK = (version: UniversalRouterVersion, chainId: number): number => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n  return CHAIN_CONFIGS[chainId].routerConfigs[version].creationBlock\n}\n\nexport const WETH_ADDRESS = (chainId: number): string => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n\n  if (CHAIN_CONFIGS[chainId].weth == WETH_NOT_SUPPORTED_ON_CHAIN) throw new Error(`Chain ${chainId} does not have WETH`)\n\n  return CHAIN_CONFIGS[chainId].weth\n}\n\nexport const CONTRACT_BALANCE = BigNumber.from(2).pow(255)\nexport const ETH_ADDRESS = '0x0000000000000000000000000000000000000000'\nexport const E_ETH_ADDRESS = '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee'\nexport const ZERO_ADDRESS = '0x0000000000000000000000000000000000000000'\nexport const MAX_UINT256 = BigNumber.from(2).pow(256).sub(1)\nexport const MAX_UINT160 = BigNumber.from(2).pow(160).sub(1)\n\nexport const SENDER_AS_RECIPIENT = '0x0000000000000000000000000000000000000001'\nexport const ROUTER_AS_RECIPIENT = '0x0000000000000000000000000000000000000002'\n","import { Currency } from '@uniswap/sdk-core'\nimport { ETH_ADDRESS } from './constants'\n\nexport function getCurrencyAddress(currency: Currency): string {\n  return currency.isNative ? ETH_ADDRESS : currency.wrapped.address\n}\n","import { BigNumber } from 'ethers'\nimport JSBI from 'jsbi'\nimport bn from 'bignumber.js'\nimport { Percent } from '@uniswap/sdk-core'\nimport { toHex } from '@uniswap/v3-sdk'\n\nexport function expandTo18DecimalsBN(n: number): BigNumber {\n  // use bn intermediately to allow decimals in intermediate calculations\n  return BigNumber.from(new bn(n).times(new bn(10).pow(18)).toFixed())\n}\n\nexport function expandTo18Decimals(n: number): JSBI {\n  return JSBI.BigInt(BigNumber.from(n).mul(BigNumber.from(10).pow(18)).toString())\n}\n\nexport function encodeFeeBips(fee: Percent): string {\n  return toHex(fee.multiply(10_000).quotient)\n}\n","import { RoutePlanner, CommandType } from '../../utils/routerCommands'\nimport { Trade as V2Trade, Pair } from '@uniswap/v2-sdk'\nimport { Trade as V3Trade, Pool as V3Pool, encodeRouteToPath } from '@uniswap/v3-sdk'\nimport {\n  Route as V4Route,\n  Trade as V4Trade,\n  Pool as V4Pool,\n  V4Planner,\n  encodeRouteToPath as encodeV4RouteToPath,\n  Actions,\n} from '@uniswap/v4-sdk'\nimport {\n  Trade as RouterTrade,\n  MixedRouteTrade,\n  Protocol,\n  IRoute,\n  RouteV2,\n  RouteV3,\n  MixedRouteSDK,\n  MixedRoute,\n  SwapOptions as RouterSwapOptions,\n  getOutputOfPools,\n  encodeMixedRouteToPath,\n  partitionMixedRouteByProtocol,\n} from '@uniswap/router-sdk'\nimport { Permit2Permit } from '../../utils/inputTokens'\nimport { getPathCurrency } from '../../utils/pathCurrency'\nimport { Currency, TradeType, Token, CurrencyAmount, Percent } from '@uniswap/sdk-core'\nimport { Command, RouterActionType, TradeConfig } from '../Command'\nimport { SENDER_AS_RECIPIENT, ROUTER_AS_RECIPIENT, CONTRACT_BALANCE, ETH_ADDRESS } from '../../utils/constants'\nimport { getCurrencyAddress } from '../../utils/getCurrencyAddress'\nimport { encodeFeeBips } from '../../utils/numbers'\nimport { BigNumber, BigNumberish } from 'ethers'\nimport { TPool } from '@uniswap/router-sdk'\n\nexport type FlatFeeOptions = {\n  amount: BigNumberish\n  recipient: string\n}\n\n// the existing router permit object doesn't include enough data for permit2\n// so we extend swap options with the permit2 permit\n// when safe mode is enabled, the SDK will add an extra ETH sweep for security\n// when useRouterBalance is enabled the SDK will use the balance in the router for the swap\nexport type SwapOptions = Omit<RouterSwapOptions, 'inputTokenPermit'> & {\n  useRouterBalance?: boolean\n  inputTokenPermit?: Permit2Permit\n  flatFee?: FlatFeeOptions\n  safeMode?: boolean\n}\n\nconst REFUND_ETH_PRICE_IMPACT_THRESHOLD = new Percent(50, 100)\n\ninterface Swap<TInput extends Currency, TOutput extends Currency> {\n  route: IRoute<TInput, TOutput, TPool>\n  inputAmount: CurrencyAmount<TInput>\n  outputAmount: CurrencyAmount<TOutput>\n}\n\n// Wrapper for uniswap router-sdk trade entity to encode swaps for Universal Router\n// also translates trade objects from previous (v2, v3) SDKs\nexport class UniswapTrade implements Command {\n  readonly tradeType: RouterActionType = RouterActionType.UniswapTrade\n  readonly payerIsUser: boolean\n\n  constructor(public trade: RouterTrade<Currency, Currency, TradeType>, public options: SwapOptions) {\n    if (!!options.fee && !!options.flatFee) throw new Error('Only one fee option permitted')\n\n    if (this.inputRequiresWrap || this.inputRequiresUnwrap || this.options.useRouterBalance) {\n      this.payerIsUser = false\n    } else {\n      this.payerIsUser = true\n    }\n  }\n\n  get isAllV4(): boolean {\n    let result = true\n    for (const swap of this.trade.swaps) {\n      result = result && swap.route.protocol == Protocol.V4\n    }\n    return result\n  }\n\n  // this.trade.swaps is an array of swaps / trades.\n  // we are iterating over one swap (trade) at a time so length is 1\n  // route is either v2, v3, v4, or mixed\n  // pathInput and pathOutput are the currencies of the input and output of the route\n  // this.trade.inputAmount is the input currency of the trade (could be different from pathInput)\n  // this.trade.outputAmount is the output currency of the trade (could be different from pathOutput)\n  // each route can have multiple pools\n  get inputRequiresWrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const route = swap.route\n    const firstPool = route.pools[0]\n\n    if (firstPool instanceof V4Pool) {\n      // If first pool is a v4 pool and input currency is native and the path input currency in the route is not native, we need to wrap.\n      return (\n        this.trade.inputAmount.currency.isNative &&\n        !(this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathInput.isNative\n      )\n    }\n    // If first pool is not a v4 pool and input currency is native, we need to wrap\n    return this.trade.inputAmount.currency.isNative\n  }\n\n  get inputRequiresUnwrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const route = swap.route\n    const firstPool = route.pools[0]\n\n    if (firstPool instanceof V4Pool) {\n      // If the first pool is a v4 pool and input currency is not native and the path input currency is native, we need to unwrap\n      return (\n        !this.trade.inputAmount.currency.isNative &&\n        (this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathInput.isNative\n      )\n    }\n    // If the first pool is not a v4 pool, we don't need to unwrap.\n    return false\n  }\n\n  get outputRequiresWrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const lastRoute = swap.route\n    const lastPool = lastRoute.pools[lastRoute.pools.length - 1]\n\n    // if last pool is v4:\n    if (lastPool instanceof V4Pool) {\n      // If output currency is not native but path currency output is native, we need to wrap\n      if (!this.trade.outputAmount.currency.isNative) {\n        if ((lastRoute as unknown as V4Route<Currency, Currency>).pathOutput.isNative) {\n          // this means path output is native and we need to wrap\n          return true\n        } else if (lastPool.currency1.equals(lastPool.currency0.wrapped) && lastRoute.pools.length > 1) {\n          let poolBefore = lastRoute.pools[lastRoute.pools.length - 2]\n          // this means last pool is eth-weth and pool before contains weth\n          if (\n            poolBefore instanceof V4Pool &&\n            (poolBefore.currency0.equals(lastPool.currency1) || poolBefore.currency1.equals(lastPool.currency1))\n          ) {\n            return true\n          } else if (poolBefore.token0.equals(lastPool.currency1) || poolBefore.token1.equals(lastPool.currency1)) {\n            // same for v2 and v3 pools\n            return true\n          }\n        }\n      }\n    }\n    // if last pool is not v4:\n    // we do not need to wrap because v2 and v3 pools already require wrapped tokens\n    return false\n  }\n\n  get outputRequiresUnwrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const lastRoute = swap.route\n    const lastPool = lastRoute.pools[lastRoute.pools.length - 1]\n\n    // if last pool is v4:\n    if (lastPool instanceof V4Pool) {\n      // If output currency is native and path currency output is not native, we need to unwrap\n      if (this.trade.outputAmount.currency.isNative) {\n        if (!(this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathOutput.isNative) {\n          // this means path output is weth and we need to unwrap\n          return true\n        } else if (\n          lastRoute.pools.length > 1 &&\n          lastRoute.pools[lastRoute.pools.length - 2] instanceof V4Pool &&\n          (lastRoute.pools[lastRoute.pools.length - 2] as V4Pool).currency0.isNative &&\n          lastPool.currency1.equals(lastPool.currency0.wrapped)\n        ) {\n          // this means last pool is eth-weth and we need to unwrap\n          return true\n        } else {\n          return false\n        }\n      }\n    }\n    // else: if path output currency is native, we need to unwrap because v2 and v3 pools already require wrapped tokens\n    return this.trade.outputAmount.currency.isNative\n  }\n\n  get outputRequiresTransition(): boolean {\n    return this.outputRequiresWrap || this.outputRequiresUnwrap\n  }\n\n  encode(planner: RoutePlanner, _config: TradeConfig): void {\n    // If the input currency is the native currency, we need to wrap it with the router as the recipient\n    if (this.inputRequiresWrap) {\n      // TODO: optimize if only one v2 pool we can directly send this to the pool\n      planner.addCommand(CommandType.WRAP_ETH, [\n        ROUTER_AS_RECIPIENT,\n        this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString(),\n      ])\n    } else if (this.inputRequiresUnwrap) {\n      // send wrapped token to router to unwrap\n      planner.addCommand(CommandType.PERMIT2_TRANSFER_FROM, [\n        (this.trade.inputAmount.currency as Token).address,\n        ROUTER_AS_RECIPIENT,\n        this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString(),\n      ])\n      planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, 0])\n    }\n    // The overall recipient at the end of the trade, SENDER_AS_RECIPIENT uses the msg.sender\n    this.options.recipient = this.options.recipient ?? SENDER_AS_RECIPIENT\n\n    // flag for whether we want to perform slippage check on aggregate output of multiple routes\n    //   1. when there are >2 exact input trades. this is only a heuristic,\n    //      as it's still more gas-expensive even in this case, but has benefits\n    //      in that the reversion probability is lower\n    const performAggregatedSlippageCheck =\n      this.trade.tradeType === TradeType.EXACT_INPUT && this.trade.routes.length > 2\n    const routerMustCustody =\n      performAggregatedSlippageCheck || this.outputRequiresTransition || hasFeeOption(this.options)\n\n    for (const swap of this.trade.swaps) {\n      switch (swap.route.protocol) {\n        case Protocol.V2:\n          addV2Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.V3:\n          addV3Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.V4:\n          addV4Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.MIXED:\n          addMixedSwap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        default:\n          throw new Error('UNSUPPORTED_TRADE_PROTOCOL')\n      }\n    }\n\n    let minimumAmountOut: BigNumber = BigNumber.from(\n      this.trade.minimumAmountOut(this.options.slippageTolerance).quotient.toString()\n    )\n    // The router custodies for 3 reasons: to unwrap, to take a fee, and/or to do a slippage check\n    if (routerMustCustody) {\n      const pools = this.trade.swaps[0].route.pools\n      const pathOutputCurrencyAddress = getCurrencyAddress(\n        getPathCurrency(this.trade.outputAmount.currency, pools[pools.length - 1])\n      )\n\n      // If there is a fee, that percentage is sent to the fee recipient\n      // In the case where ETH is the output currency, the fee is taken in WETH (for gas reasons)\n      if (!!this.options.fee) {\n        const feeBips = encodeFeeBips(this.options.fee.fee)\n        planner.addCommand(CommandType.PAY_PORTION, [pathOutputCurrencyAddress, this.options.fee.recipient, feeBips])\n\n        // If the trade is exact output, and a fee was taken, we must adjust the amount out to be the amount after the fee\n        // Otherwise we continue as expected with the trade's normal expected output\n        if (this.trade.tradeType === TradeType.EXACT_OUTPUT) {\n          minimumAmountOut = minimumAmountOut.sub(minimumAmountOut.mul(feeBips).div(10000))\n        }\n      }\n\n      // If there is a flat fee, that absolute amount is sent to the fee recipient\n      // In the case where ETH is the output currency, the fee is taken in WETH (for gas reasons)\n      if (!!this.options.flatFee) {\n        const feeAmount = this.options.flatFee.amount\n        if (minimumAmountOut.lt(feeAmount)) throw new Error('Flat fee amount greater than minimumAmountOut')\n\n        planner.addCommand(CommandType.TRANSFER, [pathOutputCurrencyAddress, this.options.flatFee.recipient, feeAmount])\n\n        // If the trade is exact output, and a fee was taken, we must adjust the amount out to be the amount after the fee\n        // Otherwise we continue as expected with the trade's normal expected output\n        if (this.trade.tradeType === TradeType.EXACT_OUTPUT) {\n          minimumAmountOut = minimumAmountOut.sub(feeAmount)\n        }\n      }\n\n      // The remaining tokens that need to be sent to the user after the fee is taken will be caught\n      // by this if-else clause.\n      if (this.outputRequiresUnwrap) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [this.options.recipient, minimumAmountOut])\n      } else if (this.outputRequiresWrap) {\n        planner.addCommand(CommandType.WRAP_ETH, [this.options.recipient, CONTRACT_BALANCE])\n      } else {\n        planner.addCommand(CommandType.SWEEP, [\n          getCurrencyAddress(this.trade.outputAmount.currency),\n          this.options.recipient,\n          minimumAmountOut,\n        ])\n      }\n    }\n\n    // for exactOutput swaps with native input or that perform an inputToken transition (wrap or unwrap)\n    // we need to send back the change to the user\n    if (this.trade.tradeType === TradeType.EXACT_OUTPUT || riskOfPartialFill(this.trade)) {\n      if (this.inputRequiresWrap) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [this.options.recipient, 0])\n      } else if (this.inputRequiresUnwrap) {\n        planner.addCommand(CommandType.WRAP_ETH, [this.options.recipient, CONTRACT_BALANCE])\n      } else if (this.trade.inputAmount.currency.isNative) {\n        // must refund extra native currency sent along for native v4 trades (no input transition)\n        planner.addCommand(CommandType.SWEEP, [ETH_ADDRESS, this.options.recipient, 0])\n      }\n    }\n\n    if (this.options.safeMode) planner.addCommand(CommandType.SWEEP, [ETH_ADDRESS, this.options.recipient, 0])\n  }\n}\n\n// encode a uniswap v2 swap\nfunction addV2Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { route, inputAmount, outputAmount }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const trade = new V2Trade(\n    route as RouteV2<TInput, TOutput>,\n    tradeType == TradeType.EXACT_INPUT ? inputAmount : outputAmount,\n    tradeType\n  )\n\n  if (tradeType == TradeType.EXACT_INPUT) {\n    planner.addCommand(CommandType.V2_SWAP_EXACT_IN, [\n      // if native, we have to unwrap so keep in the router for now\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      // if router will custody funds, we do aggregated slippage check from router\n      routerMustCustody ? 0 : trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      route.path.map((token) => token.wrapped.address),\n      payerIsUser,\n    ])\n  } else if (tradeType == TradeType.EXACT_OUTPUT) {\n    planner.addCommand(CommandType.V2_SWAP_EXACT_OUT, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      route.path.map((token) => token.wrapped.address),\n      payerIsUser,\n    ])\n  }\n}\n\n// encode a uniswap v3 swap\nfunction addV3Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { route, inputAmount, outputAmount }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const trade = V3Trade.createUncheckedTrade({\n    route: route as RouteV3<TInput, TOutput>,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const path = encodeRouteToPath(route as RouteV3<TInput, TOutput>, trade.tradeType === TradeType.EXACT_OUTPUT)\n  if (tradeType == TradeType.EXACT_INPUT) {\n    planner.addCommand(CommandType.V3_SWAP_EXACT_IN, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      routerMustCustody ? 0 : trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      path,\n      payerIsUser,\n    ])\n  } else if (tradeType == TradeType.EXACT_OUTPUT) {\n    planner.addCommand(CommandType.V3_SWAP_EXACT_OUT, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      path,\n      payerIsUser,\n    ])\n  }\n}\n\nfunction addV4Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { inputAmount, outputAmount, route }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  // create a deep copy of pools since v4Planner encoding tampers with array\n  const pools = route.pools.map((p) => p) as V4Pool[]\n  const v4Route = new V4Route(pools, inputAmount.currency, outputAmount.currency)\n  const trade = V4Trade.createUncheckedTrade({\n    route: v4Route,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const slippageToleranceOnSwap =\n    routerMustCustody && tradeType == TradeType.EXACT_INPUT ? undefined : options.slippageTolerance\n\n  const v4Planner = new V4Planner()\n  v4Planner.addTrade(trade, slippageToleranceOnSwap)\n  v4Planner.addSettle(trade.route.pathInput, payerIsUser)\n\n  // Handle split route output consistency:\n  // - If output is ETH and some routes output WETH: force all to output WETH, then unwrap\n  // - If output is WETH and some routes output ETH: force all to output ETH, then wrap\n  let pathOutputForTake = trade.route.pathOutput\n  let lastPool = v4Route.pools[v4Route.pools.length - 1]\n  let ethWethPool = lastPool.currency1.equals(lastPool.currency0.wrapped)\n\n  if (ethWethPool && v4Route.pools.length > 1) {\n    let poolBefore = v4Route.pools[v4Route.pools.length - 2]\n    if (pathOutputForTake.isNative && poolBefore.currency0.isNative) {\n      pathOutputForTake = pathOutputForTake.wrapped\n    } else if (\n      !pathOutputForTake.isNative &&\n      (poolBefore.currency0.equals(lastPool.currency1) || poolBefore.currency1.equals(lastPool.currency1))\n    ) {\n      pathOutputForTake = lastPool.currency0\n    }\n  }\n\n  v4Planner.addTake(\n    pathOutputForTake,\n    routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient ?? SENDER_AS_RECIPIENT\n  )\n  planner.addCommand(CommandType.V4_SWAP, [v4Planner.finalize()])\n}\n\n// encode a mixed route swap, i.e. including both v2 and v3 pools\nfunction addMixedSwap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  swap: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const route = swap.route as MixedRoute<TInput, TOutput>\n  const inputAmount = swap.inputAmount\n  const outputAmount = swap.outputAmount\n  const tradeRecipient = routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient ?? SENDER_AS_RECIPIENT\n\n  // single hop, so it can be reduced to plain swap logic for one protocol version\n  if (route.pools.length === 1) {\n    if (route.pools[0] instanceof V4Pool) {\n      return addV4Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else if (route.pools[0] instanceof V3Pool) {\n      return addV3Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else if (route.pools[0] instanceof Pair) {\n      return addV2Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else {\n      throw new Error('Invalid route type')\n    }\n  }\n\n  const trade = MixedRouteTrade.createUncheckedTrade({\n    route: route as MixedRoute<TInput, TOutput>,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const amountIn = trade.maximumAmountIn(options.slippageTolerance, inputAmount).quotient.toString()\n  const amountOut = routerMustCustody\n    ? 0\n    : trade.minimumAmountOut(options.slippageTolerance, outputAmount).quotient.toString()\n\n  // logic from\n  // https://github.com/Uniswap/router-sdk/blob/d8eed164e6c79519983844ca8b6a3fc24ebcb8f8/src/swapRouter.ts#L276\n  const sections = partitionMixedRouteByProtocol(route as MixedRoute<TInput, TOutput>)\n  const isLastSectionInRoute = (i: number) => {\n    return i === sections.length - 1\n  }\n\n  let inputToken = route.pathInput\n\n  for (let i = 0; i < sections.length; i++) {\n    const section = sections[i]\n    const routePool = section[0]\n    const outputToken = getOutputOfPools(section, inputToken)\n    const subRoute = new MixedRoute(new MixedRouteSDK([...section], inputToken, outputToken))\n\n    let nextInputToken\n    let swapRecipient\n\n    if (isLastSectionInRoute(i)) {\n      nextInputToken = outputToken\n      swapRecipient = tradeRecipient\n    } else {\n      const nextPool = sections[i + 1][0]\n      nextInputToken = getPathCurrency(outputToken, nextPool)\n\n      const v2PoolIsSwapRecipient = nextPool instanceof Pair && outputToken.equals(nextInputToken)\n      swapRecipient = v2PoolIsSwapRecipient ? (nextPool as Pair).liquidityToken.address : ROUTER_AS_RECIPIENT\n    }\n\n    if (routePool instanceof V4Pool) {\n      const v4Planner = new V4Planner()\n      const v4SubRoute = new V4Route(section as V4Pool[], subRoute.input, subRoute.output)\n\n      v4Planner.addSettle(inputToken, payerIsUser && i === 0, (i == 0 ? amountIn : CONTRACT_BALANCE) as BigNumber)\n      v4Planner.addAction(Actions.SWAP_EXACT_IN, [\n        {\n          currencyIn: inputToken.isNative ? ETH_ADDRESS : inputToken.address,\n          path: encodeV4RouteToPath(v4SubRoute),\n          amountIn: 0, // denotes open delta, amount set in v4Planner.addSettle()\n          amountOutMinimum: !isLastSectionInRoute(i) ? 0 : amountOut,\n        },\n      ])\n\n      // Handle split route output consistency for V4 sections in mixed routes\n      let outputTokenForTake = outputToken\n      if (isLastSectionInRoute(i)) {\n        let lastPool = route.pools[route.pools.length - 1]\n        let v4Pool = lastPool instanceof V4Pool\n        let ethWethPool = v4Pool ? (lastPool as V4Pool).currency1.equals((lastPool as V4Pool).currency0.wrapped) : false\n        let poolBefore = route.pools[route.pools.length - 2]\n\n        if (ethWethPool) {\n          if (outputToken.isNative && poolBefore.token0.isNative) {\n            outputTokenForTake = outputToken.wrapped\n          } else if (\n            !outputToken.isNative &&\n            (poolBefore.token0.equals(lastPool.token1) || poolBefore.token1.equals(lastPool.token1))\n          ) {\n            outputTokenForTake = lastPool.token0\n          }\n        }\n      }\n\n      v4Planner.addTake(outputTokenForTake, swapRecipient)\n\n      planner.addCommand(CommandType.V4_SWAP, [v4Planner.finalize()])\n    } else if (routePool instanceof V3Pool) {\n      planner.addCommand(CommandType.V3_SWAP_EXACT_IN, [\n        swapRecipient, // recipient\n        i == 0 ? amountIn : CONTRACT_BALANCE, // amountIn\n        !isLastSectionInRoute(i) ? 0 : amountOut, // amountOut\n        encodeMixedRouteToPath(subRoute), // path\n        payerIsUser && i === 0, // payerIsUser\n      ])\n    } else if (routePool instanceof Pair) {\n      planner.addCommand(CommandType.V2_SWAP_EXACT_IN, [\n        swapRecipient, // recipient\n        i === 0 ? amountIn : CONTRACT_BALANCE, // amountIn\n        !isLastSectionInRoute(i) ? 0 : amountOut, // amountOutMin\n        subRoute.path.map((token) => token.wrapped.address), // path\n        payerIsUser && i === 0,\n      ])\n    } else {\n      throw new Error('Unexpected Pool Type')\n    }\n\n    // perform a token transition (wrap/unwrap if necessary)\n    if (!isLastSectionInRoute(i)) {\n      if (outputToken.isNative && !nextInputToken.isNative) {\n        planner.addCommand(CommandType.WRAP_ETH, [ROUTER_AS_RECIPIENT, CONTRACT_BALANCE])\n      } else if (!outputToken.isNative && nextInputToken.isNative) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, 0])\n      }\n    }\n\n    inputToken = nextInputToken\n  }\n}\n\n// if price impact is very high, there's a chance of hitting max/min prices resulting in a partial fill of the swap\nfunction riskOfPartialFill(trade: RouterTrade<Currency, Currency, TradeType>): boolean {\n  return trade.priceImpact.greaterThan(REFUND_ETH_PRICE_IMPACT_THRESHOLD)\n}\n\nfunction hasFeeOption(swapOptions: SwapOptions): boolean {\n  return !!swapOptions.fee || !!swapOptions.flatFee\n}\n","import invariant from 'tiny-invariant'\nimport { ethers } from 'ethers'\nimport { validateAndParseAddress, BigintIsh } from '@uniswap/sdk-core'\nimport { NFTPermitOptions, NonfungiblePositionManager } from '@uniswap/v3-sdk'\nimport { PermitSingle } from '@uniswap/permit2-sdk'\nimport { CommandType, RoutePlanner } from './routerCommands'\nimport { ROUTER_AS_RECIPIENT } from './constants'\n\nexport interface Permit2Permit extends PermitSingle {\n  signature: string\n}\n\nexport type ApproveProtocol = {\n  token: string\n  protocol: string\n}\n\nexport type Permit2TransferFrom = {\n  token: string\n  amount: string\n  recipient?: string\n}\n\nexport type InputTokenOptions = {\n  permit2Permit?: Permit2Permit\n  permit2TransferFrom?: Permit2TransferFrom\n}\n\nconst SIGNATURE_LENGTH = 65\nconst EIP_2098_SIGNATURE_LENGTH = 64\n\nexport function encodePermit(planner: RoutePlanner, permit2: Permit2Permit): void {\n  let signature = permit2.signature\n\n  const length = ethers.utils.arrayify(permit2.signature).length\n  // signature data provided for EIP-1271 may have length different from ECDSA signature\n  if (length === SIGNATURE_LENGTH || length === EIP_2098_SIGNATURE_LENGTH) {\n    // sanitizes signature to cover edge cases of malformed EIP-2098 sigs and v used as recovery id\n    signature = ethers.utils.joinSignature(ethers.utils.splitSignature(permit2.signature))\n  }\n\n  planner.addCommand(CommandType.PERMIT2_PERMIT, [permit2, signature])\n}\n\nexport function encodeV3PositionPermit(planner: RoutePlanner, permit: NFTPermitOptions, tokenId: BigintIsh): void {\n  const calldata = NonfungiblePositionManager.INTERFACE.encodeFunctionData('permit', [\n    validateAndParseAddress(permit.spender),\n    tokenId,\n    permit.deadline,\n    permit.v,\n    permit.r,\n    permit.s,\n  ])\n\n  planner.addCommand(CommandType.V3_POSITION_MANAGER_PERMIT, [calldata])\n}\n\n// Handles the encoding of commands needed to gather input tokens for a trade\n// Approval: The router approving another address to take tokens.\n//   note: Only seaport and sudoswap support this action. Approvals are left open.\n// Permit: A Permit2 signature-based Permit to allow the router to access a user's tokens\n// Transfer: A Permit2 TransferFrom of tokens from a user to either the router or another address\nexport function encodeInputTokenOptions(planner: RoutePlanner, options: InputTokenOptions) {\n  // first ensure that all tokens provided for encoding are the same\n  if (!!options.permit2TransferFrom && !!options.permit2Permit)\n    invariant(options.permit2TransferFrom.token === options.permit2Permit.details.token, `inconsistent token`)\n\n  // if this order has a options.permit2Permit, encode it\n  if (!!options.permit2Permit) {\n    encodePermit(planner, options.permit2Permit)\n  }\n\n  if (!!options.permit2TransferFrom) {\n    planner.addCommand(CommandType.PERMIT2_TRANSFER_FROM, [\n      options.permit2TransferFrom.token,\n      options.permit2TransferFrom.recipient ? options.permit2TransferFrom.recipient : ROUTER_AS_RECIPIENT,\n      options.permit2TransferFrom.amount,\n    ])\n  }\n}\n","import invariant from 'tiny-invariant'\nimport UniversalRouter from '@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json'\nimport { Interface } from '@ethersproject/abi'\nimport { BigNumber, BigNumberish } from 'ethers'\nimport {\n  MethodParameters,\n  Multicall,\n  Position as V3Position,\n  NonfungiblePositionManager as V3PositionManager,\n  RemoveLiquidityOptions as V3RemoveLiquidityOptions,\n} from '@uniswap/v3-sdk'\nimport {\n  Position as V4Position,\n  V4PositionManager,\n  AddLiquidityOptions as V4AddLiquidityOptions,\n  MintOptions,\n  Pool as V4Pool,\n  PoolKey,\n} from '@uniswap/v4-sdk'\nimport { Trade as RouterTrade } from '@uniswap/router-sdk'\nimport { Currency, TradeType, Percent, CHAIN_TO_ADDRESSES_MAP, SupportedChainsType } from '@uniswap/sdk-core'\nimport { UniswapTrade, SwapOptions } from './entities/actions/uniswap'\nimport { RoutePlanner, CommandType } from './utils/routerCommands'\nimport { encodePermit, encodeV3PositionPermit } from './utils/inputTokens'\nimport { UNIVERSAL_ROUTER_ADDRESS, UniversalRouterVersion } from './utils/constants'\n\nexport type SwapRouterConfig = {\n  sender?: string // address\n  deadline?: BigNumberish\n}\n\nexport interface MigrateV3ToV4Options {\n  inputPosition: V3Position\n  outputPosition: V4Position\n  v3RemoveLiquidityOptions: V3RemoveLiquidityOptions\n  v4AddLiquidityOptions: V4AddLiquidityOptions\n}\n\nfunction isMint(options: V4AddLiquidityOptions): options is MintOptions {\n  return Object.keys(options).some((k) => k === 'recipient')\n}\n\nexport abstract class SwapRouter {\n  public static INTERFACE: Interface = new Interface(UniversalRouter.abi)\n\n  public static swapCallParameters(\n    trades: RouterTrade<Currency, Currency, TradeType>,\n    options: SwapOptions\n  ): MethodParameters {\n    // TODO: use permit if signature included in swapOptions\n    const planner = new RoutePlanner()\n\n    const trade: UniswapTrade = new UniswapTrade(trades, options)\n\n    const inputCurrency = trade.trade.inputAmount.currency\n    invariant(!(inputCurrency.isNative && !!options.inputTokenPermit), 'NATIVE_INPUT_PERMIT')\n\n    if (options.inputTokenPermit) {\n      encodePermit(planner, options.inputTokenPermit)\n    }\n\n    const nativeCurrencyValue = inputCurrency.isNative\n      ? BigNumber.from(trade.trade.maximumAmountIn(options.slippageTolerance).quotient.toString())\n      : BigNumber.from(0)\n\n    trade.encode(planner, { allowRevert: false })\n    return SwapRouter.encodePlan(planner, nativeCurrencyValue, {\n      deadline: options.deadlineOrPreviousBlockhash ? BigNumber.from(options.deadlineOrPreviousBlockhash) : undefined,\n    })\n  }\n\n  /**\n   * Builds the call parameters for a migration from a V3 position to a V4 position.\n   * Some requirements of the parameters:\n   *   - v3RemoveLiquidityOptions.collectOptions.recipient must equal v4PositionManager\n   *   - v3RemoveLiquidityOptions.liquidityPercentage must be 100%\n   *   - input pool and output pool must have the same tokens\n   *   - V3 NFT must be approved, or valid inputV3NFTPermit must be provided with UR as spender\n   */\n  public static migrateV3ToV4CallParameters(\n    options: MigrateV3ToV4Options,\n    positionManagerOverride?: string\n  ): MethodParameters {\n    const v4Pool: V4Pool = options.outputPosition.pool\n    const v3Token0 = options.inputPosition.pool.token0\n    const v3Token1 = options.inputPosition.pool.token1\n    const v4PositionManagerAddress =\n      positionManagerOverride ?? CHAIN_TO_ADDRESSES_MAP[v4Pool.chainId as SupportedChainsType].v4PositionManagerAddress\n\n    // owner of the v3 nft must be the receiver of the v4 nft\n\n    // validate the parameters\n    if (v4Pool.currency0.isNative) {\n      invariant(\n        (v4Pool.currency0.wrapped.equals(v3Token0) && v4Pool.currency1.equals(v3Token1)) ||\n          (v4Pool.currency0.wrapped.equals(v3Token1) && v4Pool.currency1.equals(v3Token0)),\n        'TOKEN_MISMATCH'\n      )\n    } else {\n      invariant(v3Token0 === v4Pool.token0, 'TOKEN0_MISMATCH')\n      invariant(v3Token1 === v4Pool.token1, 'TOKEN1_MISMATCH')\n    }\n\n    invariant(\n      options.v3RemoveLiquidityOptions.liquidityPercentage.equalTo(new Percent(100, 100)),\n      'FULL_REMOVAL_REQUIRED'\n    )\n    invariant(options.v3RemoveLiquidityOptions.burnToken == true, 'BURN_TOKEN_REQUIRED')\n    invariant(\n      options.v3RemoveLiquidityOptions.collectOptions.recipient === v4PositionManagerAddress,\n      'RECIPIENT_NOT_POSITION_MANAGER'\n    )\n    invariant(isMint(options.v4AddLiquidityOptions), 'MINT_REQUIRED')\n    invariant(options.v4AddLiquidityOptions.migrate, 'MIGRATE_REQUIRED')\n\n    const planner = new RoutePlanner()\n\n    // to prevent reentrancy by the pool hook, we initialize the v4 pool before moving funds\n    if (options.v4AddLiquidityOptions.createPool) {\n      const poolKey: PoolKey = V4Pool.getPoolKey(\n        v4Pool.currency0,\n        v4Pool.currency1,\n        v4Pool.fee,\n        v4Pool.tickSpacing,\n        v4Pool.hooks\n      )\n      planner.addCommand(CommandType.V4_INITIALIZE_POOL, [poolKey, v4Pool.sqrtRatioX96.toString()])\n      // remove createPool setting, so that it doesnt get encoded again later\n      delete options.v4AddLiquidityOptions.createPool\n    }\n\n    // add position permit to the universal router planner\n    if (options.v3RemoveLiquidityOptions.permit) {\n      // permit spender should be UR\n      const universalRouterAddress = UNIVERSAL_ROUTER_ADDRESS(\n        UniversalRouterVersion.V2_0,\n        options.inputPosition.pool.chainId as SupportedChainsType\n      )\n      invariant(universalRouterAddress == options.v3RemoveLiquidityOptions.permit.spender, 'INVALID_SPENDER')\n      // don't need to transfer it because v3posm uses isApprovedOrOwner()\n      encodeV3PositionPermit(planner, options.v3RemoveLiquidityOptions.permit, options.v3RemoveLiquidityOptions.tokenId)\n      // remove permit so that multicall doesnt add it again\n      delete options.v3RemoveLiquidityOptions.permit\n    }\n\n    // encode v3 withdraw\n    const v3RemoveParams: MethodParameters = V3PositionManager.removeCallParameters(\n      options.inputPosition,\n      options.v3RemoveLiquidityOptions\n    )\n    const v3Calls: string[] = Multicall.decodeMulticall(v3RemoveParams.calldata)\n\n    for (const v3Call of v3Calls) {\n      // slice selector - 0x + 4 bytes = 10 characters\n      const selector = v3Call.slice(0, 10)\n      invariant(\n        selector == V3PositionManager.INTERFACE.getSighash('collect') ||\n          selector == V3PositionManager.INTERFACE.getSighash('decreaseLiquidity') ||\n          selector == V3PositionManager.INTERFACE.getSighash('burn'),\n        'INVALID_V3_CALL: ' + selector\n      )\n      planner.addCommand(CommandType.V3_POSITION_MANAGER_CALL, [v3Call])\n    }\n\n    // encode v4 mint\n    const v4AddParams = V4PositionManager.addCallParameters(options.outputPosition, options.v4AddLiquidityOptions)\n    // only modifyLiquidities can be called by the UniversalRouter\n    const selector = v4AddParams.calldata.slice(0, 10)\n    invariant(selector == V4PositionManager.INTERFACE.getSighash('modifyLiquidities'), 'INVALID_V4_CALL: ' + selector)\n\n    planner.addCommand(CommandType.V4_POSITION_MANAGER_CALL, [v4AddParams.calldata])\n\n    return SwapRouter.encodePlan(planner, BigNumber.from(0), {\n      deadline: BigNumber.from(options.v4AddLiquidityOptions.deadline),\n    })\n  }\n\n  /**\n   * Encodes a planned route into a method name and parameters for the Router contract.\n   * @param planner the planned route\n   * @param nativeCurrencyValue the native currency value of the planned route\n   * @param config the router config\n   */\n  private static encodePlan(\n    planner: RoutePlanner,\n    nativeCurrencyValue: BigNumber,\n    config: SwapRouterConfig = {}\n  ): MethodParameters {\n    const { commands, inputs } = planner\n    const functionSignature = !!config.deadline ? 'execute(bytes,bytes[],uint256)' : 'execute(bytes,bytes[])'\n    const parameters = !!config.deadline ? [commands, inputs, config.deadline] : [commands, inputs]\n    const calldata = SwapRouter.INTERFACE.encodeFunctionData(functionSignature, parameters)\n    return { calldata, value: nativeCurrencyValue.toHexString() }\n  }\n}\n","import invariant from 'tiny-invariant'\nimport { BigNumberish } from 'ethers'\nimport { RoutePlanner, CommandType } from '../../utils/routerCommands'\nimport { encodeInputTokenOptions, Permit2Permit } from '../../utils/inputTokens'\nimport { Command, RouterActionType, TradeConfig } from '../Command'\nimport { ROUTER_AS_RECIPIENT, WETH_ADDRESS } from '../../utils/constants'\n\nexport class UnwrapWETH implements Command {\n  readonly tradeType: RouterActionType = RouterActionType.UnwrapWETH\n  readonly permit2Data?: Permit2Permit\n  readonly wethAddress: string\n  readonly amount: BigNumberish\n\n  constructor(amount: BigNumberish, chainId: number, permit2?: Permit2Permit) {\n    this.wethAddress = WETH_ADDRESS(chainId)\n    this.amount = amount\n\n    if (!!permit2) {\n      invariant(\n        permit2.details.token.toLowerCase() === this.wethAddress.toLowerCase(),\n        `must be permitting WETH address: ${this.wethAddress}`\n      )\n      invariant(permit2.details.amount >= amount, `Did not permit enough WETH for unwrapWETH transaction`)\n      this.permit2Data = permit2\n    }\n  }\n\n  encode(planner: RoutePlanner, _: TradeConfig): void {\n    encodeInputTokenOptions(planner, {\n      permit2Permit: this.permit2Data,\n      permit2TransferFrom: {\n        token: this.wethAddress,\n        amount: this.amount.toString(),\n      },\n    })\n    planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, this.amount])\n  }\n}\n","import { MixedRouteSDK, Trade as RouterTrade } from '@uniswap/router-sdk'\nimport { Currency, CurrencyAmount, Ether, Token, TradeType } from '@uniswap/sdk-core'\nimport { Pair, Route as V2Route } from '@uniswap/v2-sdk'\nimport { Pool as V3Pool, Route as V3Route, FeeAmount } from '@uniswap/v3-sdk'\nimport { Pool as V4Pool, Route as V4Route } from '@uniswap/v4-sdk'\nimport { BigNumber } from 'ethers'\nimport { ETH_ADDRESS, E_ETH_ADDRESS } from './constants'\n\nexport type TokenInRoute = {\n  address: string\n  chainId: number\n  symbol: string\n  decimals: string\n  name?: string\n  buyFeeBps?: string\n  sellFeeBps?: string\n}\n\nexport enum PoolType {\n  V2Pool = 'v2-pool',\n  V3Pool = 'v3-pool',\n  V4Pool = 'v4-pool',\n}\n\nexport type V2Reserve = {\n  token: TokenInRoute\n  quotient: string\n}\n\nexport type V2PoolInRoute = {\n  type: PoolType.V2Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  reserve0: V2Reserve\n  reserve1: V2Reserve\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type V3PoolInRoute = {\n  type: PoolType.V3Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  sqrtRatioX96: string\n  liquidity: string\n  tickCurrent: string\n  fee: string\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type V4PoolInRoute = {\n  type: PoolType.V4Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  fee: string\n  tickSpacing: string\n  hooks: string\n  liquidity: string\n  sqrtRatioX96: string\n  tickCurrent: string\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type PartialClassicQuote = {\n  // We need tokenIn/Out to support native currency\n  tokenIn: string\n  tokenOut: string\n  tradeType: TradeType\n  route: Array<(V4PoolInRoute | V3PoolInRoute | V2PoolInRoute)[]>\n}\n\ninterface RouteResult {\n  routev4: V4Route<Currency, Currency> | null\n  routev3: V3Route<Currency, Currency> | null\n  routev2: V2Route<Currency, Currency> | null\n  mixedRoute: MixedRouteSDK<Currency, Currency> | null\n  inputAmount: CurrencyAmount<Currency>\n  outputAmount: CurrencyAmount<Currency>\n}\n\nexport const isNativeCurrency = (address: string) =>\n  address.toLowerCase() === ETH_ADDRESS.toLowerCase() || address.toLowerCase() === E_ETH_ADDRESS.toLowerCase()\n\n// Helper class to convert routing-specific quote entities to RouterTrade entities\n// the returned RouterTrade can then be used to build the UniswapTrade entity in this package\nexport class RouterTradeAdapter {\n  // Generate a RouterTrade using fields from a classic quote response\n  static fromClassicQuote(quote: PartialClassicQuote) {\n    const { route, tokenIn, tokenOut } = quote\n\n    if (!route) throw new Error('Expected route to be present')\n    if (!route.length) throw new Error('Expected there to be at least one route')\n    if (route.some((r) => !r.length)) throw new Error('Expected all routes to have at least one pool')\n    const firstRoute = route[0]\n\n    const tokenInData = firstRoute[0].tokenIn\n    const tokenOutData = firstRoute[firstRoute.length - 1].tokenOut\n\n    if (!tokenInData || !tokenOutData) throw new Error('Expected both tokenIn and tokenOut to be present')\n    if (tokenInData.chainId !== tokenOutData.chainId)\n      throw new Error('Expected tokenIn and tokenOut to be have same chainId')\n\n    const parsedCurrencyIn = RouterTradeAdapter.toCurrency(isNativeCurrency(tokenIn), tokenInData)\n    const parsedCurrencyOut = RouterTradeAdapter.toCurrency(isNativeCurrency(tokenOut), tokenOutData)\n\n    const typedRoutes: RouteResult[] = route.map((subRoute) => {\n      const rawAmountIn = subRoute[0].amountIn\n      const rawAmountOut = subRoute[subRoute.length - 1].amountOut\n\n      if (!rawAmountIn || !rawAmountOut) {\n        throw new Error('Expected both raw amountIn and raw amountOut to be present')\n      }\n\n      const inputAmount = CurrencyAmount.fromRawAmount(parsedCurrencyIn, rawAmountIn)\n      const outputAmount = CurrencyAmount.fromRawAmount(parsedCurrencyOut, rawAmountOut)\n\n      const isOnlyV2 = RouterTradeAdapter.isVersionedRoute<V2PoolInRoute>(PoolType.V2Pool, subRoute)\n      const isOnlyV3 = RouterTradeAdapter.isVersionedRoute<V3PoolInRoute>(PoolType.V3Pool, subRoute)\n      const isOnlyV4 = RouterTradeAdapter.isVersionedRoute<V4PoolInRoute>(PoolType.V4Pool, subRoute)\n      return {\n        routev4: isOnlyV4\n          ? new V4Route(\n              (subRoute as V4PoolInRoute[]).map(RouterTradeAdapter.toV4Pool),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        routev3: isOnlyV3\n          ? new V3Route(\n              (subRoute as V3PoolInRoute[]).map(RouterTradeAdapter.toV3Pool),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        routev2: isOnlyV2\n          ? new V2Route(\n              (subRoute as V2PoolInRoute[]).map(RouterTradeAdapter.toPair),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        mixedRoute:\n          !isOnlyV4 && !isOnlyV3 && !isOnlyV2\n            ? new MixedRouteSDK(subRoute.map(RouterTradeAdapter.toPoolOrPair), parsedCurrencyIn, parsedCurrencyOut)\n            : null,\n        inputAmount,\n        outputAmount,\n      }\n    })\n\n    return new RouterTrade({\n      v2Routes: typedRoutes\n        .filter((route) => route.routev2)\n        .map((route) => ({\n          routev2: route.routev2 as V2Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      v3Routes: typedRoutes\n        .filter((route) => route.routev3)\n        .map((route) => ({\n          routev3: route.routev3 as V3Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      v4Routes: typedRoutes\n        .filter((route) => route.routev4)\n        .map((route) => ({\n          routev4: route.routev4 as V4Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      mixedRoutes: typedRoutes\n        .filter((route) => route.mixedRoute)\n        .map((route) => ({\n          mixedRoute: route.mixedRoute as MixedRouteSDK<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      tradeType: quote.tradeType,\n    })\n  }\n\n  private static toCurrency(isNative: boolean, token: TokenInRoute): Currency {\n    if (isNative) {\n      return Ether.onChain(token.chainId)\n    }\n    return this.toToken(token)\n  }\n\n  private static toPoolOrPair = (pool: V4PoolInRoute | V3PoolInRoute | V2PoolInRoute): V4Pool | V3Pool | Pair => {\n    switch (pool.type) {\n      case PoolType.V4Pool:\n        return RouterTradeAdapter.toV4Pool(pool)\n      case PoolType.V3Pool:\n        return RouterTradeAdapter.toV3Pool(pool)\n      case PoolType.V2Pool:\n        return RouterTradeAdapter.toPair(pool)\n      default:\n        throw new Error('Invalid pool type')\n    }\n  }\n\n  private static toToken(token: TokenInRoute): Token {\n    const { chainId, address, decimals, symbol, buyFeeBps, sellFeeBps } = token\n    return new Token(\n      chainId,\n      address,\n      parseInt(decimals.toString()),\n      symbol,\n      /* name */ undefined,\n      false,\n      buyFeeBps ? BigNumber.from(buyFeeBps) : undefined,\n      sellFeeBps ? BigNumber.from(sellFeeBps) : undefined\n    )\n  }\n\n  private static toV3Pool({ fee, sqrtRatioX96, liquidity, tickCurrent, tokenIn, tokenOut }: V3PoolInRoute): V3Pool {\n    return new V3Pool(\n      RouterTradeAdapter.toToken(tokenIn),\n      RouterTradeAdapter.toToken(tokenOut),\n      parseInt(fee) as FeeAmount,\n      sqrtRatioX96,\n      liquidity,\n      parseInt(tickCurrent)\n    )\n  }\n\n  private static toV4Pool(pool: V4PoolInRoute): V4Pool {\n    const parsedCurrencyIn = RouterTradeAdapter.toCurrency(isNativeCurrency(pool.tokenIn.address), pool.tokenIn)\n    const parsedCurrencyOut = RouterTradeAdapter.toCurrency(isNativeCurrency(pool.tokenOut.address), pool.tokenOut)\n    return new V4Pool(\n      parsedCurrencyIn,\n      parsedCurrencyOut,\n      parseInt(pool.fee) as FeeAmount,\n      parseInt(pool.tickSpacing),\n      pool.hooks,\n      pool.sqrtRatioX96,\n      pool.liquidity,\n      parseInt(pool.tickCurrent)\n    )\n  }\n\n  private static toPair = ({ reserve0, reserve1 }: V2PoolInRoute): Pair => {\n    return new Pair(\n      CurrencyAmount.fromRawAmount(RouterTradeAdapter.toToken(reserve0.token), reserve0.quotient),\n      CurrencyAmount.fromRawAmount(RouterTradeAdapter.toToken(reserve1.token), reserve1.quotient)\n    )\n  }\n\n  private static isVersionedRoute<T extends V2PoolInRoute | V3PoolInRoute | V4PoolInRoute>(\n    type: PoolType,\n    route: (V3PoolInRoute | V2PoolInRoute | V4PoolInRoute)[]\n  ): route is T[] {\n    return route.every((pool) => pool.type === type)\n  }\n}\n","import { ethers } from 'ethers'\nimport UniversalRouter from '@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json'\nimport { Interface } from '@ethersproject/abi'\nimport { V4BaseActionsParser, V4RouterAction } from '@uniswap/v4-sdk'\nimport { CommandType, CommandDefinition, COMMAND_DEFINITION, Subparser, Parser } from '../utils/routerCommands'\n\nexport type Param = {\n  readonly name: string\n  readonly value: any\n}\n\nexport type UniversalRouterCommand = {\n  readonly commandName: string\n  readonly commandType: CommandType\n  readonly params: readonly Param[]\n}\n\nexport type UniversalRouterCall = {\n  readonly commands: readonly UniversalRouterCommand[]\n}\n\nexport type V3PathItem = {\n  readonly tokenIn: string\n  readonly tokenOut: string\n  readonly fee: number\n}\n\nexport interface CommandsDefinition {\n  [key: number]: CommandDefinition\n}\n\n// Parses UniversalRouter V2 commands\nexport abstract class CommandParser {\n  public static INTERFACE: Interface = new Interface(UniversalRouter.abi)\n\n  public static parseCalldata(calldata: string): UniversalRouterCall {\n    const genericParser = new GenericCommandParser(COMMAND_DEFINITION)\n    const txDescription = CommandParser.INTERFACE.parseTransaction({ data: calldata })\n    const { commands, inputs } = txDescription.args\n    return genericParser.parse(commands, inputs)\n  }\n}\n\n// Parses commands based on given command definition\nexport class GenericCommandParser {\n  constructor(private readonly commandDefinition: CommandsDefinition) {}\n\n  public parse(commands: string, inputs: string[]): UniversalRouterCall {\n    const commandTypes = GenericCommandParser.getCommands(commands)\n\n    return {\n      commands: commandTypes.map((commandType: CommandType, i: number) => {\n        const commandDef = this.commandDefinition[commandType]\n\n        if (commandDef.parser === Parser.V4Actions) {\n          const { actions } = V4BaseActionsParser.parseCalldata(inputs[i])\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params: v4RouterCallToParams(actions),\n          }\n        } else if (commandDef.parser === Parser.Abi) {\n          const abiDef = commandDef.params\n          const rawParams = ethers.utils.defaultAbiCoder.decode(\n            abiDef.map((command) => command.type),\n            inputs[i]\n          )\n\n          const params = rawParams.map((param: any, j: number) => {\n            switch (abiDef[j].subparser) {\n              case Subparser.V3PathExactIn:\n                return {\n                  name: abiDef[j].name,\n                  value: parseV3PathExactIn(param),\n                }\n              case Subparser.V3PathExactOut:\n                return {\n                  name: abiDef[j].name,\n                  value: parseV3PathExactOut(param),\n                }\n              default:\n                return {\n                  name: abiDef[j].name,\n                  value: param,\n                }\n            }\n          })\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params,\n          }\n        } else if (commandDef.parser === Parser.V3Actions) {\n          // TODO: implement better parsing here\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params: inputs.map((input) => ({ name: 'command', value: input })),\n          }\n        } else {\n          throw new Error(`Unsupported parser: ${commandDef}`)\n        }\n      }),\n    }\n  }\n\n  // parse command types from bytes string\n  private static getCommands(commands: string): CommandType[] {\n    const commandTypes: CommandType[] = []\n\n    for (let i = 2; i < commands.length; i += 2) {\n      const byte = commands.substring(i, i + 2)\n      commandTypes.push(parseInt(byte, 16) as CommandType)\n    }\n\n    return commandTypes\n  }\n}\n\nexport function parseV3PathExactIn(path: string): readonly V3PathItem[] {\n  const strippedPath = path.replace('0x', '')\n  let tokenIn = ethers.utils.getAddress(strippedPath.substring(0, 40))\n  let loc = 40\n  const res: V3PathItem[] = []\n  while (loc < strippedPath.length) {\n    const feeAndTokenOut = strippedPath.substring(loc, loc + 46)\n    const fee = parseInt(feeAndTokenOut.substring(0, 6), 16)\n    const tokenOut = ethers.utils.getAddress(feeAndTokenOut.substring(6, 46))\n\n    res.push({\n      tokenIn,\n      tokenOut,\n      fee,\n    })\n    tokenIn = tokenOut\n    loc += 46\n  }\n\n  return res\n}\n\nexport function parseV3PathExactOut(path: string): readonly V3PathItem[] {\n  const strippedPath = path.replace('0x', '')\n  let tokenIn = ethers.utils.getAddress(strippedPath.substring(strippedPath.length - 40))\n  let loc = strippedPath.length - 86 // 86 = (20 addr + 3 fee + 20 addr) * 2 (for hex characters)\n  const res: V3PathItem[] = []\n  while (loc >= 0) {\n    const feeAndTokenOut = strippedPath.substring(loc, loc + 46)\n    const tokenOut = ethers.utils.getAddress(feeAndTokenOut.substring(0, 40))\n    const fee = parseInt(feeAndTokenOut.substring(40, 46), 16)\n\n    res.push({\n      tokenIn,\n      tokenOut,\n      fee,\n    })\n    tokenIn = tokenOut\n\n    loc -= 46\n  }\n\n  return res\n}\n\nfunction v4RouterCallToParams(actions: readonly V4RouterAction[]): readonly Param[] {\n  return actions.map((action) => {\n    return {\n      name: action.actionName,\n      value: action.params.map((param) => {\n        return {\n          name: param.name,\n          value: param.value,\n        }\n      }),\n    }\n  })\n}\n"],"names":["CommandType","Subparser","Parser","ALLOW_REVERT_FLAG","REVERTIBLE_COMMANDS","Set","EXECUTE_SUB_PLAN","PERMIT_STRUCT","PERMIT_BATCH_STRUCT","POOL_KEY_STRUCT","PERMIT2_TRANSFER_FROM_STRUCT","PERMIT2_TRANSFER_FROM_BATCH_STRUCT","COMMAND_DEFINITION","_COMMAND_DEFINITION","parser","Abi","params","name","type","PERMIT2_PERMIT","PERMIT2_PERMIT_BATCH","PERMIT2_TRANSFER_FROM","PERMIT2_TRANSFER_FROM_BATCH","V3_SWAP_EXACT_IN","subparser","V3PathExactIn","V3_SWAP_EXACT_OUT","V3PathExactOut","V2_SWAP_EXACT_IN","V2_SWAP_EXACT_OUT","V4_SWAP","V4Actions","WRAP_ETH","UNWRAP_WETH","SWEEP","TRANSFER","PAY_PORTION","BALANCE_CHECK_ERC20","V4_INITIALIZE_POOL","V3_POSITION_MANAGER_PERMIT","V3Actions","V3_POSITION_MANAGER_CALL","V4_POSITION_MANAGER_CALL","RoutePlanner","commands","inputs","_proto","prototype","addSubPlan","subplan","addCommand","parameters","allowRevert","command","createCommand","push","encodedInput","has","Error","concat","toString","padStart","commandDef","defaultAbiCoder","encode","map","abi","getPathCurrency","currency","pool","involvesToken","wrapped","V4Pool","token0","equals","token1","symbol","RouterActionType","UniversalRouterVersion","WETH_NOT_SUPPORTED_ON_CHAIN","CHAIN_CONFIGS","_CHAIN_CONFIGS","weth","routerConfigs","_routerConfigs","V1_2","address","creationBlock","V2_0","_routerConfigs2","_routerConfigs3","_routerConfigs4","_routerConfigs5","_routerConfigs6","_routerConfigs7","_routerConfigs8","_routerConfigs9","_routerConfigs0","_routerConfigs1","_routerConfigs10","_routerConfigs11","_routerConfigs12","_routerConfigs13","_routerConfigs14","_routerConfigs15","_routerConfigs16","_routerConfigs17","_routerConfigs18","_routerConfigs19","_routerConfigs20","_routerConfigs21","_routerConfigs22","_routerConfigs23","_routerConfigs24","UNIVERSAL_ROUTER_ADDRESS","version","chainId","UNIVERSAL_ROUTER_CREATION_BLOCK","WETH_ADDRESS","CONTRACT_BALANCE","BigNumber","from","pow","ETH_ADDRESS","E_ETH_ADDRESS","SENDER_AS_RECIPIENT","ROUTER_AS_RECIPIENT","getCurrencyAddress","isNative","encodeFeeBips","fee","toHex","multiply","quotient","REFUND_ETH_PRICE_IMPACT_THRESHOLD","Percent","UniswapTrade","trade","options","flatFee","inputRequiresWrap","inputRequiresUnwrap","useRouterBalance","payerIsUser","planner","_config","maximumAmountIn","slippageTolerance","inputAmount","recipient","_this$options$recipie","performAggregatedSlippageCheck","tradeType","TradeType","EXACT_INPUT","routes","length","routerMustCustody","outputRequiresTransition","hasFeeOption","_iterator","_createForOfIteratorHelperLoose","swaps","_step","done","swap","value","route","protocol","Protocol","V2","addV2Swap","V3","addV3Swap","V4","addV4Swap","MIXED","addMixedSwap","minimumAmountOut","pools","pathOutputCurrencyAddress","outputAmount","feeBips","EXACT_OUTPUT","sub","mul","div","feeAmount","amount","lt","outputRequiresUnwrap","outputRequiresWrap","riskOfPartialFill","safeMode","_createClass","key","get","result","_iterator2","_step2","firstPool","pathInput","lastRoute","lastPool","pathOutput","currency1","currency0","poolBefore","_ref","V2Trade","path","token","_ref2","V3Trade","createUncheckedTrade","encodeRouteToPath","_ref3","p","v4Route","V4Route","V4Trade","slippageToleranceOnSwap","undefined","v4Planner","V4Planner","addTrade","addSettle","pathOutputForTake","ethWethPool","addTake","_options$recipient","finalize","tradeRecipient","_options$recipient2","V3Pool","Pair","MixedRouteTrade","amountIn","amountOut","sections","partitionMixedRouteByProtocol","isLastSectionInRoute","i","inputToken","section","routePool","outputToken","getOutputOfPools","subRoute","MixedRoute","MixedRouteSDK","nextInputToken","swapRecipient","nextPool","v2PoolIsSwapRecipient","liquidityToken","v4SubRoute","input","output","addAction","Actions","SWAP_EXACT_IN","currencyIn","encodeV4RouteToPath","amountOutMinimum","outputTokenForTake","v4Pool","encodeMixedRouteToPath","priceImpact","greaterThan","swapOptions","SIGNATURE_LENGTH","EIP_2098_SIGNATURE_LENGTH","encodePermit","permit2","signature","ethers","utils","arrayify","joinSignature","splitSignature","encodeV3PositionPermit","permit","tokenId","calldata","NonfungiblePositionManager","INTERFACE","encodeFunctionData","validateAndParseAddress","spender","deadline","v","r","s","encodeInputTokenOptions","permit2TransferFrom","permit2Permit","details","process","invariant","isMint","Object","keys","some","k","SwapRouter","swapCallParameters","trades","inputCurrency","inputTokenPermit","nativeCurrencyValue","encodePlan","deadlineOrPreviousBlockhash","migrateV3ToV4CallParameters","positionManagerOverride","outputPosition","v3Token0","inputPosition","v3Token1","v4PositionManagerAddress","CHAIN_TO_ADDRESSES_MAP","v3RemoveLiquidityOptions","liquidityPercentage","equalTo","burnToken","collectOptions","v4AddLiquidityOptions","migrate","createPool","poolKey","getPoolKey","tickSpacing","hooks","sqrtRatioX96","universalRouterAddress","v3RemoveParams","V3PositionManager","removeCallParameters","v3Calls","Multicall","decodeMulticall","v3Call","selector","slice","getSighash","v4AddParams","V4PositionManager","addCallParameters","config","functionSignature","toHexString","Interface","UniversalRouter","UnwrapWETH","wethAddress","toLowerCase","permit2Data","_","PoolType","isNativeCurrency","RouterTradeAdapter","fromClassicQuote","quote","tokenIn","tokenOut","firstRoute","tokenInData","tokenOutData","parsedCurrencyIn","toCurrency","parsedCurrencyOut","typedRoutes","rawAmountIn","rawAmountOut","CurrencyAmount","fromRawAmount","isOnlyV2","isVersionedRoute","V2Pool","isOnlyV3","isOnlyV4","routev4","toV4Pool","routev3","V3Route","toV3Pool","routev2","V2Route","toPair","mixedRoute","toPoolOrPair","RouterTrade","v2Routes","filter","v3Routes","v4Routes","mixedRoutes","Ether","onChain","toToken","decimals","buyFeeBps","sellFeeBps","Token","parseInt","liquidity","tickCurrent","every","reserve0","reserve1","CommandParser","parseCalldata","genericParser","GenericCommandParser","txDescription","parseTransaction","data","_txDescription$args","args","parse","commandDefinition","commandTypes","getCommands","commandType","_this","_V4BaseActionsParser$","V4BaseActionsParser","actions","commandName","v4RouterCallToParams","abiDef","rawParams","decode","param","j","parseV3PathExactIn","parseV3PathExactOut","byte","substring","strippedPath","replace","getAddress","loc","res","feeAndTokenOut","action","actionName"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOA,WAAYA,WAAW;EACrBA,qEAAuB;EACvBA,uEAAwB;EACxBA,+EAA4B;EAC5BA,6EAA2B;EAC3BA,+CAAY;EACZA,qDAAe;EACfA,2DAAkB;EAElBA,qEAAuB;EACvBA,uEAAwB;EACxBA,kEAAqB;EACrBA,sDAAe;EACfA,4DAAkB;EAClBA,4FAAkC;EAClCA,4EAA0B;EAE1BA,oDAAc;EACdA,0FAAiC;EACjCA,sFAA+B;EAC/BA,0EAAyB;EACzBA,sFAA+B;EAE/BA,sEAAuB;AACzB,CAAC,EAxBWA,mBAAW,KAAXA,mBAAW;AA0BvB,WAAYC,SAAS;EACnBA,2DAAa;EACbA,6DAAc;AAChB,CAAC,EAHWA,iBAAS,KAATA,iBAAS;AAKrB,WAAYC,MAAM;EAChBA,iCAAG;EACHA,6CAAS;EACTA,6CAAS;AACX,CAAC,EAJWA,cAAM,KAANA,cAAM;AAwBlB,IAAMC,iBAAiB,GAAG,IAAI;AAC9B,IAAMC,mBAAmB,gBAAG,IAAIC,GAAG,CAAc,CAACL,mBAAW,CAACM,gBAAgB,CAAC,CAAC;AAEhF,IAAMC,aAAa,GACjB,6GAA6G;AAE/G,IAAMC,mBAAmB,GACvB,+GAA+G;AAEjH,IAAMC,eAAe,GAAG,kFAAkF;AAE1G,IAAMC,4BAA4B,GAAG,wDAAwD;AAC7F,IAAMC,kCAAkC,GAAGD,4BAA4B,GAAG,IAAI;IAEjEE,kBAAkB,IAAAC,mBAAA,OAAAA,mBAAA,CAE5Bb,mBAAW,CAACM,gBAAgB,IAAG;EAC9BQ,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,UAAU;IAAEC,IAAI,EAAE;GAAS,EACnC;IAAED,IAAI,EAAE,QAAQ;IAAEC,IAAI,EAAE;GAAW;CAEtC,EAAAL,mBAAA,CAGAb,mBAAW,CAACmB,cAAc,IAAG;EAC5BL,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,QAAQ;IAAEC,IAAI,EAAEX;GAAe,EACvC;IAAEU,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAS;CAEvC,EAAAL,mBAAA,CACAb,mBAAW,CAACoB,oBAAoB,IAAG;EAClCN,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,QAAQ;IAAEC,IAAI,EAAEV;GAAqB,EAC7C;IAAES,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAS;CAEvC,EAAAL,mBAAA,CACAb,mBAAW,CAACqB,qBAAqB,IAAG;EACnCP,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,OAAO;IAAEC,IAAI,EAAE;GAAW,EAClC;IAAED,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW,EACtC;IAAED,IAAI,EAAE,QAAQ;IAAEC,IAAI,EAAE;GAAW;CAEtC,EAAAL,mBAAA,CACAb,mBAAW,CAACsB,2BAA2B,IAAG;EACzCR,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IACEC,IAAI,EAAE,cAAc;IACpBC,IAAI,EAAEP;GACP;CAEJ,EAAAE,mBAAA,CAGAb,mBAAW,CAACuB,gBAAgB,IAAG;EAC9BT,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW,EACtC;IAAED,IAAI,EAAE,UAAU;IAAEC,IAAI,EAAE;GAAW,EACrC;IAAED,IAAI,EAAE,cAAc;IAAEC,IAAI,EAAE;GAAW,EACzC;IAAED,IAAI,EAAE,MAAM;IAAEO,SAAS,EAAEvB,iBAAS,CAACwB,aAAa;IAAEP,IAAI,EAAE;GAAS,EACnE;IAAED,IAAI,EAAE,aAAa;IAAEC,IAAI,EAAE;GAAQ;CAExC,EAAAL,mBAAA,CACAb,mBAAW,CAAC0B,iBAAiB,IAAG;EAC/BZ,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW,EACtC;IAAED,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW,EACtC;IAAED,IAAI,EAAE,aAAa;IAAEC,IAAI,EAAE;GAAW,EACxC;IAAED,IAAI,EAAE,MAAM;IAAEO,SAAS,EAAEvB,iBAAS,CAAC0B,cAAc;IAAET,IAAI,EAAE;GAAS,EACpE;IAAED,IAAI,EAAE,aAAa;IAAEC,IAAI,EAAE;GAAQ;CAExC,EAAAL,mBAAA,CACAb,mBAAW,CAAC4B,gBAAgB,IAAG;EAC9Bd,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW,EACtC;IAAED,IAAI,EAAE,UAAU;IAAEC,IAAI,EAAE;GAAW,EACrC;IAAED,IAAI,EAAE,cAAc;IAAEC,IAAI,EAAE;GAAW,EACzC;IAAED,IAAI,EAAE,MAAM;IAAEC,IAAI,EAAE;GAAa,EACnC;IAAED,IAAI,EAAE,aAAa;IAAEC,IAAI,EAAE;GAAQ;CAExC,EAAAL,mBAAA,CACAb,mBAAW,CAAC6B,iBAAiB,IAAG;EAC/Bf,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW,EACtC;IAAED,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW,EACtC;IAAED,IAAI,EAAE,aAAa;IAAEC,IAAI,EAAE;GAAW,EACxC;IAAED,IAAI,EAAE,MAAM;IAAEC,IAAI,EAAE;GAAa,EACnC;IAAED,IAAI,EAAE,aAAa;IAAEC,IAAI,EAAE;GAAQ;CAExC,EAAAL,mBAAA,CACAb,mBAAW,CAAC8B,OAAO,IAAG;EAAEhB,MAAM,EAAEZ,cAAM,CAAC6B;CAAW,EAAAlB,mBAAA,CAGlDb,mBAAW,CAACgC,QAAQ,IAAG;EACtBlB,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW,EACtC;IAAED,IAAI,EAAE,QAAQ;IAAEC,IAAI,EAAE;GAAW;CAEtC,EAAAL,mBAAA,CACAb,mBAAW,CAACiC,WAAW,IAAG;EACzBnB,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW,EACtC;IAAED,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW;CAEzC,EAAAL,mBAAA,CACAb,mBAAW,CAACkC,KAAK,IAAG;EACnBpB,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,OAAO;IAAEC,IAAI,EAAE;GAAW,EAClC;IAAED,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW,EACtC;IAAED,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW;CAEzC,EAAAL,mBAAA,CACAb,mBAAW,CAACmC,QAAQ,IAAG;EACtBrB,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,OAAO;IAAEC,IAAI,EAAE;GAAW,EAClC;IAAED,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW,EACtC;IAAED,IAAI,EAAE,OAAO;IAAEC,IAAI,EAAE;GAAW;CAErC,EAAAL,mBAAA,CACAb,mBAAW,CAACoC,WAAW,IAAG;EACzBtB,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,OAAO;IAAEC,IAAI,EAAE;GAAW,EAClC;IAAED,IAAI,EAAE,WAAW;IAAEC,IAAI,EAAE;GAAW,EACtC;IAAED,IAAI,EAAE,MAAM;IAAEC,IAAI,EAAE;GAAW;CAEpC,EAAAL,mBAAA,CACAb,mBAAW,CAACqC,mBAAmB,IAAG;EACjCvB,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,OAAO;IAAEC,IAAI,EAAE;GAAW,EAClC;IAAED,IAAI,EAAE,OAAO;IAAEC,IAAI,EAAE;GAAW,EAClC;IAAED,IAAI,EAAE,YAAY;IAAEC,IAAI,EAAE;GAAW;CAE1C,EAAAL,mBAAA,CACAb,mBAAW,CAACsC,kBAAkB,IAAG;EAChCxB,MAAM,EAAEZ,cAAM,CAACa,GAAG;EAClBC,MAAM,EAAE,CACN;IAAEC,IAAI,EAAE,SAAS;IAAEC,IAAI,EAAET;GAAiB,EAC1C;IAAEQ,IAAI,EAAE,cAAc;IAAEC,IAAI,EAAE;GAAW;CAE5C,EAAAL,mBAAA,CAGAb,mBAAW,CAACuC,0BAA0B,IAAG;EAAEzB,MAAM,EAAEZ,cAAM,CAACsC;CAAW,EAAA3B,mBAAA,CACrEb,mBAAW,CAACyC,wBAAwB,IAAG;EAAE3B,MAAM,EAAEZ,cAAM,CAACsC;CAAW,EAAA3B,mBAAA,CACnEb,mBAAW,CAAC0C,wBAAwB,IAAG;EAAE5B,MAAM,EAAEZ,cAAM,CAAC6B;CAAW,EAAAlB,mBAAA;IAGzD8B,YAAY;EAIvB,SAAAA;IACE,IAAI,CAACC,QAAQ,GAAG,IAAI;IACpB,IAAI,CAACC,MAAM,GAAG,EAAE;;EACjB,IAAAC,MAAA,GAAAH,YAAA,CAAAI,SAAA;EAAAD,MAAA,CAEDE,UAAU,GAAV,SAAAA,UAAUA,CAACC,OAAqB;IAC9B,IAAI,CAACC,UAAU,CAAClD,mBAAW,CAACM,gBAAgB,EAAE,CAAC2C,OAAO,CAACL,QAAQ,EAAEK,OAAO,CAACJ,MAAM,CAAC,EAAE,IAAI,CAAC;IACvF,OAAO,IAAI;GACZ;EAAAC,MAAA,CAEDI,UAAU,GAAV,SAAAA,UAAUA,CAAChC,IAAiB,EAAEiC,UAAiB,EAAEC,WAAW;QAAXA,WAAW;MAAXA,WAAW,GAAG,KAAK;;IAClE,IAAIC,OAAO,GAAGC,aAAa,CAACpC,IAAI,EAAEiC,UAAU,CAAC;IAC7C,IAAI,CAACN,MAAM,CAACU,IAAI,CAACF,OAAO,CAACG,YAAY,CAAC;IACtC,IAAIJ,WAAW,EAAE;MACf,IAAI,CAAChD,mBAAmB,CAACqD,GAAG,CAACJ,OAAO,CAACnC,IAAI,CAAC,EAAE;QAC1C,MAAM,IAAIwC,KAAK,oBAAkBL,OAAO,CAACnC,IAAI,iCAA8B,CAAC;;MAE9EmC,OAAO,CAACnC,IAAI,GAAGmC,OAAO,CAACnC,IAAI,GAAGf,iBAAiB;;IAGjD,IAAI,CAACyC,QAAQ,GAAG,IAAI,CAACA,QAAQ,CAACe,MAAM,CAACN,OAAO,CAACnC,IAAI,CAAC0C,QAAQ,CAAC,EAAE,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;IAChF,OAAO,IAAI;GACZ;EAAA,OAAAlB,YAAA;AAAA;SAQaW,aAAaA,CAACpC,IAAiB,EAAEiC,UAAiB;EAChE,IAAMW,UAAU,GAAGlD,kBAAkB,CAACM,IAAI,CAAC;EAC3C,QAAQ4C,UAAU,CAAChD,MAAM;IACvB,KAAKZ,cAAM,CAACa,GAAG;MACb,IAAMyC,YAAY,GAAGO,qBAAe,CAACC,MAAM,CACzCF,UAAU,CAAC9C,MAAM,CAACiD,GAAG,CAAC,UAACC,GAAG;QAAA,OAAKA,GAAG,CAAChD,IAAI;QAAC,EACxCiC,UAAU,CACX;MACD,OAAO;QAAEjC,IAAI,EAAJA,IAAI;QAAEsC,YAAY,EAAZA;OAAc;IAC/B,KAAKtD,cAAM,CAAC6B,SAAS;;MAEnB,OAAO;QAAEb,IAAI,EAAJA,IAAI;QAAEsC,YAAY,EAAEL,UAAU,CAAC,CAAC;OAAG;IAC9C,KAAKjD,cAAM,CAACsC,SAAS;;MAEnB,OAAO;QAAEtB,IAAI,EAAJA,IAAI;QAAEsC,YAAY,EAAEL,UAAU,CAAC,CAAC;OAAG;;AAElD;;SC7QgBgB,eAAeA,CAACC,QAAkB,EAAEC,IAAW;;EAE7D,IAAIA,IAAI,CAACC,aAAa,CAACF,QAAiB,CAAC,EAAE;IACzC,OAAOA,QAAQ;;GAGhB,MAAM,IAAIC,IAAI,CAACC,aAAa,CAACF,QAAQ,CAACG,OAAgB,CAAC,EAAE;IACxD,OAAOH,QAAQ,CAACG,OAAO;;GAGxB,MAAM,IAAIF,IAAI,YAAYG,UAAM,IAAIH,IAAI,CAACI,MAAM,CAACF,OAAO,CAACG,MAAM,CAACN,QAAQ,CAAC,EAAE;IACzE,OAAOC,IAAI,CAACI,MAAM;GACnB,MAAM,IAAIJ,IAAI,YAAYG,UAAM,IAAIH,IAAI,CAACM,MAAM,CAACJ,OAAO,CAACG,MAAM,CAACN,QAAQ,CAAC,EAAE;IACzE,OAAOC,IAAI,CAACM,MAAM;GACnB,MAAM;IACL,MAAM,IAAIjB,KAAK,wBAAsBU,QAAQ,CAACQ,MAAM,sBAAiBP,IAAI,CAACI,MAAM,CAACG,MAAM,YAAOP,IAAI,CAACM,MAAM,CAACC,MAAQ,CAAC;;AAIvH;;ACjBA,WAAYC,gBAAgB;EAC1BA,iDAA6B;EAC7BA,6CAAyB;AAC3B,CAAC,EAHWA,wBAAgB,KAAhBA,wBAAgB;;;ACN5B,AAEA,WAAYC,sBAAsB;EAChCA,sCAAY;EACZA,sCAAY;AACd,CAAC,EAHWA,8BAAsB,KAAtBA,8BAAsB;AAelC,IAAMC,2BAA2B,GAAG,4CAA4C;AAEhF;AACA,AAAO,IAAMC,aAAa,IAAAC,cAAA,OAAAA,cAAA,CAEvB,CAAC,IAAG;EACHC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAC,cAAA,OAAAA,cAAA,CACVN,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAH,cAAA,CACAN,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAH,cAAA;CAEJ,EAAAH,cAAA,CAEA,CAAC,IAAG;EACHC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAM,eAAA,OAAAA,eAAA,CACVX,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAE,eAAA,CACAX,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAE,eAAA;CAEJ,EAAAR,cAAA,CAEA,QAAQ,IAAG;EACVC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAO,eAAA,OAAAA,eAAA,CACVZ,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAG,eAAA,CACAZ,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAG,eAAA;CAEJ,EAAAT,cAAA,CAEA,GAAG,IAAG;EACLC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAQ,eAAA,OAAAA,eAAA,CACVb,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAI,eAAA,CACAb,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAI,eAAA;CAEJ,EAAAV,cAAA,CAEA,KAAK,IAAG;EACPC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAS,eAAA,OAAAA,eAAA,CACVd,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAK,eAAA,CACAd,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAK,eAAA;CAEJ,EAAAX,cAAA,CAEA,EAAE,IAAG;EACJC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAU,eAAA,OAAAA,eAAA,CACVf,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAM,eAAA,CACAf,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAM,eAAA;CAEJ,EAAAZ,cAAA,CAEA,GAAG,IAAG;EACLC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAW,eAAA,OAAAA,eAAA,CACVhB,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAO,eAAA,CACAhB,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAO,eAAA;CAEJ,EAAAb,cAAA,CAEA,KAAK,IAAG;EACPC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAY,eAAA,OAAAA,eAAA,CACVjB,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAQ,eAAA,CACAjB,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAQ,eAAA;CAEJ,EAAAd,cAAA,CAEA,MAAM,IAAG;EACRC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAa,eAAA,OAAAA,eAAA,CACVlB,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAS,eAAA,CACAlB,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAS,eAAA;CAEJ,EAAAf,cAAA,CAEA,KAAK,IAAG;EACPC,IAAI,EAAEH,2BAA2B;EACjCI,aAAa,GAAAc,eAAA,OAAAA,eAAA,CACVnB,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAU,eAAA,CACAnB,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAU,eAAA;CAEJ,EAAAhB,cAAA,CAEA,KAAK,IAAG;EACPC,IAAI,EAAEH,2BAA2B;EACjCI,aAAa,GAAAe,eAAA,OAAAA,eAAA,CACVpB,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAW,eAAA,CACApB,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAW,eAAA;CAEJ,EAAAjB,cAAA,CAEA,EAAE,IAAG;EACJC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAgB,gBAAA,OAAAA,gBAAA,CACVrB,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAY,gBAAA,CACArB,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAY,gBAAA;CAEJ,EAAAlB,cAAA,CAEA,KAAK,IAAG;EACPC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAiB,gBAAA,OAAAA,gBAAA,CACVtB,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAa,gBAAA,CACAtB,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAa,gBAAA;CAEJ,EAAAnB,cAAA,CAEA,KAAK,IAAG;EACPC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAkB,gBAAA,OAAAA,gBAAA,CACVvB,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAc,gBAAA,CACAvB,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAc,gBAAA;CAEJ,EAAApB,cAAA,CAEA,IAAI,IAAG;EACNC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAmB,gBAAA,OAAAA,gBAAA,CACVxB,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAe,gBAAA,CACAxB,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAe,gBAAA;CAEJ,EAAArB,cAAA,CAEA,KAAK,IAAG;EACPC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAoB,gBAAA,OAAAA,gBAAA,CACVzB,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAgB,gBAAA,CACAzB,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAgB,gBAAA;CAEJ,EAAAtB,cAAA,CAEA,OAAO,IAAG;EACTC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAqB,gBAAA,OAAAA,gBAAA,CACV1B,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAiB,gBAAA,CACA1B,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAiB,gBAAA;CAEJ,EAAAvB,cAAA,CACA,GAAG,IAAG;EACLC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAsB,gBAAA,OAAAA,gBAAA,CACV3B,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAkB,gBAAA,CACA3B,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAkB,gBAAA;CAEJ,EAAAxB,cAAA,CAEA,GAAG,IAAG;EACLC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAuB,gBAAA,OAAAA,gBAAA,CACV5B,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAmB,gBAAA,CACA5B,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAmB,gBAAA;CAEJ,EAAAzB,cAAA,CACA,IAAI,IAAG;EACNC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAwB,gBAAA,OAAAA,gBAAA,CACV7B,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAoB,gBAAA,CACA7B,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAoB,gBAAA;CAEJ,EAAA1B,cAAA,CAEA,GAAG,IAAG;EACLC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAAyB,gBAAA,OAAAA,gBAAA,CACV9B,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAqB,gBAAA,CACA9B,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAqB,gBAAA;CAEJ,EAAA3B,cAAA,CACA,KAAK,IAAG;EACPC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAA0B,gBAAA,OAAAA,gBAAA,CACV/B,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAsB,gBAAA,CACA/B,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAsB,gBAAA;CAEJ,EAAA5B,cAAA,CACA,KAAK,IAAG;EACPC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAA2B,gBAAA,OAAAA,gBAAA,CACVhC,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAuB,gBAAA,CACAhC,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAuB,gBAAA;CAEJ,EAAA7B,cAAA,CACA,IAAI,IAAG;EACNC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAA4B,gBAAA,OAAAA,gBAAA,CACVjC,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAwB,gBAAA,CACAjC,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAwB,gBAAA;CAEJ,EAAA9B,cAAA,CACA,GAAG,IAAG;EACLC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAA6B,gBAAA,OAAAA,gBAAA,CACVlC,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAyB,gBAAA,CACAlC,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAAyB,gBAAA;CAEJ,EAAA/B,cAAA,CACA,GAAG,IAAG;EACLC,IAAI,EAAE,4CAA4C;EAClDC,aAAa,GAAA8B,gBAAA,OAAAA,gBAAA,CACVnC,8BAAsB,CAACO,IAAI,IAAG;IAC7BC,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAA0B,gBAAA,CACAnC,8BAAsB,CAACU,IAAI,IAAG;IAC7BF,OAAO,EAAE,4CAA4C;IACrDC,aAAa,EAAE;GAChB,EAAA0B,gBAAA;CAEJ,EAAAhC,cAAA,CACF;AAED,IAAaiC,wBAAwB,GAAG,SAA3BA,wBAAwBA,CAAIC,OAA+B,EAAEC,OAAe;EACvF,IAAI,EAAEA,OAAO,IAAIpC,aAAa,CAAC,EAAE,MAAM,IAAItB,KAAK,6CAA2C0D,OAAS,CAAC;EACrG,OAAOpC,aAAa,CAACoC,OAAO,CAAC,CAACjC,aAAa,CAACgC,OAAO,CAAC,CAAC7B,OAAO;AAC9D,CAAC;AAED,IAAa+B,+BAA+B,GAAG,SAAlCA,+BAA+BA,CAAIF,OAA+B,EAAEC,OAAe;EAC9F,IAAI,EAAEA,OAAO,IAAIpC,aAAa,CAAC,EAAE,MAAM,IAAItB,KAAK,6CAA2C0D,OAAS,CAAC;EACrG,OAAOpC,aAAa,CAACoC,OAAO,CAAC,CAACjC,aAAa,CAACgC,OAAO,CAAC,CAAC5B,aAAa;AACpE,CAAC;AAED,IAAa+B,YAAY,GAAG,SAAfA,YAAYA,CAAIF,OAAe;EAC1C,IAAI,EAAEA,OAAO,IAAIpC,aAAa,CAAC,EAAE,MAAM,IAAItB,KAAK,6CAA2C0D,OAAS,CAAC;EAErG,IAAIpC,aAAa,CAACoC,OAAO,CAAC,CAAClC,IAAI,IAAIH,2BAA2B,EAAE,MAAM,IAAIrB,KAAK,YAAU0D,OAAO,wBAAqB,CAAC;EAEtH,OAAOpC,aAAa,CAACoC,OAAO,CAAC,CAAClC,IAAI;AACpC,CAAC;AAED,AAAO,IAAMqC,gBAAgB,gBAAGC,gBAAS,CAACC,IAAI,CAAC,CAAC,CAAC,CAACC,GAAG,CAAC,GAAG,CAAC;AAC1D,AAAO,IAAMC,WAAW,GAAG,4CAA4C;AACvE,AAAO,IAAMC,aAAa,GAAG,4CAA4C;AACzE,AAIO,IAAMC,mBAAmB,GAAG,4CAA4C;AAC/E,IAAaC,mBAAmB,GAAG,4CAA4C;;SCnZ/DC,kBAAkBA,CAAC3D,QAAkB;EACnD,OAAOA,QAAQ,CAAC4D,QAAQ,GAAGL,WAAW,GAAGvD,QAAQ,CAACG,OAAO,CAACe,OAAO;AACnE;;SCUgB2C,aAAaA,CAACC,GAAY;EACxC,OAAOC,WAAK,CAACD,GAAG,CAACE,QAAQ,CAAC,KAAM,CAAC,CAACC,QAAQ,CAAC;AAC7C;;ACkCA,IAAMC,iCAAiC,gBAAG,IAAIC,eAAO,CAAC,EAAE,EAAE,GAAG,CAAC;AAQ9D;AACA;AACA,IAAaC,YAAY;EAIvB,SAAAA,aAAmBC,KAAiD,EAASC,OAAoB;IAA9E,UAAK,GAALD,KAAK;IAAqD,YAAO,GAAPC,OAAO;IAH3E,cAAS,GAAqB7D,wBAAgB,CAAC2D,YAAY;IAIlE,IAAI,CAAC,CAACE,OAAO,CAACR,GAAG,IAAI,CAAC,CAACQ,OAAO,CAACC,OAAO,EAAE,MAAM,IAAIjF,KAAK,CAAC,+BAA+B,CAAC;IAExF,IAAI,IAAI,CAACkF,iBAAiB,IAAI,IAAI,CAACC,mBAAmB,IAAI,IAAI,CAACH,OAAO,CAACI,gBAAgB,EAAE;MACvF,IAAI,CAACC,WAAW,GAAG,KAAK;KACzB,MAAM;MACL,IAAI,CAACA,WAAW,GAAG,IAAI;;;EAE1B,IAAAjG,MAAA,GAAA0F,YAAA,CAAAzF,SAAA;EAAAD,MAAA,CAkHDkB,MAAM,GAAN,SAAAA,MAAMA,CAACgF,OAAqB,EAAEC,OAAoB;;;IAEhD,IAAI,IAAI,CAACL,iBAAiB,EAAE;;MAE1BI,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACgC,QAAQ,EAAE,CACvC8F,mBAAmB,EACnB,IAAI,CAACW,KAAK,CAACS,eAAe,CAAC,IAAI,CAACR,OAAO,CAACS,iBAAiB,CAAC,CAACd,QAAQ,CAACzE,QAAQ,EAAE,CAC/E,CAAC;KACH,MAAM,IAAI,IAAI,CAACiF,mBAAmB,EAAE;;MAEnCG,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACqB,qBAAqB,EAAE,CACnD,IAAI,CAACoH,KAAK,CAACW,WAAW,CAAChF,QAAkB,CAACkB,OAAO,EAClDwC,mBAAmB,EACnB,IAAI,CAACW,KAAK,CAACS,eAAe,CAAC,IAAI,CAACR,OAAO,CAACS,iBAAiB,CAAC,CAACd,QAAQ,CAACzE,QAAQ,EAAE,CAC/E,CAAC;MACFoF,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACiC,WAAW,EAAE,CAAC6F,mBAAmB,EAAE,CAAC,CAAC,CAAC;;;IAGvE,IAAI,CAACY,OAAO,CAACW,SAAS,IAAAC,qBAAA,GAAG,IAAI,CAACZ,OAAO,CAACW,SAAS,YAAAC,qBAAA,GAAIzB,mBAAmB;;;;;IAMtE,IAAM0B,8BAA8B,GAClC,IAAI,CAACd,KAAK,CAACe,SAAS,KAAKC,iBAAS,CAACC,WAAW,IAAI,IAAI,CAACjB,KAAK,CAACkB,MAAM,CAACC,MAAM,GAAG,CAAC;IAChF,IAAMC,iBAAiB,GACrBN,8BAA8B,IAAI,IAAI,CAACO,wBAAwB,IAAIC,YAAY,CAAC,IAAI,CAACrB,OAAO,CAAC;IAE/F,SAAAsB,SAAA,GAAAC,+BAAA,CAAmB,IAAI,CAACxB,KAAK,CAACyB,KAAK,GAAAC,KAAA,IAAAA,KAAA,GAAAH,SAAA,IAAAI,IAAA,GAAE;MAAA,IAA1BC,IAAI,GAAAF,KAAA,CAAAG,KAAA;MACb,QAAQD,IAAI,CAACE,KAAK,CAACC,QAAQ;QACzB,KAAKC,kBAAQ,CAACC,EAAE;UACdC,SAAS,CAAC3B,OAAO,EAAEqB,IAAI,EAAE,IAAI,CAAC5B,KAAK,CAACe,SAAS,EAAE,IAAI,CAACd,OAAO,EAAE,IAAI,CAACK,WAAW,EAAEc,iBAAiB,CAAC;UACjG;QACF,KAAKY,kBAAQ,CAACG,EAAE;UACdC,SAAS,CAAC7B,OAAO,EAAEqB,IAAI,EAAE,IAAI,CAAC5B,KAAK,CAACe,SAAS,EAAE,IAAI,CAACd,OAAO,EAAE,IAAI,CAACK,WAAW,EAAEc,iBAAiB,CAAC;UACjG;QACF,KAAKY,kBAAQ,CAACK,EAAE;UACdC,SAAS,CAAC/B,OAAO,EAAEqB,IAAI,EAAE,IAAI,CAAC5B,KAAK,CAACe,SAAS,EAAE,IAAI,CAACd,OAAO,EAAE,IAAI,CAACK,WAAW,EAAEc,iBAAiB,CAAC;UACjG;QACF,KAAKY,kBAAQ,CAACO,KAAK;UACjBC,YAAY,CAACjC,OAAO,EAAEqB,IAAI,EAAE,IAAI,CAAC5B,KAAK,CAACe,SAAS,EAAE,IAAI,CAACd,OAAO,EAAE,IAAI,CAACK,WAAW,EAAEc,iBAAiB,CAAC;UACpG;QACF;UACE,MAAM,IAAInG,KAAK,CAAC,4BAA4B,CAAC;;;IAInD,IAAIwH,gBAAgB,GAAc1D,gBAAS,CAACC,IAAI,CAC9C,IAAI,CAACgB,KAAK,CAACyC,gBAAgB,CAAC,IAAI,CAACxC,OAAO,CAACS,iBAAiB,CAAC,CAACd,QAAQ,CAACzE,QAAQ,EAAE,CAChF;;IAED,IAAIiG,iBAAiB,EAAE;MACrB,IAAMsB,KAAK,GAAG,IAAI,CAAC1C,KAAK,CAACyB,KAAK,CAAC,CAAC,CAAC,CAACK,KAAK,CAACY,KAAK;MAC7C,IAAMC,yBAAyB,GAAGrD,kBAAkB,CAClD5D,eAAe,CAAC,IAAI,CAACsE,KAAK,CAAC4C,YAAY,CAACjH,QAAQ,EAAE+G,KAAK,CAACA,KAAK,CAACvB,MAAM,GAAG,CAAC,CAAC,CAAC,CAC3E;;;MAID,IAAI,CAAC,CAAC,IAAI,CAAClB,OAAO,CAACR,GAAG,EAAE;QACtB,IAAMoD,OAAO,GAAGrD,aAAa,CAAC,IAAI,CAACS,OAAO,CAACR,GAAG,CAACA,GAAG,CAAC;QACnDc,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACoC,WAAW,EAAE,CAACgJ,yBAAyB,EAAE,IAAI,CAAC1C,OAAO,CAACR,GAAG,CAACmB,SAAS,EAAEiC,OAAO,CAAC,CAAC;;;QAI7G,IAAI,IAAI,CAAC7C,KAAK,CAACe,SAAS,KAAKC,iBAAS,CAAC8B,YAAY,EAAE;UACnDL,gBAAgB,GAAGA,gBAAgB,CAACM,GAAG,CAACN,gBAAgB,CAACO,GAAG,CAACH,OAAO,CAAC,CAACI,GAAG,CAAC,KAAK,CAAC,CAAC;;;;;MAMrF,IAAI,CAAC,CAAC,IAAI,CAAChD,OAAO,CAACC,OAAO,EAAE;QAC1B,IAAMgD,SAAS,GAAG,IAAI,CAACjD,OAAO,CAACC,OAAO,CAACiD,MAAM;QAC7C,IAAIV,gBAAgB,CAACW,EAAE,CAACF,SAAS,CAAC,EAAE,MAAM,IAAIjI,KAAK,CAAC,+CAA+C,CAAC;QAEpGsF,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACmC,QAAQ,EAAE,CAACiJ,yBAAyB,EAAE,IAAI,CAAC1C,OAAO,CAACC,OAAO,CAACU,SAAS,EAAEsC,SAAS,CAAC,CAAC;;;QAIhH,IAAI,IAAI,CAAClD,KAAK,CAACe,SAAS,KAAKC,iBAAS,CAAC8B,YAAY,EAAE;UACnDL,gBAAgB,GAAGA,gBAAgB,CAACM,GAAG,CAACG,SAAS,CAAC;;;;;MAMtD,IAAI,IAAI,CAACG,oBAAoB,EAAE;QAC7B9C,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACiC,WAAW,EAAE,CAAC,IAAI,CAACyG,OAAO,CAACW,SAAS,EAAE6B,gBAAgB,CAAC,CAAC;OACxF,MAAM,IAAI,IAAI,CAACa,kBAAkB,EAAE;QAClC/C,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACgC,QAAQ,EAAE,CAAC,IAAI,CAAC0G,OAAO,CAACW,SAAS,EAAE9B,gBAAgB,CAAC,CAAC;OACrF,MAAM;QACLyB,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACkC,KAAK,EAAE,CACpC6F,kBAAkB,CAAC,IAAI,CAACU,KAAK,CAAC4C,YAAY,CAACjH,QAAQ,CAAC,EACpD,IAAI,CAACsE,OAAO,CAACW,SAAS,EACtB6B,gBAAgB,CACjB,CAAC;;;;;IAMN,IAAI,IAAI,CAACzC,KAAK,CAACe,SAAS,KAAKC,iBAAS,CAAC8B,YAAY,IAAIS,iBAAiB,CAAC,IAAI,CAACvD,KAAK,CAAC,EAAE;MACpF,IAAI,IAAI,CAACG,iBAAiB,EAAE;QAC1BI,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACiC,WAAW,EAAE,CAAC,IAAI,CAACyG,OAAO,CAACW,SAAS,EAAE,CAAC,CAAC,CAAC;OACzE,MAAM,IAAI,IAAI,CAACR,mBAAmB,EAAE;QACnCG,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACgC,QAAQ,EAAE,CAAC,IAAI,CAAC0G,OAAO,CAACW,SAAS,EAAE9B,gBAAgB,CAAC,CAAC;OACrF,MAAM,IAAI,IAAI,CAACkB,KAAK,CAACW,WAAW,CAAChF,QAAQ,CAAC4D,QAAQ,EAAE;;QAEnDgB,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACkC,KAAK,EAAE,CAACyF,WAAW,EAAE,IAAI,CAACe,OAAO,CAACW,SAAS,EAAE,CAAC,CAAC,CAAC;;;IAInF,IAAI,IAAI,CAACX,OAAO,CAACuD,QAAQ,EAAEjD,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACkC,KAAK,EAAE,CAACyF,WAAW,EAAE,IAAI,CAACe,OAAO,CAACW,SAAS,EAAE,CAAC,CAAC,CAAC;GAC3G;EAAA,OAAA6C,YAAA,CAAA1D,YAAA;IAAA2D,GAAA;IAAAC,GAAA,EAnOD,SAAAA;MACE,IAAIC,MAAM,GAAG,IAAI;MACjB,SAAAC,UAAA,GAAArC,+BAAA,CAAmB,IAAI,CAACxB,KAAK,CAACyB,KAAK,GAAAqC,MAAA,IAAAA,MAAA,GAAAD,UAAA,IAAAlC,IAAA,GAAE;QAAA,IAA1BC,IAAI,GAAAkC,MAAA,CAAAjC,KAAA;QACb+B,MAAM,GAAGA,MAAM,IAAIhC,IAAI,CAACE,KAAK,CAACC,QAAQ,IAAIC,kBAAQ,CAACK,EAAE;;MAEvD,OAAOuB,MAAM;;;;;;;;;;IASfF,GAAA;IAAAC,GAAA,EACA,SAAAA;MACE,IAAM/B,IAAI,GAAG,IAAI,CAAC5B,KAAK,CAACyB,KAAK,CAAC,CAAC,CAAC;MAChC,IAAMK,KAAK,GAAGF,IAAI,CAACE,KAAK;MACxB,IAAMiC,SAAS,GAAGjC,KAAK,CAACY,KAAK,CAAC,CAAC,CAAC;MAEhC,IAAIqB,SAAS,YAAYhI,UAAM,EAAE;;QAE/B,OACE,IAAI,CAACiE,KAAK,CAACW,WAAW,CAAChF,QAAQ,CAAC4D,QAAQ,IACxC,CAAE,IAAI,CAACS,KAAK,CAACyB,KAAK,CAAC,CAAC,CAAC,CAACK,KAAgD,CAACkC,SAAS,CAACzE,QAAQ;;;MAI7F,OAAO,IAAI,CAACS,KAAK,CAACW,WAAW,CAAChF,QAAQ,CAAC4D,QAAQ;;;IAChDmE,GAAA;IAAAC,GAAA,EAED,SAAAA;MACE,IAAM/B,IAAI,GAAG,IAAI,CAAC5B,KAAK,CAACyB,KAAK,CAAC,CAAC,CAAC;MAChC,IAAMK,KAAK,GAAGF,IAAI,CAACE,KAAK;MACxB,IAAMiC,SAAS,GAAGjC,KAAK,CAACY,KAAK,CAAC,CAAC,CAAC;MAEhC,IAAIqB,SAAS,YAAYhI,UAAM,EAAE;;QAE/B,OACE,CAAC,IAAI,CAACiE,KAAK,CAACW,WAAW,CAAChF,QAAQ,CAAC4D,QAAQ,IACxC,IAAI,CAACS,KAAK,CAACyB,KAAK,CAAC,CAAC,CAAC,CAACK,KAAgD,CAACkC,SAAS,CAACzE,QAAQ;;;MAI5F,OAAO,KAAK;;;IACbmE,GAAA;IAAAC,GAAA,EAED,SAAAA;MACE,IAAM/B,IAAI,GAAG,IAAI,CAAC5B,KAAK,CAACyB,KAAK,CAAC,CAAC,CAAC;MAChC,IAAMwC,SAAS,GAAGrC,IAAI,CAACE,KAAK;MAC5B,IAAMoC,QAAQ,GAAGD,SAAS,CAACvB,KAAK,CAACuB,SAAS,CAACvB,KAAK,CAACvB,MAAM,GAAG,CAAC,CAAC;;MAG5D,IAAI+C,QAAQ,YAAYnI,UAAM,EAAE;;QAE9B,IAAI,CAAC,IAAI,CAACiE,KAAK,CAAC4C,YAAY,CAACjH,QAAQ,CAAC4D,QAAQ,EAAE;UAC9C,IAAK0E,SAAoD,CAACE,UAAU,CAAC5E,QAAQ,EAAE;;YAE7E,OAAO,IAAI;WACZ,MAAM,IAAI2E,QAAQ,CAACE,SAAS,CAACnI,MAAM,CAACiI,QAAQ,CAACG,SAAS,CAACvI,OAAO,CAAC,IAAImI,SAAS,CAACvB,KAAK,CAACvB,MAAM,GAAG,CAAC,EAAE;YAC9F,IAAImD,UAAU,GAAGL,SAAS,CAACvB,KAAK,CAACuB,SAAS,CAACvB,KAAK,CAACvB,MAAM,GAAG,CAAC,CAAC;;YAE5D,IACEmD,UAAU,YAAYvI,UAAM,KAC3BuI,UAAU,CAACD,SAAS,CAACpI,MAAM,CAACiI,QAAQ,CAACE,SAAS,CAAC,IAAIE,UAAU,CAACF,SAAS,CAACnI,MAAM,CAACiI,QAAQ,CAACE,SAAS,CAAC,CAAC,EACpG;cACA,OAAO,IAAI;aACZ,MAAM,IAAIE,UAAU,CAACtI,MAAM,CAACC,MAAM,CAACiI,QAAQ,CAACE,SAAS,CAAC,IAAIE,UAAU,CAACpI,MAAM,CAACD,MAAM,CAACiI,QAAQ,CAACE,SAAS,CAAC,EAAE;;cAEvG,OAAO,IAAI;;;;;;;MAOnB,OAAO,KAAK;;;IACbV,GAAA;IAAAC,GAAA,EAED,SAAAA;MACE,IAAM/B,IAAI,GAAG,IAAI,CAAC5B,KAAK,CAACyB,KAAK,CAAC,CAAC,CAAC;MAChC,IAAMwC,SAAS,GAAGrC,IAAI,CAACE,KAAK;MAC5B,IAAMoC,QAAQ,GAAGD,SAAS,CAACvB,KAAK,CAACuB,SAAS,CAACvB,KAAK,CAACvB,MAAM,GAAG,CAAC,CAAC;;MAG5D,IAAI+C,QAAQ,YAAYnI,UAAM,EAAE;;QAE9B,IAAI,IAAI,CAACiE,KAAK,CAAC4C,YAAY,CAACjH,QAAQ,CAAC4D,QAAQ,EAAE;UAC7C,IAAI,CAAE,IAAI,CAACS,KAAK,CAACyB,KAAK,CAAC,CAAC,CAAC,CAACK,KAAgD,CAACqC,UAAU,CAAC5E,QAAQ,EAAE;;YAE9F,OAAO,IAAI;WACZ,MAAM,IACL0E,SAAS,CAACvB,KAAK,CAACvB,MAAM,GAAG,CAAC,IAC1B8C,SAAS,CAACvB,KAAK,CAACuB,SAAS,CAACvB,KAAK,CAACvB,MAAM,GAAG,CAAC,CAAC,YAAYpF,UAAM,IAC5DkI,SAAS,CAACvB,KAAK,CAACuB,SAAS,CAACvB,KAAK,CAACvB,MAAM,GAAG,CAAC,CAAY,CAACkD,SAAS,CAAC9E,QAAQ,IAC1E2E,QAAQ,CAACE,SAAS,CAACnI,MAAM,CAACiI,QAAQ,CAACG,SAAS,CAACvI,OAAO,CAAC,EACrD;;YAEA,OAAO,IAAI;WACZ,MAAM;YACL,OAAO,KAAK;;;;;MAKlB,OAAO,IAAI,CAACkE,KAAK,CAAC4C,YAAY,CAACjH,QAAQ,CAAC4D,QAAQ;;;IACjDmE,GAAA;IAAAC,GAAA,EAED,SAAAA;MACE,OAAO,IAAI,CAACL,kBAAkB,IAAI,IAAI,CAACD,oBAAoB;;;AAC5D;AAwHH;AACA,SAASnB,SAASA,CAChB3B,OAAqB,EAAAgE,IAAA,EAErBxD,SAAoB,EACpBd,OAAoB,EACpBK,WAAoB,EACpBc,iBAA0B;MAJxBU,KAAK,GAAAyC,IAAA,CAALzC,KAAK;IAAEnB,WAAW,GAAA4D,IAAA,CAAX5D,WAAW;IAAEiC,YAAY,GAAA2B,IAAA,CAAZ3B,YAAY;EAMlC,IAAM5C,KAAK,GAAG,IAAIwE,WAAO,CACvB1C,KAAiC,EACjCf,SAAS,IAAIC,iBAAS,CAACC,WAAW,GAAGN,WAAW,GAAGiC,YAAY,EAC/D7B,SAAS,CACV;EAED,IAAIA,SAAS,IAAIC,iBAAS,CAACC,WAAW,EAAE;IACtCV,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAAC4B,gBAAgB,EAAE;;IAE/CiI,iBAAiB,GAAG/B,mBAAmB,GAAGY,OAAO,CAACW,SAAS,EAC3DZ,KAAK,CAACS,eAAe,CAACR,OAAO,CAACS,iBAAiB,CAAC,CAACd,QAAQ,CAACzE,QAAQ,EAAE;;IAEpEiG,iBAAiB,GAAG,CAAC,GAAGpB,KAAK,CAACyC,gBAAgB,CAACxC,OAAO,CAACS,iBAAiB,CAAC,CAACd,QAAQ,CAACzE,QAAQ,EAAE,EAC7F2G,KAAK,CAAC2C,IAAI,CAACjJ,GAAG,CAAC,UAACkJ,KAAK;MAAA,OAAKA,KAAK,CAAC5I,OAAO,CAACe,OAAO;MAAC,EAChDyD,WAAW,CACZ,CAAC;GACH,MAAM,IAAIS,SAAS,IAAIC,iBAAS,CAAC8B,YAAY,EAAE;IAC9CvC,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAAC6B,iBAAiB,EAAE,CAChDgI,iBAAiB,GAAG/B,mBAAmB,GAAGY,OAAO,CAACW,SAAS,EAC3DZ,KAAK,CAACyC,gBAAgB,CAACxC,OAAO,CAACS,iBAAiB,CAAC,CAACd,QAAQ,CAACzE,QAAQ,EAAE,EACrE6E,KAAK,CAACS,eAAe,CAACR,OAAO,CAACS,iBAAiB,CAAC,CAACd,QAAQ,CAACzE,QAAQ,EAAE,EACpE2G,KAAK,CAAC2C,IAAI,CAACjJ,GAAG,CAAC,UAACkJ,KAAK;MAAA,OAAKA,KAAK,CAAC5I,OAAO,CAACe,OAAO;MAAC,EAChDyD,WAAW,CACZ,CAAC;;AAEN;AAEA;AACA,SAAS8B,SAASA,CAChB7B,OAAqB,EAAAoE,KAAA,EAErB5D,SAAoB,EACpBd,OAAoB,EACpBK,WAAoB,EACpBc,iBAA0B;MAJxBU,KAAK,GAAA6C,KAAA,CAAL7C,KAAK;IAAEnB,WAAW,GAAAgE,KAAA,CAAXhE,WAAW;IAAEiC,YAAY,GAAA+B,KAAA,CAAZ/B,YAAY;EAMlC,IAAM5C,KAAK,GAAG4E,WAAO,CAACC,oBAAoB,CAAC;IACzC/C,KAAK,EAAEA,KAAiC;IACxCnB,WAAW,EAAXA,WAAW;IACXiC,YAAY,EAAZA,YAAY;IACZ7B,SAAS,EAATA;GACD,CAAC;EAEF,IAAM0D,IAAI,GAAGK,uBAAiB,CAAChD,KAAiC,EAAE9B,KAAK,CAACe,SAAS,KAAKC,iBAAS,CAAC8B,YAAY,CAAC;EAC7G,IAAI/B,SAAS,IAAIC,iBAAS,CAACC,WAAW,EAAE;IACtCV,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACuB,gBAAgB,EAAE,CAC/CsI,iBAAiB,GAAG/B,mBAAmB,GAAGY,OAAO,CAACW,SAAS,EAC3DZ,KAAK,CAACS,eAAe,CAACR,OAAO,CAACS,iBAAiB,CAAC,CAACd,QAAQ,CAACzE,QAAQ,EAAE,EACpEiG,iBAAiB,GAAG,CAAC,GAAGpB,KAAK,CAACyC,gBAAgB,CAACxC,OAAO,CAACS,iBAAiB,CAAC,CAACd,QAAQ,CAACzE,QAAQ,EAAE,EAC7FsJ,IAAI,EACJnE,WAAW,CACZ,CAAC;GACH,MAAM,IAAIS,SAAS,IAAIC,iBAAS,CAAC8B,YAAY,EAAE;IAC9CvC,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAAC0B,iBAAiB,EAAE,CAChDmI,iBAAiB,GAAG/B,mBAAmB,GAAGY,OAAO,CAACW,SAAS,EAC3DZ,KAAK,CAACyC,gBAAgB,CAACxC,OAAO,CAACS,iBAAiB,CAAC,CAACd,QAAQ,CAACzE,QAAQ,EAAE,EACrE6E,KAAK,CAACS,eAAe,CAACR,OAAO,CAACS,iBAAiB,CAAC,CAACd,QAAQ,CAACzE,QAAQ,EAAE,EACpEsJ,IAAI,EACJnE,WAAW,CACZ,CAAC;;AAEN;AAEA,SAASgC,SAASA,CAChB/B,OAAqB,EAAAwE,KAAA,EAErBhE,SAAoB,EACpBd,OAAoB,EACpBK,WAAoB,EACpBc,iBAA0B;;MAJxBT,WAAW,GAAAoE,KAAA,CAAXpE,WAAW;IAAEiC,YAAY,GAAAmC,KAAA,CAAZnC,YAAY;IAAEd,KAAK,GAAAiD,KAAA,CAALjD,KAAK;;EAOlC,IAAMY,KAAK,GAAGZ,KAAK,CAACY,KAAK,CAAClH,GAAG,CAAC,UAACwJ,CAAC;IAAA,OAAKA,CAAC;IAAa;EACnD,IAAMC,OAAO,GAAG,IAAIC,WAAO,CAACxC,KAAK,EAAE/B,WAAW,CAAChF,QAAQ,EAAEiH,YAAY,CAACjH,QAAQ,CAAC;EAC/E,IAAMqE,KAAK,GAAGmF,WAAO,CAACN,oBAAoB,CAAC;IACzC/C,KAAK,EAAEmD,OAAO;IACdtE,WAAW,EAAXA,WAAW;IACXiC,YAAY,EAAZA,YAAY;IACZ7B,SAAS,EAATA;GACD,CAAC;EAEF,IAAMqE,uBAAuB,GAC3BhE,iBAAiB,IAAIL,SAAS,IAAIC,iBAAS,CAACC,WAAW,GAAGoE,SAAS,GAAGpF,OAAO,CAACS,iBAAiB;EAEjG,IAAM4E,SAAS,GAAG,IAAIC,eAAS,EAAE;EACjCD,SAAS,CAACE,QAAQ,CAACxF,KAAK,EAAEoF,uBAAuB,CAAC;EAClDE,SAAS,CAACG,SAAS,CAACzF,KAAK,CAAC8B,KAAK,CAACkC,SAAS,EAAE1D,WAAW,CAAC;;;;EAKvD,IAAIoF,iBAAiB,GAAG1F,KAAK,CAAC8B,KAAK,CAACqC,UAAU;EAC9C,IAAID,QAAQ,GAAGe,OAAO,CAACvC,KAAK,CAACuC,OAAO,CAACvC,KAAK,CAACvB,MAAM,GAAG,CAAC,CAAC;EACtD,IAAIwE,WAAW,GAAGzB,QAAQ,CAACE,SAAS,CAACnI,MAAM,CAACiI,QAAQ,CAACG,SAAS,CAACvI,OAAO,CAAC;EAEvE,IAAI6J,WAAW,IAAIV,OAAO,CAACvC,KAAK,CAACvB,MAAM,GAAG,CAAC,EAAE;IAC3C,IAAImD,UAAU,GAAGW,OAAO,CAACvC,KAAK,CAACuC,OAAO,CAACvC,KAAK,CAACvB,MAAM,GAAG,CAAC,CAAC;IACxD,IAAIuE,iBAAiB,CAACnG,QAAQ,IAAI+E,UAAU,CAACD,SAAS,CAAC9E,QAAQ,EAAE;MAC/DmG,iBAAiB,GAAGA,iBAAiB,CAAC5J,OAAO;KAC9C,MAAM,IACL,CAAC4J,iBAAiB,CAACnG,QAAQ,KAC1B+E,UAAU,CAACD,SAAS,CAACpI,MAAM,CAACiI,QAAQ,CAACE,SAAS,CAAC,IAAIE,UAAU,CAACF,SAAS,CAACnI,MAAM,CAACiI,QAAQ,CAACE,SAAS,CAAC,CAAC,EACpG;MACAsB,iBAAiB,GAAGxB,QAAQ,CAACG,SAAS;;;EAI1CiB,SAAS,CAACM,OAAO,CACfF,iBAAiB,EACjBtE,iBAAiB,GAAG/B,mBAAmB,IAAAwG,kBAAA,GAAG5F,OAAO,CAACW,SAAS,YAAAiF,kBAAA,GAAIzG,mBAAmB,CACnF;EACDmB,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAAC8B,OAAO,EAAE,CAACiM,SAAS,CAACQ,QAAQ,EAAE,CAAC,CAAC;AACjE;AAEA;AACA,SAAStD,YAAYA,CACnBjC,OAAqB,EACrBqB,IAA2B,EAC3Bb,SAAoB,EACpBd,OAAoB,EACpBK,WAAoB,EACpBc,iBAA0B;;EAE1B,IAAMU,KAAK,GAAGF,IAAI,CAACE,KAAoC;EACvD,IAAMnB,WAAW,GAAGiB,IAAI,CAACjB,WAAW;EACpC,IAAMiC,YAAY,GAAGhB,IAAI,CAACgB,YAAY;EACtC,IAAMmD,cAAc,GAAG3E,iBAAiB,GAAG/B,mBAAmB,IAAA2G,mBAAA,GAAG/F,OAAO,CAACW,SAAS,YAAAoF,mBAAA,GAAI5G,mBAAmB;;EAGzG,IAAI0C,KAAK,CAACY,KAAK,CAACvB,MAAM,KAAK,CAAC,EAAE;IAC5B,IAAIW,KAAK,CAACY,KAAK,CAAC,CAAC,CAAC,YAAY3G,UAAM,EAAE;MACpC,OAAOuG,SAAS,CAAC/B,OAAO,EAAEqB,IAAI,EAAEb,SAAS,EAAEd,OAAO,EAAEK,WAAW,EAAEc,iBAAiB,CAAC;KACpF,MAAM,IAAIU,KAAK,CAACY,KAAK,CAAC,CAAC,CAAC,YAAYuD,UAAM,EAAE;MAC3C,OAAO7D,SAAS,CAAC7B,OAAO,EAAEqB,IAAI,EAAEb,SAAS,EAAEd,OAAO,EAAEK,WAAW,EAAEc,iBAAiB,CAAC;KACpF,MAAM,IAAIU,KAAK,CAACY,KAAK,CAAC,CAAC,CAAC,YAAYwD,UAAI,EAAE;MACzC,OAAOhE,SAAS,CAAC3B,OAAO,EAAEqB,IAAI,EAAEb,SAAS,EAAEd,OAAO,EAAEK,WAAW,EAAEc,iBAAiB,CAAC;KACpF,MAAM;MACL,MAAM,IAAInG,KAAK,CAAC,oBAAoB,CAAC;;;EAIzC,IAAM+E,KAAK,GAAGmG,yBAAe,CAACtB,oBAAoB,CAAC;IACjD/C,KAAK,EAAEA,KAAoC;IAC3CnB,WAAW,EAAXA,WAAW;IACXiC,YAAY,EAAZA,YAAY;IACZ7B,SAAS,EAATA;GACD,CAAC;EAEF,IAAMqF,QAAQ,GAAGpG,KAAK,CAACS,eAAe,CAACR,OAAO,CAACS,iBAAiB,EAAEC,WAAW,CAAC,CAACf,QAAQ,CAACzE,QAAQ,EAAE;EAClG,IAAMkL,SAAS,GAAGjF,iBAAiB,GAC/B,CAAC,GACDpB,KAAK,CAACyC,gBAAgB,CAACxC,OAAO,CAACS,iBAAiB,EAAEkC,YAAY,CAAC,CAAChD,QAAQ,CAACzE,QAAQ,EAAE;;;EAIvF,IAAMmL,QAAQ,GAAGC,uCAA6B,CAACzE,KAAoC,CAAC;EACpF,IAAM0E,oBAAoB,GAAG,SAAvBA,oBAAoBA,CAAIC,CAAS;IACrC,OAAOA,CAAC,KAAKH,QAAQ,CAACnF,MAAM,GAAG,CAAC;GACjC;EAED,IAAIuF,UAAU,GAAG5E,KAAK,CAACkC,SAAS;EAEhC,KAAK,IAAIyC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,QAAQ,CAACnF,MAAM,EAAEsF,CAAC,EAAE,EAAE;IACxC,IAAME,OAAO,GAAGL,QAAQ,CAACG,CAAC,CAAC;IAC3B,IAAMG,SAAS,GAAGD,OAAO,CAAC,CAAC,CAAC;IAC5B,IAAME,WAAW,GAAGC,0BAAgB,CAACH,OAAO,EAAED,UAAU,CAAC;IACzD,IAAMK,QAAQ,GAAG,IAAIC,oBAAU,CAAC,IAAIC,uBAAa,IAAA/L,MAAA,CAAKyL,OAAO,GAAGD,UAAU,EAAEG,WAAW,CAAC,CAAC;IAEzF,IAAIK,cAAc;IAClB,IAAIC,aAAa;IAEjB,IAAIX,oBAAoB,CAACC,CAAC,CAAC,EAAE;MAC3BS,cAAc,GAAGL,WAAW;MAC5BM,aAAa,GAAGpB,cAAc;KAC/B,MAAM;MACL,IAAMqB,QAAQ,GAAGd,QAAQ,CAACG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;MACnCS,cAAc,GAAGxL,eAAe,CAACmL,WAAW,EAAEO,QAAQ,CAAC;MAEvD,IAAMC,qBAAqB,GAAGD,QAAQ,YAAYlB,UAAI,IAAIW,WAAW,CAAC5K,MAAM,CAACiL,cAAc,CAAC;MAC5FC,aAAa,GAAGE,qBAAqB,GAAID,QAAiB,CAACE,cAAc,CAACzK,OAAO,GAAGwC,mBAAmB;;IAGzG,IAAIuH,SAAS,YAAY7K,UAAM,EAAE;MAC/B,IAAMuJ,SAAS,GAAG,IAAIC,eAAS,EAAE;MACjC,IAAMgC,UAAU,GAAG,IAAIrC,WAAO,CAACyB,OAAmB,EAAEI,QAAQ,CAACS,KAAK,EAAET,QAAQ,CAACU,MAAM,CAAC;MAEpFnC,SAAS,CAACG,SAAS,CAACiB,UAAU,EAAEpG,WAAW,IAAImG,CAAC,KAAK,CAAC,EAAGA,CAAC,IAAI,CAAC,GAAGL,QAAQ,GAAGtH,gBAA8B,CAAC;MAC5GwG,SAAS,CAACoC,SAAS,CAACC,aAAO,CAACC,aAAa,EAAE,CACzC;QACEC,UAAU,EAAEnB,UAAU,CAACnH,QAAQ,GAAGL,WAAW,GAAGwH,UAAU,CAAC7J,OAAO;QAClE4H,IAAI,EAAEqD,uBAAmB,CAACP,UAAU,CAAC;QACrCnB,QAAQ,EAAE,CAAC;QACX2B,gBAAgB,EAAE,CAACvB,oBAAoB,CAACC,CAAC,CAAC,GAAG,CAAC,GAAGJ;OAClD,CACF,CAAC;;MAGF,IAAI2B,kBAAkB,GAAGnB,WAAW;MACpC,IAAIL,oBAAoB,CAACC,CAAC,CAAC,EAAE;QAC3B,IAAIvC,QAAQ,GAAGpC,KAAK,CAACY,KAAK,CAACZ,KAAK,CAACY,KAAK,CAACvB,MAAM,GAAG,CAAC,CAAC;QAClD,IAAI8G,MAAM,GAAG/D,QAAQ,YAAYnI,UAAM;QACvC,IAAI4J,WAAW,GAAGsC,MAAM,GAAI/D,QAAmB,CAACE,SAAS,CAACnI,MAAM,CAAEiI,QAAmB,CAACG,SAAS,CAACvI,OAAO,CAAC,GAAG,KAAK;QAChH,IAAIwI,UAAU,GAAGxC,KAAK,CAACY,KAAK,CAACZ,KAAK,CAACY,KAAK,CAACvB,MAAM,GAAG,CAAC,CAAC;QAEpD,IAAIwE,WAAW,EAAE;UACf,IAAIkB,WAAW,CAACtH,QAAQ,IAAI+E,UAAU,CAACtI,MAAM,CAACuD,QAAQ,EAAE;YACtDyI,kBAAkB,GAAGnB,WAAW,CAAC/K,OAAO;WACzC,MAAM,IACL,CAAC+K,WAAW,CAACtH,QAAQ,KACpB+E,UAAU,CAACtI,MAAM,CAACC,MAAM,CAACiI,QAAQ,CAAChI,MAAM,CAAC,IAAIoI,UAAU,CAACpI,MAAM,CAACD,MAAM,CAACiI,QAAQ,CAAChI,MAAM,CAAC,CAAC,EACxF;YACA8L,kBAAkB,GAAG9D,QAAQ,CAAClI,MAAM;;;;MAK1CsJ,SAAS,CAACM,OAAO,CAACoC,kBAAkB,EAAEb,aAAa,CAAC;MAEpD5G,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAAC8B,OAAO,EAAE,CAACiM,SAAS,CAACQ,QAAQ,EAAE,CAAC,CAAC;KAChE,MAAM,IAAIc,SAAS,YAAYX,UAAM,EAAE;MACtC1F,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACuB,gBAAgB,EAAE,CAC/CqO,aAAa,EACbV,CAAC,IAAI,CAAC,GAAGL,QAAQ,GAAGtH,gBAAgB,EACpC,CAAC0H,oBAAoB,CAACC,CAAC,CAAC,GAAG,CAAC,GAAGJ,SAAS,EACxC6B,gCAAsB,CAACnB,QAAQ,CAAC,EAChCzG,WAAW,IAAImG,CAAC,KAAK,CAAC,CACvB,CAAC;KACH,MAAM,IAAIG,SAAS,YAAYV,UAAI,EAAE;MACpC3F,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAAC4B,gBAAgB,EAAE,CAC/CgO,aAAa,EACbV,CAAC,KAAK,CAAC,GAAGL,QAAQ,GAAGtH,gBAAgB,EACrC,CAAC0H,oBAAoB,CAACC,CAAC,CAAC,GAAG,CAAC,GAAGJ,SAAS,EACxCU,QAAQ,CAACtC,IAAI,CAACjJ,GAAG,CAAC,UAACkJ,KAAK;QAAA,OAAKA,KAAK,CAAC5I,OAAO,CAACe,OAAO;QAAC,EACnDyD,WAAW,IAAImG,CAAC,KAAK,CAAC,CACvB,CAAC;KACH,MAAM;MACL,MAAM,IAAIxL,KAAK,CAAC,sBAAsB,CAAC;;;IAIzC,IAAI,CAACuL,oBAAoB,CAACC,CAAC,CAAC,EAAE;MAC5B,IAAII,WAAW,CAACtH,QAAQ,IAAI,CAAC2H,cAAc,CAAC3H,QAAQ,EAAE;QACpDgB,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACgC,QAAQ,EAAE,CAAC8F,mBAAmB,EAAEP,gBAAgB,CAAC,CAAC;OAClF,MAAM,IAAI,CAAC+H,WAAW,CAACtH,QAAQ,IAAI2H,cAAc,CAAC3H,QAAQ,EAAE;QAC3DgB,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACiC,WAAW,EAAE,CAAC6F,mBAAmB,EAAE,CAAC,CAAC,CAAC;;;IAIzEqH,UAAU,GAAGQ,cAAc;;AAE/B;AAEA;AACA,SAAS3D,iBAAiBA,CAACvD,KAAiD;EAC1E,OAAOA,KAAK,CAACmI,WAAW,CAACC,WAAW,CAACvI,iCAAiC,CAAC;AACzE;AAEA,SAASyB,YAAYA,CAAC+G,WAAwB;EAC5C,OAAO,CAAC,CAACA,WAAW,CAAC5I,GAAG,IAAI,CAAC,CAAC4I,WAAW,CAACnI,OAAO;AACnD;;ACjiBA,IAAMoI,gBAAgB,GAAG,EAAE;AAC3B,IAAMC,yBAAyB,GAAG,EAAE;AAEpC,SAAgBC,YAAYA,CAACjI,OAAqB,EAAEkI,OAAsB;EACxE,IAAIC,SAAS,GAAGD,OAAO,CAACC,SAAS;EAEjC,IAAMvH,MAAM,GAAGwH,aAAM,CAACC,KAAK,CAACC,QAAQ,CAACJ,OAAO,CAACC,SAAS,CAAC,CAACvH,MAAM;;EAE9D,IAAIA,MAAM,KAAKmH,gBAAgB,IAAInH,MAAM,KAAKoH,yBAAyB,EAAE;;IAEvEG,SAAS,GAAGC,aAAM,CAACC,KAAK,CAACE,aAAa,CAACH,aAAM,CAACC,KAAK,CAACG,cAAc,CAACN,OAAO,CAACC,SAAS,CAAC,CAAC;;EAGxFnI,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACmB,cAAc,EAAE,CAAC+P,OAAO,EAAEC,SAAS,CAAC,CAAC;AACtE;AAEA,SAAgBM,sBAAsBA,CAACzI,OAAqB,EAAE0I,MAAwB,EAAEC,OAAkB;EACxG,IAAMC,QAAQ,GAAGC,gCAA0B,CAACC,SAAS,CAACC,kBAAkB,CAAC,QAAQ,EAAE,CACjFC,+BAAuB,CAACN,MAAM,CAACO,OAAO,CAAC,EACvCN,OAAO,EACPD,MAAM,CAACQ,QAAQ,EACfR,MAAM,CAACS,CAAC,EACRT,MAAM,CAACU,CAAC,EACRV,MAAM,CAACW,CAAC,CACT,CAAC;EAEFrJ,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACuC,0BAA0B,EAAE,CAACqP,QAAQ,CAAC,CAAC;AACxE;AAEA;AACA;AACA;AACA;AACA;AACA,SAAgBU,uBAAuBA,CAACtJ,OAAqB,EAAEN,OAA0B;;EAEvF,IAAI,CAAC,CAACA,OAAO,CAAC6J,mBAAmB,IAAI,CAAC,CAAC7J,OAAO,CAAC8J,aAAa,EAC1D,EAAU9J,OAAO,CAAC6J,mBAAmB,CAACpF,KAAK,KAAKzE,OAAO,CAAC8J,aAAa,CAACC,OAAO,CAACtF,KAAK,IAAAuF,CAAnFC,SAAS;;EAGX,IAAI,CAAC,CAACjK,OAAO,CAAC8J,aAAa,EAAE;IAC3BvB,YAAY,CAACjI,OAAO,EAAEN,OAAO,CAAC8J,aAAa,CAAC;;EAG9C,IAAI,CAAC,CAAC9J,OAAO,CAAC6J,mBAAmB,EAAE;IACjCvJ,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACqB,qBAAqB,EAAE,CACpDqH,OAAO,CAAC6J,mBAAmB,CAACpF,KAAK,EACjCzE,OAAO,CAAC6J,mBAAmB,CAAClJ,SAAS,GAAGX,OAAO,CAAC6J,mBAAmB,CAAClJ,SAAS,GAAGvB,mBAAmB,EACnGY,OAAO,CAAC6J,mBAAmB,CAAC3G,MAAM,CACnC,CAAC;;AAEN;;ACzCA,SAASgH,MAAMA,CAAClK,OAA8B;EAC5C,OAAOmK,MAAM,CAACC,IAAI,CAACpK,OAAO,CAAC,CAACqK,IAAI,CAAC,UAACC,CAAC;IAAA,OAAKA,CAAC,KAAK,WAAW;IAAC;AAC5D;AAEA,IAAsBC,UAAU;EAAA,SAAAA;EAAAA,UAAA,CAGhBC,kBAAkB,GAAzB,SAAOA,kBAAkBA,CAC9BC,MAAkD,EAClDzK,OAAoB;;IAGpB,IAAMM,OAAO,GAAG,IAAIrG,YAAY,EAAE;IAElC,IAAM8F,KAAK,GAAiB,IAAID,YAAY,CAAC2K,MAAM,EAAEzK,OAAO,CAAC;IAE7D,IAAM0K,aAAa,GAAG3K,KAAK,CAACA,KAAK,CAACW,WAAW,CAAChF,QAAQ;IACtD,CAAU,EAAEgP,aAAa,CAACpL,QAAQ,IAAI,CAAC,CAACU,OAAO,CAAC2K,gBAAgB,CAAC,GAAAX,CAAjEC,SAAS,QAA0D,qBAAqB;IAExF,IAAIjK,OAAO,CAAC2K,gBAAgB,EAAE;MAC5BpC,YAAY,CAACjI,OAAO,EAAEN,OAAO,CAAC2K,gBAAgB,CAAC;;IAGjD,IAAMC,mBAAmB,GAAGF,aAAa,CAACpL,QAAQ,GAC9CR,gBAAS,CAACC,IAAI,CAACgB,KAAK,CAACA,KAAK,CAACS,eAAe,CAACR,OAAO,CAACS,iBAAiB,CAAC,CAACd,QAAQ,CAACzE,QAAQ,EAAE,CAAC,GAC1F4D,gBAAS,CAACC,IAAI,CAAC,CAAC,CAAC;IAErBgB,KAAK,CAACzE,MAAM,CAACgF,OAAO,EAAE;MAAE5F,WAAW,EAAE;KAAO,CAAC;IAC7C,OAAO6P,UAAU,CAACM,UAAU,CAACvK,OAAO,EAAEsK,mBAAmB,EAAE;MACzDpB,QAAQ,EAAExJ,OAAO,CAAC8K,2BAA2B,GAAGhM,gBAAS,CAACC,IAAI,CAACiB,OAAO,CAAC8K,2BAA2B,CAAC,GAAG1F;KACvG,CAAC;;;;;;;;;;EAGJmF,UAAA,CAQcQ,2BAA2B,GAAlC,SAAOA,2BAA2BA,CACvC/K,OAA6B,EAC7BgL,uBAAgC;IAEhC,IAAMhD,MAAM,GAAWhI,OAAO,CAACiL,cAAc,CAACtP,IAAI;IAClD,IAAMuP,QAAQ,GAAGlL,OAAO,CAACmL,aAAa,CAACxP,IAAI,CAACI,MAAM;IAClD,IAAMqP,QAAQ,GAAGpL,OAAO,CAACmL,aAAa,CAACxP,IAAI,CAACM,MAAM;IAClD,IAAMoP,wBAAwB,GAC5BL,uBAAuB,WAAvBA,uBAAuB,GAAIM,8BAAsB,CAACtD,MAAM,CAACtJ,OAA8B,CAAC,CAAC2M,wBAAwB;;;IAKnH,IAAIrD,MAAM,CAAC5D,SAAS,CAAC9E,QAAQ,EAAE;MAC7B,EACG0I,MAAM,CAAC5D,SAAS,CAACvI,OAAO,CAACG,MAAM,CAACkP,QAAQ,CAAC,IAAIlD,MAAM,CAAC7D,SAAS,CAACnI,MAAM,CAACoP,QAAQ,CAAC,IAC5EpD,MAAM,CAAC5D,SAAS,CAACvI,OAAO,CAACG,MAAM,CAACoP,QAAQ,CAAC,IAAIpD,MAAM,CAAC7D,SAAS,CAACnI,MAAM,CAACkP,QAAQ,CAAE,IAAAlB,CAFpFC,SAAS,QAGP,gBAAgB;KAEnB,MAAM;MACL,EAAUiB,QAAQ,KAAKlD,MAAM,CAACjM,MAAM,IAAAiO,CAApCC,SAAS,QAA6B,iBAAiB;MACvD,EAAUmB,QAAQ,KAAKpD,MAAM,CAAC/L,MAAM,IAAA+N,CAApCC,SAAS,QAA6B,iBAAiB;;IAGzD,CACEjK,OAAO,CAACuL,wBAAwB,CAACC,mBAAmB,CAACC,OAAO,CAAC,IAAI5L,eAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,GAAAmK,CADrFC,SAAS,QAEP,uBAAuB;IAEzB,EAAUjK,OAAO,CAACuL,wBAAwB,CAACG,SAAS,IAAI,IAAI,IAAA1B,CAA5DC,SAAS,QAAqD,qBAAqB;IACnF,EACEjK,OAAO,CAACuL,wBAAwB,CAACI,cAAc,CAAChL,SAAS,KAAK0K,wBAAwB,IAAArB,CADxFC,SAAS,QAEP,gCAAgC;IAElC,CAAUC,MAAM,CAAClK,OAAO,CAAC4L,qBAAqB,CAAC,GAAA5B,CAA/CC,SAAS,QAAwC,eAAe;IAChE,CAAUjK,OAAO,CAAC4L,qBAAqB,CAACC,OAAO,GAAA7B,CAA/CC,SAAS,QAAwC,kBAAkB;IAEnE,IAAM3J,OAAO,GAAG,IAAIrG,YAAY,EAAE;;IAGlC,IAAI+F,OAAO,CAAC4L,qBAAqB,CAACE,UAAU,EAAE;MAC5C,IAAMC,OAAO,GAAYjQ,UAAM,CAACkQ,UAAU,CACxChE,MAAM,CAAC5D,SAAS,EAChB4D,MAAM,CAAC7D,SAAS,EAChB6D,MAAM,CAACxI,GAAG,EACVwI,MAAM,CAACiE,WAAW,EAClBjE,MAAM,CAACkE,KAAK,CACb;MACD5L,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACsC,kBAAkB,EAAE,CAACmS,OAAO,EAAE/D,MAAM,CAACmE,YAAY,CAACjR,QAAQ,EAAE,CAAC,CAAC;;MAE7F,OAAO8E,OAAO,CAAC4L,qBAAqB,CAACE,UAAU;;;IAIjD,IAAI9L,OAAO,CAACuL,wBAAwB,CAACvC,MAAM,EAAE;;MAE3C,IAAMoD,sBAAsB,GAAG5N,wBAAwB,CACrDpC,8BAAsB,CAACU,IAAI,EAC3BkD,OAAO,CAACmL,aAAa,CAACxP,IAAI,CAAC+C,OAA8B,CAC1D;MACD,EAAU0N,sBAAsB,IAAIpM,OAAO,CAACuL,wBAAwB,CAACvC,MAAM,CAACO,OAAO,IAAAS,CAAnFC,SAAS,QAA4E,iBAAiB;;MAEtGlB,sBAAsB,CAACzI,OAAO,EAAEN,OAAO,CAACuL,wBAAwB,CAACvC,MAAM,EAAEhJ,OAAO,CAACuL,wBAAwB,CAACtC,OAAO,CAAC;;MAElH,OAAOjJ,OAAO,CAACuL,wBAAwB,CAACvC,MAAM;;;IAIhD,IAAMqD,cAAc,GAAqBC,gCAAiB,CAACC,oBAAoB,CAC7EvM,OAAO,CAACmL,aAAa,EACrBnL,OAAO,CAACuL,wBAAwB,CACjC;IACD,IAAMiB,OAAO,GAAaC,eAAS,CAACC,eAAe,CAACL,cAAc,CAACnD,QAAQ,CAAC;IAE5E,SAAA5H,SAAA,GAAAC,+BAAA,CAAqBiL,OAAO,GAAA/K,KAAA,IAAAA,KAAA,GAAAH,SAAA,IAAAI,IAAA,GAAE;MAAA,IAAnBiL,MAAM,GAAAlL,KAAA,CAAAG,KAAA;;MAEf,IAAMgL,SAAQ,GAAGD,MAAM,CAACE,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;MACpC,EACED,SAAQ,IAAIN,gCAAiB,CAAClD,SAAS,CAAC0D,UAAU,CAAC,SAAS,CAAC,IAC3DF,SAAQ,IAAIN,gCAAiB,CAAClD,SAAS,CAAC0D,UAAU,CAAC,mBAAmB,CAAC,IACvEF,SAAQ,IAAIN,gCAAiB,CAAClD,SAAS,CAAC0D,UAAU,CAAC,MAAM,CAAC,IAAA9C,CAH9DC,SAAS,QAIP,mBAAmB,GAAG2C,SAAQ;MAEhCtM,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACyC,wBAAwB,EAAE,CAAC4S,MAAM,CAAC,CAAC;;;IAIpE,IAAMI,WAAW,GAAGC,uBAAiB,CAACC,iBAAiB,CAACjN,OAAO,CAACiL,cAAc,EAAEjL,OAAO,CAAC4L,qBAAqB,CAAC;;IAE9G,IAAMgB,QAAQ,GAAGG,WAAW,CAAC7D,QAAQ,CAAC2D,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC;IAClD,EAAUD,QAAQ,IAAII,uBAAiB,CAAC5D,SAAS,CAAC0D,UAAU,CAAC,mBAAmB,CAAC,IAAA9C,CAAjFC,SAAS,QAA0E,mBAAmB,GAAG2C,QAAQ;IAEjHtM,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAAC0C,wBAAwB,EAAE,CAAC+S,WAAW,CAAC7D,QAAQ,CAAC,CAAC;IAEhF,OAAOqB,UAAU,CAACM,UAAU,CAACvK,OAAO,EAAExB,gBAAS,CAACC,IAAI,CAAC,CAAC,CAAC,EAAE;MACvDyK,QAAQ,EAAE1K,gBAAS,CAACC,IAAI,CAACiB,OAAO,CAAC4L,qBAAqB,CAACpC,QAAQ;KAChE,CAAC;;;;;;;;EAGJe,UAAA,CAMeM,UAAU,GAAjB,SAAOA,UAAUA,CACvBvK,OAAqB,EACrBsK,mBAA8B,EAC9BsC;QAAAA;MAAAA,SAA2B,EAAE;;IAE7B,IAAQhT,QAAQ,GAAaoG,OAAO,CAA5BpG,QAAQ;MAAEC,MAAM,GAAKmG,OAAO,CAAlBnG,MAAM;IACxB,IAAMgT,iBAAiB,GAAG,CAAC,CAACD,MAAM,CAAC1D,QAAQ,GAAG,gCAAgC,GAAG,wBAAwB;IACzG,IAAM/O,UAAU,GAAG,CAAC,CAACyS,MAAM,CAAC1D,QAAQ,GAAG,CAACtP,QAAQ,EAAEC,MAAM,EAAE+S,MAAM,CAAC1D,QAAQ,CAAC,GAAG,CAACtP,QAAQ,EAAEC,MAAM,CAAC;IAC/F,IAAM+O,QAAQ,GAAGqB,UAAU,CAACnB,SAAS,CAACC,kBAAkB,CAAC8D,iBAAiB,EAAE1S,UAAU,CAAC;IACvF,OAAO;MAAEyO,QAAQ,EAARA,QAAQ;MAAEtH,KAAK,EAAEgJ,mBAAmB,CAACwC,WAAW;KAAI;GAC9D;EAAA,OAAA7C,UAAA;AAAA;AAtJaA,oBAAS,gBAAc,IAAI8C,aAAS,CAACC,eAAe,CAAC9R,GAAG,CAAC;;ICpC5D+R,UAAU;EAMrB,SAAAA,WAAYrK,MAAoB,EAAExE,OAAe,EAAE8J,OAAuB;IALjE,cAAS,GAAqBrM,wBAAgB,CAACoR,UAAU;IAMhE,IAAI,CAACC,WAAW,GAAG5O,YAAY,CAACF,OAAO,CAAC;IACxC,IAAI,CAACwE,MAAM,GAAGA,MAAM;IAEpB,IAAI,CAAC,CAACsF,OAAO,EAAE;MACb,EACEA,OAAO,CAACuB,OAAO,CAACtF,KAAK,CAACgJ,WAAW,EAAE,KAAK,IAAI,CAACD,WAAW,CAACC,WAAW,EAAE,IAAAzD,CADxEC,SAAS,8CAE6B,IAAI,CAACuD,WAAW;MAEtD,EAAUhF,OAAO,CAACuB,OAAO,CAAC7G,MAAM,IAAIA,MAAM,IAAA8G,CAA1CC,SAAS;MACT,IAAI,CAACyD,WAAW,GAAGlF,OAAO;;;EAE7B,IAAApO,MAAA,GAAAmT,UAAA,CAAAlT,SAAA;EAAAD,MAAA,CAEDkB,MAAM,GAAN,SAAAA,MAAMA,CAACgF,OAAqB,EAAEqN,CAAc;IAC1C/D,uBAAuB,CAACtJ,OAAO,EAAE;MAC/BwJ,aAAa,EAAE,IAAI,CAAC4D,WAAW;MAC/B7D,mBAAmB,EAAE;QACnBpF,KAAK,EAAE,IAAI,CAAC+I,WAAW;QACvBtK,MAAM,EAAE,IAAI,CAACA,MAAM,CAAChI,QAAQ;;KAE/B,CAAC;IACFoF,OAAO,CAAC9F,UAAU,CAAClD,mBAAW,CAACiC,WAAW,EAAE,CAAC6F,mBAAmB,EAAE,IAAI,CAAC8D,MAAM,CAAC,CAAC;GAChF;EAAA,OAAAqK,UAAA;AAAA;;AClBH,WAAYK,QAAQ;EAClBA,8BAAkB;EAClBA,8BAAkB;EAClBA,8BAAkB;AACpB,CAAC,EAJWA,gBAAQ,KAARA,gBAAQ;AAmEpB,IAAaC,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAIjR,OAAe;EAAA,OAC9CA,OAAO,CAAC6Q,WAAW,EAAE,KAAKxO,WAAW,CAACwO,WAAW,EAAE,IAAI7Q,OAAO,CAAC6Q,WAAW,EAAE,KAAKvO,aAAa,CAACuO,WAAW,EAAE;AAAA;AAE9G;AACA;AACA,IAAaK,kBAAkB;EAAA,SAAAA;;EAC7BA,kBAAA,CACOC,gBAAgB,GAAvB,SAAOA,gBAAgBA,CAACC,KAA0B;IAChD,IAAQnM,KAAK,GAAwBmM,KAAK,CAAlCnM,KAAK;MAAEoM,OAAO,GAAeD,KAAK,CAA3BC,OAAO;MAAEC,QAAQ,GAAKF,KAAK,CAAlBE,QAAQ;IAEhC,IAAI,CAACrM,KAAK,EAAE,MAAM,IAAI7G,KAAK,CAAC,8BAA8B,CAAC;IAC3D,IAAI,CAAC6G,KAAK,CAACX,MAAM,EAAE,MAAM,IAAIlG,KAAK,CAAC,yCAAyC,CAAC;IAC7E,IAAI6G,KAAK,CAACwI,IAAI,CAAC,UAACX,CAAC;MAAA,OAAK,CAACA,CAAC,CAACxI,MAAM;MAAC,EAAE,MAAM,IAAIlG,KAAK,CAAC,+CAA+C,CAAC;IAClG,IAAMmT,UAAU,GAAGtM,KAAK,CAAC,CAAC,CAAC;IAE3B,IAAMuM,WAAW,GAAGD,UAAU,CAAC,CAAC,CAAC,CAACF,OAAO;IACzC,IAAMI,YAAY,GAAGF,UAAU,CAACA,UAAU,CAACjN,MAAM,GAAG,CAAC,CAAC,CAACgN,QAAQ;IAE/D,IAAI,CAACE,WAAW,IAAI,CAACC,YAAY,EAAE,MAAM,IAAIrT,KAAK,CAAC,kDAAkD,CAAC;IACtG,IAAIoT,WAAW,CAAC1P,OAAO,KAAK2P,YAAY,CAAC3P,OAAO,EAC9C,MAAM,IAAI1D,KAAK,CAAC,uDAAuD,CAAC;IAE1E,IAAMsT,gBAAgB,GAAGR,kBAAkB,CAACS,UAAU,CAACV,gBAAgB,CAACI,OAAO,CAAC,EAAEG,WAAW,CAAC;IAC9F,IAAMI,iBAAiB,GAAGV,kBAAkB,CAACS,UAAU,CAACV,gBAAgB,CAACK,QAAQ,CAAC,EAAEG,YAAY,CAAC;IAEjG,IAAMI,WAAW,GAAkB5M,KAAK,CAACtG,GAAG,CAAC,UAACuL,QAAQ;MACpD,IAAM4H,WAAW,GAAG5H,QAAQ,CAAC,CAAC,CAAC,CAACX,QAAQ;MACxC,IAAMwI,YAAY,GAAG7H,QAAQ,CAACA,QAAQ,CAAC5F,MAAM,GAAG,CAAC,CAAC,CAACkF,SAAS;MAE5D,IAAI,CAACsI,WAAW,IAAI,CAACC,YAAY,EAAE;QACjC,MAAM,IAAI3T,KAAK,CAAC,4DAA4D,CAAC;;MAG/E,IAAM0F,WAAW,GAAGkO,sBAAc,CAACC,aAAa,CAACP,gBAAgB,EAAEI,WAAW,CAAC;MAC/E,IAAM/L,YAAY,GAAGiM,sBAAc,CAACC,aAAa,CAACL,iBAAiB,EAAEG,YAAY,CAAC;MAElF,IAAMG,QAAQ,GAAGhB,kBAAkB,CAACiB,gBAAgB,CAAgBnB,gBAAQ,CAACoB,MAAM,EAAElI,QAAQ,CAAC;MAC9F,IAAMmI,QAAQ,GAAGnB,kBAAkB,CAACiB,gBAAgB,CAAgBnB,gBAAQ,CAAC5H,MAAM,EAAEc,QAAQ,CAAC;MAC9F,IAAMoI,QAAQ,GAAGpB,kBAAkB,CAACiB,gBAAgB,CAAgBnB,gBAAQ,CAAC9R,MAAM,EAAEgL,QAAQ,CAAC;MAC9F,OAAO;QACLqI,OAAO,EAAED,QAAQ,GACb,IAAIjK,WAAO,CACR6B,QAA4B,CAACvL,GAAG,CAACuS,kBAAkB,CAACsB,QAAQ,CAAC,EAC9Dd,gBAAgB,EAChBE,iBAAiB,CAClB,GACD,IAAI;QACRa,OAAO,EAAEJ,QAAQ,GACb,IAAIK,WAAO,CACRxI,QAA4B,CAACvL,GAAG,CAACuS,kBAAkB,CAACyB,QAAQ,CAAC,EAC9DjB,gBAAgB,EAChBE,iBAAiB,CAClB,GACD,IAAI;QACRgB,OAAO,EAAEV,QAAQ,GACb,IAAIW,WAAO,CACR3I,QAA4B,CAACvL,GAAG,CAACuS,kBAAkB,CAAC4B,MAAM,CAAC,EAC5DpB,gBAAgB,EAChBE,iBAAiB,CAClB,GACD,IAAI;QACRmB,UAAU,EACR,CAACT,QAAQ,IAAI,CAACD,QAAQ,IAAI,CAACH,QAAQ,GAC/B,IAAI9H,uBAAa,CAACF,QAAQ,CAACvL,GAAG,CAACuS,kBAAkB,CAAC8B,YAAY,CAAC,EAAEtB,gBAAgB,EAAEE,iBAAiB,CAAC,GACrG,IAAI;QACV9N,WAAW,EAAXA,WAAW;QACXiC,YAAY,EAAZA;OACD;KACF,CAAC;IAEF,OAAO,IAAIkN,eAAW,CAAC;MACrBC,QAAQ,EAAErB,WAAW,CAClBsB,MAAM,CAAC,UAAClO,KAAK;QAAA,OAAKA,KAAK,CAAC2N,OAAO;QAAC,CAChCjU,GAAG,CAAC,UAACsG,KAAK;QAAA,OAAM;UACf2N,OAAO,EAAE3N,KAAK,CAAC2N,OAAsC;UACrD9O,WAAW,EAAEmB,KAAK,CAACnB,WAAW;UAC9BiC,YAAY,EAAEd,KAAK,CAACc;SACrB;OAAC,CAAC;MACLqN,QAAQ,EAAEvB,WAAW,CAClBsB,MAAM,CAAC,UAAClO,KAAK;QAAA,OAAKA,KAAK,CAACwN,OAAO;QAAC,CAChC9T,GAAG,CAAC,UAACsG,KAAK;QAAA,OAAM;UACfwN,OAAO,EAAExN,KAAK,CAACwN,OAAsC;UACrD3O,WAAW,EAAEmB,KAAK,CAACnB,WAAW;UAC9BiC,YAAY,EAAEd,KAAK,CAACc;SACrB;OAAC,CAAC;MACLsN,QAAQ,EAAExB,WAAW,CAClBsB,MAAM,CAAC,UAAClO,KAAK;QAAA,OAAKA,KAAK,CAACsN,OAAO;QAAC,CAChC5T,GAAG,CAAC,UAACsG,KAAK;QAAA,OAAM;UACfsN,OAAO,EAAEtN,KAAK,CAACsN,OAAsC;UACrDzO,WAAW,EAAEmB,KAAK,CAACnB,WAAW;UAC9BiC,YAAY,EAAEd,KAAK,CAACc;SACrB;OAAC,CAAC;MACLuN,WAAW,EAAEzB,WAAW,CACrBsB,MAAM,CAAC,UAAClO,KAAK;QAAA,OAAKA,KAAK,CAAC8N,UAAU;QAAC,CACnCpU,GAAG,CAAC,UAACsG,KAAK;QAAA,OAAM;UACf8N,UAAU,EAAE9N,KAAK,CAAC8N,UAA+C;UACjEjP,WAAW,EAAEmB,KAAK,CAACnB,WAAW;UAC9BiC,YAAY,EAAEd,KAAK,CAACc;SACrB;OAAC,CAAC;MACL7B,SAAS,EAAEkN,KAAK,CAAClN;KAClB,CAAC;GACH;EAAAgN,kBAAA,CAEcS,UAAU,GAAjB,SAAOA,UAAUA,CAACjP,QAAiB,EAAEmF,KAAmB;IAC9D,IAAInF,QAAQ,EAAE;MACZ,OAAO6Q,aAAK,CAACC,OAAO,CAAC3L,KAAK,CAAC/F,OAAO,CAAC;;IAErC,OAAO,IAAI,CAAC2R,OAAO,CAAC5L,KAAK,CAAC;GAC3B;EAAAqJ,kBAAA,CAecuC,OAAO,GAAd,SAAOA,OAAOA,CAAC5L,KAAmB;IACxC,IAAQ/F,OAAO,GAAuD+F,KAAK,CAAnE/F,OAAO;MAAE9B,OAAO,GAA8C6H,KAAK,CAA1D7H,OAAO;MAAE0T,QAAQ,GAAoC7L,KAAK,CAAjD6L,QAAQ;MAAEpU,MAAM,GAA4BuI,KAAK,CAAvCvI,MAAM;MAAEqU,SAAS,GAAiB9L,KAAK,CAA/B8L,SAAS;MAAEC,UAAU,GAAK/L,KAAK,CAApB+L,UAAU;IACjE,OAAO,IAAIC,aAAK,CACd/R,OAAO,EACP9B,OAAO,EACP8T,QAAQ,CAACJ,QAAQ,CAACpV,QAAQ,EAAE,CAAC,EAC7BgB,MAAM,YACKkJ,SAAS,EACpB,KAAK,EACLmL,SAAS,GAAGzR,gBAAS,CAACC,IAAI,CAACwR,SAAS,CAAC,GAAGnL,SAAS,EACjDoL,UAAU,GAAG1R,gBAAS,CAACC,IAAI,CAACyR,UAAU,CAAC,GAAGpL,SAAS,CACpD;GACF;EAAA0I,kBAAA,CAEcyB,QAAQ,GAAf,SAAOA,QAAQA,CAAAjL,IAAA;QAAG9E,GAAG,GAAA8E,IAAA,CAAH9E,GAAG;MAAE2M,YAAY,GAAA7H,IAAA,CAAZ6H,YAAY;MAAEwE,SAAS,GAAArM,IAAA,CAATqM,SAAS;MAAEC,WAAW,GAAAtM,IAAA,CAAXsM,WAAW;MAAE3C,OAAO,GAAA3J,IAAA,CAAP2J,OAAO;MAAEC,QAAQ,GAAA5J,IAAA,CAAR4J,QAAQ;IACpF,OAAO,IAAIlI,UAAM,CACf8H,kBAAkB,CAACuC,OAAO,CAACpC,OAAO,CAAC,EACnCH,kBAAkB,CAACuC,OAAO,CAACnC,QAAQ,CAAC,EACpCwC,QAAQ,CAAClR,GAAG,CAAc,EAC1B2M,YAAY,EACZwE,SAAS,EACTD,QAAQ,CAACE,WAAW,CAAC,CACtB;GACF;EAAA9C,kBAAA,CAEcsB,QAAQ,GAAf,SAAOA,QAAQA,CAACzT,IAAmB;IACzC,IAAM2S,gBAAgB,GAAGR,kBAAkB,CAACS,UAAU,CAACV,gBAAgB,CAAClS,IAAI,CAACsS,OAAO,CAACrR,OAAO,CAAC,EAAEjB,IAAI,CAACsS,OAAO,CAAC;IAC5G,IAAMO,iBAAiB,GAAGV,kBAAkB,CAACS,UAAU,CAACV,gBAAgB,CAAClS,IAAI,CAACuS,QAAQ,CAACtR,OAAO,CAAC,EAAEjB,IAAI,CAACuS,QAAQ,CAAC;IAC/G,OAAO,IAAIpS,UAAM,CACfwS,gBAAgB,EAChBE,iBAAiB,EACjBkC,QAAQ,CAAC/U,IAAI,CAAC6D,GAAG,CAAc,EAC/BkR,QAAQ,CAAC/U,IAAI,CAACsQ,WAAW,CAAC,EAC1BtQ,IAAI,CAACuQ,KAAK,EACVvQ,IAAI,CAACwQ,YAAY,EACjBxQ,IAAI,CAACgV,SAAS,EACdD,QAAQ,CAAC/U,IAAI,CAACiV,WAAW,CAAC,CAC3B;GACF;EAAA9C,kBAAA,CASciB,gBAAgB,GAAvB,SAAOA,gBAAgBA,CAC7BvW,IAAc,EACdqJ,KAAwD;IAExD,OAAOA,KAAK,CAACgP,KAAK,CAAC,UAAClV,IAAI;MAAA,OAAKA,IAAI,CAACnD,IAAI,KAAKA,IAAI;MAAC;GACjD;EAAA,OAAAsV,kBAAA;AAAA;AAjEcA,+BAAY,GAAG,UAACnS,IAAmD;EAChF,QAAQA,IAAI,CAACnD,IAAI;IACf,KAAKoV,gBAAQ,CAAC9R,MAAM;MAClB,OAAOgS,kBAAkB,CAACsB,QAAQ,CAACzT,IAAI,CAAC;IAC1C,KAAKiS,gBAAQ,CAAC5H,MAAM;MAClB,OAAO8H,kBAAkB,CAACyB,QAAQ,CAAC5T,IAAI,CAAC;IAC1C,KAAKiS,gBAAQ,CAACoB,MAAM;MAClB,OAAOlB,kBAAkB,CAAC4B,MAAM,CAAC/T,IAAI,CAAC;IACxC;MACE,MAAM,IAAIX,KAAK,CAAC,mBAAmB,CAAC;;AAE1C,CAAC;AA0Cc8S,yBAAM,GAAG,UAAApJ,KAAA;MAAGoM,QAAQ,GAAApM,KAAA,CAARoM,QAAQ;IAAEC,QAAQ,GAAArM,KAAA,CAARqM,QAAQ;EAC3C,OAAO,IAAI9K,UAAI,CACb2I,sBAAc,CAACC,aAAa,CAACf,kBAAkB,CAACuC,OAAO,CAACS,QAAQ,CAACrM,KAAK,CAAC,EAAEqM,QAAQ,CAACnR,QAAQ,CAAC,EAC3FiP,sBAAc,CAACC,aAAa,CAACf,kBAAkB,CAACuC,OAAO,CAACU,QAAQ,CAACtM,KAAK,CAAC,EAAEsM,QAAQ,CAACpR,QAAQ,CAAC,CAC5F;AACH,CAAC;;AC9NH;AACA,IAAsBqR,aAAa;EAAA,SAAAA;EAAAA,aAAA,CAGnBC,aAAa,GAApB,SAAOA,aAAaA,CAAC/H,QAAgB;IAC1C,IAAMgI,aAAa,GAAG,IAAIC,oBAAoB,CAACjZ,kBAAkB,CAAC;IAClE,IAAMkZ,aAAa,GAAGJ,aAAa,CAAC5H,SAAS,CAACiI,gBAAgB,CAAC;MAAEC,IAAI,EAAEpI;KAAU,CAAC;IAClF,IAAAqI,mBAAA,GAA6BH,aAAa,CAACI,IAAI;MAAvCtX,QAAQ,GAAAqX,mBAAA,CAARrX,QAAQ;MAAEC,MAAM,GAAAoX,mBAAA,CAANpX,MAAM;IACxB,OAAO+W,aAAa,CAACO,KAAK,CAACvX,QAAQ,EAAEC,MAAM,CAAC;GAC7C;EAAA,OAAA6W,aAAA;AAAA;AAPaA,uBAAS,gBAAc,IAAI3D,aAAS,CAACC,eAAe,CAAC9R,GAAG,CAAC;AAUzE;AACA,IAAa2V,oBAAoB;EAC/B,SAAAA,qBAA6BO,iBAAqC;IAArC,sBAAiB,GAAjBA,iBAAiB;;EAAwB,IAAAtX,MAAA,GAAA+W,oBAAA,CAAA9W,SAAA;EAAAD,MAAA,CAE/DqX,KAAK,GAAL,SAAAA,KAAKA,CAACvX,QAAgB,EAAEC,MAAgB;;IAC7C,IAAMwX,YAAY,GAAGR,oBAAoB,CAACS,WAAW,CAAC1X,QAAQ,CAAC;IAE/D,OAAO;MACLA,QAAQ,EAAEyX,YAAY,CAACpW,GAAG,CAAC,UAACsW,WAAwB,EAAErL,CAAS;QAC7D,IAAMpL,UAAU,GAAG0W,KAAI,CAACJ,iBAAiB,CAACG,WAAW,CAAC;QAEtD,IAAIzW,UAAU,CAAChD,MAAM,KAAKZ,cAAM,CAAC6B,SAAS,EAAE;UAC1C,IAAA0Y,qBAAA,GAAoBC,yBAAmB,CAACf,aAAa,CAAC9W,MAAM,CAACqM,CAAC,CAAC,CAAC;YAAxDyL,OAAO,GAAAF,qBAAA,CAAPE,OAAO;UACf,OAAO;YACLC,WAAW,EAAE5a,mBAAW,CAACua,WAAW,CAAC;YACrCA,WAAW,EAAXA,WAAW;YACXvZ,MAAM,EAAE6Z,oBAAoB,CAACF,OAAO;WACrC;SACF,MAAM,IAAI7W,UAAU,CAAChD,MAAM,KAAKZ,cAAM,CAACa,GAAG,EAAE;UAC3C,IAAM+Z,MAAM,GAAGhX,UAAU,CAAC9C,MAAM;UAChC,IAAM+Z,SAAS,GAAG3J,aAAM,CAACC,KAAK,CAACtN,eAAe,CAACiX,MAAM,CACnDF,MAAM,CAAC7W,GAAG,CAAC,UAACZ,OAAO;YAAA,OAAKA,OAAO,CAACnC,IAAI;YAAC,EACrC2B,MAAM,CAACqM,CAAC,CAAC,CACV;UAED,IAAMlO,MAAM,GAAG+Z,SAAS,CAAC9W,GAAG,CAAC,UAACgX,KAAU,EAAEC,CAAS;YACjD,QAAQJ,MAAM,CAACI,CAAC,CAAC,CAAC1Z,SAAS;cACzB,KAAKvB,iBAAS,CAACwB,aAAa;gBAC1B,OAAO;kBACLR,IAAI,EAAE6Z,MAAM,CAACI,CAAC,CAAC,CAACja,IAAI;kBACpBqJ,KAAK,EAAE6Q,kBAAkB,CAACF,KAAK;iBAChC;cACH,KAAKhb,iBAAS,CAAC0B,cAAc;gBAC3B,OAAO;kBACLV,IAAI,EAAE6Z,MAAM,CAACI,CAAC,CAAC,CAACja,IAAI;kBACpBqJ,KAAK,EAAE8Q,mBAAmB,CAACH,KAAK;iBACjC;cACH;gBACE,OAAO;kBACLha,IAAI,EAAE6Z,MAAM,CAACI,CAAC,CAAC,CAACja,IAAI;kBACpBqJ,KAAK,EAAE2Q;iBACR;;WAEN,CAAC;UACF,OAAO;YACLL,WAAW,EAAE5a,mBAAW,CAACua,WAAW,CAAC;YACrCA,WAAW,EAAXA,WAAW;YACXvZ,MAAM,EAANA;WACD;SACF,MAAM,IAAI8C,UAAU,CAAChD,MAAM,KAAKZ,cAAM,CAACsC,SAAS,EAAE;;UAEjD,OAAO;YACLoY,WAAW,EAAE5a,mBAAW,CAACua,WAAW,CAAC;YACrCA,WAAW,EAAXA,WAAW;YACXvZ,MAAM,EAAE6B,MAAM,CAACoB,GAAG,CAAC,UAACgM,KAAK;cAAA,OAAM;gBAAEhP,IAAI,EAAE,SAAS;gBAAEqJ,KAAK,EAAE2F;eAAO;aAAC;WAClE;SACF,MAAM;UACL,MAAM,IAAIvM,KAAK,0BAAwBI,UAAY,CAAC;;OAEvD;KACF;;;;EAGH+V,oBAAA,CACeS,WAAW,GAAlB,SAAOA,WAAWA,CAAC1X,QAAgB;IACzC,IAAMyX,YAAY,GAAkB,EAAE;IAEtC,KAAK,IAAInL,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGtM,QAAQ,CAACgH,MAAM,EAAEsF,CAAC,IAAI,CAAC,EAAE;MAC3C,IAAMmM,KAAI,GAAGzY,QAAQ,CAAC0Y,SAAS,CAACpM,CAAC,EAAEA,CAAC,GAAG,CAAC,CAAC;MACzCmL,YAAY,CAAC9W,IAAI,CAAC6V,QAAQ,CAACiC,KAAI,EAAE,EAAE,CAAgB,CAAC;;IAGtD,OAAOhB,YAAY;GACpB;EAAA,OAAAR,oBAAA;AAAA;AAGH,SAAgBsB,kBAAkBA,CAACjO,IAAY;EAC7C,IAAMqO,YAAY,GAAGrO,IAAI,CAACsO,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC;EAC3C,IAAI7E,OAAO,GAAGvF,aAAM,CAACC,KAAK,CAACoK,UAAU,CAACF,YAAY,CAACD,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;EACpE,IAAII,GAAG,GAAG,EAAE;EACZ,IAAMC,GAAG,GAAiB,EAAE;EAC5B,OAAOD,GAAG,GAAGH,YAAY,CAAC3R,MAAM,EAAE;IAChC,IAAMgS,cAAc,GAAGL,YAAY,CAACD,SAAS,CAACI,GAAG,EAAEA,GAAG,GAAG,EAAE,CAAC;IAC5D,IAAMxT,GAAG,GAAGkR,QAAQ,CAACwC,cAAc,CAACN,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC;IACxD,IAAM1E,QAAQ,GAAGxF,aAAM,CAACC,KAAK,CAACoK,UAAU,CAACG,cAAc,CAACN,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IAEzEK,GAAG,CAACpY,IAAI,CAAC;MACPoT,OAAO,EAAPA,OAAO;MACPC,QAAQ,EAARA,QAAQ;MACR1O,GAAG,EAAHA;KACD,CAAC;IACFyO,OAAO,GAAGC,QAAQ;IAClB8E,GAAG,IAAI,EAAE;;EAGX,OAAOC,GAAG;AACZ;AAEA,SAAgBP,mBAAmBA,CAAClO,IAAY;EAC9C,IAAMqO,YAAY,GAAGrO,IAAI,CAACsO,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC;EAC3C,IAAI7E,OAAO,GAAGvF,aAAM,CAACC,KAAK,CAACoK,UAAU,CAACF,YAAY,CAACD,SAAS,CAACC,YAAY,CAAC3R,MAAM,GAAG,EAAE,CAAC,CAAC;EACvF,IAAI8R,GAAG,GAAGH,YAAY,CAAC3R,MAAM,GAAG,EAAE,CAAA;EAClC,IAAM+R,GAAG,GAAiB,EAAE;EAC5B,OAAOD,GAAG,IAAI,CAAC,EAAE;IACf,IAAME,cAAc,GAAGL,YAAY,CAACD,SAAS,CAACI,GAAG,EAAEA,GAAG,GAAG,EAAE,CAAC;IAC5D,IAAM9E,QAAQ,GAAGxF,aAAM,CAACC,KAAK,CAACoK,UAAU,CAACG,cAAc,CAACN,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IACzE,IAAMpT,GAAG,GAAGkR,QAAQ,CAACwC,cAAc,CAACN,SAAS,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC;IAE1DK,GAAG,CAACpY,IAAI,CAAC;MACPoT,OAAO,EAAPA,OAAO;MACPC,QAAQ,EAARA,QAAQ;MACR1O,GAAG,EAAHA;KACD,CAAC;IACFyO,OAAO,GAAGC,QAAQ;IAElB8E,GAAG,IAAI,EAAE;;EAGX,OAAOC,GAAG;AACZ;AAEA,SAASd,oBAAoBA,CAACF,OAAkC;EAC9D,OAAOA,OAAO,CAAC1W,GAAG,CAAC,UAAC4X,MAAM;IACxB,OAAO;MACL5a,IAAI,EAAE4a,MAAM,CAACC,UAAU;MACvBxR,KAAK,EAAEuR,MAAM,CAAC7a,MAAM,CAACiD,GAAG,CAAC,UAACgX,KAAK;QAC7B,OAAO;UACLha,IAAI,EAAEga,KAAK,CAACha,IAAI;UAChBqJ,KAAK,EAAE2Q,KAAK,CAAC3Q;SACd;OACF;KACF;GACF,CAAC;AACJ;;;;;;;;;;;;;;;;"}
\ No newline at end of file
+{"version":3,"file":"universal-router-sdk.cjs.development.js","sources":["../src/utils/routerCommands.ts","../src/utils/pathCurrency.ts","../src/entities/Command.ts","../src/utils/constants.ts","../src/utils/getCurrencyAddress.ts","../src/utils/numbers.ts","../src/entities/actions/uniswap.ts","../src/utils/inputTokens.ts","../src/utils/eip712.ts","../src/swapRouter.ts","../src/entities/actions/unwrapWETH.ts","../src/utils/routerTradeAdapter.ts","../src/utils/commandParser.ts"],"sourcesContent":["import { defaultAbiCoder } from 'ethers/lib/utils'\nimport { AcrossV4DepositV3Params } from '../entities/actions/across'\n\n/**\n * CommandTypes\n * @description Flags that modify a command's execution\n * @enum {number}\n */\nexport enum CommandType {\n  V3_SWAP_EXACT_IN = 0x00,\n  V3_SWAP_EXACT_OUT = 0x01,\n  PERMIT2_TRANSFER_FROM = 0x02,\n  PERMIT2_PERMIT_BATCH = 0x03,\n  SWEEP = 0x04,\n  TRANSFER = 0x05,\n  PAY_PORTION = 0x06,\n\n  V2_SWAP_EXACT_IN = 0x08,\n  V2_SWAP_EXACT_OUT = 0x09,\n  PERMIT2_PERMIT = 0x0a,\n  WRAP_ETH = 0x0b,\n  UNWRAP_WETH = 0x0c,\n  PERMIT2_TRANSFER_FROM_BATCH = 0x0d,\n  BALANCE_CHECK_ERC20 = 0x0e,\n\n  V4_SWAP = 0x10,\n  V3_POSITION_MANAGER_PERMIT = 0x11,\n  V3_POSITION_MANAGER_CALL = 0x12,\n  V4_INITIALIZE_POOL = 0x13,\n  V4_POSITION_MANAGER_CALL = 0x14,\n\n  EXECUTE_SUB_PLAN = 0x21,\n\n  // 3rd party integrations\n  ACROSS_V4_DEPOSIT_V3 = 0x40,\n}\n\nexport enum Subparser {\n  V3PathExactIn,\n  V3PathExactOut,\n}\n\nexport enum Parser {\n  Abi,\n  V4Actions,\n  V3Actions,\n}\n\nexport type ParamType = {\n  readonly name: string\n  readonly type: string\n  readonly subparser?: Subparser\n}\n\nexport type CommandDefinition =\n  | {\n      parser: Parser.Abi\n      params: ParamType[]\n    }\n  | {\n      parser: Parser.V4Actions\n    }\n  | {\n      parser: Parser.V3Actions\n    }\n\nconst ALLOW_REVERT_FLAG = 0x80\nconst REVERTIBLE_COMMANDS = new Set<CommandType>([CommandType.EXECUTE_SUB_PLAN])\n\nconst PERMIT_STRUCT =\n  '((address token,uint160 amount,uint48 expiration,uint48 nonce) details,address spender,uint256 sigDeadline)'\n\nconst PERMIT_BATCH_STRUCT =\n  '((address token,uint160 amount,uint48 expiration,uint48 nonce)[] details,address spender,uint256 sigDeadline)'\n\nconst POOL_KEY_STRUCT = '(address currency0,address currency1,uint24 fee,int24 tickSpacing,address hooks)'\n\nconst PERMIT2_TRANSFER_FROM_STRUCT = '(address from,address to,uint160 amount,address token)'\nconst PERMIT2_TRANSFER_FROM_BATCH_STRUCT = PERMIT2_TRANSFER_FROM_STRUCT + '[]'\n\nexport const COMMAND_DEFINITION: { [key in CommandType]: CommandDefinition } = {\n  // Batch Reverts\n  [CommandType.EXECUTE_SUB_PLAN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'commands', type: 'bytes' },\n      { name: 'inputs', type: 'bytes[]' },\n    ],\n  },\n\n  // Permit2 Actions\n  [CommandType.PERMIT2_PERMIT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'permit', type: PERMIT_STRUCT },\n      { name: 'signature', type: 'bytes' },\n    ],\n  },\n  [CommandType.PERMIT2_PERMIT_BATCH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'permit', type: PERMIT_BATCH_STRUCT },\n      { name: 'signature', type: 'bytes' },\n    ],\n  },\n  [CommandType.PERMIT2_TRANSFER_FROM]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'amount', type: 'uint160' },\n    ],\n  },\n  [CommandType.PERMIT2_TRANSFER_FROM_BATCH]: {\n    parser: Parser.Abi,\n    params: [\n      {\n        name: 'transferFrom',\n        type: PERMIT2_TRANSFER_FROM_BATCH_STRUCT,\n      },\n    ],\n  },\n\n  // Uniswap Actions\n  [CommandType.V3_SWAP_EXACT_IN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountIn', type: 'uint256' },\n      { name: 'amountOutMin', type: 'uint256' },\n      { name: 'path', subparser: Subparser.V3PathExactIn, type: 'bytes' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V3_SWAP_EXACT_OUT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountOut', type: 'uint256' },\n      { name: 'amountInMax', type: 'uint256' },\n      { name: 'path', subparser: Subparser.V3PathExactOut, type: 'bytes' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V2_SWAP_EXACT_IN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountIn', type: 'uint256' },\n      { name: 'amountOutMin', type: 'uint256' },\n      { name: 'path', type: 'address[]' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V2_SWAP_EXACT_OUT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountOut', type: 'uint256' },\n      { name: 'amountInMax', type: 'uint256' },\n      { name: 'path', type: 'address[]' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V4_SWAP]: { parser: Parser.V4Actions },\n\n  // Token Actions and Checks\n  [CommandType.WRAP_ETH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amount', type: 'uint256' },\n    ],\n  },\n  [CommandType.UNWRAP_WETH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountMin', type: 'uint256' },\n    ],\n  },\n  [CommandType.SWEEP]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'amountMin', type: 'uint256' },\n    ],\n  },\n  [CommandType.TRANSFER]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'value', type: 'uint256' },\n    ],\n  },\n  [CommandType.PAY_PORTION]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'bips', type: 'uint256' },\n    ],\n  },\n  [CommandType.BALANCE_CHECK_ERC20]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'owner', type: 'address' },\n      { name: 'token', type: 'address' },\n      { name: 'minBalance', type: 'uint256' },\n    ],\n  },\n  [CommandType.V4_INITIALIZE_POOL]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'poolKey', type: POOL_KEY_STRUCT },\n      { name: 'sqrtPriceX96', type: 'uint160' },\n    ],\n  },\n\n  // Position Actions\n  [CommandType.V3_POSITION_MANAGER_PERMIT]: { parser: Parser.V3Actions },\n  [CommandType.V3_POSITION_MANAGER_CALL]: { parser: Parser.V3Actions },\n  [CommandType.V4_POSITION_MANAGER_CALL]: { parser: Parser.V4Actions },\n\n  // 3rd party integrations\n  [CommandType.ACROSS_V4_DEPOSIT_V3]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'depositor', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'inputToken', type: 'address' },\n      { name: 'outputToken', type: 'address' },\n      { name: 'inputAmount', type: 'uint256' },\n      { name: 'outputAmount', type: 'uint256' },\n      { name: 'destinationChainId', type: 'uint256' },\n      { name: 'exclusiveRelayer', type: 'address' },\n      { name: 'quoteTimestamp', type: 'uint32' },\n      { name: 'fillDeadline', type: 'uint32' },\n      { name: 'exclusivityDeadline', type: 'uint32' },\n      { name: 'message', type: 'bytes' },\n      { name: 'useNative', type: 'bool' },\n    ],\n  },\n}\n\nexport class RoutePlanner {\n  commands: string\n  inputs: string[]\n\n  constructor() {\n    this.commands = '0x'\n    this.inputs = []\n  }\n\n  addSubPlan(subplan: RoutePlanner): RoutePlanner {\n    this.addCommand(CommandType.EXECUTE_SUB_PLAN, [subplan.commands, subplan.inputs], true)\n    return this\n  }\n\n  addAcrossBridge(params: AcrossV4DepositV3Params): RoutePlanner {\n    this.addCommand(CommandType.ACROSS_V4_DEPOSIT_V3, [\n      params.depositor,\n      params.recipient,\n      params.inputToken,\n      params.outputToken,\n      params.inputAmount,\n      params.outputAmount,\n      params.destinationChainId,\n      params.exclusiveRelayer,\n      params.quoteTimestamp,\n      params.fillDeadline,\n      params.exclusivityDeadline,\n      params.message,\n      params.useNative,\n    ])\n    return this\n  }\n\n  addCommand(type: CommandType, parameters: any[], allowRevert = false): RoutePlanner {\n    let command = createCommand(type, parameters)\n    this.inputs.push(command.encodedInput)\n    if (allowRevert) {\n      if (!REVERTIBLE_COMMANDS.has(command.type)) {\n        throw new Error(`command type: ${command.type} cannot be allowed to revert`)\n      }\n      command.type = command.type | ALLOW_REVERT_FLAG\n    }\n\n    this.commands = this.commands.concat(command.type.toString(16).padStart(2, '0'))\n    return this\n  }\n}\n\nexport type RouterCommand = {\n  type: CommandType\n  encodedInput: string\n}\n\nexport function createCommand(type: CommandType, parameters: any[]): RouterCommand {\n  const commandDef = COMMAND_DEFINITION[type]\n  switch (commandDef.parser) {\n    case Parser.Abi:\n      const encodedInput = defaultAbiCoder.encode(\n        commandDef.params.map((abi) => abi.type),\n        parameters\n      )\n      return { type, encodedInput }\n    case Parser.V4Actions:\n      // v4 swap data comes pre-encoded at index 0\n      return { type, encodedInput: parameters[0] }\n    case Parser.V3Actions:\n      // v4 swap data comes pre-encoded at index 0\n      return { type, encodedInput: parameters[0] }\n  }\n}\n","import { Currency, Token } from '@uniswap/sdk-core'\nimport { Pool as V4Pool } from '@uniswap/v4-sdk'\nimport { TPool } from '@uniswap/router-sdk'\n\nexport function getPathCurrency(currency: Currency, pool: TPool): Currency {\n  // return currency if the currency matches a currency of the pool\n  if (pool.involvesToken(currency as Token)) {\n    return currency\n\n    // return if currency.wrapped if pool involves wrapped currency\n  } else if (pool.involvesToken(currency.wrapped as Token)) {\n    return currency.wrapped\n\n    // return native currency if pool involves native version of wrapped currency (only applies to V4)\n  } else if (pool instanceof V4Pool && pool.token0.wrapped.equals(currency)) {\n    return pool.token0\n  } else if (pool instanceof V4Pool && pool.token1.wrapped.equals(currency)) {\n    return pool.token1\n  } else {\n    throw new Error(`Expected currency ${currency.symbol} to be either ${pool.token0.symbol} or ${pool.token1.symbol}`)\n  }\n\n  return currency // this line needed for typescript to compile\n}\n","import { RoutePlanner } from '../utils/routerCommands'\n\nexport type TradeConfig = {\n  allowRevert: boolean\n}\n\nexport enum RouterActionType {\n  UniswapTrade = 'UniswapTrade',\n  UnwrapWETH = 'UnwrapWETH',\n}\n\n// interface for entities that can be encoded as a Universal Router command\nexport interface Command {\n  tradeType: RouterActionType\n  encode(planner: RoutePlanner, config: TradeConfig): void\n}\n","import { BigNumber } from 'ethers'\n\nexport enum UniversalRouterVersion {\n  V1_2 = '1.2',\n  V2_0 = '2.0',\n  V2_1 = '2.1',\n}\n\nexport type RouterConfig = {\n  address: string\n  creationBlock: number\n}\n\ntype ChainConfig = {\n  weth: string\n  routerConfigs: { [key in UniversalRouterVersion]: RouterConfig }\n}\n\nconst ZERO_ROUTER_CONFIG: RouterConfig = {\n  address: '0x0000000000000000000000000000000000000000',\n  creationBlock: 1,\n}\n\nconst WETH_NOT_SUPPORTED_ON_CHAIN = '0x0000000000000000000000000000000000000000'\n\n// Todo: Change `CHAIN_CONFIGS` to pull the UR address with v4\nexport const CHAIN_CONFIGS: { [key: number]: ChainConfig } = {\n  // mainnet\n  [1]: {\n    weth: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17143817,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x66a9893cc07d91d95644aedd05d03f95e1dba8af',\n        creationBlock: 21689092,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0xd92a36b0000531ef3063ded4de20a0783308446c',\n        creationBlock: 23836348,\n      },\n    },\n  },\n  // goerli\n  [5]: {\n    weth: '0xb4fbf271143f4fbf7b91a5ded31805e42b2208d6',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8940568,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8940568,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // sepolia\n  [11155111]: {\n    weth: '0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 3543575,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3a9d48ab9751398bbfa63ad67599bb04e4bdf98b', // only update here and creation block below\n        creationBlock: 7259601,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0x470FFC67b1feEEC31D16C46AC7545C98716a194c',\n        creationBlock: 9664766,\n      },\n    },\n  },\n  // polygon\n  [137]: {\n    weth: '0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xec7BE89e9d109e7e3Fec59c222CF297125FEFda2',\n        creationBlock: 52210153,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x1095692a6237d83c6a72f3f5efedb9a670c49223',\n        creationBlock: 66980401,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0xE27610fD9dD05FC061366bc9dA414CA6F948f204',\n        creationBlock: 79245524,\n      },\n    },\n  },\n  //polygon mumbai\n  [80001]: {\n    weth: '0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 35176052,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 35176052,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  //optimism\n  [10]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xCb1355ff08Ab38bBCE60111F1bb2B784bE25D7e8',\n        creationBlock: 114702266,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x851116d9223fabed8e56c0e6b8ad0c31d98b3507',\n        creationBlock: 129906462,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0xde20EEE5398D3790a4D356e8925bD21Ea65D99Af',\n        creationBlock: 134078764,\n      },\n    },\n  },\n  // optimism goerli\n  [420]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8887728,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8887728,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // arbitrum\n  [42161]: {\n    weth: '0x82aF49447D8a07e3bd95BD0d56f35241523fBab1',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x5E325eDA8064b456f4781070C0738d849c824258',\n        creationBlock: 169472836,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xa51afafe0263b40edaef0df8781ea9aa03e381a3',\n        creationBlock: 290124593,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0x96b2FD2F80e9428Daa65d859653117D453981AB4',\n        creationBlock: 329155034,\n      },\n    },\n  },\n  // arbitrum goerli\n  [421613]: {\n    weth: '0xe39Ab88f8A4777030A534146A9Ca3B52bd5D43A3',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 18815277,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 18815277,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // celo\n  [42220]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x643770e279d5d0733f21d6dc03a8efbabf3255b4',\n        creationBlock: 21407637,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xcb695bc5D3Aa22cAD1E6DF07801b061a05A0233A',\n        creationBlock: 47387857,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // celo alfajores\n  [44787]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17566658,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17566658,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // binance smart chain\n  [56]: {\n    weth: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4Dae2f939ACf50408e13d58534Ff8c2776d45265',\n        creationBlock: 35160263,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x1906c1d672b88cd1b9ac7593301ca990f94eae07',\n        creationBlock: 1737493275,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // avalanche\n  [43114]: {\n    weth: '0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4Dae2f939ACf50408e13d58534Ff8c2776d45265',\n        creationBlock: 40237257,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x94b75331ae8d42c1b61065089b7d48fe14aa73b7',\n        creationBlock: 1737558236,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0x0Cf1f86B331A03179646341D10A2A87515087221',\n        creationBlock: 58800800,\n      },\n    },\n  },\n  // base goerli\n  [84531]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',\n        creationBlock: 6915289,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',\n        creationBlock: 6915289,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // base mainnet\n  [8453]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 9107268,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x6ff5693b99212da76ad316178a184ab56d299b43',\n        creationBlock: 1737491485,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0xf3a4f4094bd2c6c06ca2f61789d8727b8d1e7259',\n        creationBlock: 28539210,\n      },\n    },\n  },\n  // blast\n  [81457]: {\n    weth: '0x4300000000000000000000000000000000000004',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x643770E279d5D0733F21d6DC03A8efbABf3255B4',\n        creationBlock: 1116444,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xeabbcb3e8e415306207ef514f660a3f820025be3',\n        creationBlock: 1737564586,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // zora\n  [7777777]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x2986d9721A49838ab4297b695858aF7F17f38014',\n        creationBlock: 11832155,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3315ef7ca28db74abadc6c44570efdf06b04b020',\n        creationBlock: 1737562927,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [324]: {\n    weth: '0x5aea5775959fbc2557cc8789bc1bf90a239d9a91',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',\n        creationBlock: 12640979,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',\n        creationBlock: 12640979,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // worldchain\n  [480]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D',\n        creationBlock: 4063979,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x8ac7bee993bb44dab564ea4bc9ea67bf9eb5e743',\n        creationBlock: 1737559557,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [1301]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x8909Dc15e40173Ff4699343b6eB8132c65e18eC6',\n        creationBlock: 1241811,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xf70536b3bcc1bd1a972dc186a2cf84cc6da6be5d',\n        creationBlock: 7100543,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // unichain mainnet\n  [130]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4D73A4411CA1c660035e4AECC8270E5DdDEC8C17',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xef740bf23acae26f6492b10de645d6b98dc8eaf3',\n        creationBlock: 1737568156,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [10143]: {\n    weth: '0x760AfE86e5de5fa0Ee542fc7B7B713e1c5425701',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [84532]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x492e6456d9528771018deb9e87ef7750ef184104',\n        creationBlock: 20216585,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x492e6456d9528771018deb9e87ef7750ef184104',\n        creationBlock: 20216585,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [1868]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',\n        creationBlock: 3254782,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',\n        creationBlock: 3254782,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [143]: {\n    weth: '0x3bd359C1119dA7Da1D913D1C4D2B7c461115433A',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',\n        creationBlock: 29255937,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',\n        creationBlock: 29255937,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [196]: {\n    weth: '0xe538905cf8410324e03A5A23C1c177a474D59b2b',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0000000000000000000000000000000000000000',\n        creationBlock: 1,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x5507749f2c558bb3e162c6e90c314c092e7372ff',\n        creationBlock: 47680350,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // rootstock\n  [30]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: ZERO_ROUTER_CONFIG,\n      [UniversalRouterVersion.V2_0]: ZERO_ROUTER_CONFIG,\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // cyber testnet\n  [111557560]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: ZERO_ROUTER_CONFIG,\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x2D094CE21AE3431909e373207a2fCef4ba8871a9',\n        creationBlock: 6183303,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n}\n\nexport const UNIVERSAL_ROUTER_ADDRESS = (version: UniversalRouterVersion, chainId: number): string => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n  return CHAIN_CONFIGS[chainId].routerConfigs[version].address\n}\n\nexport const UNIVERSAL_ROUTER_CREATION_BLOCK = (version: UniversalRouterVersion, chainId: number): number => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n  return CHAIN_CONFIGS[chainId].routerConfigs[version].creationBlock\n}\n\nexport const WETH_ADDRESS = (chainId: number): string => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n\n  if (CHAIN_CONFIGS[chainId].weth == WETH_NOT_SUPPORTED_ON_CHAIN) throw new Error(`Chain ${chainId} does not have WETH`)\n\n  return CHAIN_CONFIGS[chainId].weth\n}\n\nexport const CONTRACT_BALANCE = BigNumber.from(2).pow(255)\nexport const ETH_ADDRESS = '0x0000000000000000000000000000000000000000'\nexport const E_ETH_ADDRESS = '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee'\nexport const ZERO_ADDRESS = '0x0000000000000000000000000000000000000000'\nexport const MAX_UINT256 = BigNumber.from(2).pow(256).sub(1)\nexport const MAX_UINT160 = BigNumber.from(2).pow(160).sub(1)\n\nexport const SENDER_AS_RECIPIENT = '0x0000000000000000000000000000000000000001'\nexport const ROUTER_AS_RECIPIENT = '0x0000000000000000000000000000000000000002'\n","import { Currency } from '@uniswap/sdk-core'\nimport { ETH_ADDRESS } from './constants'\n\nexport function getCurrencyAddress(currency: Currency): string {\n  return currency.isNative ? ETH_ADDRESS : currency.wrapped.address\n}\n","import { BigNumber } from 'ethers'\nimport JSBI from 'jsbi'\nimport bn from 'bignumber.js'\nimport { Percent } from '@uniswap/sdk-core'\nimport { toHex } from '@uniswap/v3-sdk'\n\nexport function expandTo18DecimalsBN(n: number): BigNumber {\n  // use bn intermediately to allow decimals in intermediate calculations\n  return BigNumber.from(new bn(n).times(new bn(10).pow(18)).toFixed())\n}\n\nexport function expandTo18Decimals(n: number): JSBI {\n  return JSBI.BigInt(BigNumber.from(n).mul(BigNumber.from(10).pow(18)).toString())\n}\n\nexport function encodeFeeBips(fee: Percent): string {\n  return toHex(fee.multiply(10_000).quotient)\n}\n","import { RoutePlanner, CommandType } from '../../utils/routerCommands'\nimport { Trade as V2Trade, Pair } from '@uniswap/v2-sdk'\nimport { Trade as V3Trade, Pool as V3Pool, encodeRouteToPath } from '@uniswap/v3-sdk'\nimport {\n  Route as V4Route,\n  Trade as V4Trade,\n  Pool as V4Pool,\n  V4Planner,\n  encodeRouteToPath as encodeV4RouteToPath,\n  Actions,\n} from '@uniswap/v4-sdk'\nimport {\n  Trade as RouterTrade,\n  MixedRouteTrade,\n  Protocol,\n  IRoute,\n  RouteV2,\n  RouteV3,\n  MixedRouteSDK,\n  MixedRoute,\n  SwapOptions as RouterSwapOptions,\n  getOutputOfPools,\n  encodeMixedRouteToPath,\n  partitionMixedRouteByProtocol,\n} from '@uniswap/router-sdk'\nimport { Permit2Permit } from '../../utils/inputTokens'\nimport { getPathCurrency } from '../../utils/pathCurrency'\nimport { Currency, TradeType, Token, CurrencyAmount, Percent } from '@uniswap/sdk-core'\nimport { Command, RouterActionType, TradeConfig } from '../Command'\nimport { SENDER_AS_RECIPIENT, ROUTER_AS_RECIPIENT, CONTRACT_BALANCE, ETH_ADDRESS } from '../../utils/constants'\nimport { getCurrencyAddress } from '../../utils/getCurrencyAddress'\nimport { encodeFeeBips } from '../../utils/numbers'\nimport { BigNumber, BigNumberish } from 'ethers'\nimport { TPool } from '@uniswap/router-sdk'\n\nexport type FlatFeeOptions = {\n  amount: BigNumberish\n  recipient: string\n}\n\n// the existing router permit object doesn't include enough data for permit2\n// so we extend swap options with the permit2 permit\n// when safe mode is enabled, the SDK will add an extra ETH sweep for security\n// when useRouterBalance is enabled the SDK will use the balance in the router for the swap\nexport type SwapOptions = Omit<RouterSwapOptions, 'inputTokenPermit'> & {\n  useRouterBalance?: boolean\n  inputTokenPermit?: Permit2Permit\n  flatFee?: FlatFeeOptions\n  safeMode?: boolean\n  maxHopSlippage?: BigNumber[]\n}\n\nconst REFUND_ETH_PRICE_IMPACT_THRESHOLD = new Percent(50, 100)\n\ninterface Swap<TInput extends Currency, TOutput extends Currency> {\n  route: IRoute<TInput, TOutput, TPool>\n  inputAmount: CurrencyAmount<TInput>\n  outputAmount: CurrencyAmount<TOutput>\n}\n\n// Wrapper for uniswap router-sdk trade entity to encode swaps for Universal Router\n// also translates trade objects from previous (v2, v3) SDKs\nexport class UniswapTrade implements Command {\n  readonly tradeType: RouterActionType = RouterActionType.UniswapTrade\n  readonly payerIsUser: boolean\n\n  constructor(public trade: RouterTrade<Currency, Currency, TradeType>, public options: SwapOptions) {\n    if (!!options.fee && !!options.flatFee) throw new Error('Only one fee option permitted')\n\n    if (this.inputRequiresWrap || this.inputRequiresUnwrap || this.options.useRouterBalance) {\n      this.payerIsUser = false\n    } else {\n      this.payerIsUser = true\n    }\n  }\n\n  get isAllV4(): boolean {\n    let result = true\n    for (const swap of this.trade.swaps) {\n      result = result && swap.route.protocol == Protocol.V4\n    }\n    return result\n  }\n\n  // this.trade.swaps is an array of swaps / trades.\n  // we are iterating over one swap (trade) at a time so length is 1\n  // route is either v2, v3, v4, or mixed\n  // pathInput and pathOutput are the currencies of the input and output of the route\n  // this.trade.inputAmount is the input currency of the trade (could be different from pathInput)\n  // this.trade.outputAmount is the output currency of the trade (could be different from pathOutput)\n  // each route can have multiple pools\n  get inputRequiresWrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const route = swap.route\n    const firstPool = route.pools[0]\n\n    if (firstPool instanceof V4Pool) {\n      // If first pool is a v4 pool and input currency is native and the path input currency in the route is not native, we need to wrap.\n      return (\n        this.trade.inputAmount.currency.isNative &&\n        !(this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathInput.isNative\n      )\n    }\n    // If first pool is not a v4 pool and input currency is native, we need to wrap\n    return this.trade.inputAmount.currency.isNative\n  }\n\n  get inputRequiresUnwrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const route = swap.route\n    const firstPool = route.pools[0]\n\n    if (firstPool instanceof V4Pool) {\n      // If the first pool is a v4 pool and input currency is not native and the path input currency is native, we need to unwrap\n      return (\n        !this.trade.inputAmount.currency.isNative &&\n        (this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathInput.isNative\n      )\n    }\n    // If the first pool is not a v4 pool, we don't need to unwrap.\n    return false\n  }\n\n  get outputRequiresWrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const lastRoute = swap.route\n    const lastPool = lastRoute.pools[lastRoute.pools.length - 1]\n\n    // if last pool is v4:\n    if (lastPool instanceof V4Pool) {\n      // If output currency is not native but path currency output is native, we need to wrap\n      if (!this.trade.outputAmount.currency.isNative) {\n        if ((lastRoute as unknown as V4Route<Currency, Currency>).pathOutput.isNative) {\n          // this means path output is native and we need to wrap\n          return true\n        } else if (lastPool.currency1.equals(lastPool.currency0.wrapped) && lastRoute.pools.length > 1) {\n          let poolBefore = lastRoute.pools[lastRoute.pools.length - 2]\n          // this means last pool is eth-weth and pool before contains weth\n          if (\n            poolBefore instanceof V4Pool &&\n            (poolBefore.currency0.equals(lastPool.currency1) || poolBefore.currency1.equals(lastPool.currency1))\n          ) {\n            return true\n          } else if (poolBefore.token0.equals(lastPool.currency1) || poolBefore.token1.equals(lastPool.currency1)) {\n            // same for v2 and v3 pools\n            return true\n          }\n        }\n      }\n    }\n    // if last pool is not v4:\n    // we do not need to wrap because v2 and v3 pools already require wrapped tokens\n    return false\n  }\n\n  get outputRequiresUnwrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const lastRoute = swap.route\n    const lastPool = lastRoute.pools[lastRoute.pools.length - 1]\n\n    // if last pool is v4:\n    if (lastPool instanceof V4Pool) {\n      // If output currency is native and path currency output is not native, we need to unwrap\n      if (this.trade.outputAmount.currency.isNative) {\n        if (!(this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathOutput.isNative) {\n          // this means path output is weth and we need to unwrap\n          return true\n        } else if (\n          lastRoute.pools.length > 1 &&\n          lastRoute.pools[lastRoute.pools.length - 2] instanceof V4Pool &&\n          (lastRoute.pools[lastRoute.pools.length - 2] as V4Pool).currency0.isNative &&\n          lastPool.currency1.equals(lastPool.currency0.wrapped)\n        ) {\n          // this means last pool is eth-weth and we need to unwrap\n          return true\n        } else {\n          return false\n        }\n      }\n    }\n    // else: if path output currency is native, we need to unwrap because v2 and v3 pools already require wrapped tokens\n    return this.trade.outputAmount.currency.isNative\n  }\n\n  get outputRequiresTransition(): boolean {\n    return this.outputRequiresWrap || this.outputRequiresUnwrap\n  }\n\n  encode(planner: RoutePlanner, _config: TradeConfig): void {\n    // If the input currency is the native currency, we need to wrap it with the router as the recipient\n    if (this.inputRequiresWrap) {\n      // TODO: optimize if only one v2 pool we can directly send this to the pool\n      planner.addCommand(CommandType.WRAP_ETH, [\n        ROUTER_AS_RECIPIENT,\n        this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString(),\n      ])\n    } else if (this.inputRequiresUnwrap) {\n      // send wrapped token to router to unwrap\n      planner.addCommand(CommandType.PERMIT2_TRANSFER_FROM, [\n        (this.trade.inputAmount.currency as Token).address,\n        ROUTER_AS_RECIPIENT,\n        this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString(),\n      ])\n      planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, 0])\n    }\n    // The overall recipient at the end of the trade, SENDER_AS_RECIPIENT uses the msg.sender\n    this.options.recipient = this.options.recipient ?? SENDER_AS_RECIPIENT\n\n    // flag for whether we want to perform slippage check on aggregate output of multiple routes\n    //   1. when there are >2 exact input trades. this is only a heuristic,\n    //      as it's still more gas-expensive even in this case, but has benefits\n    //      in that the reversion probability is lower\n    const performAggregatedSlippageCheck =\n      this.trade.tradeType === TradeType.EXACT_INPUT && this.trade.routes.length > 2\n    const routerMustCustody =\n      performAggregatedSlippageCheck || this.outputRequiresTransition || hasFeeOption(this.options)\n\n    for (const swap of this.trade.swaps) {\n      switch (swap.route.protocol) {\n        case Protocol.V2:\n          addV2Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.V3:\n          addV3Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.V4:\n          addV4Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.MIXED:\n          addMixedSwap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        default:\n          throw new Error('UNSUPPORTED_TRADE_PROTOCOL')\n      }\n    }\n\n    let minimumAmountOut: BigNumber = BigNumber.from(\n      this.trade.minimumAmountOut(this.options.slippageTolerance).quotient.toString()\n    )\n    // The router custodies for 3 reasons: to unwrap, to take a fee, and/or to do a slippage check\n    if (routerMustCustody) {\n      const pools = this.trade.swaps[0].route.pools\n      const pathOutputCurrencyAddress = getCurrencyAddress(\n        getPathCurrency(this.trade.outputAmount.currency, pools[pools.length - 1])\n      )\n\n      // If there is a fee, that percentage is sent to the fee recipient\n      // In the case where ETH is the output currency, the fee is taken in WETH (for gas reasons)\n      if (!!this.options.fee) {\n        const feeBips = encodeFeeBips(this.options.fee.fee)\n        planner.addCommand(CommandType.PAY_PORTION, [pathOutputCurrencyAddress, this.options.fee.recipient, feeBips])\n\n        // If the trade is exact output, and a fee was taken, we must adjust the amount out to be the amount after the fee\n        // Otherwise we continue as expected with the trade's normal expected output\n        if (this.trade.tradeType === TradeType.EXACT_OUTPUT) {\n          minimumAmountOut = minimumAmountOut.sub(minimumAmountOut.mul(feeBips).div(10000))\n        }\n      }\n\n      // If there is a flat fee, that absolute amount is sent to the fee recipient\n      // In the case where ETH is the output currency, the fee is taken in WETH (for gas reasons)\n      if (!!this.options.flatFee) {\n        const feeAmount = this.options.flatFee.amount\n        if (minimumAmountOut.lt(feeAmount)) throw new Error('Flat fee amount greater than minimumAmountOut')\n\n        planner.addCommand(CommandType.TRANSFER, [pathOutputCurrencyAddress, this.options.flatFee.recipient, feeAmount])\n\n        // If the trade is exact output, and a fee was taken, we must adjust the amount out to be the amount after the fee\n        // Otherwise we continue as expected with the trade's normal expected output\n        if (this.trade.tradeType === TradeType.EXACT_OUTPUT) {\n          minimumAmountOut = minimumAmountOut.sub(feeAmount)\n        }\n      }\n\n      // The remaining tokens that need to be sent to the user after the fee is taken will be caught\n      // by this if-else clause.\n      if (this.outputRequiresUnwrap) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [this.options.recipient, minimumAmountOut])\n      } else if (this.outputRequiresWrap) {\n        planner.addCommand(CommandType.WRAP_ETH, [this.options.recipient, CONTRACT_BALANCE])\n      } else {\n        planner.addCommand(CommandType.SWEEP, [\n          getCurrencyAddress(this.trade.outputAmount.currency),\n          this.options.recipient,\n          minimumAmountOut,\n        ])\n      }\n    }\n\n    // for exactOutput swaps with native input or that perform an inputToken transition (wrap or unwrap)\n    // we need to send back the change to the user\n    if (this.trade.tradeType === TradeType.EXACT_OUTPUT || riskOfPartialFill(this.trade)) {\n      if (this.inputRequiresWrap) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [this.options.recipient, 0])\n      } else if (this.inputRequiresUnwrap) {\n        planner.addCommand(CommandType.WRAP_ETH, [this.options.recipient, CONTRACT_BALANCE])\n      } else if (this.trade.inputAmount.currency.isNative) {\n        // must refund extra native currency sent along for native v4 trades (no input transition)\n        planner.addCommand(CommandType.SWEEP, [ETH_ADDRESS, this.options.recipient, 0])\n      }\n    }\n\n    if (this.options.safeMode) planner.addCommand(CommandType.SWEEP, [ETH_ADDRESS, this.options.recipient, 0])\n  }\n}\n\n// encode a uniswap v2 swap\nfunction addV2Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { route, inputAmount, outputAmount }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const trade = new V2Trade(\n    route as RouteV2<TInput, TOutput>,\n    tradeType == TradeType.EXACT_INPUT ? inputAmount : outputAmount,\n    tradeType\n  )\n\n  if (tradeType == TradeType.EXACT_INPUT) {\n    planner.addCommand(CommandType.V2_SWAP_EXACT_IN, [\n      // if native, we have to unwrap so keep in the router for now\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      // if router will custody funds, we do aggregated slippage check from router\n      routerMustCustody ? 0 : trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      route.path.map((token) => token.wrapped.address),\n      payerIsUser,\n    ])\n  } else if (tradeType == TradeType.EXACT_OUTPUT) {\n    planner.addCommand(CommandType.V2_SWAP_EXACT_OUT, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      route.path.map((token) => token.wrapped.address),\n      payerIsUser,\n    ])\n  }\n}\n\n// encode a uniswap v3 swap\nfunction addV3Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { route, inputAmount, outputAmount }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const trade = V3Trade.createUncheckedTrade({\n    route: route as RouteV3<TInput, TOutput>,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const path = encodeRouteToPath(route as RouteV3<TInput, TOutput>, trade.tradeType === TradeType.EXACT_OUTPUT)\n  if (tradeType == TradeType.EXACT_INPUT) {\n    planner.addCommand(CommandType.V3_SWAP_EXACT_IN, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      routerMustCustody ? 0 : trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      path,\n      payerIsUser,\n    ])\n  } else if (tradeType == TradeType.EXACT_OUTPUT) {\n    planner.addCommand(CommandType.V3_SWAP_EXACT_OUT, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      path,\n      payerIsUser,\n    ])\n  }\n}\n\nfunction addV4Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { inputAmount, outputAmount, route }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  // create a deep copy of pools since v4Planner encoding tampers with array\n  const pools = route.pools.map((p) => p) as V4Pool[]\n  const v4Route = new V4Route(pools, inputAmount.currency, outputAmount.currency)\n  const trade = V4Trade.createUncheckedTrade({\n    route: v4Route,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const slippageToleranceOnSwap =\n    routerMustCustody && tradeType == TradeType.EXACT_INPUT ? undefined : options.slippageTolerance\n\n  const v4Planner = new V4Planner()\n  v4Planner.addTrade(trade, slippageToleranceOnSwap)\n  v4Planner.addSettle(trade.route.pathInput, payerIsUser)\n\n  // Handle split route output consistency:\n  // - If output is ETH and some routes output WETH: force all to output WETH, then unwrap\n  // - If output is WETH and some routes output ETH: force all to output ETH, then wrap\n  let pathOutputForTake = trade.route.pathOutput\n  let lastPool = v4Route.pools[v4Route.pools.length - 1]\n  let ethWethPool = lastPool.currency1.equals(lastPool.currency0.wrapped)\n\n  if (ethWethPool && v4Route.pools.length > 1) {\n    let poolBefore = v4Route.pools[v4Route.pools.length - 2]\n    if (pathOutputForTake.isNative && poolBefore.currency0.isNative) {\n      pathOutputForTake = pathOutputForTake.wrapped\n    } else if (\n      !pathOutputForTake.isNative &&\n      (poolBefore.currency0.equals(lastPool.currency1) || poolBefore.currency1.equals(lastPool.currency1))\n    ) {\n      pathOutputForTake = lastPool.currency0\n    }\n  }\n\n  v4Planner.addTake(\n    pathOutputForTake,\n    routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient ?? SENDER_AS_RECIPIENT\n  )\n  planner.addCommand(CommandType.V4_SWAP, [v4Planner.finalize()])\n}\n\n// encode a mixed route swap, i.e. including both v2 and v3 pools\nfunction addMixedSwap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  swap: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const route = swap.route as MixedRoute<TInput, TOutput>\n  const inputAmount = swap.inputAmount\n  const outputAmount = swap.outputAmount\n  const tradeRecipient = routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient ?? SENDER_AS_RECIPIENT\n\n  // single hop, so it can be reduced to plain swap logic for one protocol version\n  if (route.pools.length === 1) {\n    if (route.pools[0] instanceof V4Pool) {\n      return addV4Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else if (route.pools[0] instanceof V3Pool) {\n      return addV3Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else if (route.pools[0] instanceof Pair) {\n      return addV2Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else {\n      throw new Error('Invalid route type')\n    }\n  }\n\n  const trade = MixedRouteTrade.createUncheckedTrade({\n    route: route as MixedRoute<TInput, TOutput>,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const amountIn = trade.maximumAmountIn(options.slippageTolerance, inputAmount).quotient.toString()\n  const amountOut = routerMustCustody\n    ? 0\n    : trade.minimumAmountOut(options.slippageTolerance, outputAmount).quotient.toString()\n\n  // logic from\n  // https://github.com/Uniswap/router-sdk/blob/d8eed164e6c79519983844ca8b6a3fc24ebcb8f8/src/swapRouter.ts#L276\n  const sections = partitionMixedRouteByProtocol(route as MixedRoute<TInput, TOutput>)\n  const isLastSectionInRoute = (i: number) => {\n    return i === sections.length - 1\n  }\n\n  let inputToken = route.pathInput\n\n  for (let i = 0; i < sections.length; i++) {\n    const section = sections[i]\n    const routePool = section[0]\n    const outputToken = getOutputOfPools(section, inputToken)\n    const subRoute = new MixedRoute(new MixedRouteSDK([...section], inputToken, outputToken))\n\n    let nextInputToken\n    let swapRecipient\n\n    if (isLastSectionInRoute(i)) {\n      nextInputToken = outputToken\n      swapRecipient = tradeRecipient\n    } else {\n      const nextPool = sections[i + 1][0]\n      nextInputToken = getPathCurrency(outputToken, nextPool)\n\n      const v2PoolIsSwapRecipient = nextPool instanceof Pair && outputToken.equals(nextInputToken)\n      swapRecipient = v2PoolIsSwapRecipient ? (nextPool as Pair).liquidityToken.address : ROUTER_AS_RECIPIENT\n    }\n\n    if (routePool instanceof V4Pool) {\n      const v4Planner = new V4Planner()\n      const v4SubRoute = new V4Route(section as V4Pool[], subRoute.input, subRoute.output)\n\n      v4Planner.addSettle(inputToken, payerIsUser && i === 0, (i == 0 ? amountIn : CONTRACT_BALANCE) as BigNumber)\n      v4Planner.addAction(Actions.SWAP_EXACT_IN, [\n        {\n          currencyIn: inputToken.isNative ? ETH_ADDRESS : inputToken.address,\n          path: encodeV4RouteToPath(v4SubRoute),\n          amountIn: 0, // denotes open delta, amount set in v4Planner.addSettle()\n          amountOutMinimum: !isLastSectionInRoute(i) ? 0 : amountOut,\n        },\n      ])\n\n      // Handle split route output consistency for V4 sections in mixed routes\n      let outputTokenForTake = outputToken\n      if (isLastSectionInRoute(i)) {\n        let lastPool = route.pools[route.pools.length - 1]\n        let v4Pool = lastPool instanceof V4Pool\n        let ethWethPool = v4Pool ? (lastPool as V4Pool).currency1.equals((lastPool as V4Pool).currency0.wrapped) : false\n        let poolBefore = route.pools[route.pools.length - 2]\n\n        if (ethWethPool) {\n          if (outputToken.isNative && poolBefore.token0.isNative) {\n            outputTokenForTake = outputToken.wrapped\n          } else if (\n            !outputToken.isNative &&\n            (poolBefore.token0.equals(lastPool.token1) || poolBefore.token1.equals(lastPool.token1))\n          ) {\n            outputTokenForTake = lastPool.token0\n          }\n        }\n      }\n\n      v4Planner.addTake(outputTokenForTake, swapRecipient)\n\n      planner.addCommand(CommandType.V4_SWAP, [v4Planner.finalize()])\n    } else if (routePool instanceof V3Pool) {\n      planner.addCommand(CommandType.V3_SWAP_EXACT_IN, [\n        swapRecipient, // recipient\n        i == 0 ? amountIn : CONTRACT_BALANCE, // amountIn\n        !isLastSectionInRoute(i) ? 0 : amountOut, // amountOut\n        encodeMixedRouteToPath(subRoute), // path\n        payerIsUser && i === 0, // payerIsUser\n      ])\n    } else if (routePool instanceof Pair) {\n      planner.addCommand(CommandType.V2_SWAP_EXACT_IN, [\n        swapRecipient, // recipient\n        i === 0 ? amountIn : CONTRACT_BALANCE, // amountIn\n        !isLastSectionInRoute(i) ? 0 : amountOut, // amountOutMin\n        subRoute.path.map((token) => token.wrapped.address), // path\n        payerIsUser && i === 0,\n      ])\n    } else {\n      throw new Error('Unexpected Pool Type')\n    }\n\n    // perform a token transition (wrap/unwrap if necessary)\n    if (!isLastSectionInRoute(i)) {\n      if (outputToken.isNative && !nextInputToken.isNative) {\n        planner.addCommand(CommandType.WRAP_ETH, [ROUTER_AS_RECIPIENT, CONTRACT_BALANCE])\n      } else if (!outputToken.isNative && nextInputToken.isNative) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, 0])\n      }\n    }\n\n    inputToken = nextInputToken\n  }\n}\n\n// if price impact is very high, there's a chance of hitting max/min prices resulting in a partial fill of the swap\nfunction riskOfPartialFill(trade: RouterTrade<Currency, Currency, TradeType>): boolean {\n  return trade.priceImpact.greaterThan(REFUND_ETH_PRICE_IMPACT_THRESHOLD)\n}\n\nfunction hasFeeOption(swapOptions: SwapOptions): boolean {\n  return !!swapOptions.fee || !!swapOptions.flatFee\n}\n","import invariant from 'tiny-invariant'\nimport { ethers } from 'ethers'\nimport { validateAndParseAddress, BigintIsh } from '@uniswap/sdk-core'\nimport { NFTPermitOptions, NonfungiblePositionManager } from '@uniswap/v3-sdk'\nimport { PermitSingle } from '@uniswap/permit2-sdk'\nimport { CommandType, RoutePlanner } from './routerCommands'\nimport { ROUTER_AS_RECIPIENT } from './constants'\n\nexport interface Permit2Permit extends PermitSingle {\n  signature: string\n}\n\nexport type ApproveProtocol = {\n  token: string\n  protocol: string\n}\n\nexport type Permit2TransferFrom = {\n  token: string\n  amount: string\n  recipient?: string\n}\n\nexport type InputTokenOptions = {\n  permit2Permit?: Permit2Permit\n  permit2TransferFrom?: Permit2TransferFrom\n}\n\nconst SIGNATURE_LENGTH = 65\nconst EIP_2098_SIGNATURE_LENGTH = 64\n\nexport function encodePermit(planner: RoutePlanner, permit2: Permit2Permit): void {\n  let signature = permit2.signature\n\n  const length = ethers.utils.arrayify(permit2.signature).length\n  // signature data provided for EIP-1271 may have length different from ECDSA signature\n  if (length === SIGNATURE_LENGTH || length === EIP_2098_SIGNATURE_LENGTH) {\n    // sanitizes signature to cover edge cases of malformed EIP-2098 sigs and v used as recovery id\n    signature = ethers.utils.joinSignature(ethers.utils.splitSignature(permit2.signature))\n  }\n\n  planner.addCommand(CommandType.PERMIT2_PERMIT, [permit2, signature])\n}\n\nexport function encodeV3PositionPermit(planner: RoutePlanner, permit: NFTPermitOptions, tokenId: BigintIsh): void {\n  const calldata = NonfungiblePositionManager.INTERFACE.encodeFunctionData('permit', [\n    validateAndParseAddress(permit.spender),\n    tokenId,\n    permit.deadline,\n    permit.v,\n    permit.r,\n    permit.s,\n  ])\n\n  planner.addCommand(CommandType.V3_POSITION_MANAGER_PERMIT, [calldata])\n}\n\n// Handles the encoding of commands needed to gather input tokens for a trade\n// Approval: The router approving another address to take tokens.\n//   note: Only seaport and sudoswap support this action. Approvals are left open.\n// Permit: A Permit2 signature-based Permit to allow the router to access a user's tokens\n// Transfer: A Permit2 TransferFrom of tokens from a user to either the router or another address\nexport function encodeInputTokenOptions(planner: RoutePlanner, options: InputTokenOptions) {\n  // first ensure that all tokens provided for encoding are the same\n  if (!!options.permit2TransferFrom && !!options.permit2Permit)\n    invariant(options.permit2TransferFrom.token === options.permit2Permit.details.token, `inconsistent token`)\n\n  // if this order has a options.permit2Permit, encode it\n  if (!!options.permit2Permit) {\n    encodePermit(planner, options.permit2Permit)\n  }\n\n  if (!!options.permit2TransferFrom) {\n    planner.addCommand(CommandType.PERMIT2_TRANSFER_FROM, [\n      options.permit2TransferFrom.token,\n      options.permit2TransferFrom.recipient ? options.permit2TransferFrom.recipient : ROUTER_AS_RECIPIENT,\n      options.permit2TransferFrom.amount,\n    ])\n  }\n}\n","import { TypedDataDomain, TypedDataField } from '@ethersproject/abstract-signer'\nimport { BigNumber } from 'ethers'\n\nexport const EIP712_DOMAIN_NAME = 'UniversalRouter'\nexport const EIP712_DOMAIN_VERSION = '2'\n\nexport const EXECUTE_SIGNED_TYPES: Record<string, TypedDataField[]> = {\n  ExecuteSigned: [\n    { name: 'commands', type: 'bytes' },\n    { name: 'inputs', type: 'bytes[]' },\n    { name: 'intent', type: 'bytes' },\n    { name: 'data', type: 'bytes' },\n    { name: 'sender', type: 'address' },\n    { name: 'nonce', type: 'uint256' },\n    { name: 'deadline', type: 'uint256' },\n  ],\n}\n\n// When set as the nonce, the nonce check is skipped\nexport const NONCE_SKIP_CHECK = BigNumber.from('0x8000000000000000000000000000000000000000000000000000000000000000')\n\n/**\n * Generate a random nonce for signed execution\n */\nexport function generateNonce(): string {\n  const randomBytes = new Uint8Array(32)\n  for (let i = 0; i < 32; i++) {\n    randomBytes[i] = Math.floor(Math.random() * 256)\n  }\n  return BigNumber.from(randomBytes).toHexString()\n}\n\n/**\n * Get the EIP712 domain for a Universal Router contract\n */\nexport function getUniversalRouterDomain(chainId: number, routerAddress: string): TypedDataDomain {\n  return {\n    name: EIP712_DOMAIN_NAME,\n    version: EIP712_DOMAIN_VERSION,\n    chainId,\n    verifyingContract: routerAddress,\n  }\n}\n","import invariant from 'tiny-invariant'\nimport UniversalRouter from '@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json'\nimport { Interface } from '@ethersproject/abi'\nimport { TypedDataDomain, TypedDataField } from '@ethersproject/abstract-signer'\nimport { BigNumber, BigNumberish } from 'ethers'\nimport {\n  MethodParameters,\n  Multicall,\n  Position as V3Position,\n  NonfungiblePositionManager as V3PositionManager,\n  RemoveLiquidityOptions as V3RemoveLiquidityOptions,\n} from '@uniswap/v3-sdk'\nimport {\n  Position as V4Position,\n  V4PositionManager,\n  AddLiquidityOptions as V4AddLiquidityOptions,\n  MintOptions,\n  Pool as V4Pool,\n  PoolKey,\n} from '@uniswap/v4-sdk'\nimport { Trade as RouterTrade } from '@uniswap/router-sdk'\nimport { Currency, TradeType, Percent, CHAIN_TO_ADDRESSES_MAP, SupportedChainsType } from '@uniswap/sdk-core'\nimport { UniswapTrade, SwapOptions } from './entities/actions/uniswap'\nimport { AcrossV4DepositV3Params } from './entities/actions/across'\nimport { RoutePlanner, CommandType } from './utils/routerCommands'\nimport { encodePermit, encodeV3PositionPermit } from './utils/inputTokens'\nimport { UNIVERSAL_ROUTER_ADDRESS, UniversalRouterVersion } from './utils/constants'\nimport { generateNonce, getUniversalRouterDomain, EXECUTE_SIGNED_TYPES } from './utils/eip712'\n\nexport type SwapRouterConfig = {\n  sender?: string // address\n  deadline?: BigNumberish\n}\n\nexport type SignedRouteOptions = {\n  intent: string\n  data: string\n  sender: string\n  nonce?: string\n}\n\nexport type EIP712Payload = {\n  domain: TypedDataDomain\n  types: Record<string, TypedDataField[]>\n  value: {\n    commands: string\n    inputs: string[]\n    intent: string\n    data: string\n    sender: string\n    nonce: string\n    deadline: string\n  }\n}\n\nexport interface MigrateV3ToV4Options {\n  inputPosition: V3Position\n  outputPosition: V4Position\n  v3RemoveLiquidityOptions: V3RemoveLiquidityOptions\n  v4AddLiquidityOptions: V4AddLiquidityOptions\n}\n\nfunction isMint(options: V4AddLiquidityOptions): options is MintOptions {\n  return Object.keys(options).some((k) => k === 'recipient')\n}\n\nexport abstract class SwapRouter {\n  public static INTERFACE: Interface = new Interface(UniversalRouter.abi)\n\n  public static swapCallParameters(\n    trades: RouterTrade<Currency, Currency, TradeType>,\n    options: SwapOptions,\n    bridgeOptions?: AcrossV4DepositV3Params[]\n  ): MethodParameters {\n    // TODO: use permit if signature included in swapOptions\n    const planner = new RoutePlanner()\n\n    const trade: UniswapTrade = new UniswapTrade(trades, options)\n\n    const inputCurrency = trade.trade.inputAmount.currency\n    invariant(!(inputCurrency.isNative && !!options.inputTokenPermit), 'NATIVE_INPUT_PERMIT')\n\n    if (options.inputTokenPermit) {\n      encodePermit(planner, options.inputTokenPermit)\n    }\n\n    const nativeCurrencyValue = inputCurrency.isNative\n      ? BigNumber.from(trade.trade.maximumAmountIn(options.slippageTolerance).quotient.toString())\n      : BigNumber.from(0)\n\n    trade.encode(planner, { allowRevert: false })\n\n    if (bridgeOptions) {\n      bridgeOptions.forEach((bridge) => planner.addAcrossBridge(bridge))\n    }\n\n    return SwapRouter.encodePlan(planner, nativeCurrencyValue, {\n      deadline: options.deadlineOrPreviousBlockhash ? BigNumber.from(options.deadlineOrPreviousBlockhash) : undefined,\n    })\n  }\n\n  /**\n   * Builds the call parameters for a migration from a V3 position to a V4 position.\n   * Some requirements of the parameters:\n   *   - v3RemoveLiquidityOptions.collectOptions.recipient must equal v4PositionManager\n   *   - v3RemoveLiquidityOptions.liquidityPercentage must be 100%\n   *   - input pool and output pool must have the same tokens\n   *   - V3 NFT must be approved, or valid inputV3NFTPermit must be provided with UR as spender\n   */\n  public static migrateV3ToV4CallParameters(\n    options: MigrateV3ToV4Options,\n    positionManagerOverride?: string\n  ): MethodParameters {\n    const v4Pool: V4Pool = options.outputPosition.pool\n    const v3Token0 = options.inputPosition.pool.token0\n    const v3Token1 = options.inputPosition.pool.token1\n    const v4PositionManagerAddress =\n      positionManagerOverride ?? CHAIN_TO_ADDRESSES_MAP[v4Pool.chainId as SupportedChainsType].v4PositionManagerAddress\n\n    // owner of the v3 nft must be the receiver of the v4 nft\n\n    // validate the parameters\n    if (v4Pool.currency0.isNative) {\n      invariant(\n        (v4Pool.currency0.wrapped.equals(v3Token0) && v4Pool.currency1.equals(v3Token1)) ||\n          (v4Pool.currency0.wrapped.equals(v3Token1) && v4Pool.currency1.equals(v3Token0)),\n        'TOKEN_MISMATCH'\n      )\n    } else {\n      invariant(v3Token0 === v4Pool.token0, 'TOKEN0_MISMATCH')\n      invariant(v3Token1 === v4Pool.token1, 'TOKEN1_MISMATCH')\n    }\n\n    invariant(\n      options.v3RemoveLiquidityOptions.liquidityPercentage.equalTo(new Percent(100, 100)),\n      'FULL_REMOVAL_REQUIRED'\n    )\n    invariant(options.v3RemoveLiquidityOptions.burnToken == true, 'BURN_TOKEN_REQUIRED')\n    invariant(\n      options.v3RemoveLiquidityOptions.collectOptions.recipient === v4PositionManagerAddress,\n      'RECIPIENT_NOT_POSITION_MANAGER'\n    )\n    invariant(isMint(options.v4AddLiquidityOptions), 'MINT_REQUIRED')\n    invariant(options.v4AddLiquidityOptions.migrate, 'MIGRATE_REQUIRED')\n\n    const planner = new RoutePlanner()\n\n    // to prevent reentrancy by the pool hook, we initialize the v4 pool before moving funds\n    if (options.v4AddLiquidityOptions.createPool) {\n      const poolKey: PoolKey = V4Pool.getPoolKey(\n        v4Pool.currency0,\n        v4Pool.currency1,\n        v4Pool.fee,\n        v4Pool.tickSpacing,\n        v4Pool.hooks\n      )\n      planner.addCommand(CommandType.V4_INITIALIZE_POOL, [poolKey, v4Pool.sqrtRatioX96.toString()])\n      // remove createPool setting, so that it doesnt get encoded again later\n      delete options.v4AddLiquidityOptions.createPool\n    }\n\n    // add position permit to the universal router planner\n    if (options.v3RemoveLiquidityOptions.permit) {\n      // permit spender should be UR\n      const universalRouterAddress = UNIVERSAL_ROUTER_ADDRESS(\n        UniversalRouterVersion.V2_0,\n        options.inputPosition.pool.chainId as SupportedChainsType\n      )\n      invariant(universalRouterAddress == options.v3RemoveLiquidityOptions.permit.spender, 'INVALID_SPENDER')\n      // don't need to transfer it because v3posm uses isApprovedOrOwner()\n      encodeV3PositionPermit(planner, options.v3RemoveLiquidityOptions.permit, options.v3RemoveLiquidityOptions.tokenId)\n      // remove permit so that multicall doesnt add it again\n      delete options.v3RemoveLiquidityOptions.permit\n    }\n\n    // encode v3 withdraw\n    const v3RemoveParams: MethodParameters = V3PositionManager.removeCallParameters(\n      options.inputPosition,\n      options.v3RemoveLiquidityOptions\n    )\n    const v3Calls: string[] = Multicall.decodeMulticall(v3RemoveParams.calldata)\n\n    for (const v3Call of v3Calls) {\n      // slice selector - 0x + 4 bytes = 10 characters\n      const selector = v3Call.slice(0, 10)\n      invariant(\n        selector == V3PositionManager.INTERFACE.getSighash('collect') ||\n          selector == V3PositionManager.INTERFACE.getSighash('decreaseLiquidity') ||\n          selector == V3PositionManager.INTERFACE.getSighash('burn'),\n        'INVALID_V3_CALL: ' + selector\n      )\n      planner.addCommand(CommandType.V3_POSITION_MANAGER_CALL, [v3Call])\n    }\n\n    // encode v4 mint\n    const v4AddParams = V4PositionManager.addCallParameters(options.outputPosition, options.v4AddLiquidityOptions)\n    // only modifyLiquidities can be called by the UniversalRouter\n    const selector = v4AddParams.calldata.slice(0, 10)\n    invariant(selector == V4PositionManager.INTERFACE.getSighash('modifyLiquidities'), 'INVALID_V4_CALL: ' + selector)\n\n    planner.addCommand(CommandType.V4_POSITION_MANAGER_CALL, [v4AddParams.calldata])\n\n    return SwapRouter.encodePlan(planner, BigNumber.from(0), {\n      deadline: BigNumber.from(options.v4AddLiquidityOptions.deadline),\n    })\n  }\n\n  static getExecuteSignedPayload(\n    calldata: string,\n    signedOptions: SignedRouteOptions,\n    deadline: BigNumberish,\n    chainId: number,\n    routerAddress: string\n  ): EIP712Payload {\n    const iface = SwapRouter.INTERFACE\n    const decoded = iface.decodeFunctionData('execute', calldata)\n    const commands = decoded[0]\n    const inputs = decoded[1]\n    const nonce = signedOptions.nonce || generateNonce()\n    const domain = getUniversalRouterDomain(chainId, routerAddress)\n    return {\n      domain,\n      types: EXECUTE_SIGNED_TYPES,\n      value: {\n        commands,\n        inputs,\n        intent: signedOptions.intent,\n        data: signedOptions.data,\n        sender: signedOptions.sender,\n        nonce,\n        deadline: deadline.toString(),\n      },\n    }\n  }\n\n  static encodeExecuteSigned(\n    calldata: string,\n    signature: string,\n    signedOptions: SignedRouteOptions,\n    deadline: BigNumberish,\n    nativeCurrencyValue?: BigNumber\n  ): MethodParameters {\n    const iface = SwapRouter.INTERFACE\n    const decoded = iface.decodeFunctionData('execute', calldata)\n    const commands = decoded[0]\n    const inputs = decoded[1]\n    const nonce = signedOptions.nonce || generateNonce()\n    const executeSignedCalldata = iface.encodeFunctionData('executeSigned', [\n      commands,\n      inputs,\n      signedOptions.intent,\n      signedOptions.data,\n      signedOptions.sender,\n      nonce,\n      BigNumber.from(deadline).toString(),\n      signature,\n    ])\n    return {\n      calldata: executeSignedCalldata,\n      value: (nativeCurrencyValue || BigNumber.from(0)).toHexString(),\n    }\n  }\n\n  /**\n   * Encodes a planned route into a method name and parameters for the Router contract.\n   * @param planner the planned route\n   * @param nativeCurrencyValue the native currency value of the planned route\n   * @param config the router config\n   */\n  private static encodePlan(\n    planner: RoutePlanner,\n    nativeCurrencyValue: BigNumber,\n    config: SwapRouterConfig = {}\n  ): MethodParameters {\n    const { commands, inputs } = planner\n    const functionSignature = !!config.deadline ? 'execute(bytes,bytes[],uint256)' : 'execute(bytes,bytes[])'\n    const parameters = !!config.deadline ? [commands, inputs, config.deadline] : [commands, inputs]\n    const calldata = SwapRouter.INTERFACE.encodeFunctionData(functionSignature, parameters)\n    return { calldata, value: nativeCurrencyValue.toHexString() }\n  }\n}\n","import invariant from 'tiny-invariant'\nimport { BigNumberish } from 'ethers'\nimport { RoutePlanner, CommandType } from '../../utils/routerCommands'\nimport { encodeInputTokenOptions, Permit2Permit } from '../../utils/inputTokens'\nimport { Command, RouterActionType, TradeConfig } from '../Command'\nimport { ROUTER_AS_RECIPIENT, WETH_ADDRESS } from '../../utils/constants'\n\nexport class UnwrapWETH implements Command {\n  readonly tradeType: RouterActionType = RouterActionType.UnwrapWETH\n  readonly permit2Data?: Permit2Permit\n  readonly wethAddress: string\n  readonly amount: BigNumberish\n\n  constructor(amount: BigNumberish, chainId: number, permit2?: Permit2Permit) {\n    this.wethAddress = WETH_ADDRESS(chainId)\n    this.amount = amount\n\n    if (!!permit2) {\n      invariant(\n        permit2.details.token.toLowerCase() === this.wethAddress.toLowerCase(),\n        `must be permitting WETH address: ${this.wethAddress}`\n      )\n      invariant(permit2.details.amount >= amount, `Did not permit enough WETH for unwrapWETH transaction`)\n      this.permit2Data = permit2\n    }\n  }\n\n  encode(planner: RoutePlanner, _: TradeConfig): void {\n    encodeInputTokenOptions(planner, {\n      permit2Permit: this.permit2Data,\n      permit2TransferFrom: {\n        token: this.wethAddress,\n        amount: this.amount.toString(),\n      },\n    })\n    planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, this.amount])\n  }\n}\n","import { MixedRouteSDK, Trade as RouterTrade } from '@uniswap/router-sdk'\nimport { Currency, CurrencyAmount, Ether, Token, TradeType } from '@uniswap/sdk-core'\nimport { Pair, Route as V2Route } from '@uniswap/v2-sdk'\nimport { Pool as V3Pool, Route as V3Route, FeeAmount } from '@uniswap/v3-sdk'\nimport { Pool as V4Pool, Route as V4Route } from '@uniswap/v4-sdk'\nimport { BigNumber } from 'ethers'\nimport { ETH_ADDRESS, E_ETH_ADDRESS } from './constants'\n\nexport type TokenInRoute = {\n  address: string\n  chainId: number\n  symbol: string\n  decimals: string\n  name?: string\n  buyFeeBps?: string\n  sellFeeBps?: string\n}\n\nexport enum PoolType {\n  V2Pool = 'v2-pool',\n  V3Pool = 'v3-pool',\n  V4Pool = 'v4-pool',\n}\n\nexport type V2Reserve = {\n  token: TokenInRoute\n  quotient: string\n}\n\nexport type V2PoolInRoute = {\n  type: PoolType.V2Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  reserve0: V2Reserve\n  reserve1: V2Reserve\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type V3PoolInRoute = {\n  type: PoolType.V3Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  sqrtRatioX96: string\n  liquidity: string\n  tickCurrent: string\n  fee: string\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type V4PoolInRoute = {\n  type: PoolType.V4Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  fee: string\n  tickSpacing: string\n  hooks: string\n  liquidity: string\n  sqrtRatioX96: string\n  tickCurrent: string\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type PartialClassicQuote = {\n  // We need tokenIn/Out to support native currency\n  tokenIn: string\n  tokenOut: string\n  tradeType: TradeType\n  route: Array<(V4PoolInRoute | V3PoolInRoute | V2PoolInRoute)[]>\n}\n\ninterface RouteResult {\n  routev4: V4Route<Currency, Currency> | null\n  routev3: V3Route<Currency, Currency> | null\n  routev2: V2Route<Currency, Currency> | null\n  mixedRoute: MixedRouteSDK<Currency, Currency> | null\n  inputAmount: CurrencyAmount<Currency>\n  outputAmount: CurrencyAmount<Currency>\n}\n\nexport const isNativeCurrency = (address: string) =>\n  address.toLowerCase() === ETH_ADDRESS.toLowerCase() || address.toLowerCase() === E_ETH_ADDRESS.toLowerCase()\n\n// Helper class to convert routing-specific quote entities to RouterTrade entities\n// the returned RouterTrade can then be used to build the UniswapTrade entity in this package\nexport class RouterTradeAdapter {\n  // Generate a RouterTrade using fields from a classic quote response\n  static fromClassicQuote(quote: PartialClassicQuote) {\n    const { route, tokenIn, tokenOut } = quote\n\n    if (!route) throw new Error('Expected route to be present')\n    if (!route.length) throw new Error('Expected there to be at least one route')\n    if (route.some((r) => !r.length)) throw new Error('Expected all routes to have at least one pool')\n    const firstRoute = route[0]\n\n    const tokenInData = firstRoute[0].tokenIn\n    const tokenOutData = firstRoute[firstRoute.length - 1].tokenOut\n\n    if (!tokenInData || !tokenOutData) throw new Error('Expected both tokenIn and tokenOut to be present')\n    if (tokenInData.chainId !== tokenOutData.chainId)\n      throw new Error('Expected tokenIn and tokenOut to be have same chainId')\n\n    const parsedCurrencyIn = RouterTradeAdapter.toCurrency(isNativeCurrency(tokenIn), tokenInData)\n    const parsedCurrencyOut = RouterTradeAdapter.toCurrency(isNativeCurrency(tokenOut), tokenOutData)\n\n    const typedRoutes: RouteResult[] = route.map((subRoute) => {\n      const rawAmountIn = subRoute[0].amountIn\n      const rawAmountOut = subRoute[subRoute.length - 1].amountOut\n\n      if (!rawAmountIn || !rawAmountOut) {\n        throw new Error('Expected both raw amountIn and raw amountOut to be present')\n      }\n\n      const inputAmount = CurrencyAmount.fromRawAmount(parsedCurrencyIn, rawAmountIn)\n      const outputAmount = CurrencyAmount.fromRawAmount(parsedCurrencyOut, rawAmountOut)\n\n      const isOnlyV2 = RouterTradeAdapter.isVersionedRoute<V2PoolInRoute>(PoolType.V2Pool, subRoute)\n      const isOnlyV3 = RouterTradeAdapter.isVersionedRoute<V3PoolInRoute>(PoolType.V3Pool, subRoute)\n      const isOnlyV4 = RouterTradeAdapter.isVersionedRoute<V4PoolInRoute>(PoolType.V4Pool, subRoute)\n      return {\n        routev4: isOnlyV4\n          ? new V4Route(\n              (subRoute as V4PoolInRoute[]).map(RouterTradeAdapter.toV4Pool),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        routev3: isOnlyV3\n          ? new V3Route(\n              (subRoute as V3PoolInRoute[]).map(RouterTradeAdapter.toV3Pool),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        routev2: isOnlyV2\n          ? new V2Route(\n              (subRoute as V2PoolInRoute[]).map(RouterTradeAdapter.toPair),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        mixedRoute:\n          !isOnlyV4 && !isOnlyV3 && !isOnlyV2\n            ? new MixedRouteSDK(subRoute.map(RouterTradeAdapter.toPoolOrPair), parsedCurrencyIn, parsedCurrencyOut)\n            : null,\n        inputAmount,\n        outputAmount,\n      }\n    })\n\n    return new RouterTrade({\n      v2Routes: typedRoutes\n        .filter((route) => route.routev2)\n        .map((route) => ({\n          routev2: route.routev2 as V2Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      v3Routes: typedRoutes\n        .filter((route) => route.routev3)\n        .map((route) => ({\n          routev3: route.routev3 as V3Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      v4Routes: typedRoutes\n        .filter((route) => route.routev4)\n        .map((route) => ({\n          routev4: route.routev4 as V4Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      mixedRoutes: typedRoutes\n        .filter((route) => route.mixedRoute)\n        .map((route) => ({\n          mixedRoute: route.mixedRoute as MixedRouteSDK<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      tradeType: quote.tradeType,\n    })\n  }\n\n  private static toCurrency(isNative: boolean, token: TokenInRoute): Currency {\n    if (isNative) {\n      return Ether.onChain(token.chainId)\n    }\n    return this.toToken(token)\n  }\n\n  private static toPoolOrPair = (pool: V4PoolInRoute | V3PoolInRoute | V2PoolInRoute): V4Pool | V3Pool | Pair => {\n    switch (pool.type) {\n      case PoolType.V4Pool:\n        return RouterTradeAdapter.toV4Pool(pool)\n      case PoolType.V3Pool:\n        return RouterTradeAdapter.toV3Pool(pool)\n      case PoolType.V2Pool:\n        return RouterTradeAdapter.toPair(pool)\n      default:\n        throw new Error('Invalid pool type')\n    }\n  }\n\n  private static toToken(token: TokenInRoute): Token {\n    const { chainId, address, decimals, symbol, buyFeeBps, sellFeeBps } = token\n    return new Token(\n      chainId,\n      address,\n      parseInt(decimals.toString()),\n      symbol,\n      /* name */ undefined,\n      false,\n      buyFeeBps ? BigNumber.from(buyFeeBps) : undefined,\n      sellFeeBps ? BigNumber.from(sellFeeBps) : undefined\n    )\n  }\n\n  private static toV3Pool({ fee, sqrtRatioX96, liquidity, tickCurrent, tokenIn, tokenOut }: V3PoolInRoute): V3Pool {\n    return new V3Pool(\n      RouterTradeAdapter.toToken(tokenIn),\n      RouterTradeAdapter.toToken(tokenOut),\n      parseInt(fee) as FeeAmount,\n      sqrtRatioX96,\n      liquidity,\n      parseInt(tickCurrent)\n    )\n  }\n\n  private static toV4Pool(pool: V4PoolInRoute): V4Pool {\n    const parsedCurrencyIn = RouterTradeAdapter.toCurrency(isNativeCurrency(pool.tokenIn.address), pool.tokenIn)\n    const parsedCurrencyOut = RouterTradeAdapter.toCurrency(isNativeCurrency(pool.tokenOut.address), pool.tokenOut)\n    return new V4Pool(\n      parsedCurrencyIn,\n      parsedCurrencyOut,\n      parseInt(pool.fee) as FeeAmount,\n      parseInt(pool.tickSpacing),\n      pool.hooks,\n      pool.sqrtRatioX96,\n      pool.liquidity,\n      parseInt(pool.tickCurrent)\n    )\n  }\n\n  private static toPair = ({ reserve0, reserve1 }: V2PoolInRoute): Pair => {\n    return new Pair(\n      CurrencyAmount.fromRawAmount(RouterTradeAdapter.toToken(reserve0.token), reserve0.quotient),\n      CurrencyAmount.fromRawAmount(RouterTradeAdapter.toToken(reserve1.token), reserve1.quotient)\n    )\n  }\n\n  private static isVersionedRoute<T extends V2PoolInRoute | V3PoolInRoute | V4PoolInRoute>(\n    type: PoolType,\n    route: (V3PoolInRoute | V2PoolInRoute | V4PoolInRoute)[]\n  ): route is T[] {\n    return route.every((pool) => pool.type === type)\n  }\n}\n","import { ethers } from 'ethers'\nimport UniversalRouter from '@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json'\nimport { Interface } from '@ethersproject/abi'\nimport { V4BaseActionsParser, V4RouterAction } from '@uniswap/v4-sdk'\nimport { CommandType, CommandDefinition, COMMAND_DEFINITION, Subparser, Parser } from '../utils/routerCommands'\n\nexport type Param = {\n  readonly name: string\n  readonly value: any\n}\n\nexport type UniversalRouterCommand = {\n  readonly commandName: string\n  readonly commandType: CommandType\n  readonly params: readonly Param[]\n}\n\nexport type UniversalRouterCall = {\n  readonly commands: readonly UniversalRouterCommand[]\n}\n\nexport type V3PathItem = {\n  readonly tokenIn: string\n  readonly tokenOut: string\n  readonly fee: number\n}\n\nexport interface CommandsDefinition {\n  [key: number]: CommandDefinition\n}\n\n// Parses UniversalRouter V2 commands\nexport abstract class CommandParser {\n  public static INTERFACE: Interface = new Interface(UniversalRouter.abi)\n\n  public static parseCalldata(calldata: string): UniversalRouterCall {\n    const genericParser = new GenericCommandParser(COMMAND_DEFINITION)\n    const txDescription = CommandParser.INTERFACE.parseTransaction({ data: calldata })\n    const { commands, inputs } = txDescription.args\n    return genericParser.parse(commands, inputs)\n  }\n}\n\n// Parses commands based on given command definition\nexport class GenericCommandParser {\n  constructor(private readonly commandDefinition: CommandsDefinition) {}\n\n  public parse(commands: string, inputs: string[]): UniversalRouterCall {\n    const commandTypes = GenericCommandParser.getCommands(commands)\n\n    return {\n      commands: commandTypes.map((commandType: CommandType, i: number) => {\n        const commandDef = this.commandDefinition[commandType]\n\n        if (commandDef.parser === Parser.V4Actions) {\n          const { actions } = V4BaseActionsParser.parseCalldata(inputs[i])\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params: v4RouterCallToParams(actions),\n          }\n        } else if (commandDef.parser === Parser.Abi) {\n          const abiDef = commandDef.params\n          const rawParams = ethers.utils.defaultAbiCoder.decode(\n            abiDef.map((command) => command.type),\n            inputs[i]\n          )\n\n          const params = rawParams.map((param: any, j: number) => {\n            switch (abiDef[j].subparser) {\n              case Subparser.V3PathExactIn:\n                return {\n                  name: abiDef[j].name,\n                  value: parseV3PathExactIn(param),\n                }\n              case Subparser.V3PathExactOut:\n                return {\n                  name: abiDef[j].name,\n                  value: parseV3PathExactOut(param),\n                }\n              default:\n                return {\n                  name: abiDef[j].name,\n                  value: param,\n                }\n            }\n          })\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params,\n          }\n        } else if (commandDef.parser === Parser.V3Actions) {\n          // TODO: implement better parsing here\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params: inputs.map((input) => ({ name: 'command', value: input })),\n          }\n        } else {\n          throw new Error(`Unsupported parser: ${commandDef}`)\n        }\n      }),\n    }\n  }\n\n  // parse command types from bytes string\n  private static getCommands(commands: string): CommandType[] {\n    const commandTypes: CommandType[] = []\n\n    for (let i = 2; i < commands.length; i += 2) {\n      const byte = commands.substring(i, i + 2)\n      commandTypes.push(parseInt(byte, 16) as CommandType)\n    }\n\n    return commandTypes\n  }\n}\n\nexport function parseV3PathExactIn(path: string): readonly V3PathItem[] {\n  const strippedPath = path.replace('0x', '')\n  let tokenIn = ethers.utils.getAddress(strippedPath.substring(0, 40))\n  let loc = 40\n  const res: V3PathItem[] = []\n  while (loc < strippedPath.length) {\n    const feeAndTokenOut = strippedPath.substring(loc, loc + 46)\n    const fee = parseInt(feeAndTokenOut.substring(0, 6), 16)\n    const tokenOut = ethers.utils.getAddress(feeAndTokenOut.substring(6, 46))\n\n    res.push({\n      tokenIn,\n      tokenOut,\n      fee,\n    })\n    tokenIn = tokenOut\n    loc += 46\n  }\n\n  return res\n}\n\nexport function parseV3PathExactOut(path: string): readonly V3PathItem[] {\n  const strippedPath = path.replace('0x', '')\n  let tokenIn = ethers.utils.getAddress(strippedPath.substring(strippedPath.length - 40))\n  let loc = strippedPath.length - 86 // 86 = (20 addr + 3 fee + 20 addr) * 2 (for hex characters)\n  const res: V3PathItem[] = []\n  while (loc >= 0) {\n    const feeAndTokenOut = strippedPath.substring(loc, loc + 46)\n    const tokenOut = ethers.utils.getAddress(feeAndTokenOut.substring(0, 40))\n    const fee = parseInt(feeAndTokenOut.substring(40, 46), 16)\n\n    res.push({\n      tokenIn,\n      tokenOut,\n      fee,\n    })\n    tokenIn = tokenOut\n\n    loc -= 46\n  }\n\n  return res\n}\n\nfunction v4RouterCallToParams(actions: readonly V4RouterAction[]): readonly Param[] {\n  return actions.map((action) => {\n    return {\n      name: action.actionName,\n      value: action.params.map((param) => {\n        return {\n          name: param.name,\n          value: param.value,\n        }\n      }),\n    }\n  })\n}\n"],"names":["CommandType","Subparser","Parser","ALLOW_REVERT_FLAG","REVERTIBLE_COMMANDS","Set","EXECUTE_SUB_PLAN","PERMIT_STRUCT","PERMIT_BATCH_STRUCT","POOL_KEY_STRUCT","PERMIT2_TRANSFER_FROM_STRUCT","PERMIT2_TRANSFER_FROM_BATCH_STRUCT","COMMAND_DEFINITION","_COMMAND_DEFINITION","parser","Abi","params","name","type","PERMIT2_PERMIT","PERMIT2_PERMIT_BATCH","PERMIT2_TRANSFER_FROM","PERMIT2_TRANSFER_FROM_BATCH","V3_SWAP_EXACT_IN","subparser","V3PathExactIn","V3_SWAP_EXACT_OUT","V3PathExactOut","V2_SWAP_EXACT_IN","V2_SWAP_EXACT_OUT","V4_SWAP","V4Actions","WRAP_ETH","UNWRAP_WETH","SWEEP","TRANSFER","PAY_PORTION","BALANCE_CHECK_ERC20","V4_INITIALIZE_POOL","V3_POSITION_MANAGER_PERMIT","V3Actions","V3_POSITION_MANAGER_CALL","V4_POSITION_MANAGER_CALL","ACROSS_V4_DEPOSIT_V3","RoutePlanner","commands","inputs","_proto","prototype","addSubPlan","subplan","addCommand","addAcrossBridge","depositor","recipient","inputToken","outputToken","inputAmount","outputAmount","destinationChainId","exclusiveRelayer","quoteTimestamp","fillDeadline","exclusivityDeadline","message","useNative","parameters","allowRevert","command","createCommand","push","encodedInput","has","Error","concat","toString","padStart","commandDef","defaultAbiCoder","encode","map","abi","getPathCurrency","currency","pool","involvesToken","wrapped","V4Pool","token0","equals","token1","symbol","RouterActionType","UniversalRouterVersion","ZERO_ROUTER_CONFIG","address","creationBlock","WETH_NOT_SUPPORTED_ON_CHAIN","CHAIN_CONFIGS","_CHAIN_CONFIGS","weth","routerConfigs","_routerConfigs","V1_2","V2_0","V2_1","_routerConfigs2","_routerConfigs3","_routerConfigs4","_routerConfigs5","_routerConfigs6","_routerConfigs7","_routerConfigs8","_routerConfigs9","_routerConfigs0","_routerConfigs1","_routerConfigs10","_routerConfigs11","_routerConfigs12","_routerConfigs13","_routerConfigs14","_routerConfigs15","_routerConfigs16","_routerConfigs17","_routerConfigs18","_routerConfigs19","_routerConfigs20","_routerConfigs21","_routerConfigs22","_routerConfigs23","_routerConfigs24","_routerConfigs25","_routerConfigs26","UNIVERSAL_ROUTER_ADDRESS","version","chainId","UNIVERSAL_ROUTER_CREATION_BLOCK","WETH_ADDRESS","CONTRACT_BALANCE","BigNumber","from","pow","ETH_ADDRESS","E_ETH_ADDRESS","SENDER_AS_RECIPIENT","ROUTER_AS_RECIPIENT","getCurrencyAddress","isNative","encodeFeeBips","fee","toHex","multiply","quotient","REFUND_ETH_PRICE_IMPACT_THRESHOLD","Percent","UniswapTrade","trade","options","flatFee","inputRequiresWrap","inputRequiresUnwrap","useRouterBalance","payerIsUser","planner","_config","maximumAmountIn","slippageTolerance","_this$options$recipie","performAggregatedSlippageCheck","tradeType","TradeType","EXACT_INPUT","routes","length","routerMustCustody","outputRequiresTransition","hasFeeOption","_iterator","_createForOfIteratorHelperLoose","swaps","_step","done","swap","value","route","protocol","Protocol","V2","addV2Swap","V3","addV3Swap","V4","addV4Swap","MIXED","addMixedSwap","minimumAmountOut","pools","pathOutputCurrencyAddress","feeBips","EXACT_OUTPUT","sub","mul","div","feeAmount","amount","lt","outputRequiresUnwrap","outputRequiresWrap","riskOfPartialFill","safeMode","_createClass","key","get","result","_iterator2","_step2","firstPool","pathInput","lastRoute","lastPool","pathOutput","currency1","currency0","poolBefore","_ref","V2Trade","path","token","_ref2","V3Trade","createUncheckedTrade","encodeRouteToPath","_ref3","p","v4Route","V4Route","V4Trade","slippageToleranceOnSwap","undefined","v4Planner","V4Planner","addTrade","addSettle","pathOutputForTake","ethWethPool","addTake","_options$recipient","finalize","tradeRecipient","_options$recipient2","V3Pool","Pair","MixedRouteTrade","amountIn","amountOut","sections","partitionMixedRouteByProtocol","isLastSectionInRoute","i","section","routePool","getOutputOfPools","subRoute","MixedRoute","MixedRouteSDK","nextInputToken","swapRecipient","nextPool","v2PoolIsSwapRecipient","liquidityToken","v4SubRoute","input","output","addAction","Actions","SWAP_EXACT_IN","currencyIn","encodeV4RouteToPath","amountOutMinimum","outputTokenForTake","v4Pool","encodeMixedRouteToPath","priceImpact","greaterThan","swapOptions","SIGNATURE_LENGTH","EIP_2098_SIGNATURE_LENGTH","encodePermit","permit2","signature","ethers","utils","arrayify","joinSignature","splitSignature","encodeV3PositionPermit","permit","tokenId","calldata","NonfungiblePositionManager","INTERFACE","encodeFunctionData","validateAndParseAddress","spender","deadline","v","r","s","encodeInputTokenOptions","permit2TransferFrom","permit2Permit","details","process","invariant","EIP712_DOMAIN_NAME","EIP712_DOMAIN_VERSION","EXECUTE_SIGNED_TYPES","ExecuteSigned","NONCE_SKIP_CHECK","generateNonce","randomBytes","Uint8Array","Math","floor","random","toHexString","getUniversalRouterDomain","routerAddress","verifyingContract","isMint","Object","keys","some","k","SwapRouter","swapCallParameters","trades","bridgeOptions","inputCurrency","inputTokenPermit","nativeCurrencyValue","forEach","bridge","encodePlan","deadlineOrPreviousBlockhash","migrateV3ToV4CallParameters","positionManagerOverride","outputPosition","v3Token0","inputPosition","v3Token1","v4PositionManagerAddress","CHAIN_TO_ADDRESSES_MAP","v3RemoveLiquidityOptions","liquidityPercentage","equalTo","burnToken","collectOptions","v4AddLiquidityOptions","migrate","createPool","poolKey","getPoolKey","tickSpacing","hooks","sqrtRatioX96","universalRouterAddress","v3RemoveParams","V3PositionManager","removeCallParameters","v3Calls","Multicall","decodeMulticall","v3Call","selector","slice","getSighash","v4AddParams","V4PositionManager","addCallParameters","getExecuteSignedPayload","signedOptions","iface","decoded","decodeFunctionData","nonce","domain","types","intent","data","sender","encodeExecuteSigned","executeSignedCalldata","config","functionSignature","Interface","UniversalRouter","UnwrapWETH","wethAddress","toLowerCase","permit2Data","_","PoolType","isNativeCurrency","RouterTradeAdapter","fromClassicQuote","quote","tokenIn","tokenOut","firstRoute","tokenInData","tokenOutData","parsedCurrencyIn","toCurrency","parsedCurrencyOut","typedRoutes","rawAmountIn","rawAmountOut","CurrencyAmount","fromRawAmount","isOnlyV2","isVersionedRoute","V2Pool","isOnlyV3","isOnlyV4","routev4","toV4Pool","routev3","V3Route","toV3Pool","routev2","V2Route","toPair","mixedRoute","toPoolOrPair","RouterTrade","v2Routes","filter","v3Routes","v4Routes","mixedRoutes","Ether","onChain","toToken","decimals","buyFeeBps","sellFeeBps","Token","parseInt","liquidity","tickCurrent","every","reserve0","reserve1","CommandParser","parseCalldata","genericParser","GenericCommandParser","txDescription","parseTransaction","_txDescription$args","args","parse","commandDefinition","commandTypes","getCommands","commandType","_this","_V4BaseActionsParser$","V4BaseActionsParser","actions","commandName","v4RouterCallToParams","abiDef","rawParams","decode","param","j","parseV3PathExactIn","parseV3PathExactOut","byte","substring","strippedPath","replace","getAddress","loc","res","feeAndTokenOut","action","actionName"],"mappings":"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"}
\ No newline at end of file
diff --git a/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.production.min.js b/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.production.min.js
index 31727e4..0980bda 100644
--- a/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.production.min.js
+++ b/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.production.min.js
@@ -1,2 +1,2 @@
-"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,r,o,n,a=e(require("tiny-invariant")),i=e(require("@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json")),s=require("@ethersproject/abi"),u=require("ethers"),p=require("@uniswap/v3-sdk"),d=require("@uniswap/v4-sdk"),c=require("@uniswap/sdk-core"),m=require("ethers/lib/utils"),l=require("@uniswap/v2-sdk"),f=require("@uniswap/router-sdk");function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=Array(t);r<t;r++)o[r]=e[r];return o}function T(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return A(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?A(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function C(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}require("jsbi"),require("bignumber.js"),(r=exports.CommandType||(exports.CommandType={}))[r.V3_SWAP_EXACT_IN=0]="V3_SWAP_EXACT_IN",r[r.V3_SWAP_EXACT_OUT=1]="V3_SWAP_EXACT_OUT",r[r.PERMIT2_TRANSFER_FROM=2]="PERMIT2_TRANSFER_FROM",r[r.PERMIT2_PERMIT_BATCH=3]="PERMIT2_PERMIT_BATCH",r[r.SWEEP=4]="SWEEP",r[r.TRANSFER=5]="TRANSFER",r[r.PAY_PORTION=6]="PAY_PORTION",r[r.V2_SWAP_EXACT_IN=8]="V2_SWAP_EXACT_IN",r[r.V2_SWAP_EXACT_OUT=9]="V2_SWAP_EXACT_OUT",r[r.PERMIT2_PERMIT=10]="PERMIT2_PERMIT",r[r.WRAP_ETH=11]="WRAP_ETH",r[r.UNWRAP_WETH=12]="UNWRAP_WETH",r[r.PERMIT2_TRANSFER_FROM_BATCH=13]="PERMIT2_TRANSFER_FROM_BATCH",r[r.BALANCE_CHECK_ERC20=14]="BALANCE_CHECK_ERC20",r[r.V4_SWAP=16]="V4_SWAP",r[r.V3_POSITION_MANAGER_PERMIT=17]="V3_POSITION_MANAGER_PERMIT",r[r.V3_POSITION_MANAGER_CALL=18]="V3_POSITION_MANAGER_CALL",r[r.V4_INITIALIZE_POOL=19]="V4_INITIALIZE_POOL",r[r.V4_POSITION_MANAGER_CALL=20]="V4_POSITION_MANAGER_CALL",r[r.EXECUTE_SUB_PLAN=33]="EXECUTE_SUB_PLAN",(o=exports.Subparser||(exports.Subparser={}))[o.V3PathExactIn=0]="V3PathExactIn",o[o.V3PathExactOut=1]="V3PathExactOut",(n=exports.Parser||(exports.Parser={}))[n.Abi=0]="Abi",n[n.V4Actions=1]="V4Actions",n[n.V3Actions=2]="V3Actions";var y,x,h,v,P,_,R,b,E,V,I,g,w,k,U,N,O,B,S,q,F,D,M,W,L,X,H,j,G,K=new Set([exports.CommandType.EXECUTE_SUB_PLAN]),Y=((t={})[exports.CommandType.EXECUTE_SUB_PLAN]={parser:exports.Parser.Abi,params:[{name:"commands",type:"bytes"},{name:"inputs",type:"bytes[]"}]},t[exports.CommandType.PERMIT2_PERMIT]={parser:exports.Parser.Abi,params:[{name:"permit",type:"((address token,uint160 amount,uint48 expiration,uint48 nonce) details,address spender,uint256 sigDeadline)"},{name:"signature",type:"bytes"}]},t[exports.CommandType.PERMIT2_PERMIT_BATCH]={parser:exports.Parser.Abi,params:[{name:"permit",type:"((address token,uint160 amount,uint48 expiration,uint48 nonce)[] details,address spender,uint256 sigDeadline)"},{name:"signature",type:"bytes"}]},t[exports.CommandType.PERMIT2_TRANSFER_FROM]={parser:exports.Parser.Abi,params:[{name:"token",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint160"}]},t[exports.CommandType.PERMIT2_TRANSFER_FROM_BATCH]={parser:exports.Parser.Abi,params:[{name:"transferFrom",type:"(address from,address to,uint160 amount,address token)[]"}]},t[exports.CommandType.V3_SWAP_EXACT_IN]={parser:exports.Parser.Abi,params:[{name:"recipient",type:"address"},{name:"amountIn",type:"uint256"},{name:"amountOutMin",type:"uint256"},{name:"path",subparser:exports.Subparser.V3PathExactIn,type:"bytes"},{name:"payerIsUser",type:"bool"}]},t[exports.CommandType.V3_SWAP_EXACT_OUT]={parser:exports.Parser.Abi,params:[{name:"recipient",type:"address"},{name:"amountOut",type:"uint256"},{name:"amountInMax",type:"uint256"},{name:"path",subparser:exports.Subparser.V3PathExactOut,type:"bytes"},{name:"payerIsUser",type:"bool"}]},t[exports.CommandType.V2_SWAP_EXACT_IN]={parser:exports.Parser.Abi,params:[{name:"recipient",type:"address"},{name:"amountIn",type:"uint256"},{name:"amountOutMin",type:"uint256"},{name:"path",type:"address[]"},{name:"payerIsUser",type:"bool"}]},t[exports.CommandType.V2_SWAP_EXACT_OUT]={parser:exports.Parser.Abi,params:[{name:"recipient",type:"address"},{name:"amountOut",type:"uint256"},{name:"amountInMax",type:"uint256"},{name:"path",type:"address[]"},{name:"payerIsUser",type:"bool"}]},t[exports.CommandType.V4_SWAP]={parser:exports.Parser.V4Actions},t[exports.CommandType.WRAP_ETH]={parser:exports.Parser.Abi,params:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}]},t[exports.CommandType.UNWRAP_WETH]={parser:exports.Parser.Abi,params:[{name:"recipient",type:"address"},{name:"amountMin",type:"uint256"}]},t[exports.CommandType.SWEEP]={parser:exports.Parser.Abi,params:[{name:"token",type:"address"},{name:"recipient",type:"address"},{name:"amountMin",type:"uint256"}]},t[exports.CommandType.TRANSFER]={parser:exports.Parser.Abi,params:[{name:"token",type:"address"},{name:"recipient",type:"address"},{name:"value",type:"uint256"}]},t[exports.CommandType.PAY_PORTION]={parser:exports.Parser.Abi,params:[{name:"token",type:"address"},{name:"recipient",type:"address"},{name:"bips",type:"uint256"}]},t[exports.CommandType.BALANCE_CHECK_ERC20]={parser:exports.Parser.Abi,params:[{name:"owner",type:"address"},{name:"token",type:"address"},{name:"minBalance",type:"uint256"}]},t[exports.CommandType.V4_INITIALIZE_POOL]={parser:exports.Parser.Abi,params:[{name:"poolKey",type:"(address currency0,address currency1,uint24 fee,int24 tickSpacing,address hooks)"},{name:"sqrtPriceX96",type:"uint160"}]},t[exports.CommandType.V3_POSITION_MANAGER_PERMIT]={parser:exports.Parser.V3Actions},t[exports.CommandType.V3_POSITION_MANAGER_CALL]={parser:exports.Parser.V3Actions},t[exports.CommandType.V4_POSITION_MANAGER_CALL]={parser:exports.Parser.V4Actions},t),Z=function(){function e(){this.commands="0x",this.inputs=[]}var t=e.prototype;return t.addSubPlan=function(e){return this.addCommand(exports.CommandType.EXECUTE_SUB_PLAN,[e.commands,e.inputs],!0),this},t.addCommand=function(e,t,r){void 0===r&&(r=!1);var o=function(e,t){var r=Y[e];switch(r.parser){case exports.Parser.Abi:return{type:e,encodedInput:m.defaultAbiCoder.encode(r.params.map((function(e){return e.type})),t)};case exports.Parser.V4Actions:case exports.Parser.V3Actions:return{type:e,encodedInput:t[0]}}}(e,t);if(this.inputs.push(o.encodedInput),r){if(!K.has(o.type))throw new Error("command type: "+o.type+" cannot be allowed to revert");o.type=128|o.type}return this.commands=this.commands.concat(o.type.toString(16).padStart(2,"0")),this},e}();function z(e,t){if(t.involvesToken(e))return e;if(t.involvesToken(e.wrapped))return e.wrapped;if(t instanceof d.Pool&&t.token0.wrapped.equals(e))return t.token0;if(t instanceof d.Pool&&t.token1.wrapped.equals(e))return t.token1;throw new Error("Expected currency "+e.symbol+" to be either "+t.token0.symbol+" or "+t.token1.symbol)}(y=exports.RouterActionType||(exports.RouterActionType={})).UniswapTrade="UniswapTrade",y.UnwrapWETH="UnwrapWETH",(G=exports.UniversalRouterVersion||(exports.UniversalRouterVersion={})).V1_2="1.2",G.V2_0="2.0";var Q=((j={})[1]={weth:"0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",routerConfigs:(x={},x[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:17143817},x[exports.UniversalRouterVersion.V2_0]={address:"0x66a9893cc07d91d95644aedd05d03f95e1dba8af",creationBlock:1737658355},x)},j[5]={weth:"0xb4fbf271143f4fbf7b91a5ded31805e42b2208d6",routerConfigs:(h={},h[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:8940568},h[exports.UniversalRouterVersion.V2_0]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:8940568},h)},j[11155111]={weth:"0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14",routerConfigs:(v={},v[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:3543575},v[exports.UniversalRouterVersion.V2_0]={address:"0x3a9d48ab9751398bbfa63ad67599bb04e4bdf98b",creationBlock:7259601},v)},j[137]={weth:"0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270",routerConfigs:(P={},P[exports.UniversalRouterVersion.V1_2]={address:"0xec7BE89e9d109e7e3Fec59c222CF297125FEFda2",creationBlock:52210153},P[exports.UniversalRouterVersion.V2_0]={address:"0x1095692a6237d83c6a72f3f5efedb9a670c49223",creationBlock:1737492197},P)},j[80001]={weth:"0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889",routerConfigs:(_={},_[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:35176052},_[exports.UniversalRouterVersion.V2_0]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:35176052},_)},j[10]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(R={},R[exports.UniversalRouterVersion.V1_2]={address:"0xCb1355ff08Ab38bBCE60111F1bb2B784bE25D7e8",creationBlock:114702266},R[exports.UniversalRouterVersion.V2_0]={address:"0x851116d9223fabed8e56c0e6b8ad0c31d98b3507",creationBlock:1737494278},R)},j[420]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(b={},b[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:8887728},b[exports.UniversalRouterVersion.V2_0]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:8887728},b)},j[42161]={weth:"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1",routerConfigs:(E={},E[exports.UniversalRouterVersion.V1_2]={address:"0x5E325eDA8064b456f4781070C0738d849c824258",creationBlock:169472836},E[exports.UniversalRouterVersion.V2_0]={address:"0xa51afafe0263b40edaef0df8781ea9aa03e381a3",creationBlock:1737487458},E)},j[421613]={weth:"0xe39Ab88f8A4777030A534146A9Ca3B52bd5D43A3",routerConfigs:(V={},V[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:18815277},V[exports.UniversalRouterVersion.V2_0]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:18815277},V)},j[42220]={weth:"0x0000000000000000000000000000000000000000",routerConfigs:(I={},I[exports.UniversalRouterVersion.V1_2]={address:"0x643770e279d5d0733f21d6dc03a8efbabf3255b4",creationBlock:21407637},I[exports.UniversalRouterVersion.V2_0]={address:"0xcb695bc5D3Aa22cAD1E6DF07801b061a05A0233A",creationBlock:47387857},I)},j[44787]={weth:"0x0000000000000000000000000000000000000000",routerConfigs:(g={},g[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:17566658},g[exports.UniversalRouterVersion.V2_0]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:17566658},g)},j[56]={weth:"0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c",routerConfigs:(w={},w[exports.UniversalRouterVersion.V1_2]={address:"0x4Dae2f939ACf50408e13d58534Ff8c2776d45265",creationBlock:35160263},w[exports.UniversalRouterVersion.V2_0]={address:"0x1906c1d672b88cd1b9ac7593301ca990f94eae07",creationBlock:1737493275},w)},j[43114]={weth:"0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7",routerConfigs:(k={},k[exports.UniversalRouterVersion.V1_2]={address:"0x4Dae2f939ACf50408e13d58534Ff8c2776d45265",creationBlock:40237257},k[exports.UniversalRouterVersion.V2_0]={address:"0x94b75331ae8d42c1b61065089b7d48fe14aa73b7",creationBlock:1737558236},k)},j[84531]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(U={},U[exports.UniversalRouterVersion.V1_2]={address:"0xd0872d928672ae2ff74bdb2f5130ac12229cafaf",creationBlock:6915289},U[exports.UniversalRouterVersion.V2_0]={address:"0xd0872d928672ae2ff74bdb2f5130ac12229cafaf",creationBlock:6915289},U)},j[8453]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(N={},N[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:9107268},N[exports.UniversalRouterVersion.V2_0]={address:"0x6ff5693b99212da76ad316178a184ab56d299b43",creationBlock:1737491485},N)},j[81457]={weth:"0x4300000000000000000000000000000000000004",routerConfigs:(O={},O[exports.UniversalRouterVersion.V1_2]={address:"0x643770E279d5D0733F21d6DC03A8efbABf3255B4",creationBlock:1116444},O[exports.UniversalRouterVersion.V2_0]={address:"0xeabbcb3e8e415306207ef514f660a3f820025be3",creationBlock:1737564586},O)},j[7777777]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(B={},B[exports.UniversalRouterVersion.V1_2]={address:"0x2986d9721A49838ab4297b695858aF7F17f38014",creationBlock:11832155},B[exports.UniversalRouterVersion.V2_0]={address:"0x3315ef7ca28db74abadc6c44570efdf06b04b020",creationBlock:1737562927},B)},j[324]={weth:"0x5aea5775959fbc2557cc8789bc1bf90a239d9a91",routerConfigs:(S={},S[exports.UniversalRouterVersion.V1_2]={address:"0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06",creationBlock:12640979},S[exports.UniversalRouterVersion.V2_0]={address:"0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06",creationBlock:12640979},S)},j[480]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(q={},q[exports.UniversalRouterVersion.V1_2]={address:"0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D",creationBlock:4063979},q[exports.UniversalRouterVersion.V2_0]={address:"0x8ac7bee993bb44dab564ea4bc9ea67bf9eb5e743",creationBlock:1737559557},q)},j[1301]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(F={},F[exports.UniversalRouterVersion.V1_2]={address:"0x8909Dc15e40173Ff4699343b6eB8132c65e18eC6",creationBlock:1241811},F[exports.UniversalRouterVersion.V2_0]={address:"0xf70536b3bcc1bd1a972dc186a2cf84cc6da6be5d",creationBlock:7100543},F)},j[130]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(D={},D[exports.UniversalRouterVersion.V1_2]={address:"0x4D73A4411CA1c660035e4AECC8270E5DdDEC8C17",creationBlock:23678},D[exports.UniversalRouterVersion.V2_0]={address:"0xef740bf23acae26f6492b10de645d6b98dc8eaf3",creationBlock:1737568156},D)},j[10143]={weth:"0x760AfE86e5de5fa0Ee542fc7B7B713e1c5425701",routerConfigs:(M={},M[exports.UniversalRouterVersion.V1_2]={address:"0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893",creationBlock:23678},M[exports.UniversalRouterVersion.V2_0]={address:"0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893",creationBlock:23678},M)},j[84532]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(W={},W[exports.UniversalRouterVersion.V1_2]={address:"0x492e6456d9528771018deb9e87ef7750ef184104",creationBlock:20216585},W[exports.UniversalRouterVersion.V2_0]={address:"0x492e6456d9528771018deb9e87ef7750ef184104",creationBlock:20216585},W)},j[1868]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(L={},L[exports.UniversalRouterVersion.V1_2]={address:"0x0e2850543f69f678257266e0907ff9a58b3f13de",creationBlock:3254782},L[exports.UniversalRouterVersion.V2_0]={address:"0x0e2850543f69f678257266e0907ff9a58b3f13de",creationBlock:3254782},L)},j[143]={weth:"0x3bd359C1119dA7Da1D913D1C4D2B7c461115433A",routerConfigs:(X={},X[exports.UniversalRouterVersion.V1_2]={address:"0x0d97dc33264bfc1c226207428a79b26757fb9dc3",creationBlock:29255937},X[exports.UniversalRouterVersion.V2_0]={address:"0x0d97dc33264bfc1c226207428a79b26757fb9dc3",creationBlock:29255937},X)},j[196]={weth:"0xe538905cf8410324e03A5A23C1c177a474D59b2b",routerConfigs:(H={},H[exports.UniversalRouterVersion.V1_2]={address:"0x0000000000000000000000000000000000000000",creationBlock:1},H[exports.UniversalRouterVersion.V2_0]={address:"0x5507749f2c558bb3e162c6e90c314c092e7372ff",creationBlock:47680350},H)},j),$=function(e,t){if(!(t in Q))throw new Error("Universal Router not deployed on chain "+t);return Q[t].routerConfigs[e].address},J=function(e){if(!(e in Q))throw new Error("Universal Router not deployed on chain "+e);if("0x0000000000000000000000000000000000000000"==Q[e].weth)throw new Error("Chain "+e+" does not have WETH");return Q[e].weth},ee=u.BigNumber.from(2).pow(255),te="0x0000000000000000000000000000000000000000",re="0x0000000000000000000000000000000000000001",oe="0x0000000000000000000000000000000000000002";function ne(e){return e.isNative?te:e.wrapped.address}var ae=new c.Percent(50,100),ie=function(){function e(e,t){if(this.trade=e,this.options=t,this.tradeType=exports.RouterActionType.UniswapTrade,t.fee&&t.flatFee)throw new Error("Only one fee option permitted");this.payerIsUser=!(this.inputRequiresWrap||this.inputRequiresUnwrap||this.options.useRouterBalance)}var t,r;return e.prototype.encode=function(e,t){var r;this.inputRequiresWrap?e.addCommand(exports.CommandType.WRAP_ETH,[oe,this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString()]):this.inputRequiresUnwrap&&(e.addCommand(exports.CommandType.PERMIT2_TRANSFER_FROM,[this.trade.inputAmount.currency.address,oe,this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString()]),e.addCommand(exports.CommandType.UNWRAP_WETH,[oe,0])),this.options.recipient=null!=(r=this.options.recipient)?r:re;for(var o,n,a=this.trade.tradeType===c.TradeType.EXACT_INPUT&&this.trade.routes.length>2||this.outputRequiresTransition||!!(o=this.options).fee||!!o.flatFee,i=T(this.trade.swaps);!(n=i()).done;){var s=n.value;switch(s.route.protocol){case f.Protocol.V2:se(e,s,this.trade.tradeType,this.options,this.payerIsUser,a);break;case f.Protocol.V3:ue(e,s,this.trade.tradeType,this.options,this.payerIsUser,a);break;case f.Protocol.V4:pe(e,s,this.trade.tradeType,this.options,this.payerIsUser,a);break;case f.Protocol.MIXED:de(e,s,this.trade.tradeType,this.options,this.payerIsUser,a);break;default:throw new Error("UNSUPPORTED_TRADE_PROTOCOL")}}var d=u.BigNumber.from(this.trade.minimumAmountOut(this.options.slippageTolerance).quotient.toString());if(a){var m=this.trade.swaps[0].route.pools,l=ne(z(this.trade.outputAmount.currency,m[m.length-1]));if(this.options.fee){var A=p.toHex(this.options.fee.fee.multiply(1e4).quotient);e.addCommand(exports.CommandType.PAY_PORTION,[l,this.options.fee.recipient,A]),this.trade.tradeType===c.TradeType.EXACT_OUTPUT&&(d=d.sub(d.mul(A).div(1e4)))}if(this.options.flatFee){var C=this.options.flatFee.amount;if(d.lt(C))throw new Error("Flat fee amount greater than minimumAmountOut");e.addCommand(exports.CommandType.TRANSFER,[l,this.options.flatFee.recipient,C]),this.trade.tradeType===c.TradeType.EXACT_OUTPUT&&(d=d.sub(C))}this.outputRequiresUnwrap?e.addCommand(exports.CommandType.UNWRAP_WETH,[this.options.recipient,d]):this.outputRequiresWrap?e.addCommand(exports.CommandType.WRAP_ETH,[this.options.recipient,ee]):e.addCommand(exports.CommandType.SWEEP,[ne(this.trade.outputAmount.currency),this.options.recipient,d])}(this.trade.tradeType===c.TradeType.EXACT_OUTPUT||this.trade.priceImpact.greaterThan(ae))&&(this.inputRequiresWrap?e.addCommand(exports.CommandType.UNWRAP_WETH,[this.options.recipient,0]):this.inputRequiresUnwrap?e.addCommand(exports.CommandType.WRAP_ETH,[this.options.recipient,ee]):this.trade.inputAmount.currency.isNative&&e.addCommand(exports.CommandType.SWEEP,[te,this.options.recipient,0])),this.options.safeMode&&e.addCommand(exports.CommandType.SWEEP,[te,this.options.recipient,0])},t=e,(r=[{key:"isAllV4",get:function(){for(var e,t=!0,r=T(this.trade.swaps);!(e=r()).done;)t=t&&e.value.route.protocol==f.Protocol.V4;return t}},{key:"inputRequiresWrap",get:function(){return this.trade.swaps[0].route.pools[0]instanceof d.Pool?this.trade.inputAmount.currency.isNative&&!this.trade.swaps[0].route.pathInput.isNative:this.trade.inputAmount.currency.isNative}},{key:"inputRequiresUnwrap",get:function(){return this.trade.swaps[0].route.pools[0]instanceof d.Pool&&!this.trade.inputAmount.currency.isNative&&this.trade.swaps[0].route.pathInput.isNative}},{key:"outputRequiresWrap",get:function(){var e=this.trade.swaps[0].route,t=e.pools[e.pools.length-1];if(t instanceof d.Pool&&!this.trade.outputAmount.currency.isNative){if(e.pathOutput.isNative)return!0;if(t.currency1.equals(t.currency0.wrapped)&&e.pools.length>1){var r=e.pools[e.pools.length-2];if(r instanceof d.Pool&&(r.currency0.equals(t.currency1)||r.currency1.equals(t.currency1)))return!0;if(r.token0.equals(t.currency1)||r.token1.equals(t.currency1))return!0}}return!1}},{key:"outputRequiresUnwrap",get:function(){var e=this.trade.swaps[0].route,t=e.pools[e.pools.length-1];return t instanceof d.Pool&&this.trade.outputAmount.currency.isNative?!this.trade.swaps[0].route.pathOutput.isNative||!!(e.pools.length>1&&e.pools[e.pools.length-2]instanceof d.Pool&&e.pools[e.pools.length-2].currency0.isNative&&t.currency1.equals(t.currency0.wrapped)):this.trade.outputAmount.currency.isNative}},{key:"outputRequiresTransition",get:function(){return this.outputRequiresWrap||this.outputRequiresUnwrap}}])&&function(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,C(o.key),o)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}();function se(e,t,r,o,n,a){var i=t.route,s=new l.Trade(i,r==c.TradeType.EXACT_INPUT?t.inputAmount:t.outputAmount,r);r==c.TradeType.EXACT_INPUT?e.addCommand(exports.CommandType.V2_SWAP_EXACT_IN,[a?oe:o.recipient,s.maximumAmountIn(o.slippageTolerance).quotient.toString(),a?0:s.minimumAmountOut(o.slippageTolerance).quotient.toString(),i.path.map((function(e){return e.wrapped.address})),n]):r==c.TradeType.EXACT_OUTPUT&&e.addCommand(exports.CommandType.V2_SWAP_EXACT_OUT,[a?oe:o.recipient,s.minimumAmountOut(o.slippageTolerance).quotient.toString(),s.maximumAmountIn(o.slippageTolerance).quotient.toString(),i.path.map((function(e){return e.wrapped.address})),n])}function ue(e,t,r,o,n,a){var i=t.route,s=p.Trade.createUncheckedTrade({route:i,inputAmount:t.inputAmount,outputAmount:t.outputAmount,tradeType:r}),u=p.encodeRouteToPath(i,s.tradeType===c.TradeType.EXACT_OUTPUT);r==c.TradeType.EXACT_INPUT?e.addCommand(exports.CommandType.V3_SWAP_EXACT_IN,[a?oe:o.recipient,s.maximumAmountIn(o.slippageTolerance).quotient.toString(),a?0:s.minimumAmountOut(o.slippageTolerance).quotient.toString(),u,n]):r==c.TradeType.EXACT_OUTPUT&&e.addCommand(exports.CommandType.V3_SWAP_EXACT_OUT,[a?oe:o.recipient,s.minimumAmountOut(o.slippageTolerance).quotient.toString(),s.maximumAmountIn(o.slippageTolerance).quotient.toString(),u,n])}function pe(e,t,r,o,n,a){var i,s=t.inputAmount,u=t.outputAmount,p=t.route.pools.map((function(e){return e})),m=new d.Route(p,s.currency,u.currency),l=d.Trade.createUncheckedTrade({route:m,inputAmount:s,outputAmount:u,tradeType:r}),f=a&&r==c.TradeType.EXACT_INPUT?void 0:o.slippageTolerance,A=new d.V4Planner;A.addTrade(l,f),A.addSettle(l.route.pathInput,n);var T=l.route.pathOutput,C=m.pools[m.pools.length-1];if(C.currency1.equals(C.currency0.wrapped)&&m.pools.length>1){var y=m.pools[m.pools.length-2];T.isNative&&y.currency0.isNative?T=T.wrapped:T.isNative||!y.currency0.equals(C.currency1)&&!y.currency1.equals(C.currency1)||(T=C.currency0)}A.addTake(T,a?oe:null!=(i=o.recipient)?i:re),e.addCommand(exports.CommandType.V4_SWAP,[A.finalize()])}function de(e,t,r,o,n,a){var i,s=t.route,u=t.inputAmount,c=t.outputAmount,m=a?oe:null!=(i=o.recipient)?i:re;if(1===s.pools.length){if(s.pools[0]instanceof d.Pool)return pe(e,t,r,o,n,a);if(s.pools[0]instanceof p.Pool)return ue(e,t,r,o,n,a);if(s.pools[0]instanceof l.Pair)return se(e,t,r,o,n,a);throw new Error("Invalid route type")}for(var A=f.MixedRouteTrade.createUncheckedTrade({route:s,inputAmount:u,outputAmount:c,tradeType:r}),T=A.maximumAmountIn(o.slippageTolerance,u).quotient.toString(),C=a?0:A.minimumAmountOut(o.slippageTolerance,c).quotient.toString(),y=f.partitionMixedRouteByProtocol(s),x=function(e){return e===y.length-1},h=s.pathInput,v=0;v<y.length;v++){var P=y[v],_=P[0],R=f.getOutputOfPools(P,h),b=new f.MixedRoute(new f.MixedRouteSDK([].concat(P),h,R)),E=void 0,V=void 0;if(x(v))E=R,V=m;else{var I=y[v+1][0];E=z(R,I),V=I instanceof l.Pair&&R.equals(E)?I.liquidityToken.address:oe}if(_ instanceof d.Pool){var g=new d.V4Planner,w=new d.Route(P,b.input,b.output);g.addSettle(h,n&&0===v,0==v?T:ee),g.addAction(d.Actions.SWAP_EXACT_IN,[{currencyIn:h.isNative?te:h.address,path:d.encodeRouteToPath(w),amountIn:0,amountOutMinimum:x(v)?C:0}]);var k=R;if(x(v)){var U=s.pools[s.pools.length-1],N=!!(U instanceof d.Pool)&&U.currency1.equals(U.currency0.wrapped),O=s.pools[s.pools.length-2];N&&(R.isNative&&O.token0.isNative?k=R.wrapped:R.isNative||!O.token0.equals(U.token1)&&!O.token1.equals(U.token1)||(k=U.token0))}g.addTake(k,V),e.addCommand(exports.CommandType.V4_SWAP,[g.finalize()])}else if(_ instanceof p.Pool)e.addCommand(exports.CommandType.V3_SWAP_EXACT_IN,[V,0==v?T:ee,x(v)?C:0,f.encodeMixedRouteToPath(b),n&&0===v]);else{if(!(_ instanceof l.Pair))throw new Error("Unexpected Pool Type");e.addCommand(exports.CommandType.V2_SWAP_EXACT_IN,[V,0===v?T:ee,x(v)?C:0,b.path.map((function(e){return e.wrapped.address})),n&&0===v])}x(v)||(R.isNative&&!E.isNative?e.addCommand(exports.CommandType.WRAP_ETH,[oe,ee]):!R.isNative&&E.isNative&&e.addCommand(exports.CommandType.UNWRAP_WETH,[oe,0])),h=E}}function ce(e,t){var r=t.signature,o=u.ethers.utils.arrayify(t.signature).length;65!==o&&64!==o||(r=u.ethers.utils.joinSignature(u.ethers.utils.splitSignature(t.signature))),e.addCommand(exports.CommandType.PERMIT2_PERMIT,[t,r])}var me=function(){function e(){}return e.swapCallParameters=function(t,r){var o=new Z,n=new ie(t,r),i=n.trade.inputAmount.currency;i.isNative&&r.inputTokenPermit&&a(!1),r.inputTokenPermit&&ce(o,r.inputTokenPermit);var s=u.BigNumber.from(i.isNative?n.trade.maximumAmountIn(r.slippageTolerance).quotient.toString():0);return n.encode(o,{allowRevert:!1}),e.encodePlan(o,s,{deadline:r.deadlineOrPreviousBlockhash?u.BigNumber.from(r.deadlineOrPreviousBlockhash):void 0})},e.migrateV3ToV4CallParameters=function(t,r){var o=t.outputPosition.pool,n=t.inputPosition.pool.token0,i=t.inputPosition.pool.token1,s=null!=r?r:c.CHAIN_TO_ADDRESSES_MAP[o.chainId].v4PositionManagerAddress;o.currency0.isNative?o.currency0.wrapped.equals(n)&&o.currency1.equals(i)||o.currency0.wrapped.equals(i)&&o.currency1.equals(n)||a(!1):(n!==o.token0&&a(!1),i!==o.token1&&a(!1)),t.v3RemoveLiquidityOptions.liquidityPercentage.equalTo(new c.Percent(100,100))||a(!1),1!=t.v3RemoveLiquidityOptions.burnToken&&a(!1),t.v3RemoveLiquidityOptions.collectOptions.recipient!==s&&a(!1),!function(e){return Object.keys(e).some((function(e){return"recipient"===e}))}(t.v4AddLiquidityOptions)&&a(!1),t.v4AddLiquidityOptions.migrate||a(!1);var m=new Z;if(t.v4AddLiquidityOptions.createPool){var l=d.Pool.getPoolKey(o.currency0,o.currency1,o.fee,o.tickSpacing,o.hooks);m.addCommand(exports.CommandType.V4_INITIALIZE_POOL,[l,o.sqrtRatioX96.toString()]),delete t.v4AddLiquidityOptions.createPool}t.v3RemoveLiquidityOptions.permit&&($(exports.UniversalRouterVersion.V2_0,t.inputPosition.pool.chainId)!=t.v3RemoveLiquidityOptions.permit.spender&&a(!1),function(e,t,r){var o=p.NonfungiblePositionManager.INTERFACE.encodeFunctionData("permit",[c.validateAndParseAddress(t.spender),r,t.deadline,t.v,t.r,t.s]);e.addCommand(exports.CommandType.V3_POSITION_MANAGER_PERMIT,[o])}(m,t.v3RemoveLiquidityOptions.permit,t.v3RemoveLiquidityOptions.tokenId),delete t.v3RemoveLiquidityOptions.permit);for(var f,A=p.NonfungiblePositionManager.removeCallParameters(t.inputPosition,t.v3RemoveLiquidityOptions),C=T(p.Multicall.decodeMulticall(A.calldata));!(f=C()).done;){var y=f.value,x=y.slice(0,10);x!=p.NonfungiblePositionManager.INTERFACE.getSighash("collect")&&x!=p.NonfungiblePositionManager.INTERFACE.getSighash("decreaseLiquidity")&&x!=p.NonfungiblePositionManager.INTERFACE.getSighash("burn")&&a(!1),m.addCommand(exports.CommandType.V3_POSITION_MANAGER_CALL,[y])}var h=d.V4PositionManager.addCallParameters(t.outputPosition,t.v4AddLiquidityOptions);return h.calldata.slice(0,10)!=d.V4PositionManager.INTERFACE.getSighash("modifyLiquidities")&&a(!1),m.addCommand(exports.CommandType.V4_POSITION_MANAGER_CALL,[h.calldata]),e.encodePlan(m,u.BigNumber.from(0),{deadline:u.BigNumber.from(t.v4AddLiquidityOptions.deadline)})},e.encodePlan=function(t,r,o){void 0===o&&(o={});var n=t.commands,a=t.inputs;return{calldata:e.INTERFACE.encodeFunctionData(o.deadline?"execute(bytes,bytes[],uint256)":"execute(bytes,bytes[])",o.deadline?[n,a,o.deadline]:[n,a]),value:r.toHexString()}},e}();me.INTERFACE=new s.Interface(i.abi);var le,fe=function(){function e(e,t,r){this.tradeType=exports.RouterActionType.UnwrapWETH,this.wethAddress=J(t),this.amount=e,r&&(r.details.token.toLowerCase()!==this.wethAddress.toLowerCase()&&a(!1),r.details.amount>=e||a(!1),this.permit2Data=r)}return e.prototype.encode=function(e,t){!function(e,t){t.permit2TransferFrom&&t.permit2Permit&&t.permit2TransferFrom.token!==t.permit2Permit.details.token&&a(!1),t.permit2Permit&&ce(e,t.permit2Permit),t.permit2TransferFrom&&e.addCommand(exports.CommandType.PERMIT2_TRANSFER_FROM,[t.permit2TransferFrom.token,t.permit2TransferFrom.recipient?t.permit2TransferFrom.recipient:oe,t.permit2TransferFrom.amount])}(e,{permit2Permit:this.permit2Data,permit2TransferFrom:{token:this.wethAddress,amount:this.amount.toString()}}),e.addCommand(exports.CommandType.UNWRAP_WETH,[oe,this.amount])},e}();(le=exports.PoolType||(exports.PoolType={})).V2Pool="v2-pool",le.V3Pool="v3-pool",le.V4Pool="v4-pool";var Ae=function(e){return e.toLowerCase()===te.toLowerCase()||e.toLowerCase()==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee".toLowerCase()},Te=function(){function e(){}return e.fromClassicQuote=function(t){var r=t.route,o=t.tokenIn,n=t.tokenOut;if(!r)throw new Error("Expected route to be present");if(!r.length)throw new Error("Expected there to be at least one route");if(r.some((function(e){return!e.length})))throw new Error("Expected all routes to have at least one pool");var a=r[0],i=a[0].tokenIn,s=a[a.length-1].tokenOut;if(!i||!s)throw new Error("Expected both tokenIn and tokenOut to be present");if(i.chainId!==s.chainId)throw new Error("Expected tokenIn and tokenOut to be have same chainId");var u=e.toCurrency(Ae(o),i),m=e.toCurrency(Ae(n),s),A=r.map((function(t){var r=t[0].amountIn,o=t[t.length-1].amountOut;if(!r||!o)throw new Error("Expected both raw amountIn and raw amountOut to be present");var n=c.CurrencyAmount.fromRawAmount(u,r),a=c.CurrencyAmount.fromRawAmount(m,o),i=e.isVersionedRoute(exports.PoolType.V2Pool,t),s=e.isVersionedRoute(exports.PoolType.V3Pool,t),A=e.isVersionedRoute(exports.PoolType.V4Pool,t);return{routev4:A?new d.Route(t.map(e.toV4Pool),u,m):null,routev3:s?new p.Route(t.map(e.toV3Pool),u,m):null,routev2:i?new l.Route(t.map(e.toPair),u,m):null,mixedRoute:A||s||i?null:new f.MixedRouteSDK(t.map(e.toPoolOrPair),u,m),inputAmount:n,outputAmount:a}}));return new f.Trade({v2Routes:A.filter((function(e){return e.routev2})).map((function(e){return{routev2:e.routev2,inputAmount:e.inputAmount,outputAmount:e.outputAmount}})),v3Routes:A.filter((function(e){return e.routev3})).map((function(e){return{routev3:e.routev3,inputAmount:e.inputAmount,outputAmount:e.outputAmount}})),v4Routes:A.filter((function(e){return e.routev4})).map((function(e){return{routev4:e.routev4,inputAmount:e.inputAmount,outputAmount:e.outputAmount}})),mixedRoutes:A.filter((function(e){return e.mixedRoute})).map((function(e){return{mixedRoute:e.mixedRoute,inputAmount:e.inputAmount,outputAmount:e.outputAmount}})),tradeType:t.tradeType})},e.toCurrency=function(e,t){return e?c.Ether.onChain(t.chainId):this.toToken(t)},e.toToken=function(e){var t=e.symbol,r=e.buyFeeBps,o=e.sellFeeBps;return new c.Token(e.chainId,e.address,parseInt(e.decimals.toString()),t,void 0,!1,r?u.BigNumber.from(r):void 0,o?u.BigNumber.from(o):void 0)},e.toV3Pool=function(t){var r=t.fee,o=t.sqrtRatioX96,n=t.liquidity,a=t.tickCurrent,i=t.tokenOut;return new p.Pool(e.toToken(t.tokenIn),e.toToken(i),parseInt(r),o,n,parseInt(a))},e.toV4Pool=function(t){var r=e.toCurrency(Ae(t.tokenIn.address),t.tokenIn),o=e.toCurrency(Ae(t.tokenOut.address),t.tokenOut);return new d.Pool(r,o,parseInt(t.fee),parseInt(t.tickSpacing),t.hooks,t.sqrtRatioX96,t.liquidity,parseInt(t.tickCurrent))},e.isVersionedRoute=function(e,t){return t.every((function(t){return t.type===e}))},e}();Te.toPoolOrPair=function(e){switch(e.type){case exports.PoolType.V4Pool:return Te.toV4Pool(e);case exports.PoolType.V3Pool:return Te.toV3Pool(e);case exports.PoolType.V2Pool:return Te.toPair(e);default:throw new Error("Invalid pool type")}},Te.toPair=function(e){var t=e.reserve0,r=e.reserve1;return new l.Pair(c.CurrencyAmount.fromRawAmount(Te.toToken(t.token),t.quotient),c.CurrencyAmount.fromRawAmount(Te.toToken(r.token),r.quotient))};var Ce=function(){function e(){}return e.parseCalldata=function(t){var r=new ye(Y),o=e.INTERFACE.parseTransaction({data:t}).args;return r.parse(o.commands,o.inputs)},e}();Ce.INTERFACE=new s.Interface(i.abi);var ye=function(){function e(e){this.commandDefinition=e}return e.prototype.parse=function(t,r){var o=this;return{commands:e.getCommands(t).map((function(e,t){var n,a=o.commandDefinition[e];if(a.parser===exports.Parser.V4Actions){var i=d.V4BaseActionsParser.parseCalldata(r[t]);return{commandName:exports.CommandType[e],commandType:e,params:(n=i.actions,n.map((function(e){return{name:e.actionName,value:e.params.map((function(e){return{name:e.name,value:e.value}}))}})))}}if(a.parser===exports.Parser.Abi){var s=a.params,p=u.ethers.utils.defaultAbiCoder.decode(s.map((function(e){return e.type})),r[t]).map((function(e,t){switch(s[t].subparser){case exports.Subparser.V3PathExactIn:return{name:s[t].name,value:xe(e)};case exports.Subparser.V3PathExactOut:return{name:s[t].name,value:he(e)};default:return{name:s[t].name,value:e}}}));return{commandName:exports.CommandType[e],commandType:e,params:p}}if(a.parser===exports.Parser.V3Actions)return{commandName:exports.CommandType[e],commandType:e,params:r.map((function(e){return{name:"command",value:e}}))};throw new Error("Unsupported parser: "+a)}))}},e.getCommands=function(e){for(var t=[],r=2;r<e.length;r+=2){var o=e.substring(r,r+2);t.push(parseInt(o,16))}return t},e}();function xe(e){for(var t=e.replace("0x",""),r=u.ethers.utils.getAddress(t.substring(0,40)),o=40,n=[];o<t.length;){var a=t.substring(o,o+46),i=parseInt(a.substring(0,6),16),s=u.ethers.utils.getAddress(a.substring(6,46));n.push({tokenIn:r,tokenOut:s,fee:i}),r=s,o+=46}return n}function he(e){for(var t=e.replace("0x",""),r=u.ethers.utils.getAddress(t.substring(t.length-40)),o=t.length-86,n=[];o>=0;){var a=t.substring(o,o+46),i=u.ethers.utils.getAddress(a.substring(0,40)),s=parseInt(a.substring(40,46),16);n.push({tokenIn:r,tokenOut:i,fee:s}),r=i,o-=46}return n}exports.COMMAND_DEFINITION=Y,exports.CommandParser=Ce,exports.GenericCommandParser=ye,exports.ROUTER_AS_RECIPIENT=oe,exports.RoutePlanner=Z,exports.RouterTradeAdapter=Te,exports.SwapRouter=me,exports.UNIVERSAL_ROUTER_ADDRESS=$,exports.UNIVERSAL_ROUTER_CREATION_BLOCK=function(e,t){if(!(t in Q))throw new Error("Universal Router not deployed on chain "+t);return Q[t].routerConfigs[e].creationBlock},exports.UniswapTrade=ie,exports.UnwrapWETH=fe,exports.WETH_ADDRESS=J,exports.isNativeCurrency=Ae;
+"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t,r,o,n,a=e(require("tiny-invariant")),s=e(require("@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json")),i=require("@ethersproject/abi"),u=require("ethers"),p=require("@uniswap/v3-sdk"),d=require("@uniswap/v4-sdk"),c=require("@uniswap/sdk-core"),m=require("ethers/lib/utils"),l=require("@uniswap/v2-sdk"),f=require("@uniswap/router-sdk");function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=Array(t);r<t;r++)o[r]=e[r];return o}function x(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return A(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?A(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function C(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}require("jsbi"),require("bignumber.js"),(r=exports.CommandType||(exports.CommandType={}))[r.V3_SWAP_EXACT_IN=0]="V3_SWAP_EXACT_IN",r[r.V3_SWAP_EXACT_OUT=1]="V3_SWAP_EXACT_OUT",r[r.PERMIT2_TRANSFER_FROM=2]="PERMIT2_TRANSFER_FROM",r[r.PERMIT2_PERMIT_BATCH=3]="PERMIT2_PERMIT_BATCH",r[r.SWEEP=4]="SWEEP",r[r.TRANSFER=5]="TRANSFER",r[r.PAY_PORTION=6]="PAY_PORTION",r[r.V2_SWAP_EXACT_IN=8]="V2_SWAP_EXACT_IN",r[r.V2_SWAP_EXACT_OUT=9]="V2_SWAP_EXACT_OUT",r[r.PERMIT2_PERMIT=10]="PERMIT2_PERMIT",r[r.WRAP_ETH=11]="WRAP_ETH",r[r.UNWRAP_WETH=12]="UNWRAP_WETH",r[r.PERMIT2_TRANSFER_FROM_BATCH=13]="PERMIT2_TRANSFER_FROM_BATCH",r[r.BALANCE_CHECK_ERC20=14]="BALANCE_CHECK_ERC20",r[r.V4_SWAP=16]="V4_SWAP",r[r.V3_POSITION_MANAGER_PERMIT=17]="V3_POSITION_MANAGER_PERMIT",r[r.V3_POSITION_MANAGER_CALL=18]="V3_POSITION_MANAGER_CALL",r[r.V4_INITIALIZE_POOL=19]="V4_INITIALIZE_POOL",r[r.V4_POSITION_MANAGER_CALL=20]="V4_POSITION_MANAGER_CALL",r[r.EXECUTE_SUB_PLAN=33]="EXECUTE_SUB_PLAN",r[r.ACROSS_V4_DEPOSIT_V3=64]="ACROSS_V4_DEPOSIT_V3",(o=exports.Subparser||(exports.Subparser={}))[o.V3PathExactIn=0]="V3PathExactIn",o[o.V3PathExactOut=1]="V3PathExactOut",(n=exports.Parser||(exports.Parser={}))[n.Abi=0]="Abi",n[n.V4Actions=1]="V4Actions",n[n.V3Actions=2]="V3Actions";var T,y,v,_,R,h,V,P,b,E,g,I,U,w,k,N,B,O,S,D,F,q,M,W,L,X,H,j,G,K,Y,Z=new Set([exports.CommandType.EXECUTE_SUB_PLAN]),z=((t={})[exports.CommandType.EXECUTE_SUB_PLAN]={parser:exports.Parser.Abi,params:[{name:"commands",type:"bytes"},{name:"inputs",type:"bytes[]"}]},t[exports.CommandType.PERMIT2_PERMIT]={parser:exports.Parser.Abi,params:[{name:"permit",type:"((address token,uint160 amount,uint48 expiration,uint48 nonce) details,address spender,uint256 sigDeadline)"},{name:"signature",type:"bytes"}]},t[exports.CommandType.PERMIT2_PERMIT_BATCH]={parser:exports.Parser.Abi,params:[{name:"permit",type:"((address token,uint160 amount,uint48 expiration,uint48 nonce)[] details,address spender,uint256 sigDeadline)"},{name:"signature",type:"bytes"}]},t[exports.CommandType.PERMIT2_TRANSFER_FROM]={parser:exports.Parser.Abi,params:[{name:"token",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint160"}]},t[exports.CommandType.PERMIT2_TRANSFER_FROM_BATCH]={parser:exports.Parser.Abi,params:[{name:"transferFrom",type:"(address from,address to,uint160 amount,address token)[]"}]},t[exports.CommandType.V3_SWAP_EXACT_IN]={parser:exports.Parser.Abi,params:[{name:"recipient",type:"address"},{name:"amountIn",type:"uint256"},{name:"amountOutMin",type:"uint256"},{name:"path",subparser:exports.Subparser.V3PathExactIn,type:"bytes"},{name:"payerIsUser",type:"bool"}]},t[exports.CommandType.V3_SWAP_EXACT_OUT]={parser:exports.Parser.Abi,params:[{name:"recipient",type:"address"},{name:"amountOut",type:"uint256"},{name:"amountInMax",type:"uint256"},{name:"path",subparser:exports.Subparser.V3PathExactOut,type:"bytes"},{name:"payerIsUser",type:"bool"}]},t[exports.CommandType.V2_SWAP_EXACT_IN]={parser:exports.Parser.Abi,params:[{name:"recipient",type:"address"},{name:"amountIn",type:"uint256"},{name:"amountOutMin",type:"uint256"},{name:"path",type:"address[]"},{name:"payerIsUser",type:"bool"}]},t[exports.CommandType.V2_SWAP_EXACT_OUT]={parser:exports.Parser.Abi,params:[{name:"recipient",type:"address"},{name:"amountOut",type:"uint256"},{name:"amountInMax",type:"uint256"},{name:"path",type:"address[]"},{name:"payerIsUser",type:"bool"}]},t[exports.CommandType.V4_SWAP]={parser:exports.Parser.V4Actions},t[exports.CommandType.WRAP_ETH]={parser:exports.Parser.Abi,params:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}]},t[exports.CommandType.UNWRAP_WETH]={parser:exports.Parser.Abi,params:[{name:"recipient",type:"address"},{name:"amountMin",type:"uint256"}]},t[exports.CommandType.SWEEP]={parser:exports.Parser.Abi,params:[{name:"token",type:"address"},{name:"recipient",type:"address"},{name:"amountMin",type:"uint256"}]},t[exports.CommandType.TRANSFER]={parser:exports.Parser.Abi,params:[{name:"token",type:"address"},{name:"recipient",type:"address"},{name:"value",type:"uint256"}]},t[exports.CommandType.PAY_PORTION]={parser:exports.Parser.Abi,params:[{name:"token",type:"address"},{name:"recipient",type:"address"},{name:"bips",type:"uint256"}]},t[exports.CommandType.BALANCE_CHECK_ERC20]={parser:exports.Parser.Abi,params:[{name:"owner",type:"address"},{name:"token",type:"address"},{name:"minBalance",type:"uint256"}]},t[exports.CommandType.V4_INITIALIZE_POOL]={parser:exports.Parser.Abi,params:[{name:"poolKey",type:"(address currency0,address currency1,uint24 fee,int24 tickSpacing,address hooks)"},{name:"sqrtPriceX96",type:"uint160"}]},t[exports.CommandType.V3_POSITION_MANAGER_PERMIT]={parser:exports.Parser.V3Actions},t[exports.CommandType.V3_POSITION_MANAGER_CALL]={parser:exports.Parser.V3Actions},t[exports.CommandType.V4_POSITION_MANAGER_CALL]={parser:exports.Parser.V4Actions},t[exports.CommandType.ACROSS_V4_DEPOSIT_V3]={parser:exports.Parser.Abi,params:[{name:"depositor",type:"address"},{name:"recipient",type:"address"},{name:"inputToken",type:"address"},{name:"outputToken",type:"address"},{name:"inputAmount",type:"uint256"},{name:"outputAmount",type:"uint256"},{name:"destinationChainId",type:"uint256"},{name:"exclusiveRelayer",type:"address"},{name:"quoteTimestamp",type:"uint32"},{name:"fillDeadline",type:"uint32"},{name:"exclusivityDeadline",type:"uint32"},{name:"message",type:"bytes"},{name:"useNative",type:"bool"}]},t),Q=function(){function e(){this.commands="0x",this.inputs=[]}var t=e.prototype;return t.addSubPlan=function(e){return this.addCommand(exports.CommandType.EXECUTE_SUB_PLAN,[e.commands,e.inputs],!0),this},t.addAcrossBridge=function(e){return this.addCommand(exports.CommandType.ACROSS_V4_DEPOSIT_V3,[e.depositor,e.recipient,e.inputToken,e.outputToken,e.inputAmount,e.outputAmount,e.destinationChainId,e.exclusiveRelayer,e.quoteTimestamp,e.fillDeadline,e.exclusivityDeadline,e.message,e.useNative]),this},t.addCommand=function(e,t,r){void 0===r&&(r=!1);var o=function(e,t){var r=z[e];switch(r.parser){case exports.Parser.Abi:return{type:e,encodedInput:m.defaultAbiCoder.encode(r.params.map((function(e){return e.type})),t)};case exports.Parser.V4Actions:case exports.Parser.V3Actions:return{type:e,encodedInput:t[0]}}}(e,t);if(this.inputs.push(o.encodedInput),r){if(!Z.has(o.type))throw new Error("command type: "+o.type+" cannot be allowed to revert");o.type=128|o.type}return this.commands=this.commands.concat(o.type.toString(16).padStart(2,"0")),this},e}();function $(e,t){if(t.involvesToken(e))return e;if(t.involvesToken(e.wrapped))return e.wrapped;if(t instanceof d.Pool&&t.token0.wrapped.equals(e))return t.token0;if(t instanceof d.Pool&&t.token1.wrapped.equals(e))return t.token1;throw new Error("Expected currency "+e.symbol+" to be either "+t.token0.symbol+" or "+t.token1.symbol)}(T=exports.RouterActionType||(exports.RouterActionType={})).UniswapTrade="UniswapTrade",T.UnwrapWETH="UnwrapWETH",(Y=exports.UniversalRouterVersion||(exports.UniversalRouterVersion={})).V1_2="1.2",Y.V2_0="2.0",Y.V2_1="2.1";var J={address:"0x0000000000000000000000000000000000000000",creationBlock:1},ee=((K={})[1]={weth:"0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",routerConfigs:(y={},y[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:17143817},y[exports.UniversalRouterVersion.V2_0]={address:"0x66a9893cc07d91d95644aedd05d03f95e1dba8af",creationBlock:21689092},y[exports.UniversalRouterVersion.V2_1]={address:"0xd92a36b0000531ef3063ded4de20a0783308446c",creationBlock:23836348},y)},K[5]={weth:"0xb4fbf271143f4fbf7b91a5ded31805e42b2208d6",routerConfigs:(v={},v[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:8940568},v[exports.UniversalRouterVersion.V2_0]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:8940568},v[exports.UniversalRouterVersion.V2_1]=J,v)},K[11155111]={weth:"0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14",routerConfigs:(_={},_[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:3543575},_[exports.UniversalRouterVersion.V2_0]={address:"0x3a9d48ab9751398bbfa63ad67599bb04e4bdf98b",creationBlock:7259601},_[exports.UniversalRouterVersion.V2_1]={address:"0x470FFC67b1feEEC31D16C46AC7545C98716a194c",creationBlock:9664766},_)},K[137]={weth:"0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270",routerConfigs:(R={},R[exports.UniversalRouterVersion.V1_2]={address:"0xec7BE89e9d109e7e3Fec59c222CF297125FEFda2",creationBlock:52210153},R[exports.UniversalRouterVersion.V2_0]={address:"0x1095692a6237d83c6a72f3f5efedb9a670c49223",creationBlock:66980401},R[exports.UniversalRouterVersion.V2_1]={address:"0xE27610fD9dD05FC061366bc9dA414CA6F948f204",creationBlock:79245524},R)},K[80001]={weth:"0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889",routerConfigs:(h={},h[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:35176052},h[exports.UniversalRouterVersion.V2_0]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:35176052},h[exports.UniversalRouterVersion.V2_1]=J,h)},K[10]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(V={},V[exports.UniversalRouterVersion.V1_2]={address:"0xCb1355ff08Ab38bBCE60111F1bb2B784bE25D7e8",creationBlock:114702266},V[exports.UniversalRouterVersion.V2_0]={address:"0x851116d9223fabed8e56c0e6b8ad0c31d98b3507",creationBlock:129906462},V[exports.UniversalRouterVersion.V2_1]={address:"0xde20EEE5398D3790a4D356e8925bD21Ea65D99Af",creationBlock:134078764},V)},K[420]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(P={},P[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:8887728},P[exports.UniversalRouterVersion.V2_0]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:8887728},P[exports.UniversalRouterVersion.V2_1]=J,P)},K[42161]={weth:"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1",routerConfigs:(b={},b[exports.UniversalRouterVersion.V1_2]={address:"0x5E325eDA8064b456f4781070C0738d849c824258",creationBlock:169472836},b[exports.UniversalRouterVersion.V2_0]={address:"0xa51afafe0263b40edaef0df8781ea9aa03e381a3",creationBlock:290124593},b[exports.UniversalRouterVersion.V2_1]={address:"0x96b2FD2F80e9428Daa65d859653117D453981AB4",creationBlock:329155034},b)},K[421613]={weth:"0xe39Ab88f8A4777030A534146A9Ca3B52bd5D43A3",routerConfigs:(E={},E[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:18815277},E[exports.UniversalRouterVersion.V2_0]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:18815277},E[exports.UniversalRouterVersion.V2_1]=J,E)},K[42220]={weth:"0x0000000000000000000000000000000000000000",routerConfigs:(g={},g[exports.UniversalRouterVersion.V1_2]={address:"0x643770e279d5d0733f21d6dc03a8efbabf3255b4",creationBlock:21407637},g[exports.UniversalRouterVersion.V2_0]={address:"0xcb695bc5D3Aa22cAD1E6DF07801b061a05A0233A",creationBlock:47387857},g[exports.UniversalRouterVersion.V2_1]=J,g)},K[44787]={weth:"0x0000000000000000000000000000000000000000",routerConfigs:(I={},I[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:17566658},I[exports.UniversalRouterVersion.V2_0]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:17566658},I[exports.UniversalRouterVersion.V2_1]=J,I)},K[56]={weth:"0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c",routerConfigs:(U={},U[exports.UniversalRouterVersion.V1_2]={address:"0x4Dae2f939ACf50408e13d58534Ff8c2776d45265",creationBlock:35160263},U[exports.UniversalRouterVersion.V2_0]={address:"0x1906c1d672b88cd1b9ac7593301ca990f94eae07",creationBlock:1737493275},U[exports.UniversalRouterVersion.V2_1]=J,U)},K[43114]={weth:"0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7",routerConfigs:(w={},w[exports.UniversalRouterVersion.V1_2]={address:"0x4Dae2f939ACf50408e13d58534Ff8c2776d45265",creationBlock:40237257},w[exports.UniversalRouterVersion.V2_0]={address:"0x94b75331ae8d42c1b61065089b7d48fe14aa73b7",creationBlock:1737558236},w[exports.UniversalRouterVersion.V2_1]={address:"0x0Cf1f86B331A03179646341D10A2A87515087221",creationBlock:58800800},w)},K[84531]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(k={},k[exports.UniversalRouterVersion.V1_2]={address:"0xd0872d928672ae2ff74bdb2f5130ac12229cafaf",creationBlock:6915289},k[exports.UniversalRouterVersion.V2_0]={address:"0xd0872d928672ae2ff74bdb2f5130ac12229cafaf",creationBlock:6915289},k[exports.UniversalRouterVersion.V2_1]=J,k)},K[8453]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(N={},N[exports.UniversalRouterVersion.V1_2]={address:"0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD",creationBlock:9107268},N[exports.UniversalRouterVersion.V2_0]={address:"0x6ff5693b99212da76ad316178a184ab56d299b43",creationBlock:1737491485},N[exports.UniversalRouterVersion.V2_1]={address:"0xf3a4f4094bd2c6c06ca2f61789d8727b8d1e7259",creationBlock:28539210},N)},K[81457]={weth:"0x4300000000000000000000000000000000000004",routerConfigs:(B={},B[exports.UniversalRouterVersion.V1_2]={address:"0x643770E279d5D0733F21d6DC03A8efbABf3255B4",creationBlock:1116444},B[exports.UniversalRouterVersion.V2_0]={address:"0xeabbcb3e8e415306207ef514f660a3f820025be3",creationBlock:1737564586},B[exports.UniversalRouterVersion.V2_1]=J,B)},K[7777777]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(O={},O[exports.UniversalRouterVersion.V1_2]={address:"0x2986d9721A49838ab4297b695858aF7F17f38014",creationBlock:11832155},O[exports.UniversalRouterVersion.V2_0]={address:"0x3315ef7ca28db74abadc6c44570efdf06b04b020",creationBlock:1737562927},O[exports.UniversalRouterVersion.V2_1]=J,O)},K[324]={weth:"0x5aea5775959fbc2557cc8789bc1bf90a239d9a91",routerConfigs:(S={},S[exports.UniversalRouterVersion.V1_2]={address:"0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06",creationBlock:12640979},S[exports.UniversalRouterVersion.V2_0]={address:"0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06",creationBlock:12640979},S[exports.UniversalRouterVersion.V2_1]=J,S)},K[480]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(D={},D[exports.UniversalRouterVersion.V1_2]={address:"0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D",creationBlock:4063979},D[exports.UniversalRouterVersion.V2_0]={address:"0x8ac7bee993bb44dab564ea4bc9ea67bf9eb5e743",creationBlock:1737559557},D[exports.UniversalRouterVersion.V2_1]=J,D)},K[1301]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(F={},F[exports.UniversalRouterVersion.V1_2]={address:"0x8909Dc15e40173Ff4699343b6eB8132c65e18eC6",creationBlock:1241811},F[exports.UniversalRouterVersion.V2_0]={address:"0xf70536b3bcc1bd1a972dc186a2cf84cc6da6be5d",creationBlock:7100543},F[exports.UniversalRouterVersion.V2_1]=J,F)},K[130]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(q={},q[exports.UniversalRouterVersion.V1_2]={address:"0x4D73A4411CA1c660035e4AECC8270E5DdDEC8C17",creationBlock:23678},q[exports.UniversalRouterVersion.V2_0]={address:"0xef740bf23acae26f6492b10de645d6b98dc8eaf3",creationBlock:1737568156},q[exports.UniversalRouterVersion.V2_1]=J,q)},K[10143]={weth:"0x760AfE86e5de5fa0Ee542fc7B7B713e1c5425701",routerConfigs:(M={},M[exports.UniversalRouterVersion.V1_2]={address:"0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893",creationBlock:23678},M[exports.UniversalRouterVersion.V2_0]={address:"0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893",creationBlock:23678},M[exports.UniversalRouterVersion.V2_1]=J,M)},K[84532]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(W={},W[exports.UniversalRouterVersion.V1_2]={address:"0x492e6456d9528771018deb9e87ef7750ef184104",creationBlock:20216585},W[exports.UniversalRouterVersion.V2_0]={address:"0x492e6456d9528771018deb9e87ef7750ef184104",creationBlock:20216585},W[exports.UniversalRouterVersion.V2_1]=J,W)},K[1868]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(L={},L[exports.UniversalRouterVersion.V1_2]={address:"0x0e2850543f69f678257266e0907ff9a58b3f13de",creationBlock:3254782},L[exports.UniversalRouterVersion.V2_0]={address:"0x0e2850543f69f678257266e0907ff9a58b3f13de",creationBlock:3254782},L[exports.UniversalRouterVersion.V2_1]=J,L)},K[143]={weth:"0x3bd359C1119dA7Da1D913D1C4D2B7c461115433A",routerConfigs:(X={},X[exports.UniversalRouterVersion.V1_2]={address:"0x0d97dc33264bfc1c226207428a79b26757fb9dc3",creationBlock:29255937},X[exports.UniversalRouterVersion.V2_0]={address:"0x0d97dc33264bfc1c226207428a79b26757fb9dc3",creationBlock:29255937},X[exports.UniversalRouterVersion.V2_1]=J,X)},K[196]={weth:"0xe538905cf8410324e03A5A23C1c177a474D59b2b",routerConfigs:(H={},H[exports.UniversalRouterVersion.V1_2]={address:"0x0000000000000000000000000000000000000000",creationBlock:1},H[exports.UniversalRouterVersion.V2_0]={address:"0x5507749f2c558bb3e162c6e90c314c092e7372ff",creationBlock:47680350},H[exports.UniversalRouterVersion.V2_1]=J,H)},K[30]={weth:"0x0000000000000000000000000000000000000000",routerConfigs:(j={},j[exports.UniversalRouterVersion.V1_2]=J,j[exports.UniversalRouterVersion.V2_0]=J,j[exports.UniversalRouterVersion.V2_1]=J,j)},K[111557560]={weth:"0x4200000000000000000000000000000000000006",routerConfigs:(G={},G[exports.UniversalRouterVersion.V1_2]=J,G[exports.UniversalRouterVersion.V2_0]={address:"0x2D094CE21AE3431909e373207a2fCef4ba8871a9",creationBlock:6183303},G[exports.UniversalRouterVersion.V2_1]=J,G)},K),te=function(e,t){if(!(t in ee))throw new Error("Universal Router not deployed on chain "+t);return ee[t].routerConfigs[e].address},re=function(e){if(!(e in ee))throw new Error("Universal Router not deployed on chain "+e);if("0x0000000000000000000000000000000000000000"==ee[e].weth)throw new Error("Chain "+e+" does not have WETH");return ee[e].weth},oe=u.BigNumber.from(2).pow(255),ne="0x0000000000000000000000000000000000000000",ae="0x0000000000000000000000000000000000000001",se="0x0000000000000000000000000000000000000002";function ie(e){return e.isNative?ne:e.wrapped.address}var ue=new c.Percent(50,100),pe=function(){function e(e,t){if(this.trade=e,this.options=t,this.tradeType=exports.RouterActionType.UniswapTrade,t.fee&&t.flatFee)throw new Error("Only one fee option permitted");this.payerIsUser=!(this.inputRequiresWrap||this.inputRequiresUnwrap||this.options.useRouterBalance)}var t,r;return e.prototype.encode=function(e,t){var r;this.inputRequiresWrap?e.addCommand(exports.CommandType.WRAP_ETH,[se,this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString()]):this.inputRequiresUnwrap&&(e.addCommand(exports.CommandType.PERMIT2_TRANSFER_FROM,[this.trade.inputAmount.currency.address,se,this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString()]),e.addCommand(exports.CommandType.UNWRAP_WETH,[se,0])),this.options.recipient=null!=(r=this.options.recipient)?r:ae;for(var o,n,a=this.trade.tradeType===c.TradeType.EXACT_INPUT&&this.trade.routes.length>2||this.outputRequiresTransition||!!(o=this.options).fee||!!o.flatFee,s=x(this.trade.swaps);!(n=s()).done;){var i=n.value;switch(i.route.protocol){case f.Protocol.V2:de(e,i,this.trade.tradeType,this.options,this.payerIsUser,a);break;case f.Protocol.V3:ce(e,i,this.trade.tradeType,this.options,this.payerIsUser,a);break;case f.Protocol.V4:me(e,i,this.trade.tradeType,this.options,this.payerIsUser,a);break;case f.Protocol.MIXED:le(e,i,this.trade.tradeType,this.options,this.payerIsUser,a);break;default:throw new Error("UNSUPPORTED_TRADE_PROTOCOL")}}var d=u.BigNumber.from(this.trade.minimumAmountOut(this.options.slippageTolerance).quotient.toString());if(a){var m=this.trade.swaps[0].route.pools,l=ie($(this.trade.outputAmount.currency,m[m.length-1]));if(this.options.fee){var A=p.toHex(this.options.fee.fee.multiply(1e4).quotient);e.addCommand(exports.CommandType.PAY_PORTION,[l,this.options.fee.recipient,A]),this.trade.tradeType===c.TradeType.EXACT_OUTPUT&&(d=d.sub(d.mul(A).div(1e4)))}if(this.options.flatFee){var C=this.options.flatFee.amount;if(d.lt(C))throw new Error("Flat fee amount greater than minimumAmountOut");e.addCommand(exports.CommandType.TRANSFER,[l,this.options.flatFee.recipient,C]),this.trade.tradeType===c.TradeType.EXACT_OUTPUT&&(d=d.sub(C))}this.outputRequiresUnwrap?e.addCommand(exports.CommandType.UNWRAP_WETH,[this.options.recipient,d]):this.outputRequiresWrap?e.addCommand(exports.CommandType.WRAP_ETH,[this.options.recipient,oe]):e.addCommand(exports.CommandType.SWEEP,[ie(this.trade.outputAmount.currency),this.options.recipient,d])}(this.trade.tradeType===c.TradeType.EXACT_OUTPUT||this.trade.priceImpact.greaterThan(ue))&&(this.inputRequiresWrap?e.addCommand(exports.CommandType.UNWRAP_WETH,[this.options.recipient,0]):this.inputRequiresUnwrap?e.addCommand(exports.CommandType.WRAP_ETH,[this.options.recipient,oe]):this.trade.inputAmount.currency.isNative&&e.addCommand(exports.CommandType.SWEEP,[ne,this.options.recipient,0])),this.options.safeMode&&e.addCommand(exports.CommandType.SWEEP,[ne,this.options.recipient,0])},t=e,(r=[{key:"isAllV4",get:function(){for(var e,t=!0,r=x(this.trade.swaps);!(e=r()).done;)t=t&&e.value.route.protocol==f.Protocol.V4;return t}},{key:"inputRequiresWrap",get:function(){return this.trade.swaps[0].route.pools[0]instanceof d.Pool?this.trade.inputAmount.currency.isNative&&!this.trade.swaps[0].route.pathInput.isNative:this.trade.inputAmount.currency.isNative}},{key:"inputRequiresUnwrap",get:function(){return this.trade.swaps[0].route.pools[0]instanceof d.Pool&&!this.trade.inputAmount.currency.isNative&&this.trade.swaps[0].route.pathInput.isNative}},{key:"outputRequiresWrap",get:function(){var e=this.trade.swaps[0].route,t=e.pools[e.pools.length-1];if(t instanceof d.Pool&&!this.trade.outputAmount.currency.isNative){if(e.pathOutput.isNative)return!0;if(t.currency1.equals(t.currency0.wrapped)&&e.pools.length>1){var r=e.pools[e.pools.length-2];if(r instanceof d.Pool&&(r.currency0.equals(t.currency1)||r.currency1.equals(t.currency1)))return!0;if(r.token0.equals(t.currency1)||r.token1.equals(t.currency1))return!0}}return!1}},{key:"outputRequiresUnwrap",get:function(){var e=this.trade.swaps[0].route,t=e.pools[e.pools.length-1];return t instanceof d.Pool&&this.trade.outputAmount.currency.isNative?!this.trade.swaps[0].route.pathOutput.isNative||!!(e.pools.length>1&&e.pools[e.pools.length-2]instanceof d.Pool&&e.pools[e.pools.length-2].currency0.isNative&&t.currency1.equals(t.currency0.wrapped)):this.trade.outputAmount.currency.isNative}},{key:"outputRequiresTransition",get:function(){return this.outputRequiresWrap||this.outputRequiresUnwrap}}])&&function(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,C(o.key),o)}}(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}();function de(e,t,r,o,n,a){var s=t.route,i=new l.Trade(s,r==c.TradeType.EXACT_INPUT?t.inputAmount:t.outputAmount,r);r==c.TradeType.EXACT_INPUT?e.addCommand(exports.CommandType.V2_SWAP_EXACT_IN,[a?se:o.recipient,i.maximumAmountIn(o.slippageTolerance).quotient.toString(),a?0:i.minimumAmountOut(o.slippageTolerance).quotient.toString(),s.path.map((function(e){return e.wrapped.address})),n]):r==c.TradeType.EXACT_OUTPUT&&e.addCommand(exports.CommandType.V2_SWAP_EXACT_OUT,[a?se:o.recipient,i.minimumAmountOut(o.slippageTolerance).quotient.toString(),i.maximumAmountIn(o.slippageTolerance).quotient.toString(),s.path.map((function(e){return e.wrapped.address})),n])}function ce(e,t,r,o,n,a){var s=t.route,i=p.Trade.createUncheckedTrade({route:s,inputAmount:t.inputAmount,outputAmount:t.outputAmount,tradeType:r}),u=p.encodeRouteToPath(s,i.tradeType===c.TradeType.EXACT_OUTPUT);r==c.TradeType.EXACT_INPUT?e.addCommand(exports.CommandType.V3_SWAP_EXACT_IN,[a?se:o.recipient,i.maximumAmountIn(o.slippageTolerance).quotient.toString(),a?0:i.minimumAmountOut(o.slippageTolerance).quotient.toString(),u,n]):r==c.TradeType.EXACT_OUTPUT&&e.addCommand(exports.CommandType.V3_SWAP_EXACT_OUT,[a?se:o.recipient,i.minimumAmountOut(o.slippageTolerance).quotient.toString(),i.maximumAmountIn(o.slippageTolerance).quotient.toString(),u,n])}function me(e,t,r,o,n,a){var s,i=t.inputAmount,u=t.outputAmount,p=t.route.pools.map((function(e){return e})),m=new d.Route(p,i.currency,u.currency),l=d.Trade.createUncheckedTrade({route:m,inputAmount:i,outputAmount:u,tradeType:r}),f=a&&r==c.TradeType.EXACT_INPUT?void 0:o.slippageTolerance,A=new d.V4Planner;A.addTrade(l,f),A.addSettle(l.route.pathInput,n);var x=l.route.pathOutput,C=m.pools[m.pools.length-1];if(C.currency1.equals(C.currency0.wrapped)&&m.pools.length>1){var T=m.pools[m.pools.length-2];x.isNative&&T.currency0.isNative?x=x.wrapped:x.isNative||!T.currency0.equals(C.currency1)&&!T.currency1.equals(C.currency1)||(x=C.currency0)}A.addTake(x,a?se:null!=(s=o.recipient)?s:ae),e.addCommand(exports.CommandType.V4_SWAP,[A.finalize()])}function le(e,t,r,o,n,a){var s,i=t.route,u=t.inputAmount,c=t.outputAmount,m=a?se:null!=(s=o.recipient)?s:ae;if(1===i.pools.length){if(i.pools[0]instanceof d.Pool)return me(e,t,r,o,n,a);if(i.pools[0]instanceof p.Pool)return ce(e,t,r,o,n,a);if(i.pools[0]instanceof l.Pair)return de(e,t,r,o,n,a);throw new Error("Invalid route type")}for(var A=f.MixedRouteTrade.createUncheckedTrade({route:i,inputAmount:u,outputAmount:c,tradeType:r}),x=A.maximumAmountIn(o.slippageTolerance,u).quotient.toString(),C=a?0:A.minimumAmountOut(o.slippageTolerance,c).quotient.toString(),T=f.partitionMixedRouteByProtocol(i),y=function(e){return e===T.length-1},v=i.pathInput,_=0;_<T.length;_++){var R=T[_],h=R[0],V=f.getOutputOfPools(R,v),P=new f.MixedRoute(new f.MixedRouteSDK([].concat(R),v,V)),b=void 0,E=void 0;if(y(_))b=V,E=m;else{var g=T[_+1][0];b=$(V,g),E=g instanceof l.Pair&&V.equals(b)?g.liquidityToken.address:se}if(h instanceof d.Pool){var I=new d.V4Planner,U=new d.Route(R,P.input,P.output);I.addSettle(v,n&&0===_,0==_?x:oe),I.addAction(d.Actions.SWAP_EXACT_IN,[{currencyIn:v.isNative?ne:v.address,path:d.encodeRouteToPath(U),amountIn:0,amountOutMinimum:y(_)?C:0}]);var w=V;if(y(_)){var k=i.pools[i.pools.length-1],N=!!(k instanceof d.Pool)&&k.currency1.equals(k.currency0.wrapped),B=i.pools[i.pools.length-2];N&&(V.isNative&&B.token0.isNative?w=V.wrapped:V.isNative||!B.token0.equals(k.token1)&&!B.token1.equals(k.token1)||(w=k.token0))}I.addTake(w,E),e.addCommand(exports.CommandType.V4_SWAP,[I.finalize()])}else if(h instanceof p.Pool)e.addCommand(exports.CommandType.V3_SWAP_EXACT_IN,[E,0==_?x:oe,y(_)?C:0,f.encodeMixedRouteToPath(P),n&&0===_]);else{if(!(h instanceof l.Pair))throw new Error("Unexpected Pool Type");e.addCommand(exports.CommandType.V2_SWAP_EXACT_IN,[E,0===_?x:oe,y(_)?C:0,P.path.map((function(e){return e.wrapped.address})),n&&0===_])}y(_)||(V.isNative&&!b.isNative?e.addCommand(exports.CommandType.WRAP_ETH,[se,oe]):!V.isNative&&b.isNative&&e.addCommand(exports.CommandType.UNWRAP_WETH,[se,0])),v=b}}function fe(e,t){var r=t.signature,o=u.ethers.utils.arrayify(t.signature).length;65!==o&&64!==o||(r=u.ethers.utils.joinSignature(u.ethers.utils.splitSignature(t.signature))),e.addCommand(exports.CommandType.PERMIT2_PERMIT,[t,r])}var Ae={ExecuteSigned:[{name:"commands",type:"bytes"},{name:"inputs",type:"bytes[]"},{name:"intent",type:"bytes"},{name:"data",type:"bytes"},{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"deadline",type:"uint256"}]},xe=u.BigNumber.from("0x8000000000000000000000000000000000000000000000000000000000000000");function Ce(){for(var e=new Uint8Array(32),t=0;t<32;t++)e[t]=Math.floor(256*Math.random());return u.BigNumber.from(e).toHexString()}function Te(e,t){return{name:"UniversalRouter",version:"2",chainId:e,verifyingContract:t}}var ye=function(){function e(){}return e.swapCallParameters=function(t,r,o){var n=new Q,s=new pe(t,r),i=s.trade.inputAmount.currency;i.isNative&&r.inputTokenPermit&&a(!1),r.inputTokenPermit&&fe(n,r.inputTokenPermit);var p=u.BigNumber.from(i.isNative?s.trade.maximumAmountIn(r.slippageTolerance).quotient.toString():0);return s.encode(n,{allowRevert:!1}),o&&o.forEach((function(e){return n.addAcrossBridge(e)})),e.encodePlan(n,p,{deadline:r.deadlineOrPreviousBlockhash?u.BigNumber.from(r.deadlineOrPreviousBlockhash):void 0})},e.migrateV3ToV4CallParameters=function(t,r){var o=t.outputPosition.pool,n=t.inputPosition.pool.token0,s=t.inputPosition.pool.token1,i=null!=r?r:c.CHAIN_TO_ADDRESSES_MAP[o.chainId].v4PositionManagerAddress;o.currency0.isNative?o.currency0.wrapped.equals(n)&&o.currency1.equals(s)||o.currency0.wrapped.equals(s)&&o.currency1.equals(n)||a(!1):(n!==o.token0&&a(!1),s!==o.token1&&a(!1)),t.v3RemoveLiquidityOptions.liquidityPercentage.equalTo(new c.Percent(100,100))||a(!1),1!=t.v3RemoveLiquidityOptions.burnToken&&a(!1),t.v3RemoveLiquidityOptions.collectOptions.recipient!==i&&a(!1),!function(e){return Object.keys(e).some((function(e){return"recipient"===e}))}(t.v4AddLiquidityOptions)&&a(!1),t.v4AddLiquidityOptions.migrate||a(!1);var m=new Q;if(t.v4AddLiquidityOptions.createPool){var l=d.Pool.getPoolKey(o.currency0,o.currency1,o.fee,o.tickSpacing,o.hooks);m.addCommand(exports.CommandType.V4_INITIALIZE_POOL,[l,o.sqrtRatioX96.toString()]),delete t.v4AddLiquidityOptions.createPool}t.v3RemoveLiquidityOptions.permit&&(te(exports.UniversalRouterVersion.V2_0,t.inputPosition.pool.chainId)!=t.v3RemoveLiquidityOptions.permit.spender&&a(!1),function(e,t,r){var o=p.NonfungiblePositionManager.INTERFACE.encodeFunctionData("permit",[c.validateAndParseAddress(t.spender),r,t.deadline,t.v,t.r,t.s]);e.addCommand(exports.CommandType.V3_POSITION_MANAGER_PERMIT,[o])}(m,t.v3RemoveLiquidityOptions.permit,t.v3RemoveLiquidityOptions.tokenId),delete t.v3RemoveLiquidityOptions.permit);for(var f,A=p.NonfungiblePositionManager.removeCallParameters(t.inputPosition,t.v3RemoveLiquidityOptions),C=x(p.Multicall.decodeMulticall(A.calldata));!(f=C()).done;){var T=f.value,y=T.slice(0,10);y!=p.NonfungiblePositionManager.INTERFACE.getSighash("collect")&&y!=p.NonfungiblePositionManager.INTERFACE.getSighash("decreaseLiquidity")&&y!=p.NonfungiblePositionManager.INTERFACE.getSighash("burn")&&a(!1),m.addCommand(exports.CommandType.V3_POSITION_MANAGER_CALL,[T])}var v=d.V4PositionManager.addCallParameters(t.outputPosition,t.v4AddLiquidityOptions);return v.calldata.slice(0,10)!=d.V4PositionManager.INTERFACE.getSighash("modifyLiquidities")&&a(!1),m.addCommand(exports.CommandType.V4_POSITION_MANAGER_CALL,[v.calldata]),e.encodePlan(m,u.BigNumber.from(0),{deadline:u.BigNumber.from(t.v4AddLiquidityOptions.deadline)})},e.getExecuteSignedPayload=function(t,r,o,n,a){var s=e.INTERFACE.decodeFunctionData("execute",t),i=s[0],u=s[1],p=r.nonce||Ce();return{domain:Te(n,a),types:Ae,value:{commands:i,inputs:u,intent:r.intent,data:r.data,sender:r.sender,nonce:p,deadline:o.toString()}}},e.encodeExecuteSigned=function(t,r,o,n,a){var s=e.INTERFACE,i=s.decodeFunctionData("execute",t),p=i[0],d=i[1],c=o.nonce||Ce();return{calldata:s.encodeFunctionData("executeSigned",[p,d,o.intent,o.data,o.sender,c,u.BigNumber.from(n).toString(),r]),value:(a||u.BigNumber.from(0)).toHexString()}},e.encodePlan=function(t,r,o){void 0===o&&(o={});var n=t.commands,a=t.inputs;return{calldata:e.INTERFACE.encodeFunctionData(o.deadline?"execute(bytes,bytes[],uint256)":"execute(bytes,bytes[])",o.deadline?[n,a,o.deadline]:[n,a]),value:r.toHexString()}},e}();ye.INTERFACE=new i.Interface(s.abi);var ve,_e=function(){function e(e,t,r){this.tradeType=exports.RouterActionType.UnwrapWETH,this.wethAddress=re(t),this.amount=e,r&&(r.details.token.toLowerCase()!==this.wethAddress.toLowerCase()&&a(!1),r.details.amount>=e||a(!1),this.permit2Data=r)}return e.prototype.encode=function(e,t){!function(e,t){t.permit2TransferFrom&&t.permit2Permit&&t.permit2TransferFrom.token!==t.permit2Permit.details.token&&a(!1),t.permit2Permit&&fe(e,t.permit2Permit),t.permit2TransferFrom&&e.addCommand(exports.CommandType.PERMIT2_TRANSFER_FROM,[t.permit2TransferFrom.token,t.permit2TransferFrom.recipient?t.permit2TransferFrom.recipient:se,t.permit2TransferFrom.amount])}(e,{permit2Permit:this.permit2Data,permit2TransferFrom:{token:this.wethAddress,amount:this.amount.toString()}}),e.addCommand(exports.CommandType.UNWRAP_WETH,[se,this.amount])},e}();(ve=exports.PoolType||(exports.PoolType={})).V2Pool="v2-pool",ve.V3Pool="v3-pool",ve.V4Pool="v4-pool";var Re=function(e){return e.toLowerCase()===ne.toLowerCase()||e.toLowerCase()==="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee".toLowerCase()},he=function(){function e(){}return e.fromClassicQuote=function(t){var r=t.route,o=t.tokenIn,n=t.tokenOut;if(!r)throw new Error("Expected route to be present");if(!r.length)throw new Error("Expected there to be at least one route");if(r.some((function(e){return!e.length})))throw new Error("Expected all routes to have at least one pool");var a=r[0],s=a[0].tokenIn,i=a[a.length-1].tokenOut;if(!s||!i)throw new Error("Expected both tokenIn and tokenOut to be present");if(s.chainId!==i.chainId)throw new Error("Expected tokenIn and tokenOut to be have same chainId");var u=e.toCurrency(Re(o),s),m=e.toCurrency(Re(n),i),A=r.map((function(t){var r=t[0].amountIn,o=t[t.length-1].amountOut;if(!r||!o)throw new Error("Expected both raw amountIn and raw amountOut to be present");var n=c.CurrencyAmount.fromRawAmount(u,r),a=c.CurrencyAmount.fromRawAmount(m,o),s=e.isVersionedRoute(exports.PoolType.V2Pool,t),i=e.isVersionedRoute(exports.PoolType.V3Pool,t),A=e.isVersionedRoute(exports.PoolType.V4Pool,t);return{routev4:A?new d.Route(t.map(e.toV4Pool),u,m):null,routev3:i?new p.Route(t.map(e.toV3Pool),u,m):null,routev2:s?new l.Route(t.map(e.toPair),u,m):null,mixedRoute:A||i||s?null:new f.MixedRouteSDK(t.map(e.toPoolOrPair),u,m),inputAmount:n,outputAmount:a}}));return new f.Trade({v2Routes:A.filter((function(e){return e.routev2})).map((function(e){return{routev2:e.routev2,inputAmount:e.inputAmount,outputAmount:e.outputAmount}})),v3Routes:A.filter((function(e){return e.routev3})).map((function(e){return{routev3:e.routev3,inputAmount:e.inputAmount,outputAmount:e.outputAmount}})),v4Routes:A.filter((function(e){return e.routev4})).map((function(e){return{routev4:e.routev4,inputAmount:e.inputAmount,outputAmount:e.outputAmount}})),mixedRoutes:A.filter((function(e){return e.mixedRoute})).map((function(e){return{mixedRoute:e.mixedRoute,inputAmount:e.inputAmount,outputAmount:e.outputAmount}})),tradeType:t.tradeType})},e.toCurrency=function(e,t){return e?c.Ether.onChain(t.chainId):this.toToken(t)},e.toToken=function(e){var t=e.symbol,r=e.buyFeeBps,o=e.sellFeeBps;return new c.Token(e.chainId,e.address,parseInt(e.decimals.toString()),t,void 0,!1,r?u.BigNumber.from(r):void 0,o?u.BigNumber.from(o):void 0)},e.toV3Pool=function(t){var r=t.fee,o=t.sqrtRatioX96,n=t.liquidity,a=t.tickCurrent,s=t.tokenOut;return new p.Pool(e.toToken(t.tokenIn),e.toToken(s),parseInt(r),o,n,parseInt(a))},e.toV4Pool=function(t){var r=e.toCurrency(Re(t.tokenIn.address),t.tokenIn),o=e.toCurrency(Re(t.tokenOut.address),t.tokenOut);return new d.Pool(r,o,parseInt(t.fee),parseInt(t.tickSpacing),t.hooks,t.sqrtRatioX96,t.liquidity,parseInt(t.tickCurrent))},e.isVersionedRoute=function(e,t){return t.every((function(t){return t.type===e}))},e}();he.toPoolOrPair=function(e){switch(e.type){case exports.PoolType.V4Pool:return he.toV4Pool(e);case exports.PoolType.V3Pool:return he.toV3Pool(e);case exports.PoolType.V2Pool:return he.toPair(e);default:throw new Error("Invalid pool type")}},he.toPair=function(e){var t=e.reserve0,r=e.reserve1;return new l.Pair(c.CurrencyAmount.fromRawAmount(he.toToken(t.token),t.quotient),c.CurrencyAmount.fromRawAmount(he.toToken(r.token),r.quotient))};var Ve=function(){function e(){}return e.parseCalldata=function(t){var r=new Pe(z),o=e.INTERFACE.parseTransaction({data:t}).args;return r.parse(o.commands,o.inputs)},e}();Ve.INTERFACE=new i.Interface(s.abi);var Pe=function(){function e(e){this.commandDefinition=e}return e.prototype.parse=function(t,r){var o=this;return{commands:e.getCommands(t).map((function(e,t){var n,a=o.commandDefinition[e];if(a.parser===exports.Parser.V4Actions){var s=d.V4BaseActionsParser.parseCalldata(r[t]);return{commandName:exports.CommandType[e],commandType:e,params:(n=s.actions,n.map((function(e){return{name:e.actionName,value:e.params.map((function(e){return{name:e.name,value:e.value}}))}})))}}if(a.parser===exports.Parser.Abi){var i=a.params,p=u.ethers.utils.defaultAbiCoder.decode(i.map((function(e){return e.type})),r[t]).map((function(e,t){switch(i[t].subparser){case exports.Subparser.V3PathExactIn:return{name:i[t].name,value:be(e)};case exports.Subparser.V3PathExactOut:return{name:i[t].name,value:Ee(e)};default:return{name:i[t].name,value:e}}}));return{commandName:exports.CommandType[e],commandType:e,params:p}}if(a.parser===exports.Parser.V3Actions)return{commandName:exports.CommandType[e],commandType:e,params:r.map((function(e){return{name:"command",value:e}}))};throw new Error("Unsupported parser: "+a)}))}},e.getCommands=function(e){for(var t=[],r=2;r<e.length;r+=2){var o=e.substring(r,r+2);t.push(parseInt(o,16))}return t},e}();function be(e){for(var t=e.replace("0x",""),r=u.ethers.utils.getAddress(t.substring(0,40)),o=40,n=[];o<t.length;){var a=t.substring(o,o+46),s=parseInt(a.substring(0,6),16),i=u.ethers.utils.getAddress(a.substring(6,46));n.push({tokenIn:r,tokenOut:i,fee:s}),r=i,o+=46}return n}function Ee(e){for(var t=e.replace("0x",""),r=u.ethers.utils.getAddress(t.substring(t.length-40)),o=t.length-86,n=[];o>=0;){var a=t.substring(o,o+46),s=u.ethers.utils.getAddress(a.substring(0,40)),i=parseInt(a.substring(40,46),16);n.push({tokenIn:r,tokenOut:s,fee:i}),r=s,o-=46}return n}exports.COMMAND_DEFINITION=z,exports.CONTRACT_BALANCE=oe,exports.CommandParser=Ve,exports.EXECUTE_SIGNED_TYPES=Ae,exports.GenericCommandParser=Pe,exports.NONCE_SKIP_CHECK=xe,exports.ROUTER_AS_RECIPIENT=se,exports.RoutePlanner=Q,exports.RouterTradeAdapter=he,exports.SwapRouter=ye,exports.UNIVERSAL_ROUTER_ADDRESS=te,exports.UNIVERSAL_ROUTER_CREATION_BLOCK=function(e,t){if(!(t in ee))throw new Error("Universal Router not deployed on chain "+t);return ee[t].routerConfigs[e].creationBlock},exports.UniswapTrade=pe,exports.UnwrapWETH=_e,exports.WETH_ADDRESS=re,exports.generateNonce=Ce,exports.getUniversalRouterDomain=Te,exports.isNativeCurrency=Re;
 //# sourceMappingURL=universal-router-sdk.cjs.production.min.js.map
diff --git a/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.production.min.js.map b/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.production.min.js.map
index d51bdd2..3e8126e 100644
--- a/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.production.min.js.map
+++ b/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.cjs.production.min.js.map
@@ -1 +1 @@
-{"version":3,"file":"universal-router-sdk.cjs.production.min.js","sources":["../src/utils/routerCommands.ts","../src/entities/Command.ts","../src/utils/constants.ts","../src/utils/pathCurrency.ts","../src/utils/getCurrencyAddress.ts","../src/entities/actions/uniswap.ts","../src/utils/numbers.ts","../src/utils/inputTokens.ts","../src/swapRouter.ts","../src/utils/routerTradeAdapter.ts","../src/entities/actions/unwrapWETH.ts","../src/utils/commandParser.ts"],"sourcesContent":["import { defaultAbiCoder } from 'ethers/lib/utils'\n\n/**\n * CommandTypes\n * @description Flags that modify a command's execution\n * @enum {number}\n */\nexport enum CommandType {\n  V3_SWAP_EXACT_IN = 0x00,\n  V3_SWAP_EXACT_OUT = 0x01,\n  PERMIT2_TRANSFER_FROM = 0x02,\n  PERMIT2_PERMIT_BATCH = 0x03,\n  SWEEP = 0x04,\n  TRANSFER = 0x05,\n  PAY_PORTION = 0x06,\n\n  V2_SWAP_EXACT_IN = 0x08,\n  V2_SWAP_EXACT_OUT = 0x09,\n  PERMIT2_PERMIT = 0x0a,\n  WRAP_ETH = 0x0b,\n  UNWRAP_WETH = 0x0c,\n  PERMIT2_TRANSFER_FROM_BATCH = 0x0d,\n  BALANCE_CHECK_ERC20 = 0x0e,\n\n  V4_SWAP = 0x10,\n  V3_POSITION_MANAGER_PERMIT = 0x11,\n  V3_POSITION_MANAGER_CALL = 0x12,\n  V4_INITIALIZE_POOL = 0x13,\n  V4_POSITION_MANAGER_CALL = 0x14,\n\n  EXECUTE_SUB_PLAN = 0x21,\n}\n\nexport enum Subparser {\n  V3PathExactIn,\n  V3PathExactOut,\n}\n\nexport enum Parser {\n  Abi,\n  V4Actions,\n  V3Actions,\n}\n\nexport type ParamType = {\n  readonly name: string\n  readonly type: string\n  readonly subparser?: Subparser\n}\n\nexport type CommandDefinition =\n  | {\n      parser: Parser.Abi\n      params: ParamType[]\n    }\n  | {\n      parser: Parser.V4Actions\n    }\n  | {\n      parser: Parser.V3Actions\n    }\n\nconst ALLOW_REVERT_FLAG = 0x80\nconst REVERTIBLE_COMMANDS = new Set<CommandType>([CommandType.EXECUTE_SUB_PLAN])\n\nconst PERMIT_STRUCT =\n  '((address token,uint160 amount,uint48 expiration,uint48 nonce) details,address spender,uint256 sigDeadline)'\n\nconst PERMIT_BATCH_STRUCT =\n  '((address token,uint160 amount,uint48 expiration,uint48 nonce)[] details,address spender,uint256 sigDeadline)'\n\nconst POOL_KEY_STRUCT = '(address currency0,address currency1,uint24 fee,int24 tickSpacing,address hooks)'\n\nconst PERMIT2_TRANSFER_FROM_STRUCT = '(address from,address to,uint160 amount,address token)'\nconst PERMIT2_TRANSFER_FROM_BATCH_STRUCT = PERMIT2_TRANSFER_FROM_STRUCT + '[]'\n\nexport const COMMAND_DEFINITION: { [key in CommandType]: CommandDefinition } = {\n  // Batch Reverts\n  [CommandType.EXECUTE_SUB_PLAN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'commands', type: 'bytes' },\n      { name: 'inputs', type: 'bytes[]' },\n    ],\n  },\n\n  // Permit2 Actions\n  [CommandType.PERMIT2_PERMIT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'permit', type: PERMIT_STRUCT },\n      { name: 'signature', type: 'bytes' },\n    ],\n  },\n  [CommandType.PERMIT2_PERMIT_BATCH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'permit', type: PERMIT_BATCH_STRUCT },\n      { name: 'signature', type: 'bytes' },\n    ],\n  },\n  [CommandType.PERMIT2_TRANSFER_FROM]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'amount', type: 'uint160' },\n    ],\n  },\n  [CommandType.PERMIT2_TRANSFER_FROM_BATCH]: {\n    parser: Parser.Abi,\n    params: [\n      {\n        name: 'transferFrom',\n        type: PERMIT2_TRANSFER_FROM_BATCH_STRUCT,\n      },\n    ],\n  },\n\n  // Uniswap Actions\n  [CommandType.V3_SWAP_EXACT_IN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountIn', type: 'uint256' },\n      { name: 'amountOutMin', type: 'uint256' },\n      { name: 'path', subparser: Subparser.V3PathExactIn, type: 'bytes' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V3_SWAP_EXACT_OUT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountOut', type: 'uint256' },\n      { name: 'amountInMax', type: 'uint256' },\n      { name: 'path', subparser: Subparser.V3PathExactOut, type: 'bytes' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V2_SWAP_EXACT_IN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountIn', type: 'uint256' },\n      { name: 'amountOutMin', type: 'uint256' },\n      { name: 'path', type: 'address[]' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V2_SWAP_EXACT_OUT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountOut', type: 'uint256' },\n      { name: 'amountInMax', type: 'uint256' },\n      { name: 'path', type: 'address[]' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V4_SWAP]: { parser: Parser.V4Actions },\n\n  // Token Actions and Checks\n  [CommandType.WRAP_ETH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amount', type: 'uint256' },\n    ],\n  },\n  [CommandType.UNWRAP_WETH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountMin', type: 'uint256' },\n    ],\n  },\n  [CommandType.SWEEP]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'amountMin', type: 'uint256' },\n    ],\n  },\n  [CommandType.TRANSFER]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'value', type: 'uint256' },\n    ],\n  },\n  [CommandType.PAY_PORTION]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'bips', type: 'uint256' },\n    ],\n  },\n  [CommandType.BALANCE_CHECK_ERC20]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'owner', type: 'address' },\n      { name: 'token', type: 'address' },\n      { name: 'minBalance', type: 'uint256' },\n    ],\n  },\n  [CommandType.V4_INITIALIZE_POOL]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'poolKey', type: POOL_KEY_STRUCT },\n      { name: 'sqrtPriceX96', type: 'uint160' },\n    ],\n  },\n\n  // Position Actions\n  [CommandType.V3_POSITION_MANAGER_PERMIT]: { parser: Parser.V3Actions },\n  [CommandType.V3_POSITION_MANAGER_CALL]: { parser: Parser.V3Actions },\n  [CommandType.V4_POSITION_MANAGER_CALL]: { parser: Parser.V4Actions },\n}\n\nexport class RoutePlanner {\n  commands: string\n  inputs: string[]\n\n  constructor() {\n    this.commands = '0x'\n    this.inputs = []\n  }\n\n  addSubPlan(subplan: RoutePlanner): RoutePlanner {\n    this.addCommand(CommandType.EXECUTE_SUB_PLAN, [subplan.commands, subplan.inputs], true)\n    return this\n  }\n\n  addCommand(type: CommandType, parameters: any[], allowRevert = false): RoutePlanner {\n    let command = createCommand(type, parameters)\n    this.inputs.push(command.encodedInput)\n    if (allowRevert) {\n      if (!REVERTIBLE_COMMANDS.has(command.type)) {\n        throw new Error(`command type: ${command.type} cannot be allowed to revert`)\n      }\n      command.type = command.type | ALLOW_REVERT_FLAG\n    }\n\n    this.commands = this.commands.concat(command.type.toString(16).padStart(2, '0'))\n    return this\n  }\n}\n\nexport type RouterCommand = {\n  type: CommandType\n  encodedInput: string\n}\n\nexport function createCommand(type: CommandType, parameters: any[]): RouterCommand {\n  const commandDef = COMMAND_DEFINITION[type]\n  switch (commandDef.parser) {\n    case Parser.Abi:\n      const encodedInput = defaultAbiCoder.encode(\n        commandDef.params.map((abi) => abi.type),\n        parameters\n      )\n      return { type, encodedInput }\n    case Parser.V4Actions:\n      // v4 swap data comes pre-encoded at index 0\n      return { type, encodedInput: parameters[0] }\n    case Parser.V3Actions:\n      // v4 swap data comes pre-encoded at index 0\n      return { type, encodedInput: parameters[0] }\n  }\n}\n","import { RoutePlanner } from '../utils/routerCommands'\n\nexport type TradeConfig = {\n  allowRevert: boolean\n}\n\nexport enum RouterActionType {\n  UniswapTrade = 'UniswapTrade',\n  UnwrapWETH = 'UnwrapWETH',\n}\n\n// interface for entities that can be encoded as a Universal Router command\nexport interface Command {\n  tradeType: RouterActionType\n  encode(planner: RoutePlanner, config: TradeConfig): void\n}\n","import { BigNumber } from 'ethers'\n\nexport enum UniversalRouterVersion {\n  V1_2 = '1.2',\n  V2_0 = '2.0',\n}\n\nexport type RouterConfig = {\n  address: string\n  creationBlock: number\n}\n\ntype ChainConfig = {\n  weth: string\n  routerConfigs: { [key in UniversalRouterVersion]: RouterConfig }\n}\n\nconst WETH_NOT_SUPPORTED_ON_CHAIN = '0x0000000000000000000000000000000000000000'\n\n// Todo: Change `CHAIN_CONFIGS` to pull the UR address with v4\nexport const CHAIN_CONFIGS: { [key: number]: ChainConfig } = {\n  // mainnet\n  [1]: {\n    weth: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17143817,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x66a9893cc07d91d95644aedd05d03f95e1dba8af',\n        creationBlock: 1737658355,\n      },\n    },\n  },\n  // goerli\n  [5]: {\n    weth: '0xb4fbf271143f4fbf7b91a5ded31805e42b2208d6',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8940568,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8940568,\n      },\n    },\n  },\n  // sepolia\n  [11155111]: {\n    weth: '0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 3543575,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3a9d48ab9751398bbfa63ad67599bb04e4bdf98b', // only update here and creation block below\n        creationBlock: 7259601,\n      },\n    },\n  },\n  // polygon\n  [137]: {\n    weth: '0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xec7BE89e9d109e7e3Fec59c222CF297125FEFda2',\n        creationBlock: 52210153,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x1095692a6237d83c6a72f3f5efedb9a670c49223',\n        creationBlock: 1737492197,\n      },\n    },\n  },\n  //polygon mumbai\n  [80001]: {\n    weth: '0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 35176052,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 35176052,\n      },\n    },\n  },\n  //optimism\n  [10]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xCb1355ff08Ab38bBCE60111F1bb2B784bE25D7e8',\n        creationBlock: 114702266,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x851116d9223fabed8e56c0e6b8ad0c31d98b3507',\n        creationBlock: 1737494278,\n      },\n    },\n  },\n  // optimism goerli\n  [420]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8887728,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8887728,\n      },\n    },\n  },\n  // arbitrum\n  [42161]: {\n    weth: '0x82aF49447D8a07e3bd95BD0d56f35241523fBab1',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x5E325eDA8064b456f4781070C0738d849c824258',\n        creationBlock: 169472836,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xa51afafe0263b40edaef0df8781ea9aa03e381a3',\n        creationBlock: 1737487458,\n      },\n    },\n  },\n  // arbitrum goerli\n  [421613]: {\n    weth: '0xe39Ab88f8A4777030A534146A9Ca3B52bd5D43A3',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 18815277,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 18815277,\n      },\n    },\n  },\n  // celo\n  [42220]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x643770e279d5d0733f21d6dc03a8efbabf3255b4',\n        creationBlock: 21407637,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xcb695bc5D3Aa22cAD1E6DF07801b061a05A0233A',\n        creationBlock: 47387857,\n      },\n    },\n  },\n  // celo alfajores\n  [44787]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17566658,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17566658,\n      },\n    },\n  },\n  // binance smart chain\n  [56]: {\n    weth: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4Dae2f939ACf50408e13d58534Ff8c2776d45265',\n        creationBlock: 35160263,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x1906c1d672b88cd1b9ac7593301ca990f94eae07',\n        creationBlock: 1737493275,\n      },\n    },\n  },\n  // avalanche\n  [43114]: {\n    weth: '0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4Dae2f939ACf50408e13d58534Ff8c2776d45265',\n        creationBlock: 40237257,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x94b75331ae8d42c1b61065089b7d48fe14aa73b7',\n        creationBlock: 1737558236,\n      },\n    },\n  },\n  // base goerli\n  [84531]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',\n        creationBlock: 6915289,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',\n        creationBlock: 6915289,\n      },\n    },\n  },\n  // base mainnet\n  [8453]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 9107268,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x6ff5693b99212da76ad316178a184ab56d299b43',\n        creationBlock: 1737491485,\n      },\n    },\n  },\n  // blast\n  [81457]: {\n    weth: '0x4300000000000000000000000000000000000004',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x643770E279d5D0733F21d6DC03A8efbABf3255B4',\n        creationBlock: 1116444,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xeabbcb3e8e415306207ef514f660a3f820025be3',\n        creationBlock: 1737564586,\n      },\n    },\n  },\n  // zora\n  [7777777]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x2986d9721A49838ab4297b695858aF7F17f38014',\n        creationBlock: 11832155,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3315ef7ca28db74abadc6c44570efdf06b04b020',\n        creationBlock: 1737562927,\n      },\n    },\n  },\n  [324]: {\n    weth: '0x5aea5775959fbc2557cc8789bc1bf90a239d9a91',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',\n        creationBlock: 12640979,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',\n        creationBlock: 12640979,\n      },\n    },\n  },\n  // worldchain\n  [480]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D',\n        creationBlock: 4063979,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x8ac7bee993bb44dab564ea4bc9ea67bf9eb5e743',\n        creationBlock: 1737559557,\n      },\n    },\n  },\n  [1301]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x8909Dc15e40173Ff4699343b6eB8132c65e18eC6',\n        creationBlock: 1241811,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xf70536b3bcc1bd1a972dc186a2cf84cc6da6be5d',\n        creationBlock: 7100543,\n      },\n    },\n  },\n  // unichain mainnet\n  [130]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4D73A4411CA1c660035e4AECC8270E5DdDEC8C17',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xef740bf23acae26f6492b10de645d6b98dc8eaf3',\n        creationBlock: 1737568156,\n      },\n    },\n  },\n  [10143]: {\n    weth: '0x760AfE86e5de5fa0Ee542fc7B7B713e1c5425701',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',\n        creationBlock: 23678,\n      },\n    },\n  },\n  [84532]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x492e6456d9528771018deb9e87ef7750ef184104',\n        creationBlock: 20216585,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x492e6456d9528771018deb9e87ef7750ef184104',\n        creationBlock: 20216585,\n      },\n    },\n  },\n  [1868]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',\n        creationBlock: 3254782,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',\n        creationBlock: 3254782,\n      },\n    },\n  },\n  [143]: {\n    weth: '0x3bd359C1119dA7Da1D913D1C4D2B7c461115433A',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',\n        creationBlock: 29255937,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',\n        creationBlock: 29255937,\n      },\n    },\n  },\n  [196]: {\n    weth: '0xe538905cf8410324e03A5A23C1c177a474D59b2b',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0000000000000000000000000000000000000000',\n        creationBlock: 1,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x5507749f2c558bb3e162c6e90c314c092e7372ff',\n        creationBlock: 47680350,\n      },\n    },\n  },\n}\n\nexport const UNIVERSAL_ROUTER_ADDRESS = (version: UniversalRouterVersion, chainId: number): string => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n  return CHAIN_CONFIGS[chainId].routerConfigs[version].address\n}\n\nexport const UNIVERSAL_ROUTER_CREATION_BLOCK = (version: UniversalRouterVersion, chainId: number): number => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n  return CHAIN_CONFIGS[chainId].routerConfigs[version].creationBlock\n}\n\nexport const WETH_ADDRESS = (chainId: number): string => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n\n  if (CHAIN_CONFIGS[chainId].weth == WETH_NOT_SUPPORTED_ON_CHAIN) throw new Error(`Chain ${chainId} does not have WETH`)\n\n  return CHAIN_CONFIGS[chainId].weth\n}\n\nexport const CONTRACT_BALANCE = BigNumber.from(2).pow(255)\nexport const ETH_ADDRESS = '0x0000000000000000000000000000000000000000'\nexport const E_ETH_ADDRESS = '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee'\nexport const ZERO_ADDRESS = '0x0000000000000000000000000000000000000000'\nexport const MAX_UINT256 = BigNumber.from(2).pow(256).sub(1)\nexport const MAX_UINT160 = BigNumber.from(2).pow(160).sub(1)\n\nexport const SENDER_AS_RECIPIENT = '0x0000000000000000000000000000000000000001'\nexport const ROUTER_AS_RECIPIENT = '0x0000000000000000000000000000000000000002'\n","import { Currency, Token } from '@uniswap/sdk-core'\nimport { Pool as V4Pool } from '@uniswap/v4-sdk'\nimport { TPool } from '@uniswap/router-sdk'\n\nexport function getPathCurrency(currency: Currency, pool: TPool): Currency {\n  // return currency if the currency matches a currency of the pool\n  if (pool.involvesToken(currency as Token)) {\n    return currency\n\n    // return if currency.wrapped if pool involves wrapped currency\n  } else if (pool.involvesToken(currency.wrapped as Token)) {\n    return currency.wrapped\n\n    // return native currency if pool involves native version of wrapped currency (only applies to V4)\n  } else if (pool instanceof V4Pool && pool.token0.wrapped.equals(currency)) {\n    return pool.token0\n  } else if (pool instanceof V4Pool && pool.token1.wrapped.equals(currency)) {\n    return pool.token1\n  } else {\n    throw new Error(`Expected currency ${currency.symbol} to be either ${pool.token0.symbol} or ${pool.token1.symbol}`)\n  }\n\n  return currency // this line needed for typescript to compile\n}\n","import { Currency } from '@uniswap/sdk-core'\nimport { ETH_ADDRESS } from './constants'\n\nexport function getCurrencyAddress(currency: Currency): string {\n  return currency.isNative ? ETH_ADDRESS : currency.wrapped.address\n}\n","import { RoutePlanner, CommandType } from '../../utils/routerCommands'\nimport { Trade as V2Trade, Pair } from '@uniswap/v2-sdk'\nimport { Trade as V3Trade, Pool as V3Pool, encodeRouteToPath } from '@uniswap/v3-sdk'\nimport {\n  Route as V4Route,\n  Trade as V4Trade,\n  Pool as V4Pool,\n  V4Planner,\n  encodeRouteToPath as encodeV4RouteToPath,\n  Actions,\n} from '@uniswap/v4-sdk'\nimport {\n  Trade as RouterTrade,\n  MixedRouteTrade,\n  Protocol,\n  IRoute,\n  RouteV2,\n  RouteV3,\n  MixedRouteSDK,\n  MixedRoute,\n  SwapOptions as RouterSwapOptions,\n  getOutputOfPools,\n  encodeMixedRouteToPath,\n  partitionMixedRouteByProtocol,\n} from '@uniswap/router-sdk'\nimport { Permit2Permit } from '../../utils/inputTokens'\nimport { getPathCurrency } from '../../utils/pathCurrency'\nimport { Currency, TradeType, Token, CurrencyAmount, Percent } from '@uniswap/sdk-core'\nimport { Command, RouterActionType, TradeConfig } from '../Command'\nimport { SENDER_AS_RECIPIENT, ROUTER_AS_RECIPIENT, CONTRACT_BALANCE, ETH_ADDRESS } from '../../utils/constants'\nimport { getCurrencyAddress } from '../../utils/getCurrencyAddress'\nimport { encodeFeeBips } from '../../utils/numbers'\nimport { BigNumber, BigNumberish } from 'ethers'\nimport { TPool } from '@uniswap/router-sdk'\n\nexport type FlatFeeOptions = {\n  amount: BigNumberish\n  recipient: string\n}\n\n// the existing router permit object doesn't include enough data for permit2\n// so we extend swap options with the permit2 permit\n// when safe mode is enabled, the SDK will add an extra ETH sweep for security\n// when useRouterBalance is enabled the SDK will use the balance in the router for the swap\nexport type SwapOptions = Omit<RouterSwapOptions, 'inputTokenPermit'> & {\n  useRouterBalance?: boolean\n  inputTokenPermit?: Permit2Permit\n  flatFee?: FlatFeeOptions\n  safeMode?: boolean\n}\n\nconst REFUND_ETH_PRICE_IMPACT_THRESHOLD = new Percent(50, 100)\n\ninterface Swap<TInput extends Currency, TOutput extends Currency> {\n  route: IRoute<TInput, TOutput, TPool>\n  inputAmount: CurrencyAmount<TInput>\n  outputAmount: CurrencyAmount<TOutput>\n}\n\n// Wrapper for uniswap router-sdk trade entity to encode swaps for Universal Router\n// also translates trade objects from previous (v2, v3) SDKs\nexport class UniswapTrade implements Command {\n  readonly tradeType: RouterActionType = RouterActionType.UniswapTrade\n  readonly payerIsUser: boolean\n\n  constructor(public trade: RouterTrade<Currency, Currency, TradeType>, public options: SwapOptions) {\n    if (!!options.fee && !!options.flatFee) throw new Error('Only one fee option permitted')\n\n    if (this.inputRequiresWrap || this.inputRequiresUnwrap || this.options.useRouterBalance) {\n      this.payerIsUser = false\n    } else {\n      this.payerIsUser = true\n    }\n  }\n\n  get isAllV4(): boolean {\n    let result = true\n    for (const swap of this.trade.swaps) {\n      result = result && swap.route.protocol == Protocol.V4\n    }\n    return result\n  }\n\n  // this.trade.swaps is an array of swaps / trades.\n  // we are iterating over one swap (trade) at a time so length is 1\n  // route is either v2, v3, v4, or mixed\n  // pathInput and pathOutput are the currencies of the input and output of the route\n  // this.trade.inputAmount is the input currency of the trade (could be different from pathInput)\n  // this.trade.outputAmount is the output currency of the trade (could be different from pathOutput)\n  // each route can have multiple pools\n  get inputRequiresWrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const route = swap.route\n    const firstPool = route.pools[0]\n\n    if (firstPool instanceof V4Pool) {\n      // If first pool is a v4 pool and input currency is native and the path input currency in the route is not native, we need to wrap.\n      return (\n        this.trade.inputAmount.currency.isNative &&\n        !(this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathInput.isNative\n      )\n    }\n    // If first pool is not a v4 pool and input currency is native, we need to wrap\n    return this.trade.inputAmount.currency.isNative\n  }\n\n  get inputRequiresUnwrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const route = swap.route\n    const firstPool = route.pools[0]\n\n    if (firstPool instanceof V4Pool) {\n      // If the first pool is a v4 pool and input currency is not native and the path input currency is native, we need to unwrap\n      return (\n        !this.trade.inputAmount.currency.isNative &&\n        (this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathInput.isNative\n      )\n    }\n    // If the first pool is not a v4 pool, we don't need to unwrap.\n    return false\n  }\n\n  get outputRequiresWrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const lastRoute = swap.route\n    const lastPool = lastRoute.pools[lastRoute.pools.length - 1]\n\n    // if last pool is v4:\n    if (lastPool instanceof V4Pool) {\n      // If output currency is not native but path currency output is native, we need to wrap\n      if (!this.trade.outputAmount.currency.isNative) {\n        if ((lastRoute as unknown as V4Route<Currency, Currency>).pathOutput.isNative) {\n          // this means path output is native and we need to wrap\n          return true\n        } else if (lastPool.currency1.equals(lastPool.currency0.wrapped) && lastRoute.pools.length > 1) {\n          let poolBefore = lastRoute.pools[lastRoute.pools.length - 2]\n          // this means last pool is eth-weth and pool before contains weth\n          if (\n            poolBefore instanceof V4Pool &&\n            (poolBefore.currency0.equals(lastPool.currency1) || poolBefore.currency1.equals(lastPool.currency1))\n          ) {\n            return true\n          } else if (poolBefore.token0.equals(lastPool.currency1) || poolBefore.token1.equals(lastPool.currency1)) {\n            // same for v2 and v3 pools\n            return true\n          }\n        }\n      }\n    }\n    // if last pool is not v4:\n    // we do not need to wrap because v2 and v3 pools already require wrapped tokens\n    return false\n  }\n\n  get outputRequiresUnwrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const lastRoute = swap.route\n    const lastPool = lastRoute.pools[lastRoute.pools.length - 1]\n\n    // if last pool is v4:\n    if (lastPool instanceof V4Pool) {\n      // If output currency is native and path currency output is not native, we need to unwrap\n      if (this.trade.outputAmount.currency.isNative) {\n        if (!(this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathOutput.isNative) {\n          // this means path output is weth and we need to unwrap\n          return true\n        } else if (\n          lastRoute.pools.length > 1 &&\n          lastRoute.pools[lastRoute.pools.length - 2] instanceof V4Pool &&\n          (lastRoute.pools[lastRoute.pools.length - 2] as V4Pool).currency0.isNative &&\n          lastPool.currency1.equals(lastPool.currency0.wrapped)\n        ) {\n          // this means last pool is eth-weth and we need to unwrap\n          return true\n        } else {\n          return false\n        }\n      }\n    }\n    // else: if path output currency is native, we need to unwrap because v2 and v3 pools already require wrapped tokens\n    return this.trade.outputAmount.currency.isNative\n  }\n\n  get outputRequiresTransition(): boolean {\n    return this.outputRequiresWrap || this.outputRequiresUnwrap\n  }\n\n  encode(planner: RoutePlanner, _config: TradeConfig): void {\n    // If the input currency is the native currency, we need to wrap it with the router as the recipient\n    if (this.inputRequiresWrap) {\n      // TODO: optimize if only one v2 pool we can directly send this to the pool\n      planner.addCommand(CommandType.WRAP_ETH, [\n        ROUTER_AS_RECIPIENT,\n        this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString(),\n      ])\n    } else if (this.inputRequiresUnwrap) {\n      // send wrapped token to router to unwrap\n      planner.addCommand(CommandType.PERMIT2_TRANSFER_FROM, [\n        (this.trade.inputAmount.currency as Token).address,\n        ROUTER_AS_RECIPIENT,\n        this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString(),\n      ])\n      planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, 0])\n    }\n    // The overall recipient at the end of the trade, SENDER_AS_RECIPIENT uses the msg.sender\n    this.options.recipient = this.options.recipient ?? SENDER_AS_RECIPIENT\n\n    // flag for whether we want to perform slippage check on aggregate output of multiple routes\n    //   1. when there are >2 exact input trades. this is only a heuristic,\n    //      as it's still more gas-expensive even in this case, but has benefits\n    //      in that the reversion probability is lower\n    const performAggregatedSlippageCheck =\n      this.trade.tradeType === TradeType.EXACT_INPUT && this.trade.routes.length > 2\n    const routerMustCustody =\n      performAggregatedSlippageCheck || this.outputRequiresTransition || hasFeeOption(this.options)\n\n    for (const swap of this.trade.swaps) {\n      switch (swap.route.protocol) {\n        case Protocol.V2:\n          addV2Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.V3:\n          addV3Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.V4:\n          addV4Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.MIXED:\n          addMixedSwap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        default:\n          throw new Error('UNSUPPORTED_TRADE_PROTOCOL')\n      }\n    }\n\n    let minimumAmountOut: BigNumber = BigNumber.from(\n      this.trade.minimumAmountOut(this.options.slippageTolerance).quotient.toString()\n    )\n    // The router custodies for 3 reasons: to unwrap, to take a fee, and/or to do a slippage check\n    if (routerMustCustody) {\n      const pools = this.trade.swaps[0].route.pools\n      const pathOutputCurrencyAddress = getCurrencyAddress(\n        getPathCurrency(this.trade.outputAmount.currency, pools[pools.length - 1])\n      )\n\n      // If there is a fee, that percentage is sent to the fee recipient\n      // In the case where ETH is the output currency, the fee is taken in WETH (for gas reasons)\n      if (!!this.options.fee) {\n        const feeBips = encodeFeeBips(this.options.fee.fee)\n        planner.addCommand(CommandType.PAY_PORTION, [pathOutputCurrencyAddress, this.options.fee.recipient, feeBips])\n\n        // If the trade is exact output, and a fee was taken, we must adjust the amount out to be the amount after the fee\n        // Otherwise we continue as expected with the trade's normal expected output\n        if (this.trade.tradeType === TradeType.EXACT_OUTPUT) {\n          minimumAmountOut = minimumAmountOut.sub(minimumAmountOut.mul(feeBips).div(10000))\n        }\n      }\n\n      // If there is a flat fee, that absolute amount is sent to the fee recipient\n      // In the case where ETH is the output currency, the fee is taken in WETH (for gas reasons)\n      if (!!this.options.flatFee) {\n        const feeAmount = this.options.flatFee.amount\n        if (minimumAmountOut.lt(feeAmount)) throw new Error('Flat fee amount greater than minimumAmountOut')\n\n        planner.addCommand(CommandType.TRANSFER, [pathOutputCurrencyAddress, this.options.flatFee.recipient, feeAmount])\n\n        // If the trade is exact output, and a fee was taken, we must adjust the amount out to be the amount after the fee\n        // Otherwise we continue as expected with the trade's normal expected output\n        if (this.trade.tradeType === TradeType.EXACT_OUTPUT) {\n          minimumAmountOut = minimumAmountOut.sub(feeAmount)\n        }\n      }\n\n      // The remaining tokens that need to be sent to the user after the fee is taken will be caught\n      // by this if-else clause.\n      if (this.outputRequiresUnwrap) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [this.options.recipient, minimumAmountOut])\n      } else if (this.outputRequiresWrap) {\n        planner.addCommand(CommandType.WRAP_ETH, [this.options.recipient, CONTRACT_BALANCE])\n      } else {\n        planner.addCommand(CommandType.SWEEP, [\n          getCurrencyAddress(this.trade.outputAmount.currency),\n          this.options.recipient,\n          minimumAmountOut,\n        ])\n      }\n    }\n\n    // for exactOutput swaps with native input or that perform an inputToken transition (wrap or unwrap)\n    // we need to send back the change to the user\n    if (this.trade.tradeType === TradeType.EXACT_OUTPUT || riskOfPartialFill(this.trade)) {\n      if (this.inputRequiresWrap) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [this.options.recipient, 0])\n      } else if (this.inputRequiresUnwrap) {\n        planner.addCommand(CommandType.WRAP_ETH, [this.options.recipient, CONTRACT_BALANCE])\n      } else if (this.trade.inputAmount.currency.isNative) {\n        // must refund extra native currency sent along for native v4 trades (no input transition)\n        planner.addCommand(CommandType.SWEEP, [ETH_ADDRESS, this.options.recipient, 0])\n      }\n    }\n\n    if (this.options.safeMode) planner.addCommand(CommandType.SWEEP, [ETH_ADDRESS, this.options.recipient, 0])\n  }\n}\n\n// encode a uniswap v2 swap\nfunction addV2Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { route, inputAmount, outputAmount }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const trade = new V2Trade(\n    route as RouteV2<TInput, TOutput>,\n    tradeType == TradeType.EXACT_INPUT ? inputAmount : outputAmount,\n    tradeType\n  )\n\n  if (tradeType == TradeType.EXACT_INPUT) {\n    planner.addCommand(CommandType.V2_SWAP_EXACT_IN, [\n      // if native, we have to unwrap so keep in the router for now\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      // if router will custody funds, we do aggregated slippage check from router\n      routerMustCustody ? 0 : trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      route.path.map((token) => token.wrapped.address),\n      payerIsUser,\n    ])\n  } else if (tradeType == TradeType.EXACT_OUTPUT) {\n    planner.addCommand(CommandType.V2_SWAP_EXACT_OUT, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      route.path.map((token) => token.wrapped.address),\n      payerIsUser,\n    ])\n  }\n}\n\n// encode a uniswap v3 swap\nfunction addV3Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { route, inputAmount, outputAmount }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const trade = V3Trade.createUncheckedTrade({\n    route: route as RouteV3<TInput, TOutput>,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const path = encodeRouteToPath(route as RouteV3<TInput, TOutput>, trade.tradeType === TradeType.EXACT_OUTPUT)\n  if (tradeType == TradeType.EXACT_INPUT) {\n    planner.addCommand(CommandType.V3_SWAP_EXACT_IN, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      routerMustCustody ? 0 : trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      path,\n      payerIsUser,\n    ])\n  } else if (tradeType == TradeType.EXACT_OUTPUT) {\n    planner.addCommand(CommandType.V3_SWAP_EXACT_OUT, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      path,\n      payerIsUser,\n    ])\n  }\n}\n\nfunction addV4Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { inputAmount, outputAmount, route }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  // create a deep copy of pools since v4Planner encoding tampers with array\n  const pools = route.pools.map((p) => p) as V4Pool[]\n  const v4Route = new V4Route(pools, inputAmount.currency, outputAmount.currency)\n  const trade = V4Trade.createUncheckedTrade({\n    route: v4Route,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const slippageToleranceOnSwap =\n    routerMustCustody && tradeType == TradeType.EXACT_INPUT ? undefined : options.slippageTolerance\n\n  const v4Planner = new V4Planner()\n  v4Planner.addTrade(trade, slippageToleranceOnSwap)\n  v4Planner.addSettle(trade.route.pathInput, payerIsUser)\n\n  // Handle split route output consistency:\n  // - If output is ETH and some routes output WETH: force all to output WETH, then unwrap\n  // - If output is WETH and some routes output ETH: force all to output ETH, then wrap\n  let pathOutputForTake = trade.route.pathOutput\n  let lastPool = v4Route.pools[v4Route.pools.length - 1]\n  let ethWethPool = lastPool.currency1.equals(lastPool.currency0.wrapped)\n\n  if (ethWethPool && v4Route.pools.length > 1) {\n    let poolBefore = v4Route.pools[v4Route.pools.length - 2]\n    if (pathOutputForTake.isNative && poolBefore.currency0.isNative) {\n      pathOutputForTake = pathOutputForTake.wrapped\n    } else if (\n      !pathOutputForTake.isNative &&\n      (poolBefore.currency0.equals(lastPool.currency1) || poolBefore.currency1.equals(lastPool.currency1))\n    ) {\n      pathOutputForTake = lastPool.currency0\n    }\n  }\n\n  v4Planner.addTake(\n    pathOutputForTake,\n    routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient ?? SENDER_AS_RECIPIENT\n  )\n  planner.addCommand(CommandType.V4_SWAP, [v4Planner.finalize()])\n}\n\n// encode a mixed route swap, i.e. including both v2 and v3 pools\nfunction addMixedSwap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  swap: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const route = swap.route as MixedRoute<TInput, TOutput>\n  const inputAmount = swap.inputAmount\n  const outputAmount = swap.outputAmount\n  const tradeRecipient = routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient ?? SENDER_AS_RECIPIENT\n\n  // single hop, so it can be reduced to plain swap logic for one protocol version\n  if (route.pools.length === 1) {\n    if (route.pools[0] instanceof V4Pool) {\n      return addV4Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else if (route.pools[0] instanceof V3Pool) {\n      return addV3Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else if (route.pools[0] instanceof Pair) {\n      return addV2Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else {\n      throw new Error('Invalid route type')\n    }\n  }\n\n  const trade = MixedRouteTrade.createUncheckedTrade({\n    route: route as MixedRoute<TInput, TOutput>,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const amountIn = trade.maximumAmountIn(options.slippageTolerance, inputAmount).quotient.toString()\n  const amountOut = routerMustCustody\n    ? 0\n    : trade.minimumAmountOut(options.slippageTolerance, outputAmount).quotient.toString()\n\n  // logic from\n  // https://github.com/Uniswap/router-sdk/blob/d8eed164e6c79519983844ca8b6a3fc24ebcb8f8/src/swapRouter.ts#L276\n  const sections = partitionMixedRouteByProtocol(route as MixedRoute<TInput, TOutput>)\n  const isLastSectionInRoute = (i: number) => {\n    return i === sections.length - 1\n  }\n\n  let inputToken = route.pathInput\n\n  for (let i = 0; i < sections.length; i++) {\n    const section = sections[i]\n    const routePool = section[0]\n    const outputToken = getOutputOfPools(section, inputToken)\n    const subRoute = new MixedRoute(new MixedRouteSDK([...section], inputToken, outputToken))\n\n    let nextInputToken\n    let swapRecipient\n\n    if (isLastSectionInRoute(i)) {\n      nextInputToken = outputToken\n      swapRecipient = tradeRecipient\n    } else {\n      const nextPool = sections[i + 1][0]\n      nextInputToken = getPathCurrency(outputToken, nextPool)\n\n      const v2PoolIsSwapRecipient = nextPool instanceof Pair && outputToken.equals(nextInputToken)\n      swapRecipient = v2PoolIsSwapRecipient ? (nextPool as Pair).liquidityToken.address : ROUTER_AS_RECIPIENT\n    }\n\n    if (routePool instanceof V4Pool) {\n      const v4Planner = new V4Planner()\n      const v4SubRoute = new V4Route(section as V4Pool[], subRoute.input, subRoute.output)\n\n      v4Planner.addSettle(inputToken, payerIsUser && i === 0, (i == 0 ? amountIn : CONTRACT_BALANCE) as BigNumber)\n      v4Planner.addAction(Actions.SWAP_EXACT_IN, [\n        {\n          currencyIn: inputToken.isNative ? ETH_ADDRESS : inputToken.address,\n          path: encodeV4RouteToPath(v4SubRoute),\n          amountIn: 0, // denotes open delta, amount set in v4Planner.addSettle()\n          amountOutMinimum: !isLastSectionInRoute(i) ? 0 : amountOut,\n        },\n      ])\n\n      // Handle split route output consistency for V4 sections in mixed routes\n      let outputTokenForTake = outputToken\n      if (isLastSectionInRoute(i)) {\n        let lastPool = route.pools[route.pools.length - 1]\n        let v4Pool = lastPool instanceof V4Pool\n        let ethWethPool = v4Pool ? (lastPool as V4Pool).currency1.equals((lastPool as V4Pool).currency0.wrapped) : false\n        let poolBefore = route.pools[route.pools.length - 2]\n\n        if (ethWethPool) {\n          if (outputToken.isNative && poolBefore.token0.isNative) {\n            outputTokenForTake = outputToken.wrapped\n          } else if (\n            !outputToken.isNative &&\n            (poolBefore.token0.equals(lastPool.token1) || poolBefore.token1.equals(lastPool.token1))\n          ) {\n            outputTokenForTake = lastPool.token0\n          }\n        }\n      }\n\n      v4Planner.addTake(outputTokenForTake, swapRecipient)\n\n      planner.addCommand(CommandType.V4_SWAP, [v4Planner.finalize()])\n    } else if (routePool instanceof V3Pool) {\n      planner.addCommand(CommandType.V3_SWAP_EXACT_IN, [\n        swapRecipient, // recipient\n        i == 0 ? amountIn : CONTRACT_BALANCE, // amountIn\n        !isLastSectionInRoute(i) ? 0 : amountOut, // amountOut\n        encodeMixedRouteToPath(subRoute), // path\n        payerIsUser && i === 0, // payerIsUser\n      ])\n    } else if (routePool instanceof Pair) {\n      planner.addCommand(CommandType.V2_SWAP_EXACT_IN, [\n        swapRecipient, // recipient\n        i === 0 ? amountIn : CONTRACT_BALANCE, // amountIn\n        !isLastSectionInRoute(i) ? 0 : amountOut, // amountOutMin\n        subRoute.path.map((token) => token.wrapped.address), // path\n        payerIsUser && i === 0,\n      ])\n    } else {\n      throw new Error('Unexpected Pool Type')\n    }\n\n    // perform a token transition (wrap/unwrap if necessary)\n    if (!isLastSectionInRoute(i)) {\n      if (outputToken.isNative && !nextInputToken.isNative) {\n        planner.addCommand(CommandType.WRAP_ETH, [ROUTER_AS_RECIPIENT, CONTRACT_BALANCE])\n      } else if (!outputToken.isNative && nextInputToken.isNative) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, 0])\n      }\n    }\n\n    inputToken = nextInputToken\n  }\n}\n\n// if price impact is very high, there's a chance of hitting max/min prices resulting in a partial fill of the swap\nfunction riskOfPartialFill(trade: RouterTrade<Currency, Currency, TradeType>): boolean {\n  return trade.priceImpact.greaterThan(REFUND_ETH_PRICE_IMPACT_THRESHOLD)\n}\n\nfunction hasFeeOption(swapOptions: SwapOptions): boolean {\n  return !!swapOptions.fee || !!swapOptions.flatFee\n}\n","import { BigNumber } from 'ethers'\nimport JSBI from 'jsbi'\nimport bn from 'bignumber.js'\nimport { Percent } from '@uniswap/sdk-core'\nimport { toHex } from '@uniswap/v3-sdk'\n\nexport function expandTo18DecimalsBN(n: number): BigNumber {\n  // use bn intermediately to allow decimals in intermediate calculations\n  return BigNumber.from(new bn(n).times(new bn(10).pow(18)).toFixed())\n}\n\nexport function expandTo18Decimals(n: number): JSBI {\n  return JSBI.BigInt(BigNumber.from(n).mul(BigNumber.from(10).pow(18)).toString())\n}\n\nexport function encodeFeeBips(fee: Percent): string {\n  return toHex(fee.multiply(10_000).quotient)\n}\n","import invariant from 'tiny-invariant'\nimport { ethers } from 'ethers'\nimport { validateAndParseAddress, BigintIsh } from '@uniswap/sdk-core'\nimport { NFTPermitOptions, NonfungiblePositionManager } from '@uniswap/v3-sdk'\nimport { PermitSingle } from '@uniswap/permit2-sdk'\nimport { CommandType, RoutePlanner } from './routerCommands'\nimport { ROUTER_AS_RECIPIENT } from './constants'\n\nexport interface Permit2Permit extends PermitSingle {\n  signature: string\n}\n\nexport type ApproveProtocol = {\n  token: string\n  protocol: string\n}\n\nexport type Permit2TransferFrom = {\n  token: string\n  amount: string\n  recipient?: string\n}\n\nexport type InputTokenOptions = {\n  permit2Permit?: Permit2Permit\n  permit2TransferFrom?: Permit2TransferFrom\n}\n\nconst SIGNATURE_LENGTH = 65\nconst EIP_2098_SIGNATURE_LENGTH = 64\n\nexport function encodePermit(planner: RoutePlanner, permit2: Permit2Permit): void {\n  let signature = permit2.signature\n\n  const length = ethers.utils.arrayify(permit2.signature).length\n  // signature data provided for EIP-1271 may have length different from ECDSA signature\n  if (length === SIGNATURE_LENGTH || length === EIP_2098_SIGNATURE_LENGTH) {\n    // sanitizes signature to cover edge cases of malformed EIP-2098 sigs and v used as recovery id\n    signature = ethers.utils.joinSignature(ethers.utils.splitSignature(permit2.signature))\n  }\n\n  planner.addCommand(CommandType.PERMIT2_PERMIT, [permit2, signature])\n}\n\nexport function encodeV3PositionPermit(planner: RoutePlanner, permit: NFTPermitOptions, tokenId: BigintIsh): void {\n  const calldata = NonfungiblePositionManager.INTERFACE.encodeFunctionData('permit', [\n    validateAndParseAddress(permit.spender),\n    tokenId,\n    permit.deadline,\n    permit.v,\n    permit.r,\n    permit.s,\n  ])\n\n  planner.addCommand(CommandType.V3_POSITION_MANAGER_PERMIT, [calldata])\n}\n\n// Handles the encoding of commands needed to gather input tokens for a trade\n// Approval: The router approving another address to take tokens.\n//   note: Only seaport and sudoswap support this action. Approvals are left open.\n// Permit: A Permit2 signature-based Permit to allow the router to access a user's tokens\n// Transfer: A Permit2 TransferFrom of tokens from a user to either the router or another address\nexport function encodeInputTokenOptions(planner: RoutePlanner, options: InputTokenOptions) {\n  // first ensure that all tokens provided for encoding are the same\n  if (!!options.permit2TransferFrom && !!options.permit2Permit)\n    invariant(options.permit2TransferFrom.token === options.permit2Permit.details.token, `inconsistent token`)\n\n  // if this order has a options.permit2Permit, encode it\n  if (!!options.permit2Permit) {\n    encodePermit(planner, options.permit2Permit)\n  }\n\n  if (!!options.permit2TransferFrom) {\n    planner.addCommand(CommandType.PERMIT2_TRANSFER_FROM, [\n      options.permit2TransferFrom.token,\n      options.permit2TransferFrom.recipient ? options.permit2TransferFrom.recipient : ROUTER_AS_RECIPIENT,\n      options.permit2TransferFrom.amount,\n    ])\n  }\n}\n","import invariant from 'tiny-invariant'\nimport UniversalRouter from '@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json'\nimport { Interface } from '@ethersproject/abi'\nimport { BigNumber, BigNumberish } from 'ethers'\nimport {\n  MethodParameters,\n  Multicall,\n  Position as V3Position,\n  NonfungiblePositionManager as V3PositionManager,\n  RemoveLiquidityOptions as V3RemoveLiquidityOptions,\n} from '@uniswap/v3-sdk'\nimport {\n  Position as V4Position,\n  V4PositionManager,\n  AddLiquidityOptions as V4AddLiquidityOptions,\n  MintOptions,\n  Pool as V4Pool,\n  PoolKey,\n} from '@uniswap/v4-sdk'\nimport { Trade as RouterTrade } from '@uniswap/router-sdk'\nimport { Currency, TradeType, Percent, CHAIN_TO_ADDRESSES_MAP, SupportedChainsType } from '@uniswap/sdk-core'\nimport { UniswapTrade, SwapOptions } from './entities/actions/uniswap'\nimport { RoutePlanner, CommandType } from './utils/routerCommands'\nimport { encodePermit, encodeV3PositionPermit } from './utils/inputTokens'\nimport { UNIVERSAL_ROUTER_ADDRESS, UniversalRouterVersion } from './utils/constants'\n\nexport type SwapRouterConfig = {\n  sender?: string // address\n  deadline?: BigNumberish\n}\n\nexport interface MigrateV3ToV4Options {\n  inputPosition: V3Position\n  outputPosition: V4Position\n  v3RemoveLiquidityOptions: V3RemoveLiquidityOptions\n  v4AddLiquidityOptions: V4AddLiquidityOptions\n}\n\nfunction isMint(options: V4AddLiquidityOptions): options is MintOptions {\n  return Object.keys(options).some((k) => k === 'recipient')\n}\n\nexport abstract class SwapRouter {\n  public static INTERFACE: Interface = new Interface(UniversalRouter.abi)\n\n  public static swapCallParameters(\n    trades: RouterTrade<Currency, Currency, TradeType>,\n    options: SwapOptions\n  ): MethodParameters {\n    // TODO: use permit if signature included in swapOptions\n    const planner = new RoutePlanner()\n\n    const trade: UniswapTrade = new UniswapTrade(trades, options)\n\n    const inputCurrency = trade.trade.inputAmount.currency\n    invariant(!(inputCurrency.isNative && !!options.inputTokenPermit), 'NATIVE_INPUT_PERMIT')\n\n    if (options.inputTokenPermit) {\n      encodePermit(planner, options.inputTokenPermit)\n    }\n\n    const nativeCurrencyValue = inputCurrency.isNative\n      ? BigNumber.from(trade.trade.maximumAmountIn(options.slippageTolerance).quotient.toString())\n      : BigNumber.from(0)\n\n    trade.encode(planner, { allowRevert: false })\n    return SwapRouter.encodePlan(planner, nativeCurrencyValue, {\n      deadline: options.deadlineOrPreviousBlockhash ? BigNumber.from(options.deadlineOrPreviousBlockhash) : undefined,\n    })\n  }\n\n  /**\n   * Builds the call parameters for a migration from a V3 position to a V4 position.\n   * Some requirements of the parameters:\n   *   - v3RemoveLiquidityOptions.collectOptions.recipient must equal v4PositionManager\n   *   - v3RemoveLiquidityOptions.liquidityPercentage must be 100%\n   *   - input pool and output pool must have the same tokens\n   *   - V3 NFT must be approved, or valid inputV3NFTPermit must be provided with UR as spender\n   */\n  public static migrateV3ToV4CallParameters(\n    options: MigrateV3ToV4Options,\n    positionManagerOverride?: string\n  ): MethodParameters {\n    const v4Pool: V4Pool = options.outputPosition.pool\n    const v3Token0 = options.inputPosition.pool.token0\n    const v3Token1 = options.inputPosition.pool.token1\n    const v4PositionManagerAddress =\n      positionManagerOverride ?? CHAIN_TO_ADDRESSES_MAP[v4Pool.chainId as SupportedChainsType].v4PositionManagerAddress\n\n    // owner of the v3 nft must be the receiver of the v4 nft\n\n    // validate the parameters\n    if (v4Pool.currency0.isNative) {\n      invariant(\n        (v4Pool.currency0.wrapped.equals(v3Token0) && v4Pool.currency1.equals(v3Token1)) ||\n          (v4Pool.currency0.wrapped.equals(v3Token1) && v4Pool.currency1.equals(v3Token0)),\n        'TOKEN_MISMATCH'\n      )\n    } else {\n      invariant(v3Token0 === v4Pool.token0, 'TOKEN0_MISMATCH')\n      invariant(v3Token1 === v4Pool.token1, 'TOKEN1_MISMATCH')\n    }\n\n    invariant(\n      options.v3RemoveLiquidityOptions.liquidityPercentage.equalTo(new Percent(100, 100)),\n      'FULL_REMOVAL_REQUIRED'\n    )\n    invariant(options.v3RemoveLiquidityOptions.burnToken == true, 'BURN_TOKEN_REQUIRED')\n    invariant(\n      options.v3RemoveLiquidityOptions.collectOptions.recipient === v4PositionManagerAddress,\n      'RECIPIENT_NOT_POSITION_MANAGER'\n    )\n    invariant(isMint(options.v4AddLiquidityOptions), 'MINT_REQUIRED')\n    invariant(options.v4AddLiquidityOptions.migrate, 'MIGRATE_REQUIRED')\n\n    const planner = new RoutePlanner()\n\n    // to prevent reentrancy by the pool hook, we initialize the v4 pool before moving funds\n    if (options.v4AddLiquidityOptions.createPool) {\n      const poolKey: PoolKey = V4Pool.getPoolKey(\n        v4Pool.currency0,\n        v4Pool.currency1,\n        v4Pool.fee,\n        v4Pool.tickSpacing,\n        v4Pool.hooks\n      )\n      planner.addCommand(CommandType.V4_INITIALIZE_POOL, [poolKey, v4Pool.sqrtRatioX96.toString()])\n      // remove createPool setting, so that it doesnt get encoded again later\n      delete options.v4AddLiquidityOptions.createPool\n    }\n\n    // add position permit to the universal router planner\n    if (options.v3RemoveLiquidityOptions.permit) {\n      // permit spender should be UR\n      const universalRouterAddress = UNIVERSAL_ROUTER_ADDRESS(\n        UniversalRouterVersion.V2_0,\n        options.inputPosition.pool.chainId as SupportedChainsType\n      )\n      invariant(universalRouterAddress == options.v3RemoveLiquidityOptions.permit.spender, 'INVALID_SPENDER')\n      // don't need to transfer it because v3posm uses isApprovedOrOwner()\n      encodeV3PositionPermit(planner, options.v3RemoveLiquidityOptions.permit, options.v3RemoveLiquidityOptions.tokenId)\n      // remove permit so that multicall doesnt add it again\n      delete options.v3RemoveLiquidityOptions.permit\n    }\n\n    // encode v3 withdraw\n    const v3RemoveParams: MethodParameters = V3PositionManager.removeCallParameters(\n      options.inputPosition,\n      options.v3RemoveLiquidityOptions\n    )\n    const v3Calls: string[] = Multicall.decodeMulticall(v3RemoveParams.calldata)\n\n    for (const v3Call of v3Calls) {\n      // slice selector - 0x + 4 bytes = 10 characters\n      const selector = v3Call.slice(0, 10)\n      invariant(\n        selector == V3PositionManager.INTERFACE.getSighash('collect') ||\n          selector == V3PositionManager.INTERFACE.getSighash('decreaseLiquidity') ||\n          selector == V3PositionManager.INTERFACE.getSighash('burn'),\n        'INVALID_V3_CALL: ' + selector\n      )\n      planner.addCommand(CommandType.V3_POSITION_MANAGER_CALL, [v3Call])\n    }\n\n    // encode v4 mint\n    const v4AddParams = V4PositionManager.addCallParameters(options.outputPosition, options.v4AddLiquidityOptions)\n    // only modifyLiquidities can be called by the UniversalRouter\n    const selector = v4AddParams.calldata.slice(0, 10)\n    invariant(selector == V4PositionManager.INTERFACE.getSighash('modifyLiquidities'), 'INVALID_V4_CALL: ' + selector)\n\n    planner.addCommand(CommandType.V4_POSITION_MANAGER_CALL, [v4AddParams.calldata])\n\n    return SwapRouter.encodePlan(planner, BigNumber.from(0), {\n      deadline: BigNumber.from(options.v4AddLiquidityOptions.deadline),\n    })\n  }\n\n  /**\n   * Encodes a planned route into a method name and parameters for the Router contract.\n   * @param planner the planned route\n   * @param nativeCurrencyValue the native currency value of the planned route\n   * @param config the router config\n   */\n  private static encodePlan(\n    planner: RoutePlanner,\n    nativeCurrencyValue: BigNumber,\n    config: SwapRouterConfig = {}\n  ): MethodParameters {\n    const { commands, inputs } = planner\n    const functionSignature = !!config.deadline ? 'execute(bytes,bytes[],uint256)' : 'execute(bytes,bytes[])'\n    const parameters = !!config.deadline ? [commands, inputs, config.deadline] : [commands, inputs]\n    const calldata = SwapRouter.INTERFACE.encodeFunctionData(functionSignature, parameters)\n    return { calldata, value: nativeCurrencyValue.toHexString() }\n  }\n}\n","import { MixedRouteSDK, Trade as RouterTrade } from '@uniswap/router-sdk'\nimport { Currency, CurrencyAmount, Ether, Token, TradeType } from '@uniswap/sdk-core'\nimport { Pair, Route as V2Route } from '@uniswap/v2-sdk'\nimport { Pool as V3Pool, Route as V3Route, FeeAmount } from '@uniswap/v3-sdk'\nimport { Pool as V4Pool, Route as V4Route } from '@uniswap/v4-sdk'\nimport { BigNumber } from 'ethers'\nimport { ETH_ADDRESS, E_ETH_ADDRESS } from './constants'\n\nexport type TokenInRoute = {\n  address: string\n  chainId: number\n  symbol: string\n  decimals: string\n  name?: string\n  buyFeeBps?: string\n  sellFeeBps?: string\n}\n\nexport enum PoolType {\n  V2Pool = 'v2-pool',\n  V3Pool = 'v3-pool',\n  V4Pool = 'v4-pool',\n}\n\nexport type V2Reserve = {\n  token: TokenInRoute\n  quotient: string\n}\n\nexport type V2PoolInRoute = {\n  type: PoolType.V2Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  reserve0: V2Reserve\n  reserve1: V2Reserve\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type V3PoolInRoute = {\n  type: PoolType.V3Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  sqrtRatioX96: string\n  liquidity: string\n  tickCurrent: string\n  fee: string\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type V4PoolInRoute = {\n  type: PoolType.V4Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  fee: string\n  tickSpacing: string\n  hooks: string\n  liquidity: string\n  sqrtRatioX96: string\n  tickCurrent: string\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type PartialClassicQuote = {\n  // We need tokenIn/Out to support native currency\n  tokenIn: string\n  tokenOut: string\n  tradeType: TradeType\n  route: Array<(V4PoolInRoute | V3PoolInRoute | V2PoolInRoute)[]>\n}\n\ninterface RouteResult {\n  routev4: V4Route<Currency, Currency> | null\n  routev3: V3Route<Currency, Currency> | null\n  routev2: V2Route<Currency, Currency> | null\n  mixedRoute: MixedRouteSDK<Currency, Currency> | null\n  inputAmount: CurrencyAmount<Currency>\n  outputAmount: CurrencyAmount<Currency>\n}\n\nexport const isNativeCurrency = (address: string) =>\n  address.toLowerCase() === ETH_ADDRESS.toLowerCase() || address.toLowerCase() === E_ETH_ADDRESS.toLowerCase()\n\n// Helper class to convert routing-specific quote entities to RouterTrade entities\n// the returned RouterTrade can then be used to build the UniswapTrade entity in this package\nexport class RouterTradeAdapter {\n  // Generate a RouterTrade using fields from a classic quote response\n  static fromClassicQuote(quote: PartialClassicQuote) {\n    const { route, tokenIn, tokenOut } = quote\n\n    if (!route) throw new Error('Expected route to be present')\n    if (!route.length) throw new Error('Expected there to be at least one route')\n    if (route.some((r) => !r.length)) throw new Error('Expected all routes to have at least one pool')\n    const firstRoute = route[0]\n\n    const tokenInData = firstRoute[0].tokenIn\n    const tokenOutData = firstRoute[firstRoute.length - 1].tokenOut\n\n    if (!tokenInData || !tokenOutData) throw new Error('Expected both tokenIn and tokenOut to be present')\n    if (tokenInData.chainId !== tokenOutData.chainId)\n      throw new Error('Expected tokenIn and tokenOut to be have same chainId')\n\n    const parsedCurrencyIn = RouterTradeAdapter.toCurrency(isNativeCurrency(tokenIn), tokenInData)\n    const parsedCurrencyOut = RouterTradeAdapter.toCurrency(isNativeCurrency(tokenOut), tokenOutData)\n\n    const typedRoutes: RouteResult[] = route.map((subRoute) => {\n      const rawAmountIn = subRoute[0].amountIn\n      const rawAmountOut = subRoute[subRoute.length - 1].amountOut\n\n      if (!rawAmountIn || !rawAmountOut) {\n        throw new Error('Expected both raw amountIn and raw amountOut to be present')\n      }\n\n      const inputAmount = CurrencyAmount.fromRawAmount(parsedCurrencyIn, rawAmountIn)\n      const outputAmount = CurrencyAmount.fromRawAmount(parsedCurrencyOut, rawAmountOut)\n\n      const isOnlyV2 = RouterTradeAdapter.isVersionedRoute<V2PoolInRoute>(PoolType.V2Pool, subRoute)\n      const isOnlyV3 = RouterTradeAdapter.isVersionedRoute<V3PoolInRoute>(PoolType.V3Pool, subRoute)\n      const isOnlyV4 = RouterTradeAdapter.isVersionedRoute<V4PoolInRoute>(PoolType.V4Pool, subRoute)\n      return {\n        routev4: isOnlyV4\n          ? new V4Route(\n              (subRoute as V4PoolInRoute[]).map(RouterTradeAdapter.toV4Pool),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        routev3: isOnlyV3\n          ? new V3Route(\n              (subRoute as V3PoolInRoute[]).map(RouterTradeAdapter.toV3Pool),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        routev2: isOnlyV2\n          ? new V2Route(\n              (subRoute as V2PoolInRoute[]).map(RouterTradeAdapter.toPair),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        mixedRoute:\n          !isOnlyV4 && !isOnlyV3 && !isOnlyV2\n            ? new MixedRouteSDK(subRoute.map(RouterTradeAdapter.toPoolOrPair), parsedCurrencyIn, parsedCurrencyOut)\n            : null,\n        inputAmount,\n        outputAmount,\n      }\n    })\n\n    return new RouterTrade({\n      v2Routes: typedRoutes\n        .filter((route) => route.routev2)\n        .map((route) => ({\n          routev2: route.routev2 as V2Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      v3Routes: typedRoutes\n        .filter((route) => route.routev3)\n        .map((route) => ({\n          routev3: route.routev3 as V3Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      v4Routes: typedRoutes\n        .filter((route) => route.routev4)\n        .map((route) => ({\n          routev4: route.routev4 as V4Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      mixedRoutes: typedRoutes\n        .filter((route) => route.mixedRoute)\n        .map((route) => ({\n          mixedRoute: route.mixedRoute as MixedRouteSDK<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      tradeType: quote.tradeType,\n    })\n  }\n\n  private static toCurrency(isNative: boolean, token: TokenInRoute): Currency {\n    if (isNative) {\n      return Ether.onChain(token.chainId)\n    }\n    return this.toToken(token)\n  }\n\n  private static toPoolOrPair = (pool: V4PoolInRoute | V3PoolInRoute | V2PoolInRoute): V4Pool | V3Pool | Pair => {\n    switch (pool.type) {\n      case PoolType.V4Pool:\n        return RouterTradeAdapter.toV4Pool(pool)\n      case PoolType.V3Pool:\n        return RouterTradeAdapter.toV3Pool(pool)\n      case PoolType.V2Pool:\n        return RouterTradeAdapter.toPair(pool)\n      default:\n        throw new Error('Invalid pool type')\n    }\n  }\n\n  private static toToken(token: TokenInRoute): Token {\n    const { chainId, address, decimals, symbol, buyFeeBps, sellFeeBps } = token\n    return new Token(\n      chainId,\n      address,\n      parseInt(decimals.toString()),\n      symbol,\n      /* name */ undefined,\n      false,\n      buyFeeBps ? BigNumber.from(buyFeeBps) : undefined,\n      sellFeeBps ? BigNumber.from(sellFeeBps) : undefined\n    )\n  }\n\n  private static toV3Pool({ fee, sqrtRatioX96, liquidity, tickCurrent, tokenIn, tokenOut }: V3PoolInRoute): V3Pool {\n    return new V3Pool(\n      RouterTradeAdapter.toToken(tokenIn),\n      RouterTradeAdapter.toToken(tokenOut),\n      parseInt(fee) as FeeAmount,\n      sqrtRatioX96,\n      liquidity,\n      parseInt(tickCurrent)\n    )\n  }\n\n  private static toV4Pool(pool: V4PoolInRoute): V4Pool {\n    const parsedCurrencyIn = RouterTradeAdapter.toCurrency(isNativeCurrency(pool.tokenIn.address), pool.tokenIn)\n    const parsedCurrencyOut = RouterTradeAdapter.toCurrency(isNativeCurrency(pool.tokenOut.address), pool.tokenOut)\n    return new V4Pool(\n      parsedCurrencyIn,\n      parsedCurrencyOut,\n      parseInt(pool.fee) as FeeAmount,\n      parseInt(pool.tickSpacing),\n      pool.hooks,\n      pool.sqrtRatioX96,\n      pool.liquidity,\n      parseInt(pool.tickCurrent)\n    )\n  }\n\n  private static toPair = ({ reserve0, reserve1 }: V2PoolInRoute): Pair => {\n    return new Pair(\n      CurrencyAmount.fromRawAmount(RouterTradeAdapter.toToken(reserve0.token), reserve0.quotient),\n      CurrencyAmount.fromRawAmount(RouterTradeAdapter.toToken(reserve1.token), reserve1.quotient)\n    )\n  }\n\n  private static isVersionedRoute<T extends V2PoolInRoute | V3PoolInRoute | V4PoolInRoute>(\n    type: PoolType,\n    route: (V3PoolInRoute | V2PoolInRoute | V4PoolInRoute)[]\n  ): route is T[] {\n    return route.every((pool) => pool.type === type)\n  }\n}\n","import invariant from 'tiny-invariant'\nimport { BigNumberish } from 'ethers'\nimport { RoutePlanner, CommandType } from '../../utils/routerCommands'\nimport { encodeInputTokenOptions, Permit2Permit } from '../../utils/inputTokens'\nimport { Command, RouterActionType, TradeConfig } from '../Command'\nimport { ROUTER_AS_RECIPIENT, WETH_ADDRESS } from '../../utils/constants'\n\nexport class UnwrapWETH implements Command {\n  readonly tradeType: RouterActionType = RouterActionType.UnwrapWETH\n  readonly permit2Data?: Permit2Permit\n  readonly wethAddress: string\n  readonly amount: BigNumberish\n\n  constructor(amount: BigNumberish, chainId: number, permit2?: Permit2Permit) {\n    this.wethAddress = WETH_ADDRESS(chainId)\n    this.amount = amount\n\n    if (!!permit2) {\n      invariant(\n        permit2.details.token.toLowerCase() === this.wethAddress.toLowerCase(),\n        `must be permitting WETH address: ${this.wethAddress}`\n      )\n      invariant(permit2.details.amount >= amount, `Did not permit enough WETH for unwrapWETH transaction`)\n      this.permit2Data = permit2\n    }\n  }\n\n  encode(planner: RoutePlanner, _: TradeConfig): void {\n    encodeInputTokenOptions(planner, {\n      permit2Permit: this.permit2Data,\n      permit2TransferFrom: {\n        token: this.wethAddress,\n        amount: this.amount.toString(),\n      },\n    })\n    planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, this.amount])\n  }\n}\n","import { ethers } from 'ethers'\nimport UniversalRouter from '@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json'\nimport { Interface } from '@ethersproject/abi'\nimport { V4BaseActionsParser, V4RouterAction } from '@uniswap/v4-sdk'\nimport { CommandType, CommandDefinition, COMMAND_DEFINITION, Subparser, Parser } from '../utils/routerCommands'\n\nexport type Param = {\n  readonly name: string\n  readonly value: any\n}\n\nexport type UniversalRouterCommand = {\n  readonly commandName: string\n  readonly commandType: CommandType\n  readonly params: readonly Param[]\n}\n\nexport type UniversalRouterCall = {\n  readonly commands: readonly UniversalRouterCommand[]\n}\n\nexport type V3PathItem = {\n  readonly tokenIn: string\n  readonly tokenOut: string\n  readonly fee: number\n}\n\nexport interface CommandsDefinition {\n  [key: number]: CommandDefinition\n}\n\n// Parses UniversalRouter V2 commands\nexport abstract class CommandParser {\n  public static INTERFACE: Interface = new Interface(UniversalRouter.abi)\n\n  public static parseCalldata(calldata: string): UniversalRouterCall {\n    const genericParser = new GenericCommandParser(COMMAND_DEFINITION)\n    const txDescription = CommandParser.INTERFACE.parseTransaction({ data: calldata })\n    const { commands, inputs } = txDescription.args\n    return genericParser.parse(commands, inputs)\n  }\n}\n\n// Parses commands based on given command definition\nexport class GenericCommandParser {\n  constructor(private readonly commandDefinition: CommandsDefinition) {}\n\n  public parse(commands: string, inputs: string[]): UniversalRouterCall {\n    const commandTypes = GenericCommandParser.getCommands(commands)\n\n    return {\n      commands: commandTypes.map((commandType: CommandType, i: number) => {\n        const commandDef = this.commandDefinition[commandType]\n\n        if (commandDef.parser === Parser.V4Actions) {\n          const { actions } = V4BaseActionsParser.parseCalldata(inputs[i])\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params: v4RouterCallToParams(actions),\n          }\n        } else if (commandDef.parser === Parser.Abi) {\n          const abiDef = commandDef.params\n          const rawParams = ethers.utils.defaultAbiCoder.decode(\n            abiDef.map((command) => command.type),\n            inputs[i]\n          )\n\n          const params = rawParams.map((param: any, j: number) => {\n            switch (abiDef[j].subparser) {\n              case Subparser.V3PathExactIn:\n                return {\n                  name: abiDef[j].name,\n                  value: parseV3PathExactIn(param),\n                }\n              case Subparser.V3PathExactOut:\n                return {\n                  name: abiDef[j].name,\n                  value: parseV3PathExactOut(param),\n                }\n              default:\n                return {\n                  name: abiDef[j].name,\n                  value: param,\n                }\n            }\n          })\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params,\n          }\n        } else if (commandDef.parser === Parser.V3Actions) {\n          // TODO: implement better parsing here\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params: inputs.map((input) => ({ name: 'command', value: input })),\n          }\n        } else {\n          throw new Error(`Unsupported parser: ${commandDef}`)\n        }\n      }),\n    }\n  }\n\n  // parse command types from bytes string\n  private static getCommands(commands: string): CommandType[] {\n    const commandTypes: CommandType[] = []\n\n    for (let i = 2; i < commands.length; i += 2) {\n      const byte = commands.substring(i, i + 2)\n      commandTypes.push(parseInt(byte, 16) as CommandType)\n    }\n\n    return commandTypes\n  }\n}\n\nexport function parseV3PathExactIn(path: string): readonly V3PathItem[] {\n  const strippedPath = path.replace('0x', '')\n  let tokenIn = ethers.utils.getAddress(strippedPath.substring(0, 40))\n  let loc = 40\n  const res: V3PathItem[] = []\n  while (loc < strippedPath.length) {\n    const feeAndTokenOut = strippedPath.substring(loc, loc + 46)\n    const fee = parseInt(feeAndTokenOut.substring(0, 6), 16)\n    const tokenOut = ethers.utils.getAddress(feeAndTokenOut.substring(6, 46))\n\n    res.push({\n      tokenIn,\n      tokenOut,\n      fee,\n    })\n    tokenIn = tokenOut\n    loc += 46\n  }\n\n  return res\n}\n\nexport function parseV3PathExactOut(path: string): readonly V3PathItem[] {\n  const strippedPath = path.replace('0x', '')\n  let tokenIn = ethers.utils.getAddress(strippedPath.substring(strippedPath.length - 40))\n  let loc = strippedPath.length - 86 // 86 = (20 addr + 3 fee + 20 addr) * 2 (for hex characters)\n  const res: V3PathItem[] = []\n  while (loc >= 0) {\n    const feeAndTokenOut = strippedPath.substring(loc, loc + 46)\n    const tokenOut = ethers.utils.getAddress(feeAndTokenOut.substring(0, 40))\n    const fee = parseInt(feeAndTokenOut.substring(40, 46), 16)\n\n    res.push({\n      tokenIn,\n      tokenOut,\n      fee,\n    })\n    tokenIn = tokenOut\n\n    loc -= 46\n  }\n\n  return res\n}\n\nfunction v4RouterCallToParams(actions: readonly V4RouterAction[]): readonly Param[] {\n  return actions.map((action) => {\n    return {\n      name: action.actionName,\n      value: action.params.map((param) => {\n        return {\n          name: param.name,\n          value: param.value,\n        }\n      }),\n    }\n  })\n}\n"],"names":["CommandType","Subparser","Parser","RouterActionType","UniversalRouterVersion","REVERTIBLE_COMMANDS","Set","EXECUTE_SUB_PLAN","COMMAND_DEFINITION","_COMMAND_DEFINITION","parser","Abi","params","name","type","PERMIT2_PERMIT","PERMIT2_PERMIT_BATCH","PERMIT2_TRANSFER_FROM","PERMIT2_TRANSFER_FROM_BATCH","PERMIT2_TRANSFER_FROM_STRUCT","V3_SWAP_EXACT_IN","subparser","V3PathExactIn","V3_SWAP_EXACT_OUT","V3PathExactOut","V2_SWAP_EXACT_IN","V2_SWAP_EXACT_OUT","V4_SWAP","V4Actions","WRAP_ETH","UNWRAP_WETH","SWEEP","TRANSFER","PAY_PORTION","BALANCE_CHECK_ERC20","V4_INITIALIZE_POOL","V3_POSITION_MANAGER_PERMIT","V3Actions","V3_POSITION_MANAGER_CALL","V4_POSITION_MANAGER_CALL","RoutePlanner","this","commands","inputs","_proto","prototype","addSubPlan","subplan","addCommand","parameters","allowRevert","command","commandDef","encodedInput","defaultAbiCoder","encode","map","abi","createCommand","push","has","Error","concat","toString","padStart","getPathCurrency","currency","pool","involvesToken","wrapped","V4Pool","token0","equals","token1","symbol","CHAIN_CONFIGS","_CHAIN_CONFIGS","weth","routerConfigs","_routerConfigs","V1_2","address","creationBlock","V2_0","_routerConfigs2","_routerConfigs3","_routerConfigs4","_routerConfigs5","_routerConfigs6","_routerConfigs7","_routerConfigs8","_routerConfigs9","_routerConfigs0","_routerConfigs1","_routerConfigs10","_routerConfigs11","_routerConfigs12","_routerConfigs13","_routerConfigs14","_routerConfigs15","_routerConfigs16","_routerConfigs17","_routerConfigs18","_routerConfigs19","_routerConfigs20","_routerConfigs21","_routerConfigs22","_routerConfigs23","_routerConfigs24","UNIVERSAL_ROUTER_ADDRESS","version","chainId","WETH_ADDRESS","CONTRACT_BALANCE","BigNumber","from","pow","ETH_ADDRESS","SENDER_AS_RECIPIENT","ROUTER_AS_RECIPIENT","getCurrencyAddress","isNative","REFUND_ETH_PRICE_IMPACT_THRESHOLD","Percent","UniswapTrade","trade","options","fee","flatFee","payerIsUser","inputRequiresWrap","inputRequiresUnwrap","useRouterBalance","planner","_config","maximumAmountIn","slippageTolerance","quotient","inputAmount","recipient","_this$options$recipie","swapOptions","_step","routerMustCustody","tradeType","TradeType","EXACT_INPUT","routes","length","outputRequiresTransition","_iterator","_createForOfIteratorHelperLoose","swaps","done","swap","value","route","protocol","Protocol","V2","addV2Swap","V3","addV3Swap","V4","addV4Swap","MIXED","addMixedSwap","minimumAmountOut","pools","pathOutputCurrencyAddress","outputAmount","feeBips","toHex","multiply","EXACT_OUTPUT","sub","mul","div","feeAmount","amount","lt","outputRequiresUnwrap","outputRequiresWrap","priceImpact","greaterThan","safeMode","key","get","_step2","result","_iterator2","pathInput","lastRoute","lastPool","pathOutput","currency1","currency0","poolBefore","_ref","V2Trade","path","token","_ref2","V3Trade","createUncheckedTrade","encodeRouteToPath","_ref3","p","v4Route","V4Route","V4Trade","slippageToleranceOnSwap","undefined","v4Planner","V4Planner","addTrade","addSettle","pathOutputForTake","addTake","_options$recipient","finalize","tradeRecipient","_options$recipient2","V3Pool","Pair","MixedRouteTrade","amountIn","amountOut","sections","partitionMixedRouteByProtocol","isLastSectionInRoute","i","inputToken","section","routePool","outputToken","getOutputOfPools","subRoute","MixedRoute","MixedRouteSDK","nextInputToken","swapRecipient","nextPool","liquidityToken","v4SubRoute","input","output","addAction","Actions","SWAP_EXACT_IN","currencyIn","encodeV4RouteToPath","amountOutMinimum","outputTokenForTake","ethWethPool","encodeMixedRouteToPath","encodePermit","permit2","signature","ethers","utils","arrayify","joinSignature","splitSignature","SwapRouter","swapCallParameters","trades","inputCurrency","inputTokenPermit","invariant","nativeCurrencyValue","encodePlan","deadline","deadlineOrPreviousBlockhash","migrateV3ToV4CallParameters","positionManagerOverride","v4Pool","outputPosition","v3Token0","inputPosition","v3Token1","v4PositionManagerAddress","CHAIN_TO_ADDRESSES_MAP","v3RemoveLiquidityOptions","liquidityPercentage","equalTo","burnToken","collectOptions","Object","keys","some","k","isMint","v4AddLiquidityOptions","migrate","createPool","poolKey","getPoolKey","tickSpacing","hooks","sqrtRatioX96","permit","spender","tokenId","calldata","NonfungiblePositionManager","INTERFACE","encodeFunctionData","validateAndParseAddress","v","r","s","encodeV3PositionPermit","v3RemoveParams","V3PositionManager","removeCallParameters","Multicall","decodeMulticall","v3Call","selector","slice","getSighash","v4AddParams","V4PositionManager","addCallParameters","config","toHexString","Interface","UniversalRouter","PoolType","UnwrapWETH","wethAddress","details","toLowerCase","permit2Data","_","permit2TransferFrom","permit2Permit","encodeInputTokenOptions","isNativeCurrency","RouterTradeAdapter","fromClassicQuote","quote","tokenIn","tokenOut","firstRoute","tokenInData","tokenOutData","parsedCurrencyIn","toCurrency","parsedCurrencyOut","typedRoutes","rawAmountIn","rawAmountOut","CurrencyAmount","fromRawAmount","isOnlyV2","isVersionedRoute","V2Pool","isOnlyV3","isOnlyV4","routev4","toV4Pool","routev3","V3Route","toV3Pool","routev2","V2Route","toPair","mixedRoute","toPoolOrPair","RouterTrade","v2Routes","filter","v3Routes","v4Routes","mixedRoutes","Ether","onChain","toToken","buyFeeBps","sellFeeBps","Token","parseInt","decimals","liquidity","tickCurrent","every","reserve0","reserve1","CommandParser","parseCalldata","genericParser","GenericCommandParser","_txDescription$args","parseTransaction","data","args","parse","commandDefinition","getCommands","commandType","actions","_this","_V4BaseActionsParser$","V4BaseActionsParser","commandName","action","actionName","param","abiDef","decode","j","parseV3PathExactIn","parseV3PathExactOut","commandTypes","byte","substring","strippedPath","replace","getAddress","loc","res","feeAndTokenOut"],"mappings":"gJAOYA,EA0BAC,EAKAC,+9CA/BAF,EAAAA,sBAAAA,kEAEVA,6CACAA,qDACAA,mDACAA,qBACAA,2BACAA,iCAEAA,2CACAA,6CACAA,wCACAA,4BACAA,kCACAA,kEACAA,kDAEAA,0BACAA,gEACAA,4DACAA,gDACAA,4DAEAA,6CAGUC,EAAAA,oBAAAA,0DAEVA,wCAGUC,EAAAA,iBAAAA,mCAEVA,6BACAA,6BAqBF,ICxDYC,wDCJAC,EF6DNC,EAAsB,IAAIC,IAAiB,CAACN,oBAAYO,mBAajDC,IAAkBC,MAE5BT,oBAAYO,kBAAmB,CAC9BG,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,WAAYC,KAAM,SAC1B,CAAED,KAAM,SAAUC,KAAM,aAE3BL,EAGAT,oBAAYe,gBAAiB,CAC5BL,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,SAAUC,KAxBtB,+GAyBI,CAAED,KAAM,YAAaC,KAAM,WAE9BL,EACAT,oBAAYgB,sBAAuB,CAClCN,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,SAAUC,KA5BtB,iHA6BI,CAAED,KAAM,YAAaC,KAAM,WAE9BL,EACAT,oBAAYiB,uBAAwB,CACnCP,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,QAASC,KAAM,WACvB,CAAED,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,SAAUC,KAAM,aAE3BL,EACAT,oBAAYkB,6BAA8B,CACzCR,OAAQR,eAAOS,IACfC,OAAQ,CACN,CACEC,KAAM,eACNC,KAxCmCK,8DA2CxCV,EAGAT,oBAAYoB,kBAAmB,CAC9BV,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,WAAYC,KAAM,WAC1B,CAAED,KAAM,eAAgBC,KAAM,WAC9B,CAAED,KAAM,OAAQQ,UAAWpB,kBAAUqB,cAAeR,KAAM,SAC1D,CAAED,KAAM,cAAeC,KAAM,UAEhCL,EACAT,oBAAYuB,mBAAoB,CAC/Bb,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,cAAeC,KAAM,WAC7B,CAAED,KAAM,OAAQQ,UAAWpB,kBAAUuB,eAAgBV,KAAM,SAC3D,CAAED,KAAM,cAAeC,KAAM,UAEhCL,EACAT,oBAAYyB,kBAAmB,CAC9Bf,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,WAAYC,KAAM,WAC1B,CAAED,KAAM,eAAgBC,KAAM,WAC9B,CAAED,KAAM,OAAQC,KAAM,aACtB,CAAED,KAAM,cAAeC,KAAM,UAEhCL,EACAT,oBAAY0B,mBAAoB,CAC/BhB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,cAAeC,KAAM,WAC7B,CAAED,KAAM,OAAQC,KAAM,aACtB,CAAED,KAAM,cAAeC,KAAM,UAEhCL,EACAT,oBAAY2B,SAAU,CAAEjB,OAAQR,eAAO0B,WAAWnB,EAGlDT,oBAAY6B,UAAW,CACtBnB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,SAAUC,KAAM,aAE3BL,EACAT,oBAAY8B,aAAc,CACzBpB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,YAAaC,KAAM,aAE9BL,EACAT,oBAAY+B,OAAQ,CACnBrB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,QAASC,KAAM,WACvB,CAAED,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,YAAaC,KAAM,aAE9BL,EACAT,oBAAYgC,UAAW,CACtBtB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,QAASC,KAAM,WACvB,CAAED,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,QAASC,KAAM,aAE1BL,EACAT,oBAAYiC,aAAc,CACzBvB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,QAASC,KAAM,WACvB,CAAED,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,OAAQC,KAAM,aAEzBL,EACAT,oBAAYkC,qBAAsB,CACjCxB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,QAASC,KAAM,WACvB,CAAED,KAAM,QAASC,KAAM,WACvB,CAAED,KAAM,aAAcC,KAAM,aAE/BL,EACAT,oBAAYmC,oBAAqB,CAChCzB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,UAAWC,KA7ID,oFA8IlB,CAAED,KAAM,eAAgBC,KAAM,aAEjCL,EAGAT,oBAAYoC,4BAA6B,CAAE1B,OAAQR,eAAOmC,WAAW5B,EACrET,oBAAYsC,0BAA2B,CAAE5B,OAAQR,eAAOmC,WAAW5B,EACnET,oBAAYuC,0BAA2B,CAAE7B,OAAQR,eAAO0B,WAAWnB,GAGzD+B,aAIX,SAAAA,IACEC,KAAKC,SAAW,KAChBD,KAAKE,OAAS,GACf,IAAAC,EAAAJ,EAAAK,UAmBA,OAnBAD,EAEDE,WAAA,SAAWC,GAET,OADAN,KAAKO,WAAWhD,oBAAYO,iBAAkB,CAACwC,EAAQL,SAAUK,EAAQJ,SAAS,GAC3EF,MACRG,EAEDI,WAAA,SAAWlC,EAAmBmC,EAAmBC,YAAAA,IAAAA,GAAc,GAC7D,IAAIC,WAmBsBrC,EAAmBmC,GAC/C,IAAMG,EAAa5C,EAAmBM,GACtC,OAAQsC,EAAW1C,QACjB,KAAKR,eAAOS,IAKV,MAAO,CAAEG,KAAAA,EAAMuC,aAJMC,kBAAgBC,OACnCH,EAAWxC,OAAO4C,KAAI,SAACC,GAAG,OAAKA,EAAI3C,QACnCmC,IAGJ,KAAK/C,eAAO0B,UAGZ,KAAK1B,eAAOmC,UAEV,MAAO,CAAEvB,KAAAA,EAAMuC,aAAcJ,EAAW,KAjC5BS,CAAc5C,EAAMmC,GAElC,GADAR,KAAKE,OAAOgB,KAAKR,EAAQE,cACrBH,EAAa,CACf,IAAK7C,EAAoBuD,IAAIT,EAAQrC,MACnC,MAAM,IAAI+C,uBAAuBV,EAAQrC,qCAE3CqC,EAAQrC,KAtLY,IAsLLqC,EAAQrC,KAIzB,OADA2B,KAAKC,SAAWD,KAAKC,SAASoB,OAAOX,EAAQrC,KAAKiD,SAAS,IAAIC,SAAS,EAAG,MACpEvB,MACRD,cGrPayB,EAAgBC,EAAoBC,GAElD,GAAIA,EAAKC,cAAcF,GACrB,OAAOA,EAGF,GAAIC,EAAKC,cAAcF,EAASG,SACrC,OAAOH,EAASG,QAGX,GAAIF,aAAgBG,QAAUH,EAAKI,OAAOF,QAAQG,OAAON,GAC9D,OAAOC,EAAKI,OACP,GAAIJ,aAAgBG,QAAUH,EAAKM,OAAOJ,QAAQG,OAAON,GAC9D,OAAOC,EAAKM,OAEZ,MAAM,IAAIZ,2BAA2BK,EAASQ,wBAAuBP,EAAKI,OAAOG,cAAaP,EAAKM,OAAOC,SFblGvE,EAAAA,2BAAAA,0DAEVA,2BCNUC,EAAAA,iCAAAA,+CAEVA,aAaF,IAGauE,IAAaC,MAEvB,GAAI,CACHC,KAAM,6CACNC,eAAaC,KAAAA,EACV3E,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,UAChBH,EACA3E,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,YAChBH,IAEJH,EAEA,GAAI,CACHC,KAAM,6CACNC,eAAaM,KAAAA,EACVhF,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,SAChBE,EACAhF,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,SAChBE,IAEJR,EAEA,UAAW,CACVC,KAAM,6CACNC,eAAaO,KAAAA,EACVjF,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,SAChBG,EACAjF,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,SAChBG,IAEJT,EAEA,KAAM,CACLC,KAAM,6CACNC,eAAaQ,KAAAA,EACVlF,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,UAChBI,EACAlF,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,YAChBI,IAEJV,EAEA,OAAQ,CACPC,KAAM,6CACNC,eAAaS,KAAAA,EACVnF,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,UAChBK,EACAnF,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,UAChBK,IAEJX,EAEA,IAAK,CACJC,KAAM,6CACNC,eAAaU,KAAAA,EACVpF,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,WAChBM,EACApF,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,YAChBM,IAEJZ,EAEA,KAAM,CACLC,KAAM,6CACNC,eAAaW,KAAAA,EACVrF,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,SAChBO,EACArF,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,SAChBO,IAEJb,EAEA,OAAQ,CACPC,KAAM,6CACNC,eAAaY,KAAAA,EACVtF,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,WAChBQ,EACAtF,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,YAChBQ,IAEJd,EAEA,QAAS,CACRC,KAAM,6CACNC,eAAaa,KAAAA,EACVvF,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,UAChBS,EACAvF,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,UAChBS,IAEJf,EAEA,OAAQ,CACPC,KApIgC,6CAqIhCC,eAAac,KAAAA,EACVxF,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,UAChBU,EACAxF,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,UAChBU,IAEJhB,EAEA,OAAQ,CACPC,KAlJgC,6CAmJhCC,eAAae,KAAAA,EACVzF,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,UAChBW,EACAzF,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,UAChBW,IAEJjB,EAEA,IAAK,CACJC,KAAM,6CACNC,eAAagB,KAAAA,EACV1F,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,UAChBY,EACA1F,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,YAChBY,IAEJlB,EAEA,OAAQ,CACPC,KAAM,6CACNC,eAAaiB,KAAAA,EACV3F,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,UAChBa,EACA3F,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,YAChBa,IAEJnB,EAEA,OAAQ,CACPC,KAAM,6CACNC,eAAakB,KAAAA,EACV5F,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,SAChBc,EACA5F,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,SAChBc,IAEJpB,EAEA,MAAO,CACNC,KAAM,6CACNC,eAAamB,KAAAA,EACV7F,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,SAChBe,EACA7F,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,YAChBe,IAEJrB,EAEA,OAAQ,CACPC,KAAM,6CACNC,eAAaoB,KAAAA,EACV9F,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,SAChBgB,EACA9F,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,YAChBgB,IAEJtB,EAEA,SAAU,CACTC,KAAM,6CACNC,eAAaqB,KAAAA,EACV/F,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,UAChBiB,EACA/F,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,YAChBiB,IAEJvB,EACA,KAAM,CACLC,KAAM,6CACNC,eAAasB,KAAAA,EACVhG,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,UAChBkB,EACAhG,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,UAChBkB,IAEJxB,EAEA,KAAM,CACLC,KAAM,6CACNC,eAAauB,KAAAA,EACVjG,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,SAChBmB,EACAjG,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,YAChBmB,IAEJzB,EACA,MAAO,CACNC,KAAM,6CACNC,eAAawB,KAAAA,EACVlG,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,SAChBoB,EACAlG,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,SAChBoB,IAEJ1B,EAEA,KAAM,CACLC,KAAM,6CACNC,eAAayB,KAAAA,EACVnG,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,OAChBqB,EACAnG,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,YAChBqB,IAEJ3B,EACA,OAAQ,CACPC,KAAM,6CACNC,eAAa0B,KAAAA,EACVpG,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,OAChBsB,EACApG,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,OAChBsB,IAEJ5B,EACA,OAAQ,CACPC,KAAM,6CACNC,eAAa2B,KAAAA,EACVrG,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,UAChBuB,EACArG,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,UAChBuB,IAEJ7B,EACA,MAAO,CACNC,KAAM,6CACNC,eAAa4B,KAAAA,EACVtG,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,SAChBwB,EACAtG,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,SAChBwB,IAEJ9B,EACA,KAAM,CACLC,KAAM,6CACNC,eAAa6B,KAAAA,EACVvG,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,UAChByB,EACAvG,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,UAChByB,IAEJ/B,EACA,KAAM,CACLC,KAAM,6CACNC,eAAa8B,KAAAA,EACVxG,+BAAuB4E,MAAO,CAC7BC,QAAS,6CACTC,cAAe,GAChB0B,EACAxG,+BAAuB+E,MAAO,CAC7BF,QAAS,6CACTC,cAAe,UAChB0B,IAEJhC,GAGUiC,EAA2B,SAACC,EAAiCC,GACxE,KAAMA,KAAWpC,GAAgB,MAAM,IAAId,gDAAgDkD,GAC3F,OAAOpC,EAAcoC,GAASjC,cAAcgC,GAAS7B,SAQ1C+B,EAAe,SAACD,GAC3B,KAAMA,KAAWpC,GAAgB,MAAM,IAAId,gDAAgDkD,GAE3F,GAxXkC,8CAwX9BpC,EAAcoC,GAASlC,KAAqC,MAAM,IAAIhB,eAAekD,yBAEzF,OAAOpC,EAAcoC,GAASlC,MAGnBoC,GAAmBC,YAAUC,KAAK,GAAGC,IAAI,KACzCC,GAAc,6CAMdC,GAAsB,6CACtBC,GAAsB,sDEnZnBC,GAAmBtD,GACjC,OAAOA,EAASuD,SAAWJ,GAAcnD,EAASG,QAAQY,YC+CtDyC,GAAoC,IAAIC,UAAQ,GAAI,KAU7CC,cAIX,SAAAA,EAAmBC,EAA0DC,GAC3E,GADiBrF,WAAAoF,EAA0DpF,aAAAqF,EAHpErF,eAA8BtC,yBAAiByH,aAIhDE,EAAQC,KAASD,EAAQE,QAAS,MAAM,IAAInE,MAAM,iCAGtDpB,KAAKwF,cADHxF,KAAKyF,mBAAqBzF,KAAK0F,qBAAuB1F,KAAKqF,QAAQM,kBAKxE,QAqOA,OArOAR,EAAA/E,UAkHDU,OAAA,SAAO8E,EAAuBC,SAExB7F,KAAKyF,kBAEPG,EAAQrF,WAAWhD,oBAAY6B,SAAU,CACvC0F,GACA9E,KAAKoF,MAAMU,gBAAgB9F,KAAKqF,QAAQU,mBAAmBC,SAAS1E,aAE7DtB,KAAK0F,sBAEdE,EAAQrF,WAAWhD,oBAAYiB,sBAAuB,CACnDwB,KAAKoF,MAAMa,YAAYxE,SAAmBe,QAC3CsC,GACA9E,KAAKoF,MAAMU,gBAAgB9F,KAAKqF,QAAQU,mBAAmBC,SAAS1E,aAEtEsE,EAAQrF,WAAWhD,oBAAY8B,YAAa,CAACyF,GAAqB,KAGpE9E,KAAKqF,QAAQa,iBAASC,EAAGnG,KAAKqF,QAAQa,WAASC,EAAItB,GAWnD,IALA,IAwWkBuB,EAnWiBC,EAH7BC,EADJtG,KAAKoF,MAAMmB,YAAcC,YAAUC,aAAezG,KAAKoF,MAAMsB,OAAOC,OAAS,GAE3C3G,KAAK4G,6BAqWvBR,EArWgEpG,KAAKqF,SAsWpEC,OAASc,EAAYb,QApWxCsB,EAAAC,EAAmB9G,KAAKoF,MAAM2B,SAAKV,EAAAQ,KAAAG,MAAE,CAAA,IAA1BC,EAAIZ,EAAAa,MACb,OAAQD,EAAKE,MAAMC,UACjB,KAAKC,WAASC,GACZC,GAAU3B,EAASqB,EAAMjH,KAAKoF,MAAMmB,UAAWvG,KAAKqF,QAASrF,KAAKwF,YAAac,GAC/E,MACF,KAAKe,WAASG,GACZC,GAAU7B,EAASqB,EAAMjH,KAAKoF,MAAMmB,UAAWvG,KAAKqF,QAASrF,KAAKwF,YAAac,GAC/E,MACF,KAAKe,WAASK,GACZC,GAAU/B,EAASqB,EAAMjH,KAAKoF,MAAMmB,UAAWvG,KAAKqF,QAASrF,KAAKwF,YAAac,GAC/E,MACF,KAAKe,WAASO,MACZC,GAAajC,EAASqB,EAAMjH,KAAKoF,MAAMmB,UAAWvG,KAAKqF,QAASrF,KAAKwF,YAAac,GAClF,MACF,QACE,MAAM,IAAIlF,MAAM,+BAItB,IAAI0G,EAA8BrD,YAAUC,KAC1C1E,KAAKoF,MAAM0C,iBAAiB9H,KAAKqF,QAAQU,mBAAmBC,SAAS1E,YAGvE,GAAIgF,EAAmB,CACrB,IAAMyB,EAAQ/H,KAAKoF,MAAM2B,MAAM,GAAGI,MAAMY,MAClCC,EAA4BjD,GAChCvD,EAAgBxB,KAAKoF,MAAM6C,aAAaxG,SAAUsG,EAAMA,EAAMpB,OAAS,KAKzE,GAAM3G,KAAKqF,QAAQC,IAAK,CACtB,IAAM4C,ECxOLC,QDwO6BnI,KAAKqF,QAAQC,IAAIA,ICxOpC8C,SAAS,KAAQpC,UDyO5BJ,EAAQrF,WAAWhD,oBAAYiC,YAAa,CAACwI,EAA2BhI,KAAKqF,QAAQC,IAAIY,UAAWgC,IAIhGlI,KAAKoF,MAAMmB,YAAcC,YAAU6B,eACrCP,EAAmBA,EAAiBQ,IAAIR,EAAiBS,IAAIL,GAASM,IAAI,OAM9E,GAAMxI,KAAKqF,QAAQE,QAAS,CAC1B,IAAMkD,EAAYzI,KAAKqF,QAAQE,QAAQmD,OACvC,GAAIZ,EAAiBa,GAAGF,GAAY,MAAM,IAAIrH,MAAM,iDAEpDwE,EAAQrF,WAAWhD,oBAAYgC,SAAU,CAACyI,EAA2BhI,KAAKqF,QAAQE,QAAQW,UAAWuC,IAIjGzI,KAAKoF,MAAMmB,YAAcC,YAAU6B,eACrCP,EAAmBA,EAAiBQ,IAAIG,IAMxCzI,KAAK4I,qBACPhD,EAAQrF,WAAWhD,oBAAY8B,YAAa,CAACW,KAAKqF,QAAQa,UAAW4B,IAC5D9H,KAAK6I,mBACdjD,EAAQrF,WAAWhD,oBAAY6B,SAAU,CAACY,KAAKqF,QAAQa,UAAW1B,KAElEoB,EAAQrF,WAAWhD,oBAAY+B,MAAO,CACpCyF,GAAmB/E,KAAKoF,MAAM6C,aAAaxG,UAC3CzB,KAAKqF,QAAQa,UACb4B,KAOF9H,KAAKoF,MAAMmB,YAAcC,YAAU6B,cAAkCrI,KAAKoF,MAsRnE0D,YAAYC,YAAY9D,OArR7BjF,KAAKyF,kBACPG,EAAQrF,WAAWhD,oBAAY8B,YAAa,CAACW,KAAKqF,QAAQa,UAAW,IAC5DlG,KAAK0F,oBACdE,EAAQrF,WAAWhD,oBAAY6B,SAAU,CAACY,KAAKqF,QAAQa,UAAW1B,KACzDxE,KAAKoF,MAAMa,YAAYxE,SAASuD,UAEzCY,EAAQrF,WAAWhD,oBAAY+B,MAAO,CAACsF,GAAa5E,KAAKqF,QAAQa,UAAW,KAI5ElG,KAAKqF,QAAQ2D,UAAUpD,EAAQrF,WAAWhD,oBAAY+B,MAAO,CAACsF,GAAa5E,KAAKqF,QAAQa,UAAW,OACxGf,OAAA8D,cAAAC,IAnOD,WAEE,IADA,IACmCC,EAD/BC,GAAS,EACbC,EAAAvC,EAAmB9G,KAAKoF,MAAM2B,SAAKoC,EAAAE,KAAArC,MACjCoC,EAASA,GADID,EAAAjC,MACWC,MAAMC,UAAYC,WAASK,GAErD,OAAO0B,KASTH,wBAAAC,IACA,WAKE,OAJalJ,KAAKoF,MAAM2B,MAAM,GACXI,MACKY,MAAM,aAELlG,OAGrB7B,KAAKoF,MAAMa,YAAYxE,SAASuD,WAC9BhF,KAAKoF,MAAM2B,MAAM,GAAGI,MAAiDmC,UAAUtE,SAI9EhF,KAAKoF,MAAMa,YAAYxE,SAASuD,YACxCiE,0BAAAC,IAED,WAKE,OAJalJ,KAAKoF,MAAM2B,MAAM,GACXI,MACKY,MAAM,aAELlG,SAGpB7B,KAAKoF,MAAMa,YAAYxE,SAASuD,UAChChF,KAAKoF,MAAM2B,MAAM,GAAGI,MAAiDmC,UAAUtE,YAKrFiE,yBAAAC,IAED,WACE,IACMK,EADOvJ,KAAKoF,MAAM2B,MAAM,GACPI,MACjBqC,EAAWD,EAAUxB,MAAMwB,EAAUxB,MAAMpB,OAAS,GAG1D,GAAI6C,aAAoB3H,SAEjB7B,KAAKoF,MAAM6C,aAAaxG,SAASuD,SAAU,CAC9C,GAAKuE,EAAqDE,WAAWzE,SAEnE,OAAO,EACF,GAAIwE,EAASE,UAAU3H,OAAOyH,EAASG,UAAU/H,UAAY2H,EAAUxB,MAAMpB,OAAS,EAAG,CAC9F,IAAIiD,EAAaL,EAAUxB,MAAMwB,EAAUxB,MAAMpB,OAAS,GAE1D,GACEiD,aAAsB/H,SACrB+H,EAAWD,UAAU5H,OAAOyH,EAASE,YAAcE,EAAWF,UAAU3H,OAAOyH,EAASE,YAEzF,OAAO,EACF,GAAIE,EAAW9H,OAAOC,OAAOyH,EAASE,YAAcE,EAAW5H,OAAOD,OAAOyH,EAASE,WAE3F,OAAO,GAOf,OAAO,KACRT,2BAAAC,IAED,WACE,IACMK,EADOvJ,KAAKoF,MAAM2B,MAAM,GACPI,MACjBqC,EAAWD,EAAUxB,MAAMwB,EAAUxB,MAAMpB,OAAS,GAG1D,OAAI6C,aAAoB3H,QAElB7B,KAAKoF,MAAM6C,aAAaxG,SAASuD,UAC7BhF,KAAKoF,MAAM2B,MAAM,GAAGI,MAAiDsC,WAAWzE,aAIpFuE,EAAUxB,MAAMpB,OAAS,GACzB4C,EAAUxB,MAAMwB,EAAUxB,MAAMpB,OAAS,aAAc9E,QACtD0H,EAAUxB,MAAMwB,EAAUxB,MAAMpB,OAAS,GAAcgD,UAAU3E,UAClEwE,EAASE,UAAU3H,OAAOyH,EAASG,UAAU/H,UAU5C5B,KAAKoF,MAAM6C,aAAaxG,SAASuD,YACzCiE,+BAAAC,IAED,WACE,OAAOlJ,KAAK6I,oBAAsB7I,KAAK4I,yQA0H3C,SAASrB,GACP3B,EAAqBiE,EAErBtD,EACAlB,EACAG,EACAc,OAJEa,EAAK0C,EAAL1C,MAMI/B,EAAQ,IAAI0E,QAChB3C,EACAZ,GAAaC,YAAUC,YARLoD,EAAX5D,YAAyB4D,EAAZ5B,aASpB1B,GAGEA,GAAaC,YAAUC,YACzBb,EAAQrF,WAAWhD,oBAAYyB,iBAAkB,CAE/CsH,EAAoBxB,GAAsBO,EAAQa,UAClDd,EAAMU,gBAAgBT,EAAQU,mBAAmBC,SAAS1E,WAE1DgF,EAAoB,EAAIlB,EAAM0C,iBAAiBzC,EAAQU,mBAAmBC,SAAS1E,WACnF6F,EAAM4C,KAAKhJ,KAAI,SAACiJ,GAAK,OAAKA,EAAMpI,QAAQY,WACxCgD,IAEOe,GAAaC,YAAU6B,cAChCzC,EAAQrF,WAAWhD,oBAAY0B,kBAAmB,CAChDqH,EAAoBxB,GAAsBO,EAAQa,UAClDd,EAAM0C,iBAAiBzC,EAAQU,mBAAmBC,SAAS1E,WAC3D8D,EAAMU,gBAAgBT,EAAQU,mBAAmBC,SAAS1E,WAC1D6F,EAAM4C,KAAKhJ,KAAI,SAACiJ,GAAK,OAAKA,EAAMpI,QAAQY,WACxCgD,IAMN,SAASiC,GACP7B,EAAqBqE,EAErB1D,EACAlB,EACAG,EACAc,OAJEa,EAAK8C,EAAL9C,MAMI/B,EAAQ8E,QAAQC,qBAAqB,CACzChD,MAAOA,EACPlB,YARkBgE,EAAXhE,YASPgC,aATgCgC,EAAZhC,aAUpB1B,UAAAA,IAGIwD,EAAOK,oBAAkBjD,EAAmC/B,EAAMmB,YAAcC,YAAU6B,cAC5F9B,GAAaC,YAAUC,YACzBb,EAAQrF,WAAWhD,oBAAYoB,iBAAkB,CAC/C2H,EAAoBxB,GAAsBO,EAAQa,UAClDd,EAAMU,gBAAgBT,EAAQU,mBAAmBC,SAAS1E,WAC1DgF,EAAoB,EAAIlB,EAAM0C,iBAAiBzC,EAAQU,mBAAmBC,SAAS1E,WACnFyI,EACAvE,IAEOe,GAAaC,YAAU6B,cAChCzC,EAAQrF,WAAWhD,oBAAYuB,kBAAmB,CAChDwH,EAAoBxB,GAAsBO,EAAQa,UAClDd,EAAM0C,iBAAiBzC,EAAQU,mBAAmBC,SAAS1E,WAC3D8D,EAAMU,gBAAgBT,EAAQU,mBAAmBC,SAAS1E,WAC1DyI,EACAvE,IAKN,SAASmC,GACP/B,EAAqByE,EAErB9D,EACAlB,EACAG,EACAc,SAJEL,EAAWoE,EAAXpE,YAAagC,EAAYoC,EAAZpC,aAOTF,EAP4BsC,EAALlD,MAOTY,MAAMhH,KAAI,SAACuJ,GAAC,OAAKA,KAC/BC,EAAU,IAAIC,QAAQzC,EAAO9B,EAAYxE,SAAUwG,EAAaxG,UAChE2D,EAAQqF,QAAQN,qBAAqB,CACzChD,MAAOoD,EACPtE,YAAAA,EACAgC,aAAAA,EACA1B,UAAAA,IAGImE,EACJpE,GAAqBC,GAAaC,YAAUC,iBAAckE,EAAYtF,EAAQU,kBAE1E6E,EAAY,IAAIC,YACtBD,EAAUE,SAAS1F,EAAOsF,GAC1BE,EAAUG,UAAU3F,EAAM+B,MAAMmC,UAAW9D,GAK3C,IAAIwF,EAAoB5F,EAAM+B,MAAMsC,WAChCD,EAAWe,EAAQxC,MAAMwC,EAAQxC,MAAMpB,OAAS,GAGpD,GAFkB6C,EAASE,UAAU3H,OAAOyH,EAASG,UAAU/H,UAE5C2I,EAAQxC,MAAMpB,OAAS,EAAG,CAC3C,IAAIiD,EAAaW,EAAQxC,MAAMwC,EAAQxC,MAAMpB,OAAS,GAClDqE,EAAkBhG,UAAY4E,EAAWD,UAAU3E,SACrDgG,EAAoBA,EAAkBpJ,QAErCoJ,EAAkBhG,WAClB4E,EAAWD,UAAU5H,OAAOyH,EAASE,aAAcE,EAAWF,UAAU3H,OAAOyH,EAASE,aAEzFsB,EAAoBxB,EAASG,WAIjCiB,EAAUK,QACRD,EACA1E,EAAoBxB,UAAmBoG,EAAG7F,EAAQa,WAASgF,EAAIrG,IAEjEe,EAAQrF,WAAWhD,oBAAY2B,QAAS,CAAC0L,EAAUO,aAIrD,SAAStD,GACPjC,EACAqB,EACAV,EACAlB,EACAG,EACAc,SAEMa,EAAQF,EAAKE,MACblB,EAAcgB,EAAKhB,YACnBgC,EAAehB,EAAKgB,aACpBmD,EAAiB9E,EAAoBxB,UAAmBuG,EAAGhG,EAAQa,WAASmF,EAAIxG,GAGtF,GAA2B,IAAvBsC,EAAMY,MAAMpB,OAAc,CAC5B,GAAIQ,EAAMY,MAAM,aAAclG,OAC5B,OAAO8F,GAAU/B,EAASqB,EAAMV,EAAWlB,EAASG,EAAac,GAC5D,GAAIa,EAAMY,MAAM,aAAcuD,OACnC,OAAO7D,GAAU7B,EAASqB,EAAMV,EAAWlB,EAASG,EAAac,GAC5D,GAAIa,EAAMY,MAAM,aAAcwD,OACnC,OAAOhE,GAAU3B,EAASqB,EAAMV,EAAWlB,EAASG,EAAac,GAEjE,MAAM,IAAIlF,MAAM,sBAyBpB,IArBA,IAAMgE,EAAQoG,kBAAgBrB,qBAAqB,CACjDhD,MAAOA,EACPlB,YAAAA,EACAgC,aAAAA,EACA1B,UAAAA,IAGIkF,EAAWrG,EAAMU,gBAAgBT,EAAQU,kBAAmBE,GAAaD,SAAS1E,WAClFoK,EAAYpF,EACd,EACAlB,EAAM0C,iBAAiBzC,EAAQU,kBAAmBkC,GAAcjC,SAAS1E,WAIvEqK,EAAWC,gCAA8BzE,GACzC0E,EAAuB,SAACC,GAC5B,OAAOA,IAAMH,EAAShF,OAAS,GAG7BoF,EAAa5E,EAAMmC,UAEdwC,EAAI,EAAGA,EAAIH,EAAShF,OAAQmF,IAAK,CACxC,IAAME,EAAUL,EAASG,GACnBG,EAAYD,EAAQ,GACpBE,EAAcC,mBAAiBH,EAASD,GACxCK,EAAW,IAAIC,aAAW,IAAIC,mBAAajL,OAAK2K,GAAUD,EAAYG,IAExEK,SACAC,SAEJ,GAAIX,EAAqBC,GACvBS,EAAiBL,EACjBM,EAAgBpB,MACX,CACL,IAAMqB,EAAWd,EAASG,EAAI,GAAG,GACjCS,EAAiB/K,EAAgB0K,EAAaO,GAG9CD,EAD8BC,aAAoBlB,QAAQW,EAAYnK,OAAOwK,GACpCE,EAAkBC,eAAelK,QAAUsC,GAGtF,GAAImH,aAAqBpK,OAAQ,CAC/B,IAAM+I,EAAY,IAAIC,YAChB8B,EAAa,IAAInC,QAAQwB,EAAqBI,EAASQ,MAAOR,EAASS,QAE7EjC,EAAUG,UAAUgB,EAAYvG,GAAqB,IAANsG,EAAe,GAALA,EAASL,EAAWjH,IAC7EoG,EAAUkC,UAAUC,UAAQC,cAAe,CACzC,CACEC,WAAYlB,EAAW/G,SAAWJ,GAAcmH,EAAWvJ,QAC3DuH,KAAMmD,oBAAoBP,GAC1BlB,SAAU,EACV0B,iBAAmBtB,EAAqBC,GAASJ,EAAJ,KAKjD,IAAI0B,EAAqBlB,EACzB,GAAIL,EAAqBC,GAAI,CAC3B,IAAItC,EAAWrC,EAAMY,MAAMZ,EAAMY,MAAMpB,OAAS,GAE5C0G,KADS7D,aAAoB3H,SACL2H,EAAoBE,UAAU3H,OAAQyH,EAAoBG,UAAU/H,SAC5FgI,EAAazC,EAAMY,MAAMZ,EAAMY,MAAMpB,OAAS,GAE9C0G,IACEnB,EAAYlH,UAAY4E,EAAW9H,OAAOkD,SAC5CoI,EAAqBlB,EAAYtK,QAEhCsK,EAAYlH,WACZ4E,EAAW9H,OAAOC,OAAOyH,EAASxH,UAAW4H,EAAW5H,OAAOD,OAAOyH,EAASxH,UAEhFoL,EAAqB5D,EAAS1H,SAKpC8I,EAAUK,QAAQmC,EAAoBZ,GAEtC5G,EAAQrF,WAAWhD,oBAAY2B,QAAS,CAAC0L,EAAUO,kBAC9C,GAAIc,aAAqBX,OAC9B1F,EAAQrF,WAAWhD,oBAAYoB,iBAAkB,CAC/C6N,EACK,GAALV,EAASL,EAAWjH,GACnBqH,EAAqBC,GAASJ,EAAJ,EAC3B4B,yBAAuBlB,GACvB5G,GAAqB,IAANsG,QAEZ,CAAA,KAAIG,aAAqBV,QAS9B,MAAM,IAAInK,MAAM,wBARhBwE,EAAQrF,WAAWhD,oBAAYyB,iBAAkB,CAC/CwN,EACM,IAANV,EAAUL,EAAWjH,GACpBqH,EAAqBC,GAASJ,EAAJ,EAC3BU,EAASrC,KAAKhJ,KAAI,SAACiJ,GAAK,OAAKA,EAAMpI,QAAQY,WAC3CgD,GAAqB,IAANsG,IAOdD,EAAqBC,KACpBI,EAAYlH,WAAauH,EAAevH,SAC1CY,EAAQrF,WAAWhD,oBAAY6B,SAAU,CAAC0F,GAAqBN,MACrD0H,EAAYlH,UAAYuH,EAAevH,UACjDY,EAAQrF,WAAWhD,oBAAY8B,YAAa,CAACyF,GAAqB,KAItEiH,EAAaQ,YEnhBDgB,GAAa3H,EAAuB4H,GAClD,IAAIC,EAAYD,EAAQC,UAElB9G,EAAS+G,SAAOC,MAAMC,SAASJ,EAAQC,WAAW9G,OANjC,KAQnBA,GAP4B,KAOGA,IAEjC8G,EAAYC,SAAOC,MAAME,cAAcH,SAAOC,MAAMG,eAAeN,EAAQC,aAG7E7H,EAAQrF,WAAWhD,oBAAYe,eAAgB,CAACkP,EAASC,ICC3D,IAAsBM,cAAU,SAAAA,KAuJ7B,OAvJ6BA,EAGhBC,mBAAP,SACLC,EACA5I,GAGA,IAAMO,EAAU,IAAI7F,EAEdqF,EAAsB,IAAID,GAAa8I,EAAQ5I,GAE/C6I,EAAgB9I,EAAMA,MAAMa,YAAYxE,SAClCyM,EAAclJ,UAAcK,EAAQ8I,kBAAhDC,MAEI/I,EAAQ8I,kBACVZ,GAAa3H,EAASP,EAAQ8I,kBAGhC,IAAME,EACF5J,YAAUC,KADcwJ,EAAclJ,SACvBI,EAAMA,MAAMU,gBAAgBT,EAAQU,mBAAmBC,SAAS1E,WAChE,GAGnB,OADA8D,EAAMtE,OAAO8E,EAAS,CAAEnF,aAAa,IAC9BsN,EAAWO,WAAW1I,EAASyI,EAAqB,CACzDE,SAAUlJ,EAAQmJ,4BAA8B/J,YAAUC,KAAKW,EAAQmJ,kCAA+B7D,KAI1GoD,EAQcU,4BAAP,SACLpJ,EACAqJ,GAEA,IAAMC,EAAiBtJ,EAAQuJ,eAAelN,KACxCmN,EAAWxJ,EAAQyJ,cAAcpN,KAAKI,OACtCiN,EAAW1J,EAAQyJ,cAAcpN,KAAKM,OACtCgN,QACJN,EAAAA,EAA2BO,yBAAuBN,EAAOrK,SAAgC0K,yBAKvFL,EAAOhF,UAAU3E,SAEhB2J,EAAOhF,UAAU/H,QAAQG,OAAO8M,IAAaF,EAAOjF,UAAU3H,OAAOgN,IACnEJ,EAAOhF,UAAU/H,QAAQG,OAAOgN,IAAaJ,EAAOjF,UAAU3H,OAAO8M,IAF1ET,OAMUS,IAAaF,EAAO7M,QAA9BsM,MACUW,IAAaJ,EAAO3M,QAA9BoM,OAIA/I,EAAQ6J,yBAAyBC,oBAAoBC,QAAQ,IAAIlK,UAAQ,IAAK,OADhFkJ,MAIwD,GAA9C/I,EAAQ6J,yBAAyBG,WAA3CjB,MAEE/I,EAAQ6J,yBAAyBI,eAAepJ,YAAc8I,GADhEZ,OAtEJ,SAAgB/I,GACd,OAAOkK,OAAOC,KAAKnK,GAASoK,MAAK,SAACC,GAAC,MAAW,cAANA,KAyE5BC,CAAOtK,EAAQuK,wBAAzBxB,MACU/I,EAAQuK,sBAAsBC,SAAxCzB,MAEA,IAAMxI,EAAU,IAAI7F,EAGpB,GAAIsF,EAAQuK,sBAAsBE,WAAY,CAC5C,IAAMC,EAAmBlO,OAAOmO,WAC9BrB,EAAOhF,UACPgF,EAAOjF,UACPiF,EAAOrJ,IACPqJ,EAAOsB,YACPtB,EAAOuB,OAETtK,EAAQrF,WAAWhD,oBAAYmC,mBAAoB,CAACqQ,EAASpB,EAAOwB,aAAa7O,oBAE1E+D,EAAQuK,sBAAsBE,WAInCzK,EAAQ6J,yBAAyBkB,SAEJhM,EAC7BzG,+BAAuB+E,KACvB2C,EAAQyJ,cAAcpN,KAAK4C,UAEOe,EAAQ6J,yBAAyBkB,OAAOC,SAA5EjC,MD9FN,SAAuCxI,EAAuBwK,EAA0BE,GACtF,IAAMC,EAAWC,6BAA2BC,UAAUC,mBAAmB,SAAU,CACjFC,0BAAwBP,EAAOC,SAC/BC,EACAF,EAAO7B,SACP6B,EAAOQ,EACPR,EAAOS,EACPT,EAAOU,IAGTlL,EAAQrF,WAAWhD,oBAAYoC,2BAA4B,CAAC4Q,ICsFxDQ,CAAuBnL,EAASP,EAAQ6J,yBAAyBkB,OAAQ/K,EAAQ6J,yBAAyBoB,gBAEnGjL,EAAQ6J,yBAAyBkB,QAU1C,IANA,IAM4B/J,EANtB2K,EAAmCC,6BAAkBC,qBACzD7L,EAAQyJ,cACRzJ,EAAQ6J,0BAIVrI,EAAAC,EAF0BqK,YAAUC,gBAAgBJ,EAAeT,aAEvClK,EAAAQ,KAAAG,MAAE,CAAA,IAAnBqK,EAAMhL,EAAAa,MAEToK,EAAWD,EAAOE,MAAM,EAAG,IAE/BD,GAAYL,6BAAkBR,UAAUe,WAAW,YACjDF,GAAYL,6BAAkBR,UAAUe,WAAW,sBACnDF,GAAYL,6BAAkBR,UAAUe,WAAW,SAHvDpD,MAMAxI,EAAQrF,WAAWhD,oBAAYsC,yBAA0B,CAACwR,IAI5D,IAAMI,EAAcC,oBAAkBC,kBAAkBtM,EAAQuJ,eAAgBvJ,EAAQuK,uBAOxF,OALiB6B,EAAYlB,SAASgB,MAAM,EAAG,KACzBG,oBAAkBjB,UAAUe,WAAW,sBAA7DpD,MAEAxI,EAAQrF,WAAWhD,oBAAYuC,yBAA0B,CAAC2R,EAAYlB,WAE/DxC,EAAWO,WAAW1I,EAASnB,YAAUC,KAAK,GAAI,CACvD6J,SAAU9J,YAAUC,KAAKW,EAAQuK,sBAAsBrB,aAI3DR,EAMeO,WAAP,SACN1I,EACAyI,EACAuD,YAAAA,IAAAA,EAA2B,IAE3B,IAAQ3R,EAAqB2F,EAArB3F,SAAUC,EAAW0F,EAAX1F,OAIlB,MAAO,CAAEqQ,SADQxC,EAAW0C,UAAUC,mBAFVkB,EAAOrD,SAAW,iCAAmC,yBAC5DqD,EAAOrD,SAAW,CAACtO,EAAUC,EAAQ0R,EAAOrD,UAAY,CAACtO,EAAUC,IAErEgH,MAAOmH,EAAoBwD,gBAC/C9D,KAtJaA,aAAuB,IAAI+D,YAAUC,EAAgB/Q,SCzBzDgR,GCXCC,cAMX,SAAAA,EAAYvJ,EAAsBpE,EAAiBkJ,GAL1CxN,eAA8BtC,yBAAiBuU,WAMtDjS,KAAKkS,YAAc3N,EAAaD,GAChCtE,KAAK0I,OAASA,EAER8E,IAEFA,EAAQ2E,QAAQnI,MAAMoI,gBAAkBpS,KAAKkS,YAAYE,eAD3DhE,MAIUZ,EAAQ2E,QAAQzJ,QAAUA,GAApC0F,MACApO,KAAKqS,YAAc7E,GAatB,OAXAyE,EAAA7R,UAEDU,OAAA,SAAO8E,EAAuB0M,aHmCQ1M,EAAuBP,GAEvDA,EAAQkN,qBAAyBlN,EAAQmN,eACnCnN,EAAQkN,oBAAoBvI,QAAU3E,EAAQmN,cAAcL,QAAQnI,OAA9EoE,MAGI/I,EAAQmN,eACZjF,GAAa3H,EAASP,EAAQmN,eAG1BnN,EAAQkN,qBACZ3M,EAAQrF,WAAWhD,oBAAYiB,sBAAuB,CACpD6G,EAAQkN,oBAAoBvI,MAC5B3E,EAAQkN,oBAAoBrM,UAAYb,EAAQkN,oBAAoBrM,UAAYpB,GAChFO,EAAQkN,oBAAoB7J,SGhD9B+J,CAAwB7M,EAAS,CAC/B4M,cAAexS,KAAKqS,YACpBE,oBAAqB,CACnBvI,MAAOhK,KAAKkS,YACZxJ,OAAQ1I,KAAK0I,OAAOpH,cAGxBsE,EAAQrF,WAAWhD,oBAAY8B,YAAa,CAACyF,GAAqB9E,KAAK0I,UACxEuJ,MDlBSD,GAAAA,mBAAAA,uCAEVA,oBACAA,wBAgEWU,GAAmB,SAAClQ,GAAe,OAC9CA,EAAQ4P,gBAAkBxN,GAAYwN,eAAiB5P,EAAQ4P,gBP0TpC,6CO1ToEA,eAIpFO,cAAkB,SAAAA,KA0K5B,OAzKDA,EACOC,iBAAP,SAAwBC,GACtB,IAAQ1L,EAA6B0L,EAA7B1L,MAAO2L,EAAsBD,EAAtBC,QAASC,EAAaF,EAAbE,SAExB,IAAK5L,EAAO,MAAM,IAAI/F,MAAM,gCAC5B,IAAK+F,EAAMR,OAAQ,MAAM,IAAIvF,MAAM,2CACnC,GAAI+F,EAAMsI,MAAK,SAACoB,GAAC,OAAMA,EAAElK,UAAS,MAAM,IAAIvF,MAAM,iDAClD,IAAM4R,EAAa7L,EAAM,GAEnB8L,EAAcD,EAAW,GAAGF,QAC5BI,EAAeF,EAAWA,EAAWrM,OAAS,GAAGoM,SAEvD,IAAKE,IAAgBC,EAAc,MAAM,IAAI9R,MAAM,oDACnD,GAAI6R,EAAY3O,UAAY4O,EAAa5O,QACvC,MAAM,IAAIlD,MAAM,yDAElB,IAAM+R,EAAmBR,EAAmBS,WAAWV,GAAiBI,GAAUG,GAC5EI,EAAoBV,EAAmBS,WAAWV,GAAiBK,GAAWG,GAE9EI,EAA6BnM,EAAMpG,KAAI,SAACqL,GAC5C,IAAMmH,EAAcnH,EAAS,GAAGX,SAC1B+H,EAAepH,EAASA,EAASzF,OAAS,GAAG+E,UAEnD,IAAK6H,IAAgBC,EACnB,MAAM,IAAIpS,MAAM,8DAGlB,IAAM6E,EAAcwN,iBAAeC,cAAcP,EAAkBI,GAC7DtL,EAAewL,iBAAeC,cAAcL,EAAmBG,GAE/DG,EAAWhB,EAAmBiB,iBAAgC5B,iBAAS6B,OAAQzH,GAC/E0H,EAAWnB,EAAmBiB,iBAAgC5B,iBAAS1G,OAAQc,GAC/E2H,EAAWpB,EAAmBiB,iBAAgC5B,iBAASnQ,OAAQuK,GACrF,MAAO,CACL4H,QAASD,EACL,IAAIvJ,QACD4B,EAA6BrL,IAAI4R,EAAmBsB,UACrDd,EACAE,GAEF,KACJa,QAASJ,EACL,IAAIK,QACD/H,EAA6BrL,IAAI4R,EAAmByB,UACrDjB,EACAE,GAEF,KACJgB,QAASV,EACL,IAAIW,QACDlI,EAA6BrL,IAAI4R,EAAmB4B,QACrDpB,EACAE,GAEF,KACJmB,WACGT,GAAaD,GAAaH,EAEvB,KADA,IAAIrH,gBAAcF,EAASrL,IAAI4R,EAAmB8B,cAAetB,EAAkBE,GAEzFpN,YAAAA,EACAgC,aAAAA,MAIJ,OAAO,IAAIyM,QAAY,CACrBC,SAAUrB,EACPsB,QAAO,SAACzN,GAAK,OAAKA,EAAMkN,WACxBtT,KAAI,SAACoG,GAAK,MAAM,CACfkN,QAASlN,EAAMkN,QACfpO,YAAakB,EAAMlB,YACnBgC,aAAcd,EAAMc,iBAExB4M,SAAUvB,EACPsB,QAAO,SAACzN,GAAK,OAAKA,EAAM+M,WACxBnT,KAAI,SAACoG,GAAK,MAAM,CACf+M,QAAS/M,EAAM+M,QACfjO,YAAakB,EAAMlB,YACnBgC,aAAcd,EAAMc,iBAExB6M,SAAUxB,EACPsB,QAAO,SAACzN,GAAK,OAAKA,EAAM6M,WACxBjT,KAAI,SAACoG,GAAK,MAAM,CACf6M,QAAS7M,EAAM6M,QACf/N,YAAakB,EAAMlB,YACnBgC,aAAcd,EAAMc,iBAExB8M,YAAazB,EACVsB,QAAO,SAACzN,GAAK,OAAKA,EAAMqN,cACxBzT,KAAI,SAACoG,GAAK,MAAM,CACfqN,WAAYrN,EAAMqN,WAClBvO,YAAakB,EAAMlB,YACnBgC,aAAcd,EAAMc,iBAExB1B,UAAWsM,EAAMtM,aAEpBoM,EAEcS,WAAP,SAAkBpO,EAAmBgF,GAC3C,OAAIhF,EACKgQ,QAAMC,QAAQjL,EAAM1F,SAEtBtE,KAAKkV,QAAQlL,IACrB2I,EAecuC,QAAP,SAAelL,GACrB,IAAoC/H,EAAkC+H,EAAlC/H,OAAQkT,EAA0BnL,EAA1BmL,UAAWC,EAAepL,EAAfoL,WACvD,OAAO,IAAIC,QAD2DrL,EAA9D1F,QAA8D0F,EAArDxH,QAIf8S,SAJoEtL,EAA5CuL,SAINjU,YAClBW,OACW0I,GACX,EACAwK,EAAY1Q,YAAUC,KAAKyQ,QAAaxK,EACxCyK,EAAa3Q,YAAUC,KAAK0Q,QAAczK,IAE7CgI,EAEcyB,SAAP,SAAevK,OAAGvE,EAAGuE,EAAHvE,IAAK6K,EAAYtG,EAAZsG,aAAcqF,EAAS3L,EAAT2L,UAAWC,EAAW5L,EAAX4L,YAAsB1C,EAAQlJ,EAARkJ,SAC5E,OAAO,IAAIzH,OACTqH,EAAmBuC,QAFqDrL,EAAPiJ,SAGjEH,EAAmBuC,QAAQnC,GAC3BuC,SAAShQ,GACT6K,EACAqF,EACAF,SAASG,KAEZ9C,EAEcsB,SAAP,SAAgBvS,GACtB,IAAMyR,EAAmBR,EAAmBS,WAAWV,GAAiBhR,EAAKoR,QAAQtQ,SAAUd,EAAKoR,SAC9FO,EAAoBV,EAAmBS,WAAWV,GAAiBhR,EAAKqR,SAASvQ,SAAUd,EAAKqR,UACtG,OAAO,IAAIlR,OACTsR,EACAE,EACAiC,SAAS5T,EAAK4D,KACdgQ,SAAS5T,EAAKuO,aACdvO,EAAKwO,MACLxO,EAAKyO,aACLzO,EAAK8T,UACLF,SAAS5T,EAAK+T,eAEjB9C,EASciB,iBAAP,SACNvV,EACA8I,GAEA,OAAOA,EAAMuO,OAAM,SAAChU,GAAI,OAAKA,EAAKrD,OAASA,MAC5CsU,KAjEcA,gBAAe,SAACjR,GAC7B,OAAQA,EAAKrD,MACX,KAAK2T,iBAASnQ,OACZ,OAAO8Q,GAAmBsB,SAASvS,GACrC,KAAKsQ,iBAAS1G,OACZ,OAAOqH,GAAmByB,SAAS1S,GACrC,KAAKsQ,iBAAS6B,OACZ,OAAOlB,GAAmB4B,OAAO7S,GACnC,QACE,MAAM,IAAIN,MAAM,uBA4CPuR,UAAS,SAAA1I,OAAG0L,EAAQ1L,EAAR0L,SAAUC,EAAQ3L,EAAR2L,SACnC,OAAO,IAAIrK,OACTkI,iBAAeC,cAAcf,GAAmBuC,QAAQS,EAAS3L,OAAQ2L,EAAS3P,UAClFyN,iBAAeC,cAAcf,GAAmBuC,QAAQU,EAAS5L,OAAQ4L,EAAS5P,YE3NxF,IAAsB6P,cAAa,SAAAA,KAQhC,OARgCA,EAGnBC,cAAP,SAAqBvF,GAC1B,IAAMwF,EAAgB,IAAIC,GAAqBjY,GAE/CkY,EADsBJ,EAAcpF,UAAUyF,iBAAiB,CAAEC,KAAM5F,IAC5B6F,KAC3C,OAAOL,EAAcM,MADLJ,EAARhW,SAAgBgW,EAAN/V,SAEnB2V,KAPaA,aAAuB,IAAI/D,YAAUC,EAAgB/Q,KAWrE,IAAagV,cACX,SAAAA,EAA6BM,GAAAtW,uBAAAsW,EAuE5B,OAvEqEN,EAAA5V,UAE/DiW,MAAA,SAAMpW,EAAkBC,cAG7B,MAAO,CACLD,SAHmB+V,EAAqBO,YAAYtW,GAG7Bc,KAAI,SAACyV,EAA0B1K,GACpD,IAgHsB2K,EAhHhB9V,EAAa+V,EAAKJ,kBAAkBE,GAE1C,GAAI7V,EAAW1C,SAAWR,eAAO0B,UAAW,CAC1C,IAAAwX,EAAoBC,sBAAoBd,cAAc5V,EAAO4L,IAC7D,MAAO,CACL+K,YAAatZ,oBAAYiZ,GACzBA,YAAAA,EACArY,QAyGkBsY,EA7GLE,EAAPF,QA8GTA,EAAQ1V,KAAI,SAAC+V,GAClB,MAAO,CACL1Y,KAAM0Y,EAAOC,WACb7P,MAAO4P,EAAO3Y,OAAO4C,KAAI,SAACiW,GACxB,MAAO,CACL5Y,KAAM4Y,EAAM5Y,KACZ8I,MAAO8P,EAAM9P,gBA9GR,GAAIvG,EAAW1C,SAAWR,eAAOS,IAAK,CAC3C,IAAM+Y,EAAStW,EAAWxC,OAMpBA,EALYuP,SAAOC,MAAM9M,gBAAgBqW,OAC7CD,EAAOlW,KAAI,SAACL,GAAO,OAAKA,EAAQrC,QAChC6B,EAAO4L,IAGgB/K,KAAI,SAACiW,EAAYG,GACxC,OAAQF,EAAOE,GAAGvY,WAChB,KAAKpB,kBAAUqB,cACb,MAAO,CACLT,KAAM6Y,EAAOE,GAAG/Y,KAChB8I,MAAOkQ,GAAmBJ,IAE9B,KAAKxZ,kBAAUuB,eACb,MAAO,CACLX,KAAM6Y,EAAOE,GAAG/Y,KAChB8I,MAAOmQ,GAAoBL,IAE/B,QACE,MAAO,CACL5Y,KAAM6Y,EAAOE,GAAG/Y,KAChB8I,MAAO8P,OAIf,MAAO,CACLH,YAAatZ,oBAAYiZ,GACzBA,YAAAA,EACArY,OAAAA,GAEG,GAAIwC,EAAW1C,SAAWR,eAAOmC,UAEtC,MAAO,CACLiX,YAAatZ,oBAAYiZ,GACzBA,YAAAA,EACArY,OAAQ+B,EAAOa,KAAI,SAAC6L,GAAK,MAAM,CAAExO,KAAM,UAAW8I,MAAO0F,OAG3D,MAAM,IAAIxL,6BAA6BT,QAM/CqV,EACeO,YAAP,SAAmBtW,GAGzB,IAFA,IAAMqX,EAA8B,GAE3BxL,EAAI,EAAGA,EAAI7L,EAAS0G,OAAQmF,GAAK,EAAG,CAC3C,IAAMyL,EAAOtX,EAASuX,UAAU1L,EAAGA,EAAI,GACvCwL,EAAapW,KAAKoU,SAASiC,EAAM,KAGnC,OAAOD,GACRtB,cAGaoB,GAAmBrN,GAKjC,IAJA,IAAM0N,EAAe1N,EAAK2N,QAAQ,KAAM,IACpC5E,EAAUpF,SAAOC,MAAMgK,WAAWF,EAAaD,UAAU,EAAG,KAC5DI,EAAM,GACJC,EAAoB,GACnBD,EAAMH,EAAa9Q,QAAQ,CAChC,IAAMmR,EAAiBL,EAAaD,UAAUI,EAAKA,EAAM,IACnDtS,EAAMgQ,SAASwC,EAAeN,UAAU,EAAG,GAAI,IAC/CzE,EAAWrF,SAAOC,MAAMgK,WAAWG,EAAeN,UAAU,EAAG,KAErEK,EAAI3W,KAAK,CACP4R,QAAAA,EACAC,SAAAA,EACAzN,IAAAA,IAEFwN,EAAUC,EACV6E,GAAO,GAGT,OAAOC,WAGOR,GAAoBtN,GAKlC,IAJA,IAAM0N,EAAe1N,EAAK2N,QAAQ,KAAM,IACpC5E,EAAUpF,SAAOC,MAAMgK,WAAWF,EAAaD,UAAUC,EAAa9Q,OAAS,KAC/EiR,EAAMH,EAAa9Q,OAAS,GAC1BkR,EAAoB,GACnBD,GAAO,GAAG,CACf,IAAME,EAAiBL,EAAaD,UAAUI,EAAKA,EAAM,IACnD7E,EAAWrF,SAAOC,MAAMgK,WAAWG,EAAeN,UAAU,EAAG,KAC/DlS,EAAMgQ,SAASwC,EAAeN,UAAU,GAAI,IAAK,IAEvDK,EAAI3W,KAAK,CACP4R,QAAAA,EACAC,SAAAA,EACAzN,IAAAA,IAEFwN,EAAUC,EAEV6E,GAAO,GAGT,OAAOC,6QTgOsC,SAACxT,EAAiCC,GAC/E,KAAMA,KAAWpC,GAAgB,MAAM,IAAId,gDAAgDkD,GAC3F,OAAOpC,EAAcoC,GAASjC,cAAcgC,GAAS5B"}
\ No newline at end of file
+{"version":3,"file":"universal-router-sdk.cjs.production.min.js","sources":["../src/utils/routerCommands.ts","../src/entities/Command.ts","../src/utils/constants.ts","../src/utils/pathCurrency.ts","../src/utils/getCurrencyAddress.ts","../src/entities/actions/uniswap.ts","../src/utils/numbers.ts","../src/utils/inputTokens.ts","../src/utils/eip712.ts","../src/swapRouter.ts","../src/utils/routerTradeAdapter.ts","../src/entities/actions/unwrapWETH.ts","../src/utils/commandParser.ts"],"sourcesContent":["import { defaultAbiCoder } from 'ethers/lib/utils'\nimport { AcrossV4DepositV3Params } from '../entities/actions/across'\n\n/**\n * CommandTypes\n * @description Flags that modify a command's execution\n * @enum {number}\n */\nexport enum CommandType {\n  V3_SWAP_EXACT_IN = 0x00,\n  V3_SWAP_EXACT_OUT = 0x01,\n  PERMIT2_TRANSFER_FROM = 0x02,\n  PERMIT2_PERMIT_BATCH = 0x03,\n  SWEEP = 0x04,\n  TRANSFER = 0x05,\n  PAY_PORTION = 0x06,\n\n  V2_SWAP_EXACT_IN = 0x08,\n  V2_SWAP_EXACT_OUT = 0x09,\n  PERMIT2_PERMIT = 0x0a,\n  WRAP_ETH = 0x0b,\n  UNWRAP_WETH = 0x0c,\n  PERMIT2_TRANSFER_FROM_BATCH = 0x0d,\n  BALANCE_CHECK_ERC20 = 0x0e,\n\n  V4_SWAP = 0x10,\n  V3_POSITION_MANAGER_PERMIT = 0x11,\n  V3_POSITION_MANAGER_CALL = 0x12,\n  V4_INITIALIZE_POOL = 0x13,\n  V4_POSITION_MANAGER_CALL = 0x14,\n\n  EXECUTE_SUB_PLAN = 0x21,\n\n  // 3rd party integrations\n  ACROSS_V4_DEPOSIT_V3 = 0x40,\n}\n\nexport enum Subparser {\n  V3PathExactIn,\n  V3PathExactOut,\n}\n\nexport enum Parser {\n  Abi,\n  V4Actions,\n  V3Actions,\n}\n\nexport type ParamType = {\n  readonly name: string\n  readonly type: string\n  readonly subparser?: Subparser\n}\n\nexport type CommandDefinition =\n  | {\n      parser: Parser.Abi\n      params: ParamType[]\n    }\n  | {\n      parser: Parser.V4Actions\n    }\n  | {\n      parser: Parser.V3Actions\n    }\n\nconst ALLOW_REVERT_FLAG = 0x80\nconst REVERTIBLE_COMMANDS = new Set<CommandType>([CommandType.EXECUTE_SUB_PLAN])\n\nconst PERMIT_STRUCT =\n  '((address token,uint160 amount,uint48 expiration,uint48 nonce) details,address spender,uint256 sigDeadline)'\n\nconst PERMIT_BATCH_STRUCT =\n  '((address token,uint160 amount,uint48 expiration,uint48 nonce)[] details,address spender,uint256 sigDeadline)'\n\nconst POOL_KEY_STRUCT = '(address currency0,address currency1,uint24 fee,int24 tickSpacing,address hooks)'\n\nconst PERMIT2_TRANSFER_FROM_STRUCT = '(address from,address to,uint160 amount,address token)'\nconst PERMIT2_TRANSFER_FROM_BATCH_STRUCT = PERMIT2_TRANSFER_FROM_STRUCT + '[]'\n\nexport const COMMAND_DEFINITION: { [key in CommandType]: CommandDefinition } = {\n  // Batch Reverts\n  [CommandType.EXECUTE_SUB_PLAN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'commands', type: 'bytes' },\n      { name: 'inputs', type: 'bytes[]' },\n    ],\n  },\n\n  // Permit2 Actions\n  [CommandType.PERMIT2_PERMIT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'permit', type: PERMIT_STRUCT },\n      { name: 'signature', type: 'bytes' },\n    ],\n  },\n  [CommandType.PERMIT2_PERMIT_BATCH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'permit', type: PERMIT_BATCH_STRUCT },\n      { name: 'signature', type: 'bytes' },\n    ],\n  },\n  [CommandType.PERMIT2_TRANSFER_FROM]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'amount', type: 'uint160' },\n    ],\n  },\n  [CommandType.PERMIT2_TRANSFER_FROM_BATCH]: {\n    parser: Parser.Abi,\n    params: [\n      {\n        name: 'transferFrom',\n        type: PERMIT2_TRANSFER_FROM_BATCH_STRUCT,\n      },\n    ],\n  },\n\n  // Uniswap Actions\n  [CommandType.V3_SWAP_EXACT_IN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountIn', type: 'uint256' },\n      { name: 'amountOutMin', type: 'uint256' },\n      { name: 'path', subparser: Subparser.V3PathExactIn, type: 'bytes' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V3_SWAP_EXACT_OUT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountOut', type: 'uint256' },\n      { name: 'amountInMax', type: 'uint256' },\n      { name: 'path', subparser: Subparser.V3PathExactOut, type: 'bytes' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V2_SWAP_EXACT_IN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountIn', type: 'uint256' },\n      { name: 'amountOutMin', type: 'uint256' },\n      { name: 'path', type: 'address[]' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V2_SWAP_EXACT_OUT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountOut', type: 'uint256' },\n      { name: 'amountInMax', type: 'uint256' },\n      { name: 'path', type: 'address[]' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V4_SWAP]: { parser: Parser.V4Actions },\n\n  // Token Actions and Checks\n  [CommandType.WRAP_ETH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amount', type: 'uint256' },\n    ],\n  },\n  [CommandType.UNWRAP_WETH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountMin', type: 'uint256' },\n    ],\n  },\n  [CommandType.SWEEP]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'amountMin', type: 'uint256' },\n    ],\n  },\n  [CommandType.TRANSFER]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'value', type: 'uint256' },\n    ],\n  },\n  [CommandType.PAY_PORTION]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'bips', type: 'uint256' },\n    ],\n  },\n  [CommandType.BALANCE_CHECK_ERC20]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'owner', type: 'address' },\n      { name: 'token', type: 'address' },\n      { name: 'minBalance', type: 'uint256' },\n    ],\n  },\n  [CommandType.V4_INITIALIZE_POOL]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'poolKey', type: POOL_KEY_STRUCT },\n      { name: 'sqrtPriceX96', type: 'uint160' },\n    ],\n  },\n\n  // Position Actions\n  [CommandType.V3_POSITION_MANAGER_PERMIT]: { parser: Parser.V3Actions },\n  [CommandType.V3_POSITION_MANAGER_CALL]: { parser: Parser.V3Actions },\n  [CommandType.V4_POSITION_MANAGER_CALL]: { parser: Parser.V4Actions },\n\n  // 3rd party integrations\n  [CommandType.ACROSS_V4_DEPOSIT_V3]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'depositor', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'inputToken', type: 'address' },\n      { name: 'outputToken', type: 'address' },\n      { name: 'inputAmount', type: 'uint256' },\n      { name: 'outputAmount', type: 'uint256' },\n      { name: 'destinationChainId', type: 'uint256' },\n      { name: 'exclusiveRelayer', type: 'address' },\n      { name: 'quoteTimestamp', type: 'uint32' },\n      { name: 'fillDeadline', type: 'uint32' },\n      { name: 'exclusivityDeadline', type: 'uint32' },\n      { name: 'message', type: 'bytes' },\n      { name: 'useNative', type: 'bool' },\n    ],\n  },\n}\n\nexport class RoutePlanner {\n  commands: string\n  inputs: string[]\n\n  constructor() {\n    this.commands = '0x'\n    this.inputs = []\n  }\n\n  addSubPlan(subplan: RoutePlanner): RoutePlanner {\n    this.addCommand(CommandType.EXECUTE_SUB_PLAN, [subplan.commands, subplan.inputs], true)\n    return this\n  }\n\n  addAcrossBridge(params: AcrossV4DepositV3Params): RoutePlanner {\n    this.addCommand(CommandType.ACROSS_V4_DEPOSIT_V3, [\n      params.depositor,\n      params.recipient,\n      params.inputToken,\n      params.outputToken,\n      params.inputAmount,\n      params.outputAmount,\n      params.destinationChainId,\n      params.exclusiveRelayer,\n      params.quoteTimestamp,\n      params.fillDeadline,\n      params.exclusivityDeadline,\n      params.message,\n      params.useNative,\n    ])\n    return this\n  }\n\n  addCommand(type: CommandType, parameters: any[], allowRevert = false): RoutePlanner {\n    let command = createCommand(type, parameters)\n    this.inputs.push(command.encodedInput)\n    if (allowRevert) {\n      if (!REVERTIBLE_COMMANDS.has(command.type)) {\n        throw new Error(`command type: ${command.type} cannot be allowed to revert`)\n      }\n      command.type = command.type | ALLOW_REVERT_FLAG\n    }\n\n    this.commands = this.commands.concat(command.type.toString(16).padStart(2, '0'))\n    return this\n  }\n}\n\nexport type RouterCommand = {\n  type: CommandType\n  encodedInput: string\n}\n\nexport function createCommand(type: CommandType, parameters: any[]): RouterCommand {\n  const commandDef = COMMAND_DEFINITION[type]\n  switch (commandDef.parser) {\n    case Parser.Abi:\n      const encodedInput = defaultAbiCoder.encode(\n        commandDef.params.map((abi) => abi.type),\n        parameters\n      )\n      return { type, encodedInput }\n    case Parser.V4Actions:\n      // v4 swap data comes pre-encoded at index 0\n      return { type, encodedInput: parameters[0] }\n    case Parser.V3Actions:\n      // v4 swap data comes pre-encoded at index 0\n      return { type, encodedInput: parameters[0] }\n  }\n}\n","import { RoutePlanner } from '../utils/routerCommands'\n\nexport type TradeConfig = {\n  allowRevert: boolean\n}\n\nexport enum RouterActionType {\n  UniswapTrade = 'UniswapTrade',\n  UnwrapWETH = 'UnwrapWETH',\n}\n\n// interface for entities that can be encoded as a Universal Router command\nexport interface Command {\n  tradeType: RouterActionType\n  encode(planner: RoutePlanner, config: TradeConfig): void\n}\n","import { BigNumber } from 'ethers'\n\nexport enum UniversalRouterVersion {\n  V1_2 = '1.2',\n  V2_0 = '2.0',\n  V2_1 = '2.1',\n}\n\nexport type RouterConfig = {\n  address: string\n  creationBlock: number\n}\n\ntype ChainConfig = {\n  weth: string\n  routerConfigs: { [key in UniversalRouterVersion]: RouterConfig }\n}\n\nconst ZERO_ROUTER_CONFIG: RouterConfig = {\n  address: '0x0000000000000000000000000000000000000000',\n  creationBlock: 1,\n}\n\nconst WETH_NOT_SUPPORTED_ON_CHAIN = '0x0000000000000000000000000000000000000000'\n\n// Todo: Change `CHAIN_CONFIGS` to pull the UR address with v4\nexport const CHAIN_CONFIGS: { [key: number]: ChainConfig } = {\n  // mainnet\n  [1]: {\n    weth: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17143817,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x66a9893cc07d91d95644aedd05d03f95e1dba8af',\n        creationBlock: 21689092,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0xd92a36b0000531ef3063ded4de20a0783308446c',\n        creationBlock: 23836348,\n      },\n    },\n  },\n  // goerli\n  [5]: {\n    weth: '0xb4fbf271143f4fbf7b91a5ded31805e42b2208d6',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8940568,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8940568,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // sepolia\n  [11155111]: {\n    weth: '0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 3543575,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3a9d48ab9751398bbfa63ad67599bb04e4bdf98b', // only update here and creation block below\n        creationBlock: 7259601,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0x470FFC67b1feEEC31D16C46AC7545C98716a194c',\n        creationBlock: 9664766,\n      },\n    },\n  },\n  // polygon\n  [137]: {\n    weth: '0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xec7BE89e9d109e7e3Fec59c222CF297125FEFda2',\n        creationBlock: 52210153,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x1095692a6237d83c6a72f3f5efedb9a670c49223',\n        creationBlock: 66980401,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0xE27610fD9dD05FC061366bc9dA414CA6F948f204',\n        creationBlock: 79245524,\n      },\n    },\n  },\n  //polygon mumbai\n  [80001]: {\n    weth: '0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 35176052,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 35176052,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  //optimism\n  [10]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xCb1355ff08Ab38bBCE60111F1bb2B784bE25D7e8',\n        creationBlock: 114702266,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x851116d9223fabed8e56c0e6b8ad0c31d98b3507',\n        creationBlock: 129906462,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0xde20EEE5398D3790a4D356e8925bD21Ea65D99Af',\n        creationBlock: 134078764,\n      },\n    },\n  },\n  // optimism goerli\n  [420]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8887728,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8887728,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // arbitrum\n  [42161]: {\n    weth: '0x82aF49447D8a07e3bd95BD0d56f35241523fBab1',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x5E325eDA8064b456f4781070C0738d849c824258',\n        creationBlock: 169472836,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xa51afafe0263b40edaef0df8781ea9aa03e381a3',\n        creationBlock: 290124593,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0x96b2FD2F80e9428Daa65d859653117D453981AB4',\n        creationBlock: 329155034,\n      },\n    },\n  },\n  // arbitrum goerli\n  [421613]: {\n    weth: '0xe39Ab88f8A4777030A534146A9Ca3B52bd5D43A3',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 18815277,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 18815277,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // celo\n  [42220]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x643770e279d5d0733f21d6dc03a8efbabf3255b4',\n        creationBlock: 21407637,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xcb695bc5D3Aa22cAD1E6DF07801b061a05A0233A',\n        creationBlock: 47387857,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // celo alfajores\n  [44787]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17566658,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17566658,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // binance smart chain\n  [56]: {\n    weth: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4Dae2f939ACf50408e13d58534Ff8c2776d45265',\n        creationBlock: 35160263,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x1906c1d672b88cd1b9ac7593301ca990f94eae07',\n        creationBlock: 1737493275,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // avalanche\n  [43114]: {\n    weth: '0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4Dae2f939ACf50408e13d58534Ff8c2776d45265',\n        creationBlock: 40237257,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x94b75331ae8d42c1b61065089b7d48fe14aa73b7',\n        creationBlock: 1737558236,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0x0Cf1f86B331A03179646341D10A2A87515087221',\n        creationBlock: 58800800,\n      },\n    },\n  },\n  // base goerli\n  [84531]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',\n        creationBlock: 6915289,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',\n        creationBlock: 6915289,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // base mainnet\n  [8453]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 9107268,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x6ff5693b99212da76ad316178a184ab56d299b43',\n        creationBlock: 1737491485,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0xf3a4f4094bd2c6c06ca2f61789d8727b8d1e7259',\n        creationBlock: 28539210,\n      },\n    },\n  },\n  // blast\n  [81457]: {\n    weth: '0x4300000000000000000000000000000000000004',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x643770E279d5D0733F21d6DC03A8efbABf3255B4',\n        creationBlock: 1116444,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xeabbcb3e8e415306207ef514f660a3f820025be3',\n        creationBlock: 1737564586,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // zora\n  [7777777]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x2986d9721A49838ab4297b695858aF7F17f38014',\n        creationBlock: 11832155,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3315ef7ca28db74abadc6c44570efdf06b04b020',\n        creationBlock: 1737562927,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [324]: {\n    weth: '0x5aea5775959fbc2557cc8789bc1bf90a239d9a91',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',\n        creationBlock: 12640979,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',\n        creationBlock: 12640979,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // worldchain\n  [480]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D',\n        creationBlock: 4063979,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x8ac7bee993bb44dab564ea4bc9ea67bf9eb5e743',\n        creationBlock: 1737559557,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [1301]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x8909Dc15e40173Ff4699343b6eB8132c65e18eC6',\n        creationBlock: 1241811,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xf70536b3bcc1bd1a972dc186a2cf84cc6da6be5d',\n        creationBlock: 7100543,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // unichain mainnet\n  [130]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4D73A4411CA1c660035e4AECC8270E5DdDEC8C17',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xef740bf23acae26f6492b10de645d6b98dc8eaf3',\n        creationBlock: 1737568156,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [10143]: {\n    weth: '0x760AfE86e5de5fa0Ee542fc7B7B713e1c5425701',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [84532]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x492e6456d9528771018deb9e87ef7750ef184104',\n        creationBlock: 20216585,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x492e6456d9528771018deb9e87ef7750ef184104',\n        creationBlock: 20216585,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [1868]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',\n        creationBlock: 3254782,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',\n        creationBlock: 3254782,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [143]: {\n    weth: '0x3bd359C1119dA7Da1D913D1C4D2B7c461115433A',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',\n        creationBlock: 29255937,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',\n        creationBlock: 29255937,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [196]: {\n    weth: '0xe538905cf8410324e03A5A23C1c177a474D59b2b',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0000000000000000000000000000000000000000',\n        creationBlock: 1,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x5507749f2c558bb3e162c6e90c314c092e7372ff',\n        creationBlock: 47680350,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // rootstock\n  [30]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: ZERO_ROUTER_CONFIG,\n      [UniversalRouterVersion.V2_0]: ZERO_ROUTER_CONFIG,\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // cyber testnet\n  [111557560]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: ZERO_ROUTER_CONFIG,\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x2D094CE21AE3431909e373207a2fCef4ba8871a9',\n        creationBlock: 6183303,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n}\n\nexport const UNIVERSAL_ROUTER_ADDRESS = (version: UniversalRouterVersion, chainId: number): string => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n  return CHAIN_CONFIGS[chainId].routerConfigs[version].address\n}\n\nexport const UNIVERSAL_ROUTER_CREATION_BLOCK = (version: UniversalRouterVersion, chainId: number): number => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n  return CHAIN_CONFIGS[chainId].routerConfigs[version].creationBlock\n}\n\nexport const WETH_ADDRESS = (chainId: number): string => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n\n  if (CHAIN_CONFIGS[chainId].weth == WETH_NOT_SUPPORTED_ON_CHAIN) throw new Error(`Chain ${chainId} does not have WETH`)\n\n  return CHAIN_CONFIGS[chainId].weth\n}\n\nexport const CONTRACT_BALANCE = BigNumber.from(2).pow(255)\nexport const ETH_ADDRESS = '0x0000000000000000000000000000000000000000'\nexport const E_ETH_ADDRESS = '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee'\nexport const ZERO_ADDRESS = '0x0000000000000000000000000000000000000000'\nexport const MAX_UINT256 = BigNumber.from(2).pow(256).sub(1)\nexport const MAX_UINT160 = BigNumber.from(2).pow(160).sub(1)\n\nexport const SENDER_AS_RECIPIENT = '0x0000000000000000000000000000000000000001'\nexport const ROUTER_AS_RECIPIENT = '0x0000000000000000000000000000000000000002'\n","import { Currency, Token } from '@uniswap/sdk-core'\nimport { Pool as V4Pool } from '@uniswap/v4-sdk'\nimport { TPool } from '@uniswap/router-sdk'\n\nexport function getPathCurrency(currency: Currency, pool: TPool): Currency {\n  // return currency if the currency matches a currency of the pool\n  if (pool.involvesToken(currency as Token)) {\n    return currency\n\n    // return if currency.wrapped if pool involves wrapped currency\n  } else if (pool.involvesToken(currency.wrapped as Token)) {\n    return currency.wrapped\n\n    // return native currency if pool involves native version of wrapped currency (only applies to V4)\n  } else if (pool instanceof V4Pool && pool.token0.wrapped.equals(currency)) {\n    return pool.token0\n  } else if (pool instanceof V4Pool && pool.token1.wrapped.equals(currency)) {\n    return pool.token1\n  } else {\n    throw new Error(`Expected currency ${currency.symbol} to be either ${pool.token0.symbol} or ${pool.token1.symbol}`)\n  }\n\n  return currency // this line needed for typescript to compile\n}\n","import { Currency } from '@uniswap/sdk-core'\nimport { ETH_ADDRESS } from './constants'\n\nexport function getCurrencyAddress(currency: Currency): string {\n  return currency.isNative ? ETH_ADDRESS : currency.wrapped.address\n}\n","import { RoutePlanner, CommandType } from '../../utils/routerCommands'\nimport { Trade as V2Trade, Pair } from '@uniswap/v2-sdk'\nimport { Trade as V3Trade, Pool as V3Pool, encodeRouteToPath } from '@uniswap/v3-sdk'\nimport {\n  Route as V4Route,\n  Trade as V4Trade,\n  Pool as V4Pool,\n  V4Planner,\n  encodeRouteToPath as encodeV4RouteToPath,\n  Actions,\n} from '@uniswap/v4-sdk'\nimport {\n  Trade as RouterTrade,\n  MixedRouteTrade,\n  Protocol,\n  IRoute,\n  RouteV2,\n  RouteV3,\n  MixedRouteSDK,\n  MixedRoute,\n  SwapOptions as RouterSwapOptions,\n  getOutputOfPools,\n  encodeMixedRouteToPath,\n  partitionMixedRouteByProtocol,\n} from '@uniswap/router-sdk'\nimport { Permit2Permit } from '../../utils/inputTokens'\nimport { getPathCurrency } from '../../utils/pathCurrency'\nimport { Currency, TradeType, Token, CurrencyAmount, Percent } from '@uniswap/sdk-core'\nimport { Command, RouterActionType, TradeConfig } from '../Command'\nimport { SENDER_AS_RECIPIENT, ROUTER_AS_RECIPIENT, CONTRACT_BALANCE, ETH_ADDRESS } from '../../utils/constants'\nimport { getCurrencyAddress } from '../../utils/getCurrencyAddress'\nimport { encodeFeeBips } from '../../utils/numbers'\nimport { BigNumber, BigNumberish } from 'ethers'\nimport { TPool } from '@uniswap/router-sdk'\n\nexport type FlatFeeOptions = {\n  amount: BigNumberish\n  recipient: string\n}\n\n// the existing router permit object doesn't include enough data for permit2\n// so we extend swap options with the permit2 permit\n// when safe mode is enabled, the SDK will add an extra ETH sweep for security\n// when useRouterBalance is enabled the SDK will use the balance in the router for the swap\nexport type SwapOptions = Omit<RouterSwapOptions, 'inputTokenPermit'> & {\n  useRouterBalance?: boolean\n  inputTokenPermit?: Permit2Permit\n  flatFee?: FlatFeeOptions\n  safeMode?: boolean\n  maxHopSlippage?: BigNumber[]\n}\n\nconst REFUND_ETH_PRICE_IMPACT_THRESHOLD = new Percent(50, 100)\n\ninterface Swap<TInput extends Currency, TOutput extends Currency> {\n  route: IRoute<TInput, TOutput, TPool>\n  inputAmount: CurrencyAmount<TInput>\n  outputAmount: CurrencyAmount<TOutput>\n}\n\n// Wrapper for uniswap router-sdk trade entity to encode swaps for Universal Router\n// also translates trade objects from previous (v2, v3) SDKs\nexport class UniswapTrade implements Command {\n  readonly tradeType: RouterActionType = RouterActionType.UniswapTrade\n  readonly payerIsUser: boolean\n\n  constructor(public trade: RouterTrade<Currency, Currency, TradeType>, public options: SwapOptions) {\n    if (!!options.fee && !!options.flatFee) throw new Error('Only one fee option permitted')\n\n    if (this.inputRequiresWrap || this.inputRequiresUnwrap || this.options.useRouterBalance) {\n      this.payerIsUser = false\n    } else {\n      this.payerIsUser = true\n    }\n  }\n\n  get isAllV4(): boolean {\n    let result = true\n    for (const swap of this.trade.swaps) {\n      result = result && swap.route.protocol == Protocol.V4\n    }\n    return result\n  }\n\n  // this.trade.swaps is an array of swaps / trades.\n  // we are iterating over one swap (trade) at a time so length is 1\n  // route is either v2, v3, v4, or mixed\n  // pathInput and pathOutput are the currencies of the input and output of the route\n  // this.trade.inputAmount is the input currency of the trade (could be different from pathInput)\n  // this.trade.outputAmount is the output currency of the trade (could be different from pathOutput)\n  // each route can have multiple pools\n  get inputRequiresWrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const route = swap.route\n    const firstPool = route.pools[0]\n\n    if (firstPool instanceof V4Pool) {\n      // If first pool is a v4 pool and input currency is native and the path input currency in the route is not native, we need to wrap.\n      return (\n        this.trade.inputAmount.currency.isNative &&\n        !(this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathInput.isNative\n      )\n    }\n    // If first pool is not a v4 pool and input currency is native, we need to wrap\n    return this.trade.inputAmount.currency.isNative\n  }\n\n  get inputRequiresUnwrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const route = swap.route\n    const firstPool = route.pools[0]\n\n    if (firstPool instanceof V4Pool) {\n      // If the first pool is a v4 pool and input currency is not native and the path input currency is native, we need to unwrap\n      return (\n        !this.trade.inputAmount.currency.isNative &&\n        (this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathInput.isNative\n      )\n    }\n    // If the first pool is not a v4 pool, we don't need to unwrap.\n    return false\n  }\n\n  get outputRequiresWrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const lastRoute = swap.route\n    const lastPool = lastRoute.pools[lastRoute.pools.length - 1]\n\n    // if last pool is v4:\n    if (lastPool instanceof V4Pool) {\n      // If output currency is not native but path currency output is native, we need to wrap\n      if (!this.trade.outputAmount.currency.isNative) {\n        if ((lastRoute as unknown as V4Route<Currency, Currency>).pathOutput.isNative) {\n          // this means path output is native and we need to wrap\n          return true\n        } else if (lastPool.currency1.equals(lastPool.currency0.wrapped) && lastRoute.pools.length > 1) {\n          let poolBefore = lastRoute.pools[lastRoute.pools.length - 2]\n          // this means last pool is eth-weth and pool before contains weth\n          if (\n            poolBefore instanceof V4Pool &&\n            (poolBefore.currency0.equals(lastPool.currency1) || poolBefore.currency1.equals(lastPool.currency1))\n          ) {\n            return true\n          } else if (poolBefore.token0.equals(lastPool.currency1) || poolBefore.token1.equals(lastPool.currency1)) {\n            // same for v2 and v3 pools\n            return true\n          }\n        }\n      }\n    }\n    // if last pool is not v4:\n    // we do not need to wrap because v2 and v3 pools already require wrapped tokens\n    return false\n  }\n\n  get outputRequiresUnwrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const lastRoute = swap.route\n    const lastPool = lastRoute.pools[lastRoute.pools.length - 1]\n\n    // if last pool is v4:\n    if (lastPool instanceof V4Pool) {\n      // If output currency is native and path currency output is not native, we need to unwrap\n      if (this.trade.outputAmount.currency.isNative) {\n        if (!(this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathOutput.isNative) {\n          // this means path output is weth and we need to unwrap\n          return true\n        } else if (\n          lastRoute.pools.length > 1 &&\n          lastRoute.pools[lastRoute.pools.length - 2] instanceof V4Pool &&\n          (lastRoute.pools[lastRoute.pools.length - 2] as V4Pool).currency0.isNative &&\n          lastPool.currency1.equals(lastPool.currency0.wrapped)\n        ) {\n          // this means last pool is eth-weth and we need to unwrap\n          return true\n        } else {\n          return false\n        }\n      }\n    }\n    // else: if path output currency is native, we need to unwrap because v2 and v3 pools already require wrapped tokens\n    return this.trade.outputAmount.currency.isNative\n  }\n\n  get outputRequiresTransition(): boolean {\n    return this.outputRequiresWrap || this.outputRequiresUnwrap\n  }\n\n  encode(planner: RoutePlanner, _config: TradeConfig): void {\n    // If the input currency is the native currency, we need to wrap it with the router as the recipient\n    if (this.inputRequiresWrap) {\n      // TODO: optimize if only one v2 pool we can directly send this to the pool\n      planner.addCommand(CommandType.WRAP_ETH, [\n        ROUTER_AS_RECIPIENT,\n        this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString(),\n      ])\n    } else if (this.inputRequiresUnwrap) {\n      // send wrapped token to router to unwrap\n      planner.addCommand(CommandType.PERMIT2_TRANSFER_FROM, [\n        (this.trade.inputAmount.currency as Token).address,\n        ROUTER_AS_RECIPIENT,\n        this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString(),\n      ])\n      planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, 0])\n    }\n    // The overall recipient at the end of the trade, SENDER_AS_RECIPIENT uses the msg.sender\n    this.options.recipient = this.options.recipient ?? SENDER_AS_RECIPIENT\n\n    // flag for whether we want to perform slippage check on aggregate output of multiple routes\n    //   1. when there are >2 exact input trades. this is only a heuristic,\n    //      as it's still more gas-expensive even in this case, but has benefits\n    //      in that the reversion probability is lower\n    const performAggregatedSlippageCheck =\n      this.trade.tradeType === TradeType.EXACT_INPUT && this.trade.routes.length > 2\n    const routerMustCustody =\n      performAggregatedSlippageCheck || this.outputRequiresTransition || hasFeeOption(this.options)\n\n    for (const swap of this.trade.swaps) {\n      switch (swap.route.protocol) {\n        case Protocol.V2:\n          addV2Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.V3:\n          addV3Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.V4:\n          addV4Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.MIXED:\n          addMixedSwap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        default:\n          throw new Error('UNSUPPORTED_TRADE_PROTOCOL')\n      }\n    }\n\n    let minimumAmountOut: BigNumber = BigNumber.from(\n      this.trade.minimumAmountOut(this.options.slippageTolerance).quotient.toString()\n    )\n    // The router custodies for 3 reasons: to unwrap, to take a fee, and/or to do a slippage check\n    if (routerMustCustody) {\n      const pools = this.trade.swaps[0].route.pools\n      const pathOutputCurrencyAddress = getCurrencyAddress(\n        getPathCurrency(this.trade.outputAmount.currency, pools[pools.length - 1])\n      )\n\n      // If there is a fee, that percentage is sent to the fee recipient\n      // In the case where ETH is the output currency, the fee is taken in WETH (for gas reasons)\n      if (!!this.options.fee) {\n        const feeBips = encodeFeeBips(this.options.fee.fee)\n        planner.addCommand(CommandType.PAY_PORTION, [pathOutputCurrencyAddress, this.options.fee.recipient, feeBips])\n\n        // If the trade is exact output, and a fee was taken, we must adjust the amount out to be the amount after the fee\n        // Otherwise we continue as expected with the trade's normal expected output\n        if (this.trade.tradeType === TradeType.EXACT_OUTPUT) {\n          minimumAmountOut = minimumAmountOut.sub(minimumAmountOut.mul(feeBips).div(10000))\n        }\n      }\n\n      // If there is a flat fee, that absolute amount is sent to the fee recipient\n      // In the case where ETH is the output currency, the fee is taken in WETH (for gas reasons)\n      if (!!this.options.flatFee) {\n        const feeAmount = this.options.flatFee.amount\n        if (minimumAmountOut.lt(feeAmount)) throw new Error('Flat fee amount greater than minimumAmountOut')\n\n        planner.addCommand(CommandType.TRANSFER, [pathOutputCurrencyAddress, this.options.flatFee.recipient, feeAmount])\n\n        // If the trade is exact output, and a fee was taken, we must adjust the amount out to be the amount after the fee\n        // Otherwise we continue as expected with the trade's normal expected output\n        if (this.trade.tradeType === TradeType.EXACT_OUTPUT) {\n          minimumAmountOut = minimumAmountOut.sub(feeAmount)\n        }\n      }\n\n      // The remaining tokens that need to be sent to the user after the fee is taken will be caught\n      // by this if-else clause.\n      if (this.outputRequiresUnwrap) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [this.options.recipient, minimumAmountOut])\n      } else if (this.outputRequiresWrap) {\n        planner.addCommand(CommandType.WRAP_ETH, [this.options.recipient, CONTRACT_BALANCE])\n      } else {\n        planner.addCommand(CommandType.SWEEP, [\n          getCurrencyAddress(this.trade.outputAmount.currency),\n          this.options.recipient,\n          minimumAmountOut,\n        ])\n      }\n    }\n\n    // for exactOutput swaps with native input or that perform an inputToken transition (wrap or unwrap)\n    // we need to send back the change to the user\n    if (this.trade.tradeType === TradeType.EXACT_OUTPUT || riskOfPartialFill(this.trade)) {\n      if (this.inputRequiresWrap) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [this.options.recipient, 0])\n      } else if (this.inputRequiresUnwrap) {\n        planner.addCommand(CommandType.WRAP_ETH, [this.options.recipient, CONTRACT_BALANCE])\n      } else if (this.trade.inputAmount.currency.isNative) {\n        // must refund extra native currency sent along for native v4 trades (no input transition)\n        planner.addCommand(CommandType.SWEEP, [ETH_ADDRESS, this.options.recipient, 0])\n      }\n    }\n\n    if (this.options.safeMode) planner.addCommand(CommandType.SWEEP, [ETH_ADDRESS, this.options.recipient, 0])\n  }\n}\n\n// encode a uniswap v2 swap\nfunction addV2Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { route, inputAmount, outputAmount }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const trade = new V2Trade(\n    route as RouteV2<TInput, TOutput>,\n    tradeType == TradeType.EXACT_INPUT ? inputAmount : outputAmount,\n    tradeType\n  )\n\n  if (tradeType == TradeType.EXACT_INPUT) {\n    planner.addCommand(CommandType.V2_SWAP_EXACT_IN, [\n      // if native, we have to unwrap so keep in the router for now\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      // if router will custody funds, we do aggregated slippage check from router\n      routerMustCustody ? 0 : trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      route.path.map((token) => token.wrapped.address),\n      payerIsUser,\n    ])\n  } else if (tradeType == TradeType.EXACT_OUTPUT) {\n    planner.addCommand(CommandType.V2_SWAP_EXACT_OUT, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      route.path.map((token) => token.wrapped.address),\n      payerIsUser,\n    ])\n  }\n}\n\n// encode a uniswap v3 swap\nfunction addV3Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { route, inputAmount, outputAmount }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const trade = V3Trade.createUncheckedTrade({\n    route: route as RouteV3<TInput, TOutput>,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const path = encodeRouteToPath(route as RouteV3<TInput, TOutput>, trade.tradeType === TradeType.EXACT_OUTPUT)\n  if (tradeType == TradeType.EXACT_INPUT) {\n    planner.addCommand(CommandType.V3_SWAP_EXACT_IN, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      routerMustCustody ? 0 : trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      path,\n      payerIsUser,\n    ])\n  } else if (tradeType == TradeType.EXACT_OUTPUT) {\n    planner.addCommand(CommandType.V3_SWAP_EXACT_OUT, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      path,\n      payerIsUser,\n    ])\n  }\n}\n\nfunction addV4Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { inputAmount, outputAmount, route }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  // create a deep copy of pools since v4Planner encoding tampers with array\n  const pools = route.pools.map((p) => p) as V4Pool[]\n  const v4Route = new V4Route(pools, inputAmount.currency, outputAmount.currency)\n  const trade = V4Trade.createUncheckedTrade({\n    route: v4Route,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const slippageToleranceOnSwap =\n    routerMustCustody && tradeType == TradeType.EXACT_INPUT ? undefined : options.slippageTolerance\n\n  const v4Planner = new V4Planner()\n  v4Planner.addTrade(trade, slippageToleranceOnSwap)\n  v4Planner.addSettle(trade.route.pathInput, payerIsUser)\n\n  // Handle split route output consistency:\n  // - If output is ETH and some routes output WETH: force all to output WETH, then unwrap\n  // - If output is WETH and some routes output ETH: force all to output ETH, then wrap\n  let pathOutputForTake = trade.route.pathOutput\n  let lastPool = v4Route.pools[v4Route.pools.length - 1]\n  let ethWethPool = lastPool.currency1.equals(lastPool.currency0.wrapped)\n\n  if (ethWethPool && v4Route.pools.length > 1) {\n    let poolBefore = v4Route.pools[v4Route.pools.length - 2]\n    if (pathOutputForTake.isNative && poolBefore.currency0.isNative) {\n      pathOutputForTake = pathOutputForTake.wrapped\n    } else if (\n      !pathOutputForTake.isNative &&\n      (poolBefore.currency0.equals(lastPool.currency1) || poolBefore.currency1.equals(lastPool.currency1))\n    ) {\n      pathOutputForTake = lastPool.currency0\n    }\n  }\n\n  v4Planner.addTake(\n    pathOutputForTake,\n    routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient ?? SENDER_AS_RECIPIENT\n  )\n  planner.addCommand(CommandType.V4_SWAP, [v4Planner.finalize()])\n}\n\n// encode a mixed route swap, i.e. including both v2 and v3 pools\nfunction addMixedSwap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  swap: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const route = swap.route as MixedRoute<TInput, TOutput>\n  const inputAmount = swap.inputAmount\n  const outputAmount = swap.outputAmount\n  const tradeRecipient = routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient ?? SENDER_AS_RECIPIENT\n\n  // single hop, so it can be reduced to plain swap logic for one protocol version\n  if (route.pools.length === 1) {\n    if (route.pools[0] instanceof V4Pool) {\n      return addV4Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else if (route.pools[0] instanceof V3Pool) {\n      return addV3Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else if (route.pools[0] instanceof Pair) {\n      return addV2Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else {\n      throw new Error('Invalid route type')\n    }\n  }\n\n  const trade = MixedRouteTrade.createUncheckedTrade({\n    route: route as MixedRoute<TInput, TOutput>,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const amountIn = trade.maximumAmountIn(options.slippageTolerance, inputAmount).quotient.toString()\n  const amountOut = routerMustCustody\n    ? 0\n    : trade.minimumAmountOut(options.slippageTolerance, outputAmount).quotient.toString()\n\n  // logic from\n  // https://github.com/Uniswap/router-sdk/blob/d8eed164e6c79519983844ca8b6a3fc24ebcb8f8/src/swapRouter.ts#L276\n  const sections = partitionMixedRouteByProtocol(route as MixedRoute<TInput, TOutput>)\n  const isLastSectionInRoute = (i: number) => {\n    return i === sections.length - 1\n  }\n\n  let inputToken = route.pathInput\n\n  for (let i = 0; i < sections.length; i++) {\n    const section = sections[i]\n    const routePool = section[0]\n    const outputToken = getOutputOfPools(section, inputToken)\n    const subRoute = new MixedRoute(new MixedRouteSDK([...section], inputToken, outputToken))\n\n    let nextInputToken\n    let swapRecipient\n\n    if (isLastSectionInRoute(i)) {\n      nextInputToken = outputToken\n      swapRecipient = tradeRecipient\n    } else {\n      const nextPool = sections[i + 1][0]\n      nextInputToken = getPathCurrency(outputToken, nextPool)\n\n      const v2PoolIsSwapRecipient = nextPool instanceof Pair && outputToken.equals(nextInputToken)\n      swapRecipient = v2PoolIsSwapRecipient ? (nextPool as Pair).liquidityToken.address : ROUTER_AS_RECIPIENT\n    }\n\n    if (routePool instanceof V4Pool) {\n      const v4Planner = new V4Planner()\n      const v4SubRoute = new V4Route(section as V4Pool[], subRoute.input, subRoute.output)\n\n      v4Planner.addSettle(inputToken, payerIsUser && i === 0, (i == 0 ? amountIn : CONTRACT_BALANCE) as BigNumber)\n      v4Planner.addAction(Actions.SWAP_EXACT_IN, [\n        {\n          currencyIn: inputToken.isNative ? ETH_ADDRESS : inputToken.address,\n          path: encodeV4RouteToPath(v4SubRoute),\n          amountIn: 0, // denotes open delta, amount set in v4Planner.addSettle()\n          amountOutMinimum: !isLastSectionInRoute(i) ? 0 : amountOut,\n        },\n      ])\n\n      // Handle split route output consistency for V4 sections in mixed routes\n      let outputTokenForTake = outputToken\n      if (isLastSectionInRoute(i)) {\n        let lastPool = route.pools[route.pools.length - 1]\n        let v4Pool = lastPool instanceof V4Pool\n        let ethWethPool = v4Pool ? (lastPool as V4Pool).currency1.equals((lastPool as V4Pool).currency0.wrapped) : false\n        let poolBefore = route.pools[route.pools.length - 2]\n\n        if (ethWethPool) {\n          if (outputToken.isNative && poolBefore.token0.isNative) {\n            outputTokenForTake = outputToken.wrapped\n          } else if (\n            !outputToken.isNative &&\n            (poolBefore.token0.equals(lastPool.token1) || poolBefore.token1.equals(lastPool.token1))\n          ) {\n            outputTokenForTake = lastPool.token0\n          }\n        }\n      }\n\n      v4Planner.addTake(outputTokenForTake, swapRecipient)\n\n      planner.addCommand(CommandType.V4_SWAP, [v4Planner.finalize()])\n    } else if (routePool instanceof V3Pool) {\n      planner.addCommand(CommandType.V3_SWAP_EXACT_IN, [\n        swapRecipient, // recipient\n        i == 0 ? amountIn : CONTRACT_BALANCE, // amountIn\n        !isLastSectionInRoute(i) ? 0 : amountOut, // amountOut\n        encodeMixedRouteToPath(subRoute), // path\n        payerIsUser && i === 0, // payerIsUser\n      ])\n    } else if (routePool instanceof Pair) {\n      planner.addCommand(CommandType.V2_SWAP_EXACT_IN, [\n        swapRecipient, // recipient\n        i === 0 ? amountIn : CONTRACT_BALANCE, // amountIn\n        !isLastSectionInRoute(i) ? 0 : amountOut, // amountOutMin\n        subRoute.path.map((token) => token.wrapped.address), // path\n        payerIsUser && i === 0,\n      ])\n    } else {\n      throw new Error('Unexpected Pool Type')\n    }\n\n    // perform a token transition (wrap/unwrap if necessary)\n    if (!isLastSectionInRoute(i)) {\n      if (outputToken.isNative && !nextInputToken.isNative) {\n        planner.addCommand(CommandType.WRAP_ETH, [ROUTER_AS_RECIPIENT, CONTRACT_BALANCE])\n      } else if (!outputToken.isNative && nextInputToken.isNative) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, 0])\n      }\n    }\n\n    inputToken = nextInputToken\n  }\n}\n\n// if price impact is very high, there's a chance of hitting max/min prices resulting in a partial fill of the swap\nfunction riskOfPartialFill(trade: RouterTrade<Currency, Currency, TradeType>): boolean {\n  return trade.priceImpact.greaterThan(REFUND_ETH_PRICE_IMPACT_THRESHOLD)\n}\n\nfunction hasFeeOption(swapOptions: SwapOptions): boolean {\n  return !!swapOptions.fee || !!swapOptions.flatFee\n}\n","import { BigNumber } from 'ethers'\nimport JSBI from 'jsbi'\nimport bn from 'bignumber.js'\nimport { Percent } from '@uniswap/sdk-core'\nimport { toHex } from '@uniswap/v3-sdk'\n\nexport function expandTo18DecimalsBN(n: number): BigNumber {\n  // use bn intermediately to allow decimals in intermediate calculations\n  return BigNumber.from(new bn(n).times(new bn(10).pow(18)).toFixed())\n}\n\nexport function expandTo18Decimals(n: number): JSBI {\n  return JSBI.BigInt(BigNumber.from(n).mul(BigNumber.from(10).pow(18)).toString())\n}\n\nexport function encodeFeeBips(fee: Percent): string {\n  return toHex(fee.multiply(10_000).quotient)\n}\n","import invariant from 'tiny-invariant'\nimport { ethers } from 'ethers'\nimport { validateAndParseAddress, BigintIsh } from '@uniswap/sdk-core'\nimport { NFTPermitOptions, NonfungiblePositionManager } from '@uniswap/v3-sdk'\nimport { PermitSingle } from '@uniswap/permit2-sdk'\nimport { CommandType, RoutePlanner } from './routerCommands'\nimport { ROUTER_AS_RECIPIENT } from './constants'\n\nexport interface Permit2Permit extends PermitSingle {\n  signature: string\n}\n\nexport type ApproveProtocol = {\n  token: string\n  protocol: string\n}\n\nexport type Permit2TransferFrom = {\n  token: string\n  amount: string\n  recipient?: string\n}\n\nexport type InputTokenOptions = {\n  permit2Permit?: Permit2Permit\n  permit2TransferFrom?: Permit2TransferFrom\n}\n\nconst SIGNATURE_LENGTH = 65\nconst EIP_2098_SIGNATURE_LENGTH = 64\n\nexport function encodePermit(planner: RoutePlanner, permit2: Permit2Permit): void {\n  let signature = permit2.signature\n\n  const length = ethers.utils.arrayify(permit2.signature).length\n  // signature data provided for EIP-1271 may have length different from ECDSA signature\n  if (length === SIGNATURE_LENGTH || length === EIP_2098_SIGNATURE_LENGTH) {\n    // sanitizes signature to cover edge cases of malformed EIP-2098 sigs and v used as recovery id\n    signature = ethers.utils.joinSignature(ethers.utils.splitSignature(permit2.signature))\n  }\n\n  planner.addCommand(CommandType.PERMIT2_PERMIT, [permit2, signature])\n}\n\nexport function encodeV3PositionPermit(planner: RoutePlanner, permit: NFTPermitOptions, tokenId: BigintIsh): void {\n  const calldata = NonfungiblePositionManager.INTERFACE.encodeFunctionData('permit', [\n    validateAndParseAddress(permit.spender),\n    tokenId,\n    permit.deadline,\n    permit.v,\n    permit.r,\n    permit.s,\n  ])\n\n  planner.addCommand(CommandType.V3_POSITION_MANAGER_PERMIT, [calldata])\n}\n\n// Handles the encoding of commands needed to gather input tokens for a trade\n// Approval: The router approving another address to take tokens.\n//   note: Only seaport and sudoswap support this action. Approvals are left open.\n// Permit: A Permit2 signature-based Permit to allow the router to access a user's tokens\n// Transfer: A Permit2 TransferFrom of tokens from a user to either the router or another address\nexport function encodeInputTokenOptions(planner: RoutePlanner, options: InputTokenOptions) {\n  // first ensure that all tokens provided for encoding are the same\n  if (!!options.permit2TransferFrom && !!options.permit2Permit)\n    invariant(options.permit2TransferFrom.token === options.permit2Permit.details.token, `inconsistent token`)\n\n  // if this order has a options.permit2Permit, encode it\n  if (!!options.permit2Permit) {\n    encodePermit(planner, options.permit2Permit)\n  }\n\n  if (!!options.permit2TransferFrom) {\n    planner.addCommand(CommandType.PERMIT2_TRANSFER_FROM, [\n      options.permit2TransferFrom.token,\n      options.permit2TransferFrom.recipient ? options.permit2TransferFrom.recipient : ROUTER_AS_RECIPIENT,\n      options.permit2TransferFrom.amount,\n    ])\n  }\n}\n","import { TypedDataDomain, TypedDataField } from '@ethersproject/abstract-signer'\nimport { BigNumber } from 'ethers'\n\nexport const EIP712_DOMAIN_NAME = 'UniversalRouter'\nexport const EIP712_DOMAIN_VERSION = '2'\n\nexport const EXECUTE_SIGNED_TYPES: Record<string, TypedDataField[]> = {\n  ExecuteSigned: [\n    { name: 'commands', type: 'bytes' },\n    { name: 'inputs', type: 'bytes[]' },\n    { name: 'intent', type: 'bytes' },\n    { name: 'data', type: 'bytes' },\n    { name: 'sender', type: 'address' },\n    { name: 'nonce', type: 'uint256' },\n    { name: 'deadline', type: 'uint256' },\n  ],\n}\n\n// When set as the nonce, the nonce check is skipped\nexport const NONCE_SKIP_CHECK = BigNumber.from('0x8000000000000000000000000000000000000000000000000000000000000000')\n\n/**\n * Generate a random nonce for signed execution\n */\nexport function generateNonce(): string {\n  const randomBytes = new Uint8Array(32)\n  for (let i = 0; i < 32; i++) {\n    randomBytes[i] = Math.floor(Math.random() * 256)\n  }\n  return BigNumber.from(randomBytes).toHexString()\n}\n\n/**\n * Get the EIP712 domain for a Universal Router contract\n */\nexport function getUniversalRouterDomain(chainId: number, routerAddress: string): TypedDataDomain {\n  return {\n    name: EIP712_DOMAIN_NAME,\n    version: EIP712_DOMAIN_VERSION,\n    chainId,\n    verifyingContract: routerAddress,\n  }\n}\n","import invariant from 'tiny-invariant'\nimport UniversalRouter from '@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json'\nimport { Interface } from '@ethersproject/abi'\nimport { TypedDataDomain, TypedDataField } from '@ethersproject/abstract-signer'\nimport { BigNumber, BigNumberish } from 'ethers'\nimport {\n  MethodParameters,\n  Multicall,\n  Position as V3Position,\n  NonfungiblePositionManager as V3PositionManager,\n  RemoveLiquidityOptions as V3RemoveLiquidityOptions,\n} from '@uniswap/v3-sdk'\nimport {\n  Position as V4Position,\n  V4PositionManager,\n  AddLiquidityOptions as V4AddLiquidityOptions,\n  MintOptions,\n  Pool as V4Pool,\n  PoolKey,\n} from '@uniswap/v4-sdk'\nimport { Trade as RouterTrade } from '@uniswap/router-sdk'\nimport { Currency, TradeType, Percent, CHAIN_TO_ADDRESSES_MAP, SupportedChainsType } from '@uniswap/sdk-core'\nimport { UniswapTrade, SwapOptions } from './entities/actions/uniswap'\nimport { AcrossV4DepositV3Params } from './entities/actions/across'\nimport { RoutePlanner, CommandType } from './utils/routerCommands'\nimport { encodePermit, encodeV3PositionPermit } from './utils/inputTokens'\nimport { UNIVERSAL_ROUTER_ADDRESS, UniversalRouterVersion } from './utils/constants'\nimport { generateNonce, getUniversalRouterDomain, EXECUTE_SIGNED_TYPES } from './utils/eip712'\n\nexport type SwapRouterConfig = {\n  sender?: string // address\n  deadline?: BigNumberish\n}\n\nexport type SignedRouteOptions = {\n  intent: string\n  data: string\n  sender: string\n  nonce?: string\n}\n\nexport type EIP712Payload = {\n  domain: TypedDataDomain\n  types: Record<string, TypedDataField[]>\n  value: {\n    commands: string\n    inputs: string[]\n    intent: string\n    data: string\n    sender: string\n    nonce: string\n    deadline: string\n  }\n}\n\nexport interface MigrateV3ToV4Options {\n  inputPosition: V3Position\n  outputPosition: V4Position\n  v3RemoveLiquidityOptions: V3RemoveLiquidityOptions\n  v4AddLiquidityOptions: V4AddLiquidityOptions\n}\n\nfunction isMint(options: V4AddLiquidityOptions): options is MintOptions {\n  return Object.keys(options).some((k) => k === 'recipient')\n}\n\nexport abstract class SwapRouter {\n  public static INTERFACE: Interface = new Interface(UniversalRouter.abi)\n\n  public static swapCallParameters(\n    trades: RouterTrade<Currency, Currency, TradeType>,\n    options: SwapOptions,\n    bridgeOptions?: AcrossV4DepositV3Params[]\n  ): MethodParameters {\n    // TODO: use permit if signature included in swapOptions\n    const planner = new RoutePlanner()\n\n    const trade: UniswapTrade = new UniswapTrade(trades, options)\n\n    const inputCurrency = trade.trade.inputAmount.currency\n    invariant(!(inputCurrency.isNative && !!options.inputTokenPermit), 'NATIVE_INPUT_PERMIT')\n\n    if (options.inputTokenPermit) {\n      encodePermit(planner, options.inputTokenPermit)\n    }\n\n    const nativeCurrencyValue = inputCurrency.isNative\n      ? BigNumber.from(trade.trade.maximumAmountIn(options.slippageTolerance).quotient.toString())\n      : BigNumber.from(0)\n\n    trade.encode(planner, { allowRevert: false })\n\n    if (bridgeOptions) {\n      bridgeOptions.forEach((bridge) => planner.addAcrossBridge(bridge))\n    }\n\n    return SwapRouter.encodePlan(planner, nativeCurrencyValue, {\n      deadline: options.deadlineOrPreviousBlockhash ? BigNumber.from(options.deadlineOrPreviousBlockhash) : undefined,\n    })\n  }\n\n  /**\n   * Builds the call parameters for a migration from a V3 position to a V4 position.\n   * Some requirements of the parameters:\n   *   - v3RemoveLiquidityOptions.collectOptions.recipient must equal v4PositionManager\n   *   - v3RemoveLiquidityOptions.liquidityPercentage must be 100%\n   *   - input pool and output pool must have the same tokens\n   *   - V3 NFT must be approved, or valid inputV3NFTPermit must be provided with UR as spender\n   */\n  public static migrateV3ToV4CallParameters(\n    options: MigrateV3ToV4Options,\n    positionManagerOverride?: string\n  ): MethodParameters {\n    const v4Pool: V4Pool = options.outputPosition.pool\n    const v3Token0 = options.inputPosition.pool.token0\n    const v3Token1 = options.inputPosition.pool.token1\n    const v4PositionManagerAddress =\n      positionManagerOverride ?? CHAIN_TO_ADDRESSES_MAP[v4Pool.chainId as SupportedChainsType].v4PositionManagerAddress\n\n    // owner of the v3 nft must be the receiver of the v4 nft\n\n    // validate the parameters\n    if (v4Pool.currency0.isNative) {\n      invariant(\n        (v4Pool.currency0.wrapped.equals(v3Token0) && v4Pool.currency1.equals(v3Token1)) ||\n          (v4Pool.currency0.wrapped.equals(v3Token1) && v4Pool.currency1.equals(v3Token0)),\n        'TOKEN_MISMATCH'\n      )\n    } else {\n      invariant(v3Token0 === v4Pool.token0, 'TOKEN0_MISMATCH')\n      invariant(v3Token1 === v4Pool.token1, 'TOKEN1_MISMATCH')\n    }\n\n    invariant(\n      options.v3RemoveLiquidityOptions.liquidityPercentage.equalTo(new Percent(100, 100)),\n      'FULL_REMOVAL_REQUIRED'\n    )\n    invariant(options.v3RemoveLiquidityOptions.burnToken == true, 'BURN_TOKEN_REQUIRED')\n    invariant(\n      options.v3RemoveLiquidityOptions.collectOptions.recipient === v4PositionManagerAddress,\n      'RECIPIENT_NOT_POSITION_MANAGER'\n    )\n    invariant(isMint(options.v4AddLiquidityOptions), 'MINT_REQUIRED')\n    invariant(options.v4AddLiquidityOptions.migrate, 'MIGRATE_REQUIRED')\n\n    const planner = new RoutePlanner()\n\n    // to prevent reentrancy by the pool hook, we initialize the v4 pool before moving funds\n    if (options.v4AddLiquidityOptions.createPool) {\n      const poolKey: PoolKey = V4Pool.getPoolKey(\n        v4Pool.currency0,\n        v4Pool.currency1,\n        v4Pool.fee,\n        v4Pool.tickSpacing,\n        v4Pool.hooks\n      )\n      planner.addCommand(CommandType.V4_INITIALIZE_POOL, [poolKey, v4Pool.sqrtRatioX96.toString()])\n      // remove createPool setting, so that it doesnt get encoded again later\n      delete options.v4AddLiquidityOptions.createPool\n    }\n\n    // add position permit to the universal router planner\n    if (options.v3RemoveLiquidityOptions.permit) {\n      // permit spender should be UR\n      const universalRouterAddress = UNIVERSAL_ROUTER_ADDRESS(\n        UniversalRouterVersion.V2_0,\n        options.inputPosition.pool.chainId as SupportedChainsType\n      )\n      invariant(universalRouterAddress == options.v3RemoveLiquidityOptions.permit.spender, 'INVALID_SPENDER')\n      // don't need to transfer it because v3posm uses isApprovedOrOwner()\n      encodeV3PositionPermit(planner, options.v3RemoveLiquidityOptions.permit, options.v3RemoveLiquidityOptions.tokenId)\n      // remove permit so that multicall doesnt add it again\n      delete options.v3RemoveLiquidityOptions.permit\n    }\n\n    // encode v3 withdraw\n    const v3RemoveParams: MethodParameters = V3PositionManager.removeCallParameters(\n      options.inputPosition,\n      options.v3RemoveLiquidityOptions\n    )\n    const v3Calls: string[] = Multicall.decodeMulticall(v3RemoveParams.calldata)\n\n    for (const v3Call of v3Calls) {\n      // slice selector - 0x + 4 bytes = 10 characters\n      const selector = v3Call.slice(0, 10)\n      invariant(\n        selector == V3PositionManager.INTERFACE.getSighash('collect') ||\n          selector == V3PositionManager.INTERFACE.getSighash('decreaseLiquidity') ||\n          selector == V3PositionManager.INTERFACE.getSighash('burn'),\n        'INVALID_V3_CALL: ' + selector\n      )\n      planner.addCommand(CommandType.V3_POSITION_MANAGER_CALL, [v3Call])\n    }\n\n    // encode v4 mint\n    const v4AddParams = V4PositionManager.addCallParameters(options.outputPosition, options.v4AddLiquidityOptions)\n    // only modifyLiquidities can be called by the UniversalRouter\n    const selector = v4AddParams.calldata.slice(0, 10)\n    invariant(selector == V4PositionManager.INTERFACE.getSighash('modifyLiquidities'), 'INVALID_V4_CALL: ' + selector)\n\n    planner.addCommand(CommandType.V4_POSITION_MANAGER_CALL, [v4AddParams.calldata])\n\n    return SwapRouter.encodePlan(planner, BigNumber.from(0), {\n      deadline: BigNumber.from(options.v4AddLiquidityOptions.deadline),\n    })\n  }\n\n  static getExecuteSignedPayload(\n    calldata: string,\n    signedOptions: SignedRouteOptions,\n    deadline: BigNumberish,\n    chainId: number,\n    routerAddress: string\n  ): EIP712Payload {\n    const iface = SwapRouter.INTERFACE\n    const decoded = iface.decodeFunctionData('execute', calldata)\n    const commands = decoded[0]\n    const inputs = decoded[1]\n    const nonce = signedOptions.nonce || generateNonce()\n    const domain = getUniversalRouterDomain(chainId, routerAddress)\n    return {\n      domain,\n      types: EXECUTE_SIGNED_TYPES,\n      value: {\n        commands,\n        inputs,\n        intent: signedOptions.intent,\n        data: signedOptions.data,\n        sender: signedOptions.sender,\n        nonce,\n        deadline: deadline.toString(),\n      },\n    }\n  }\n\n  static encodeExecuteSigned(\n    calldata: string,\n    signature: string,\n    signedOptions: SignedRouteOptions,\n    deadline: BigNumberish,\n    nativeCurrencyValue?: BigNumber\n  ): MethodParameters {\n    const iface = SwapRouter.INTERFACE\n    const decoded = iface.decodeFunctionData('execute', calldata)\n    const commands = decoded[0]\n    const inputs = decoded[1]\n    const nonce = signedOptions.nonce || generateNonce()\n    const executeSignedCalldata = iface.encodeFunctionData('executeSigned', [\n      commands,\n      inputs,\n      signedOptions.intent,\n      signedOptions.data,\n      signedOptions.sender,\n      nonce,\n      BigNumber.from(deadline).toString(),\n      signature,\n    ])\n    return {\n      calldata: executeSignedCalldata,\n      value: (nativeCurrencyValue || BigNumber.from(0)).toHexString(),\n    }\n  }\n\n  /**\n   * Encodes a planned route into a method name and parameters for the Router contract.\n   * @param planner the planned route\n   * @param nativeCurrencyValue the native currency value of the planned route\n   * @param config the router config\n   */\n  private static encodePlan(\n    planner: RoutePlanner,\n    nativeCurrencyValue: BigNumber,\n    config: SwapRouterConfig = {}\n  ): MethodParameters {\n    const { commands, inputs } = planner\n    const functionSignature = !!config.deadline ? 'execute(bytes,bytes[],uint256)' : 'execute(bytes,bytes[])'\n    const parameters = !!config.deadline ? [commands, inputs, config.deadline] : [commands, inputs]\n    const calldata = SwapRouter.INTERFACE.encodeFunctionData(functionSignature, parameters)\n    return { calldata, value: nativeCurrencyValue.toHexString() }\n  }\n}\n","import { MixedRouteSDK, Trade as RouterTrade } from '@uniswap/router-sdk'\nimport { Currency, CurrencyAmount, Ether, Token, TradeType } from '@uniswap/sdk-core'\nimport { Pair, Route as V2Route } from '@uniswap/v2-sdk'\nimport { Pool as V3Pool, Route as V3Route, FeeAmount } from '@uniswap/v3-sdk'\nimport { Pool as V4Pool, Route as V4Route } from '@uniswap/v4-sdk'\nimport { BigNumber } from 'ethers'\nimport { ETH_ADDRESS, E_ETH_ADDRESS } from './constants'\n\nexport type TokenInRoute = {\n  address: string\n  chainId: number\n  symbol: string\n  decimals: string\n  name?: string\n  buyFeeBps?: string\n  sellFeeBps?: string\n}\n\nexport enum PoolType {\n  V2Pool = 'v2-pool',\n  V3Pool = 'v3-pool',\n  V4Pool = 'v4-pool',\n}\n\nexport type V2Reserve = {\n  token: TokenInRoute\n  quotient: string\n}\n\nexport type V2PoolInRoute = {\n  type: PoolType.V2Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  reserve0: V2Reserve\n  reserve1: V2Reserve\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type V3PoolInRoute = {\n  type: PoolType.V3Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  sqrtRatioX96: string\n  liquidity: string\n  tickCurrent: string\n  fee: string\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type V4PoolInRoute = {\n  type: PoolType.V4Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  fee: string\n  tickSpacing: string\n  hooks: string\n  liquidity: string\n  sqrtRatioX96: string\n  tickCurrent: string\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type PartialClassicQuote = {\n  // We need tokenIn/Out to support native currency\n  tokenIn: string\n  tokenOut: string\n  tradeType: TradeType\n  route: Array<(V4PoolInRoute | V3PoolInRoute | V2PoolInRoute)[]>\n}\n\ninterface RouteResult {\n  routev4: V4Route<Currency, Currency> | null\n  routev3: V3Route<Currency, Currency> | null\n  routev2: V2Route<Currency, Currency> | null\n  mixedRoute: MixedRouteSDK<Currency, Currency> | null\n  inputAmount: CurrencyAmount<Currency>\n  outputAmount: CurrencyAmount<Currency>\n}\n\nexport const isNativeCurrency = (address: string) =>\n  address.toLowerCase() === ETH_ADDRESS.toLowerCase() || address.toLowerCase() === E_ETH_ADDRESS.toLowerCase()\n\n// Helper class to convert routing-specific quote entities to RouterTrade entities\n// the returned RouterTrade can then be used to build the UniswapTrade entity in this package\nexport class RouterTradeAdapter {\n  // Generate a RouterTrade using fields from a classic quote response\n  static fromClassicQuote(quote: PartialClassicQuote) {\n    const { route, tokenIn, tokenOut } = quote\n\n    if (!route) throw new Error('Expected route to be present')\n    if (!route.length) throw new Error('Expected there to be at least one route')\n    if (route.some((r) => !r.length)) throw new Error('Expected all routes to have at least one pool')\n    const firstRoute = route[0]\n\n    const tokenInData = firstRoute[0].tokenIn\n    const tokenOutData = firstRoute[firstRoute.length - 1].tokenOut\n\n    if (!tokenInData || !tokenOutData) throw new Error('Expected both tokenIn and tokenOut to be present')\n    if (tokenInData.chainId !== tokenOutData.chainId)\n      throw new Error('Expected tokenIn and tokenOut to be have same chainId')\n\n    const parsedCurrencyIn = RouterTradeAdapter.toCurrency(isNativeCurrency(tokenIn), tokenInData)\n    const parsedCurrencyOut = RouterTradeAdapter.toCurrency(isNativeCurrency(tokenOut), tokenOutData)\n\n    const typedRoutes: RouteResult[] = route.map((subRoute) => {\n      const rawAmountIn = subRoute[0].amountIn\n      const rawAmountOut = subRoute[subRoute.length - 1].amountOut\n\n      if (!rawAmountIn || !rawAmountOut) {\n        throw new Error('Expected both raw amountIn and raw amountOut to be present')\n      }\n\n      const inputAmount = CurrencyAmount.fromRawAmount(parsedCurrencyIn, rawAmountIn)\n      const outputAmount = CurrencyAmount.fromRawAmount(parsedCurrencyOut, rawAmountOut)\n\n      const isOnlyV2 = RouterTradeAdapter.isVersionedRoute<V2PoolInRoute>(PoolType.V2Pool, subRoute)\n      const isOnlyV3 = RouterTradeAdapter.isVersionedRoute<V3PoolInRoute>(PoolType.V3Pool, subRoute)\n      const isOnlyV4 = RouterTradeAdapter.isVersionedRoute<V4PoolInRoute>(PoolType.V4Pool, subRoute)\n      return {\n        routev4: isOnlyV4\n          ? new V4Route(\n              (subRoute as V4PoolInRoute[]).map(RouterTradeAdapter.toV4Pool),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        routev3: isOnlyV3\n          ? new V3Route(\n              (subRoute as V3PoolInRoute[]).map(RouterTradeAdapter.toV3Pool),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        routev2: isOnlyV2\n          ? new V2Route(\n              (subRoute as V2PoolInRoute[]).map(RouterTradeAdapter.toPair),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        mixedRoute:\n          !isOnlyV4 && !isOnlyV3 && !isOnlyV2\n            ? new MixedRouteSDK(subRoute.map(RouterTradeAdapter.toPoolOrPair), parsedCurrencyIn, parsedCurrencyOut)\n            : null,\n        inputAmount,\n        outputAmount,\n      }\n    })\n\n    return new RouterTrade({\n      v2Routes: typedRoutes\n        .filter((route) => route.routev2)\n        .map((route) => ({\n          routev2: route.routev2 as V2Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      v3Routes: typedRoutes\n        .filter((route) => route.routev3)\n        .map((route) => ({\n          routev3: route.routev3 as V3Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      v4Routes: typedRoutes\n        .filter((route) => route.routev4)\n        .map((route) => ({\n          routev4: route.routev4 as V4Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      mixedRoutes: typedRoutes\n        .filter((route) => route.mixedRoute)\n        .map((route) => ({\n          mixedRoute: route.mixedRoute as MixedRouteSDK<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      tradeType: quote.tradeType,\n    })\n  }\n\n  private static toCurrency(isNative: boolean, token: TokenInRoute): Currency {\n    if (isNative) {\n      return Ether.onChain(token.chainId)\n    }\n    return this.toToken(token)\n  }\n\n  private static toPoolOrPair = (pool: V4PoolInRoute | V3PoolInRoute | V2PoolInRoute): V4Pool | V3Pool | Pair => {\n    switch (pool.type) {\n      case PoolType.V4Pool:\n        return RouterTradeAdapter.toV4Pool(pool)\n      case PoolType.V3Pool:\n        return RouterTradeAdapter.toV3Pool(pool)\n      case PoolType.V2Pool:\n        return RouterTradeAdapter.toPair(pool)\n      default:\n        throw new Error('Invalid pool type')\n    }\n  }\n\n  private static toToken(token: TokenInRoute): Token {\n    const { chainId, address, decimals, symbol, buyFeeBps, sellFeeBps } = token\n    return new Token(\n      chainId,\n      address,\n      parseInt(decimals.toString()),\n      symbol,\n      /* name */ undefined,\n      false,\n      buyFeeBps ? BigNumber.from(buyFeeBps) : undefined,\n      sellFeeBps ? BigNumber.from(sellFeeBps) : undefined\n    )\n  }\n\n  private static toV3Pool({ fee, sqrtRatioX96, liquidity, tickCurrent, tokenIn, tokenOut }: V3PoolInRoute): V3Pool {\n    return new V3Pool(\n      RouterTradeAdapter.toToken(tokenIn),\n      RouterTradeAdapter.toToken(tokenOut),\n      parseInt(fee) as FeeAmount,\n      sqrtRatioX96,\n      liquidity,\n      parseInt(tickCurrent)\n    )\n  }\n\n  private static toV4Pool(pool: V4PoolInRoute): V4Pool {\n    const parsedCurrencyIn = RouterTradeAdapter.toCurrency(isNativeCurrency(pool.tokenIn.address), pool.tokenIn)\n    const parsedCurrencyOut = RouterTradeAdapter.toCurrency(isNativeCurrency(pool.tokenOut.address), pool.tokenOut)\n    return new V4Pool(\n      parsedCurrencyIn,\n      parsedCurrencyOut,\n      parseInt(pool.fee) as FeeAmount,\n      parseInt(pool.tickSpacing),\n      pool.hooks,\n      pool.sqrtRatioX96,\n      pool.liquidity,\n      parseInt(pool.tickCurrent)\n    )\n  }\n\n  private static toPair = ({ reserve0, reserve1 }: V2PoolInRoute): Pair => {\n    return new Pair(\n      CurrencyAmount.fromRawAmount(RouterTradeAdapter.toToken(reserve0.token), reserve0.quotient),\n      CurrencyAmount.fromRawAmount(RouterTradeAdapter.toToken(reserve1.token), reserve1.quotient)\n    )\n  }\n\n  private static isVersionedRoute<T extends V2PoolInRoute | V3PoolInRoute | V4PoolInRoute>(\n    type: PoolType,\n    route: (V3PoolInRoute | V2PoolInRoute | V4PoolInRoute)[]\n  ): route is T[] {\n    return route.every((pool) => pool.type === type)\n  }\n}\n","import invariant from 'tiny-invariant'\nimport { BigNumberish } from 'ethers'\nimport { RoutePlanner, CommandType } from '../../utils/routerCommands'\nimport { encodeInputTokenOptions, Permit2Permit } from '../../utils/inputTokens'\nimport { Command, RouterActionType, TradeConfig } from '../Command'\nimport { ROUTER_AS_RECIPIENT, WETH_ADDRESS } from '../../utils/constants'\n\nexport class UnwrapWETH implements Command {\n  readonly tradeType: RouterActionType = RouterActionType.UnwrapWETH\n  readonly permit2Data?: Permit2Permit\n  readonly wethAddress: string\n  readonly amount: BigNumberish\n\n  constructor(amount: BigNumberish, chainId: number, permit2?: Permit2Permit) {\n    this.wethAddress = WETH_ADDRESS(chainId)\n    this.amount = amount\n\n    if (!!permit2) {\n      invariant(\n        permit2.details.token.toLowerCase() === this.wethAddress.toLowerCase(),\n        `must be permitting WETH address: ${this.wethAddress}`\n      )\n      invariant(permit2.details.amount >= amount, `Did not permit enough WETH for unwrapWETH transaction`)\n      this.permit2Data = permit2\n    }\n  }\n\n  encode(planner: RoutePlanner, _: TradeConfig): void {\n    encodeInputTokenOptions(planner, {\n      permit2Permit: this.permit2Data,\n      permit2TransferFrom: {\n        token: this.wethAddress,\n        amount: this.amount.toString(),\n      },\n    })\n    planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, this.amount])\n  }\n}\n","import { ethers } from 'ethers'\nimport UniversalRouter from '@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json'\nimport { Interface } from '@ethersproject/abi'\nimport { V4BaseActionsParser, V4RouterAction } from '@uniswap/v4-sdk'\nimport { CommandType, CommandDefinition, COMMAND_DEFINITION, Subparser, Parser } from '../utils/routerCommands'\n\nexport type Param = {\n  readonly name: string\n  readonly value: any\n}\n\nexport type UniversalRouterCommand = {\n  readonly commandName: string\n  readonly commandType: CommandType\n  readonly params: readonly Param[]\n}\n\nexport type UniversalRouterCall = {\n  readonly commands: readonly UniversalRouterCommand[]\n}\n\nexport type V3PathItem = {\n  readonly tokenIn: string\n  readonly tokenOut: string\n  readonly fee: number\n}\n\nexport interface CommandsDefinition {\n  [key: number]: CommandDefinition\n}\n\n// Parses UniversalRouter V2 commands\nexport abstract class CommandParser {\n  public static INTERFACE: Interface = new Interface(UniversalRouter.abi)\n\n  public static parseCalldata(calldata: string): UniversalRouterCall {\n    const genericParser = new GenericCommandParser(COMMAND_DEFINITION)\n    const txDescription = CommandParser.INTERFACE.parseTransaction({ data: calldata })\n    const { commands, inputs } = txDescription.args\n    return genericParser.parse(commands, inputs)\n  }\n}\n\n// Parses commands based on given command definition\nexport class GenericCommandParser {\n  constructor(private readonly commandDefinition: CommandsDefinition) {}\n\n  public parse(commands: string, inputs: string[]): UniversalRouterCall {\n    const commandTypes = GenericCommandParser.getCommands(commands)\n\n    return {\n      commands: commandTypes.map((commandType: CommandType, i: number) => {\n        const commandDef = this.commandDefinition[commandType]\n\n        if (commandDef.parser === Parser.V4Actions) {\n          const { actions } = V4BaseActionsParser.parseCalldata(inputs[i])\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params: v4RouterCallToParams(actions),\n          }\n        } else if (commandDef.parser === Parser.Abi) {\n          const abiDef = commandDef.params\n          const rawParams = ethers.utils.defaultAbiCoder.decode(\n            abiDef.map((command) => command.type),\n            inputs[i]\n          )\n\n          const params = rawParams.map((param: any, j: number) => {\n            switch (abiDef[j].subparser) {\n              case Subparser.V3PathExactIn:\n                return {\n                  name: abiDef[j].name,\n                  value: parseV3PathExactIn(param),\n                }\n              case Subparser.V3PathExactOut:\n                return {\n                  name: abiDef[j].name,\n                  value: parseV3PathExactOut(param),\n                }\n              default:\n                return {\n                  name: abiDef[j].name,\n                  value: param,\n                }\n            }\n          })\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params,\n          }\n        } else if (commandDef.parser === Parser.V3Actions) {\n          // TODO: implement better parsing here\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params: inputs.map((input) => ({ name: 'command', value: input })),\n          }\n        } else {\n          throw new Error(`Unsupported parser: ${commandDef}`)\n        }\n      }),\n    }\n  }\n\n  // parse command types from bytes string\n  private static getCommands(commands: string): CommandType[] {\n    const commandTypes: CommandType[] = []\n\n    for (let i = 2; i < commands.length; i += 2) {\n      const byte = commands.substring(i, i + 2)\n      commandTypes.push(parseInt(byte, 16) as CommandType)\n    }\n\n    return commandTypes\n  }\n}\n\nexport function parseV3PathExactIn(path: string): readonly V3PathItem[] {\n  const strippedPath = path.replace('0x', '')\n  let tokenIn = ethers.utils.getAddress(strippedPath.substring(0, 40))\n  let loc = 40\n  const res: V3PathItem[] = []\n  while (loc < strippedPath.length) {\n    const feeAndTokenOut = strippedPath.substring(loc, loc + 46)\n    const fee = parseInt(feeAndTokenOut.substring(0, 6), 16)\n    const tokenOut = ethers.utils.getAddress(feeAndTokenOut.substring(6, 46))\n\n    res.push({\n      tokenIn,\n      tokenOut,\n      fee,\n    })\n    tokenIn = tokenOut\n    loc += 46\n  }\n\n  return res\n}\n\nexport function parseV3PathExactOut(path: string): readonly V3PathItem[] {\n  const strippedPath = path.replace('0x', '')\n  let tokenIn = ethers.utils.getAddress(strippedPath.substring(strippedPath.length - 40))\n  let loc = strippedPath.length - 86 // 86 = (20 addr + 3 fee + 20 addr) * 2 (for hex characters)\n  const res: V3PathItem[] = []\n  while (loc >= 0) {\n    const feeAndTokenOut = strippedPath.substring(loc, loc + 46)\n    const tokenOut = ethers.utils.getAddress(feeAndTokenOut.substring(0, 40))\n    const fee = parseInt(feeAndTokenOut.substring(40, 46), 16)\n\n    res.push({\n      tokenIn,\n      tokenOut,\n      fee,\n    })\n    tokenIn = tokenOut\n\n    loc -= 46\n  }\n\n  return res\n}\n\nfunction v4RouterCallToParams(actions: readonly V4RouterAction[]): readonly Param[] {\n  return actions.map((action) => {\n    return {\n      name: action.actionName,\n      value: action.params.map((param) => {\n        return {\n          name: param.name,\n          value: param.value,\n        }\n      }),\n    }\n  })\n}\n"],"names":["CommandType","Subparser","Parser","RouterActionType","UniversalRouterVersion","REVERTIBLE_COMMANDS","Set","EXECUTE_SUB_PLAN","COMMAND_DEFINITION","_COMMAND_DEFINITION","parser","Abi","params","name","type","PERMIT2_PERMIT","PERMIT2_PERMIT_BATCH","PERMIT2_TRANSFER_FROM","PERMIT2_TRANSFER_FROM_BATCH","PERMIT2_TRANSFER_FROM_STRUCT","V3_SWAP_EXACT_IN","subparser","V3PathExactIn","V3_SWAP_EXACT_OUT","V3PathExactOut","V2_SWAP_EXACT_IN","V2_SWAP_EXACT_OUT","V4_SWAP","V4Actions","WRAP_ETH","UNWRAP_WETH","SWEEP","TRANSFER","PAY_PORTION","BALANCE_CHECK_ERC20","V4_INITIALIZE_POOL","V3_POSITION_MANAGER_PERMIT","V3Actions","V3_POSITION_MANAGER_CALL","V4_POSITION_MANAGER_CALL","ACROSS_V4_DEPOSIT_V3","RoutePlanner","this","commands","inputs","_proto","prototype","addSubPlan","subplan","addCommand","addAcrossBridge","depositor","recipient","inputToken","outputToken","inputAmount","outputAmount","destinationChainId","exclusiveRelayer","quoteTimestamp","fillDeadline","exclusivityDeadline","message","useNative","parameters","allowRevert","command","commandDef","encodedInput","defaultAbiCoder","encode","map","abi","createCommand","push","has","Error","concat","toString","padStart","getPathCurrency","currency","pool","involvesToken","wrapped","V4Pool","token0","equals","token1","symbol","ZERO_ROUTER_CONFIG","address","creationBlock","CHAIN_CONFIGS","_CHAIN_CONFIGS","weth","routerConfigs","_routerConfigs","V1_2","V2_0","V2_1","_routerConfigs2","_routerConfigs3","_routerConfigs4","_routerConfigs5","_routerConfigs6","_routerConfigs7","_routerConfigs8","_routerConfigs9","_routerConfigs0","_routerConfigs1","_routerConfigs10","_routerConfigs11","_routerConfigs12","_routerConfigs13","_routerConfigs14","_routerConfigs15","_routerConfigs16","_routerConfigs17","_routerConfigs18","_routerConfigs19","_routerConfigs20","_routerConfigs21","_routerConfigs22","_routerConfigs23","_routerConfigs24","_routerConfigs25","_routerConfigs26","UNIVERSAL_ROUTER_ADDRESS","version","chainId","WETH_ADDRESS","CONTRACT_BALANCE","BigNumber","from","pow","ETH_ADDRESS","SENDER_AS_RECIPIENT","ROUTER_AS_RECIPIENT","getCurrencyAddress","isNative","REFUND_ETH_PRICE_IMPACT_THRESHOLD","Percent","UniswapTrade","trade","options","fee","flatFee","payerIsUser","inputRequiresWrap","inputRequiresUnwrap","useRouterBalance","planner","_config","maximumAmountIn","slippageTolerance","quotient","_this$options$recipie","swapOptions","_step","routerMustCustody","tradeType","TradeType","EXACT_INPUT","routes","length","outputRequiresTransition","_iterator","_createForOfIteratorHelperLoose","swaps","done","swap","value","route","protocol","Protocol","V2","addV2Swap","V3","addV3Swap","V4","addV4Swap","MIXED","addMixedSwap","minimumAmountOut","pools","pathOutputCurrencyAddress","feeBips","toHex","multiply","EXACT_OUTPUT","sub","mul","div","feeAmount","amount","lt","outputRequiresUnwrap","outputRequiresWrap","priceImpact","greaterThan","safeMode","key","get","_step2","result","_iterator2","pathInput","lastRoute","lastPool","pathOutput","currency1","currency0","poolBefore","_ref","V2Trade","path","token","_ref2","V3Trade","createUncheckedTrade","encodeRouteToPath","_ref3","p","v4Route","V4Route","V4Trade","slippageToleranceOnSwap","undefined","v4Planner","V4Planner","addTrade","addSettle","pathOutputForTake","addTake","_options$recipient","finalize","tradeRecipient","_options$recipient2","V3Pool","Pair","MixedRouteTrade","amountIn","amountOut","sections","partitionMixedRouteByProtocol","isLastSectionInRoute","i","section","routePool","getOutputOfPools","subRoute","MixedRoute","MixedRouteSDK","nextInputToken","swapRecipient","nextPool","liquidityToken","v4SubRoute","input","output","addAction","Actions","SWAP_EXACT_IN","currencyIn","encodeV4RouteToPath","amountOutMinimum","outputTokenForTake","ethWethPool","encodeMixedRouteToPath","encodePermit","permit2","signature","ethers","utils","arrayify","joinSignature","splitSignature","EXECUTE_SIGNED_TYPES","ExecuteSigned","NONCE_SKIP_CHECK","generateNonce","randomBytes","Uint8Array","Math","floor","random","toHexString","getUniversalRouterDomain","routerAddress","verifyingContract","SwapRouter","swapCallParameters","trades","bridgeOptions","inputCurrency","inputTokenPermit","invariant","nativeCurrencyValue","forEach","bridge","encodePlan","deadline","deadlineOrPreviousBlockhash","migrateV3ToV4CallParameters","positionManagerOverride","v4Pool","outputPosition","v3Token0","inputPosition","v3Token1","v4PositionManagerAddress","CHAIN_TO_ADDRESSES_MAP","v3RemoveLiquidityOptions","liquidityPercentage","equalTo","burnToken","collectOptions","Object","keys","some","k","isMint","v4AddLiquidityOptions","migrate","createPool","poolKey","getPoolKey","tickSpacing","hooks","sqrtRatioX96","permit","spender","tokenId","calldata","NonfungiblePositionManager","INTERFACE","encodeFunctionData","validateAndParseAddress","v","r","s","encodeV3PositionPermit","v3RemoveParams","V3PositionManager","removeCallParameters","Multicall","decodeMulticall","v3Call","selector","slice","getSighash","v4AddParams","V4PositionManager","addCallParameters","getExecuteSignedPayload","signedOptions","decoded","decodeFunctionData","nonce","domain","types","intent","data","sender","encodeExecuteSigned","iface","config","Interface","UniversalRouter","PoolType","UnwrapWETH","wethAddress","details","toLowerCase","permit2Data","_","permit2TransferFrom","permit2Permit","encodeInputTokenOptions","isNativeCurrency","RouterTradeAdapter","fromClassicQuote","quote","tokenIn","tokenOut","firstRoute","tokenInData","tokenOutData","parsedCurrencyIn","toCurrency","parsedCurrencyOut","typedRoutes","rawAmountIn","rawAmountOut","CurrencyAmount","fromRawAmount","isOnlyV2","isVersionedRoute","V2Pool","isOnlyV3","isOnlyV4","routev4","toV4Pool","routev3","V3Route","toV3Pool","routev2","V2Route","toPair","mixedRoute","toPoolOrPair","RouterTrade","v2Routes","filter","v3Routes","v4Routes","mixedRoutes","Ether","onChain","toToken","buyFeeBps","sellFeeBps","Token","parseInt","decimals","liquidity","tickCurrent","every","reserve0","reserve1","CommandParser","parseCalldata","genericParser","GenericCommandParser","_txDescription$args","parseTransaction","args","parse","commandDefinition","getCommands","commandType","actions","_this","_V4BaseActionsParser$","V4BaseActionsParser","commandName","action","actionName","param","abiDef","decode","j","parseV3PathExactIn","parseV3PathExactOut","commandTypes","byte","substring","strippedPath","replace","getAddress","loc","res","feeAndTokenOut"],"mappings":"gJAQYA,EA6BAC,EAKAC,+9CAlCAF,EAAAA,sBAAAA,kEAEVA,6CACAA,qDACAA,mDACAA,qBACAA,2BACAA,iCAEAA,2CACAA,6CACAA,wCACAA,4BACAA,kCACAA,kEACAA,kDAEAA,0BACAA,gEACAA,4DACAA,gDACAA,4DAEAA,4CAGAA,qDAGUC,EAAAA,oBAAAA,0DAEVA,wCAGUC,EAAAA,iBAAAA,mCAEVA,6BACAA,6BAqBF,IC5DYC,4DCJAC,EFiENC,EAAsB,IAAIC,IAAiB,CAACN,oBAAYO,mBAajDC,IAAkBC,MAE5BT,oBAAYO,kBAAmB,CAC9BG,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,WAAYC,KAAM,SAC1B,CAAED,KAAM,SAAUC,KAAM,aAE3BL,EAGAT,oBAAYe,gBAAiB,CAC5BL,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,SAAUC,KAxBtB,+GAyBI,CAAED,KAAM,YAAaC,KAAM,WAE9BL,EACAT,oBAAYgB,sBAAuB,CAClCN,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,SAAUC,KA5BtB,iHA6BI,CAAED,KAAM,YAAaC,KAAM,WAE9BL,EACAT,oBAAYiB,uBAAwB,CACnCP,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,QAASC,KAAM,WACvB,CAAED,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,SAAUC,KAAM,aAE3BL,EACAT,oBAAYkB,6BAA8B,CACzCR,OAAQR,eAAOS,IACfC,OAAQ,CACN,CACEC,KAAM,eACNC,KAxCmCK,8DA2CxCV,EAGAT,oBAAYoB,kBAAmB,CAC9BV,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,WAAYC,KAAM,WAC1B,CAAED,KAAM,eAAgBC,KAAM,WAC9B,CAAED,KAAM,OAAQQ,UAAWpB,kBAAUqB,cAAeR,KAAM,SAC1D,CAAED,KAAM,cAAeC,KAAM,UAEhCL,EACAT,oBAAYuB,mBAAoB,CAC/Bb,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,cAAeC,KAAM,WAC7B,CAAED,KAAM,OAAQQ,UAAWpB,kBAAUuB,eAAgBV,KAAM,SAC3D,CAAED,KAAM,cAAeC,KAAM,UAEhCL,EACAT,oBAAYyB,kBAAmB,CAC9Bf,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,WAAYC,KAAM,WAC1B,CAAED,KAAM,eAAgBC,KAAM,WAC9B,CAAED,KAAM,OAAQC,KAAM,aACtB,CAAED,KAAM,cAAeC,KAAM,UAEhCL,EACAT,oBAAY0B,mBAAoB,CAC/BhB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,cAAeC,KAAM,WAC7B,CAAED,KAAM,OAAQC,KAAM,aACtB,CAAED,KAAM,cAAeC,KAAM,UAEhCL,EACAT,oBAAY2B,SAAU,CAAEjB,OAAQR,eAAO0B,WAAWnB,EAGlDT,oBAAY6B,UAAW,CACtBnB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,SAAUC,KAAM,aAE3BL,EACAT,oBAAY8B,aAAc,CACzBpB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,YAAaC,KAAM,aAE9BL,EACAT,oBAAY+B,OAAQ,CACnBrB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,QAASC,KAAM,WACvB,CAAED,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,YAAaC,KAAM,aAE9BL,EACAT,oBAAYgC,UAAW,CACtBtB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,QAASC,KAAM,WACvB,CAAED,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,QAASC,KAAM,aAE1BL,EACAT,oBAAYiC,aAAc,CACzBvB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,QAASC,KAAM,WACvB,CAAED,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,OAAQC,KAAM,aAEzBL,EACAT,oBAAYkC,qBAAsB,CACjCxB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,QAASC,KAAM,WACvB,CAAED,KAAM,QAASC,KAAM,WACvB,CAAED,KAAM,aAAcC,KAAM,aAE/BL,EACAT,oBAAYmC,oBAAqB,CAChCzB,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,UAAWC,KA7ID,oFA8IlB,CAAED,KAAM,eAAgBC,KAAM,aAEjCL,EAGAT,oBAAYoC,4BAA6B,CAAE1B,OAAQR,eAAOmC,WAAW5B,EACrET,oBAAYsC,0BAA2B,CAAE5B,OAAQR,eAAOmC,WAAW5B,EACnET,oBAAYuC,0BAA2B,CAAE7B,OAAQR,eAAO0B,WAAWnB,EAGnET,oBAAYwC,sBAAuB,CAClC9B,OAAQR,eAAOS,IACfC,OAAQ,CACN,CAAEC,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,YAAaC,KAAM,WAC3B,CAAED,KAAM,aAAcC,KAAM,WAC5B,CAAED,KAAM,cAAeC,KAAM,WAC7B,CAAED,KAAM,cAAeC,KAAM,WAC7B,CAAED,KAAM,eAAgBC,KAAM,WAC9B,CAAED,KAAM,qBAAsBC,KAAM,WACpC,CAAED,KAAM,mBAAoBC,KAAM,WAClC,CAAED,KAAM,iBAAkBC,KAAM,UAChC,CAAED,KAAM,eAAgBC,KAAM,UAC9B,CAAED,KAAM,sBAAuBC,KAAM,UACrC,CAAED,KAAM,UAAWC,KAAM,SACzB,CAAED,KAAM,YAAaC,KAAM,UAE9BL,GAGUgC,aAIX,SAAAA,IACEC,KAAKC,SAAW,KAChBD,KAAKE,OAAS,GACf,IAAAC,EAAAJ,EAAAK,UAsCA,OAtCAD,EAEDE,WAAA,SAAWC,GAET,OADAN,KAAKO,WAAWjD,oBAAYO,iBAAkB,CAACyC,EAAQL,SAAUK,EAAQJ,SAAS,GAC3EF,MACRG,EAEDK,gBAAA,SAAgBtC,GAgBd,OAfA8B,KAAKO,WAAWjD,oBAAYwC,qBAAsB,CAChD5B,EAAOuC,UACPvC,EAAOwC,UACPxC,EAAOyC,WACPzC,EAAO0C,YACP1C,EAAO2C,YACP3C,EAAO4C,aACP5C,EAAO6C,mBACP7C,EAAO8C,iBACP9C,EAAO+C,eACP/C,EAAOgD,aACPhD,EAAOiD,oBACPjD,EAAOkD,QACPlD,EAAOmD,YAEFrB,MACRG,EAEDI,WAAA,SAAWnC,EAAmBkD,EAAmBC,YAAAA,IAAAA,GAAc,GAC7D,IAAIC,WAmBsBpD,EAAmBkD,GAC/C,IAAMG,EAAa3D,EAAmBM,GACtC,OAAQqD,EAAWzD,QACjB,KAAKR,eAAOS,IAKV,MAAO,CAAEG,KAAAA,EAAMsD,aAJMC,kBAAgBC,OACnCH,EAAWvD,OAAO2D,KAAI,SAACC,GAAG,OAAKA,EAAI1D,QACnCkD,IAGJ,KAAK9D,eAAO0B,UAGZ,KAAK1B,eAAOmC,UAEV,MAAO,CAAEvB,KAAAA,EAAMsD,aAAcJ,EAAW,KAjC5BS,CAAc3D,EAAMkD,GAElC,GADAtB,KAAKE,OAAO8B,KAAKR,EAAQE,cACrBH,EAAa,CACf,IAAK5D,EAAoBsE,IAAIT,EAAQpD,MACnC,MAAM,IAAI8D,uBAAuBV,EAAQpD,qCAE3CoD,EAAQpD,KA7NY,IA6NLoD,EAAQpD,KAIzB,OADA4B,KAAKC,SAAWD,KAAKC,SAASkC,OAAOX,EAAQpD,KAAKgE,SAAS,IAAIC,SAAS,EAAG,MACpErC,MACRD,cGhSauC,EAAgBC,EAAoBC,GAElD,GAAIA,EAAKC,cAAcF,GACrB,OAAOA,EAGF,GAAIC,EAAKC,cAAcF,EAASG,SACrC,OAAOH,EAASG,QAGX,GAAIF,aAAgBG,QAAUH,EAAKI,OAAOF,QAAQG,OAAON,GAC9D,OAAOC,EAAKI,OACP,GAAIJ,aAAgBG,QAAUH,EAAKM,OAAOJ,QAAQG,OAAON,GAC9D,OAAOC,EAAKM,OAEZ,MAAM,IAAIZ,2BAA2BK,EAASQ,wBAAuBP,EAAKI,OAAOG,cAAaP,EAAKM,OAAOC,SFblGtF,EAAAA,2BAAAA,0DAEVA,2BCNUC,EAAAA,iCAAAA,+CAEVA,aACAA,aAaF,IAAMsF,EAAmC,CACvCC,QAAS,6CACTC,cAAe,GAMJC,KAAaC,MAEvB,GAAI,CACHC,KAAM,6CACNC,eAAaC,KAAAA,EACV7F,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,UAChBK,EACA7F,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,UAChBK,EACA7F,+BAAuBgG,MAAO,CAC7BT,QAAS,6CACTC,cAAe,UAChBK,IAEJH,EAEA,GAAI,CACHC,KAAM,6CACNC,eAAaK,KAAAA,EACVjG,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,SAChBS,EACAjG,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,SAChBS,EACAjG,+BAAuBgG,MAAOV,EAAkBW,IAEpDP,EAEA,UAAW,CACVC,KAAM,6CACNC,eAAaM,KAAAA,EACVlG,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,SAChBU,EACAlG,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,SAChBU,EACAlG,+BAAuBgG,MAAO,CAC7BT,QAAS,6CACTC,cAAe,SAChBU,IAEJR,EAEA,KAAM,CACLC,KAAM,6CACNC,eAAaO,KAAAA,EACVnG,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,UAChBW,EACAnG,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,UAChBW,EACAnG,+BAAuBgG,MAAO,CAC7BT,QAAS,6CACTC,cAAe,UAChBW,IAEJT,EAEA,OAAQ,CACPC,KAAM,6CACNC,eAAaQ,KAAAA,EACVpG,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,UAChBY,EACApG,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,UAChBY,EACApG,+BAAuBgG,MAAOV,EAAkBc,IAEpDV,EAEA,IAAK,CACJC,KAAM,6CACNC,eAAaS,KAAAA,EACVrG,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,WAChBa,EACArG,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,WAChBa,EACArG,+BAAuBgG,MAAO,CAC7BT,QAAS,6CACTC,cAAe,WAChBa,IAEJX,EAEA,KAAM,CACLC,KAAM,6CACNC,eAAaU,KAAAA,EACVtG,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,SAChBc,EACAtG,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,SAChBc,EACAtG,+BAAuBgG,MAAOV,EAAkBgB,IAEpDZ,EAEA,OAAQ,CACPC,KAAM,6CACNC,eAAaW,KAAAA,EACVvG,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,WAChBe,EACAvG,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,WAChBe,EACAvG,+BAAuBgG,MAAO,CAC7BT,QAAS,6CACTC,cAAe,WAChBe,IAEJb,EAEA,QAAS,CACRC,KAAM,6CACNC,eAAaY,KAAAA,EACVxG,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,UAChBgB,EACAxG,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,UAChBgB,EACAxG,+BAAuBgG,MAAOV,EAAkBkB,IAEpDd,EAEA,OAAQ,CACPC,KA5JgC,6CA6JhCC,eAAaa,KAAAA,EACVzG,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,UAChBiB,EACAzG,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,UAChBiB,EACAzG,+BAAuBgG,MAAOV,EAAkBmB,IAEpDf,EAEA,OAAQ,CACPC,KA3KgC,6CA4KhCC,eAAac,KAAAA,EACV1G,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,UAChBkB,EACA1G,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,UAChBkB,EACA1G,+BAAuBgG,MAAOV,EAAkBoB,IAEpDhB,EAEA,IAAK,CACJC,KAAM,6CACNC,eAAae,KAAAA,EACV3G,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,UAChBmB,EACA3G,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,YAChBmB,EACA3G,+BAAuBgG,MAAOV,EAAkBqB,IAEpDjB,EAEA,OAAQ,CACPC,KAAM,6CACNC,eAAagB,KAAAA,EACV5G,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,UAChBoB,EACA5G,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,YAChBoB,EACA5G,+BAAuBgG,MAAO,CAC7BT,QAAS,6CACTC,cAAe,UAChBoB,IAEJlB,EAEA,OAAQ,CACPC,KAAM,6CACNC,eAAaiB,KAAAA,EACV7G,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,SAChBqB,EACA7G,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,SAChBqB,EACA7G,+BAAuBgG,MAAOV,EAAkBuB,IAEpDnB,EAEA,MAAO,CACNC,KAAM,6CACNC,eAAakB,KAAAA,EACV9G,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,SAChBsB,EACA9G,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,YAChBsB,EACA9G,+BAAuBgG,MAAO,CAC7BT,QAAS,6CACTC,cAAe,UAChBsB,IAEJpB,EAEA,OAAQ,CACPC,KAAM,6CACNC,eAAamB,KAAAA,EACV/G,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,SAChBuB,EACA/G,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,YAChBuB,EACA/G,+BAAuBgG,MAAOV,EAAkByB,IAEpDrB,EAEA,SAAU,CACTC,KAAM,6CACNC,eAAaoB,KAAAA,EACVhH,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,UAChBwB,EACAhH,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,YAChBwB,EACAhH,+BAAuBgG,MAAOV,EAAkB0B,IAEpDtB,EACA,KAAM,CACLC,KAAM,6CACNC,eAAaqB,KAAAA,EACVjH,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,UAChByB,EACAjH,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,UAChByB,EACAjH,+BAAuBgG,MAAOV,EAAkB2B,IAEpDvB,EAEA,KAAM,CACLC,KAAM,6CACNC,eAAasB,KAAAA,EACVlH,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,SAChB0B,EACAlH,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,YAChB0B,EACAlH,+BAAuBgG,MAAOV,EAAkB4B,IAEpDxB,EACA,MAAO,CACNC,KAAM,6CACNC,eAAauB,KAAAA,EACVnH,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,SAChB2B,EACAnH,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,SAChB2B,EACAnH,+BAAuBgG,MAAOV,EAAkB6B,IAEpDzB,EAEA,KAAM,CACLC,KAAM,6CACNC,eAAawB,KAAAA,EACVpH,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,OAChB4B,EACApH,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,YAChB4B,EACApH,+BAAuBgG,MAAOV,EAAkB8B,IAEpD1B,EACA,OAAQ,CACPC,KAAM,6CACNC,eAAayB,KAAAA,EACVrH,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,OAChB6B,EACArH,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,OAChB6B,EACArH,+BAAuBgG,MAAOV,EAAkB+B,IAEpD3B,EACA,OAAQ,CACPC,KAAM,6CACNC,eAAa0B,KAAAA,EACVtH,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,UAChB8B,EACAtH,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,UAChB8B,EACAtH,+BAAuBgG,MAAOV,EAAkBgC,IAEpD5B,EACA,MAAO,CACNC,KAAM,6CACNC,eAAa2B,KAAAA,EACVvH,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,SAChB+B,EACAvH,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,SAChB+B,EACAvH,+BAAuBgG,MAAOV,EAAkBiC,IAEpD7B,EACA,KAAM,CACLC,KAAM,6CACNC,eAAa4B,KAAAA,EACVxH,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,UAChBgC,EACAxH,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,UAChBgC,EACAxH,+BAAuBgG,MAAOV,EAAkBkC,IAEpD9B,EACA,KAAM,CACLC,KAAM,6CACNC,eAAa6B,KAAAA,EACVzH,+BAAuB8F,MAAO,CAC7BP,QAAS,6CACTC,cAAe,GAChBiC,EACAzH,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,UAChBiC,EACAzH,+BAAuBgG,MAAOV,EAAkBmC,IAEpD/B,EAEA,IAAK,CACJC,KA1ZgC,6CA2ZhCC,eAAa8B,KAAAA,EACV1H,+BAAuB8F,MAAOR,EAAkBoC,EAChD1H,+BAAuB+F,MAAOT,EAAkBoC,EAChD1H,+BAAuBgG,MAAOV,EAAkBoC,IAEpDhC,EAEA,WAAY,CACXC,KAAM,6CACNC,eAAa+B,KAAAA,EACV3H,+BAAuB8F,MAAOR,EAAkBqC,EAChD3H,+BAAuB+F,MAAO,CAC7BR,QAAS,6CACTC,cAAe,SAChBmC,EACA3H,+BAAuBgG,MAAOV,EAAkBqC,IAEpDjC,GAGUkC,GAA2B,SAACC,EAAiCC,GACxE,KAAMA,KAAWrC,IAAgB,MAAM,IAAIjB,gDAAgDsD,GAC3F,OAAOrC,GAAcqC,GAASlC,cAAciC,GAAStC,SAQ1CwC,GAAe,SAACD,GAC3B,KAAMA,KAAWrC,IAAgB,MAAM,IAAIjB,gDAAgDsD,GAE3F,GA5bkC,8CA4b9BrC,GAAcqC,GAASnC,KAAqC,MAAM,IAAInB,eAAesD,yBAEzF,OAAOrC,GAAcqC,GAASnC,MAGnBqC,GAAmBC,YAAUC,KAAK,GAAGC,IAAI,KACzCC,GAAc,6CAMdC,GAAsB,6CACtBC,GAAsB,sDE7dnBC,GAAmB1D,GACjC,OAAOA,EAAS2D,SAAWJ,GAAcvD,EAASG,QAAQO,YCgDtDkD,GAAoC,IAAIC,UAAQ,GAAI,KAU7CC,cAIX,SAAAA,EAAmBC,EAA0DC,GAC3E,GADiBvG,WAAAsG,EAA0DtG,aAAAuG,EAHpEvG,eAA8BvC,yBAAiB4I,aAIhDE,EAAQC,KAASD,EAAQE,QAAS,MAAM,IAAIvE,MAAM,iCAGtDlC,KAAK0G,cADH1G,KAAK2G,mBAAqB3G,KAAK4G,qBAAuB5G,KAAKuG,QAAQM,kBAKxE,QAqOA,OArOAR,EAAAjG,UAkHDwB,OAAA,SAAOkF,EAAuBC,SAExB/G,KAAK2G,kBAEPG,EAAQvG,WAAWjD,oBAAY6B,SAAU,CACvC6G,GACAhG,KAAKsG,MAAMU,gBAAgBhH,KAAKuG,QAAQU,mBAAmBC,SAAS9E,aAE7DpC,KAAK4G,sBAEdE,EAAQvG,WAAWjD,oBAAYiB,sBAAuB,CACnDyB,KAAKsG,MAAMzF,YAAY0B,SAAmBU,QAC3C+C,GACAhG,KAAKsG,MAAMU,gBAAgBhH,KAAKuG,QAAQU,mBAAmBC,SAAS9E,aAEtE0E,EAAQvG,WAAWjD,oBAAY8B,YAAa,CAAC4G,GAAqB,KAGpEhG,KAAKuG,QAAQ7F,iBAASyG,EAAGnH,KAAKuG,QAAQ7F,WAASyG,EAAIpB,GAWnD,IALA,IAwWkBqB,EAnWiBC,EAH7BC,EADJtH,KAAKsG,MAAMiB,YAAcC,YAAUC,aAAezH,KAAKsG,MAAMoB,OAAOC,OAAS,GAE3C3H,KAAK4H,6BAqWvBR,EArWgEpH,KAAKuG,SAsWpEC,OAASY,EAAYX,QApWxCoB,EAAAC,EAAmB9H,KAAKsG,MAAMyB,SAAKV,EAAAQ,KAAAG,MAAE,CAAA,IAA1BC,EAAIZ,EAAAa,MACb,OAAQD,EAAKE,MAAMC,UACjB,KAAKC,WAASC,GACZC,GAAUzB,EAASmB,EAAMjI,KAAKsG,MAAMiB,UAAWvH,KAAKuG,QAASvG,KAAK0G,YAAaY,GAC/E,MACF,KAAKe,WAASG,GACZC,GAAU3B,EAASmB,EAAMjI,KAAKsG,MAAMiB,UAAWvH,KAAKuG,QAASvG,KAAK0G,YAAaY,GAC/E,MACF,KAAKe,WAASK,GACZC,GAAU7B,EAASmB,EAAMjI,KAAKsG,MAAMiB,UAAWvH,KAAKuG,QAASvG,KAAK0G,YAAaY,GAC/E,MACF,KAAKe,WAASO,MACZC,GAAa/B,EAASmB,EAAMjI,KAAKsG,MAAMiB,UAAWvH,KAAKuG,QAASvG,KAAK0G,YAAaY,GAClF,MACF,QACE,MAAM,IAAIpF,MAAM,+BAItB,IAAI4G,EAA8BnD,YAAUC,KAC1C5F,KAAKsG,MAAMwC,iBAAiB9I,KAAKuG,QAAQU,mBAAmBC,SAAS9E,YAGvE,GAAIkF,EAAmB,CACrB,IAAMyB,EAAQ/I,KAAKsG,MAAMyB,MAAM,GAAGI,MAAMY,MAClCC,EAA4B/C,GAChC3D,EAAgBtC,KAAKsG,MAAMxF,aAAayB,SAAUwG,EAAMA,EAAMpB,OAAS,KAKzE,GAAM3H,KAAKuG,QAAQC,IAAK,CACtB,IAAMyC,ECzOLC,QDyO6BlJ,KAAKuG,QAAQC,IAAIA,ICzOpC2C,SAAS,KAAQjC,UD0O5BJ,EAAQvG,WAAWjD,oBAAYiC,YAAa,CAACyJ,EAA2BhJ,KAAKuG,QAAQC,IAAI9F,UAAWuI,IAIhGjJ,KAAKsG,MAAMiB,YAAcC,YAAU4B,eACrCN,EAAmBA,EAAiBO,IAAIP,EAAiBQ,IAAIL,GAASM,IAAI,OAM9E,GAAMvJ,KAAKuG,QAAQE,QAAS,CAC1B,IAAM+C,EAAYxJ,KAAKuG,QAAQE,QAAQgD,OACvC,GAAIX,EAAiBY,GAAGF,GAAY,MAAM,IAAItH,MAAM,iDAEpD4E,EAAQvG,WAAWjD,oBAAYgC,SAAU,CAAC0J,EAA2BhJ,KAAKuG,QAAQE,QAAQ/F,UAAW8I,IAIjGxJ,KAAKsG,MAAMiB,YAAcC,YAAU4B,eACrCN,EAAmBA,EAAiBO,IAAIG,IAMxCxJ,KAAK2J,qBACP7C,EAAQvG,WAAWjD,oBAAY8B,YAAa,CAACY,KAAKuG,QAAQ7F,UAAWoI,IAC5D9I,KAAK4J,mBACd9C,EAAQvG,WAAWjD,oBAAY6B,SAAU,CAACa,KAAKuG,QAAQ7F,UAAWgF,KAElEoB,EAAQvG,WAAWjD,oBAAY+B,MAAO,CACpC4G,GAAmBjG,KAAKsG,MAAMxF,aAAayB,UAC3CvC,KAAKuG,QAAQ7F,UACboI,KAOF9I,KAAKsG,MAAMiB,YAAcC,YAAU4B,cAAkCpJ,KAAKsG,MAsRnEuD,YAAYC,YAAY3D,OArR7BnG,KAAK2G,kBACPG,EAAQvG,WAAWjD,oBAAY8B,YAAa,CAACY,KAAKuG,QAAQ7F,UAAW,IAC5DV,KAAK4G,oBACdE,EAAQvG,WAAWjD,oBAAY6B,SAAU,CAACa,KAAKuG,QAAQ7F,UAAWgF,KACzD1F,KAAKsG,MAAMzF,YAAY0B,SAAS2D,UAEzCY,EAAQvG,WAAWjD,oBAAY+B,MAAO,CAACyG,GAAa9F,KAAKuG,QAAQ7F,UAAW,KAI5EV,KAAKuG,QAAQwD,UAAUjD,EAAQvG,WAAWjD,oBAAY+B,MAAO,CAACyG,GAAa9F,KAAKuG,QAAQ7F,UAAW,OACxG2F,OAAA2D,cAAAC,IAnOD,WAEE,IADA,IACmCC,EAD/BC,GAAS,EACbC,EAAAtC,EAAmB9H,KAAKsG,MAAMyB,SAAKmC,EAAAE,KAAApC,MACjCmC,EAASA,GADID,EAAAhC,MACWC,MAAMC,UAAYC,WAASK,GAErD,OAAOyB,KASTH,wBAAAC,IACA,WAKE,OAJajK,KAAKsG,MAAMyB,MAAM,GACXI,MACKY,MAAM,aAELpG,OAGrB3C,KAAKsG,MAAMzF,YAAY0B,SAAS2D,WAC9BlG,KAAKsG,MAAMyB,MAAM,GAAGI,MAAiDkC,UAAUnE,SAI9ElG,KAAKsG,MAAMzF,YAAY0B,SAAS2D,YACxC8D,0BAAAC,IAED,WAKE,OAJajK,KAAKsG,MAAMyB,MAAM,GACXI,MACKY,MAAM,aAELpG,SAGpB3C,KAAKsG,MAAMzF,YAAY0B,SAAS2D,UAChClG,KAAKsG,MAAMyB,MAAM,GAAGI,MAAiDkC,UAAUnE,YAKrF8D,yBAAAC,IAED,WACE,IACMK,EADOtK,KAAKsG,MAAMyB,MAAM,GACPI,MACjBoC,EAAWD,EAAUvB,MAAMuB,EAAUvB,MAAMpB,OAAS,GAG1D,GAAI4C,aAAoB5H,SAEjB3C,KAAKsG,MAAMxF,aAAayB,SAAS2D,SAAU,CAC9C,GAAKoE,EAAqDE,WAAWtE,SAEnE,OAAO,EACF,GAAIqE,EAASE,UAAU5H,OAAO0H,EAASG,UAAUhI,UAAY4H,EAAUvB,MAAMpB,OAAS,EAAG,CAC9F,IAAIgD,EAAaL,EAAUvB,MAAMuB,EAAUvB,MAAMpB,OAAS,GAE1D,GACEgD,aAAsBhI,SACrBgI,EAAWD,UAAU7H,OAAO0H,EAASE,YAAcE,EAAWF,UAAU5H,OAAO0H,EAASE,YAEzF,OAAO,EACF,GAAIE,EAAW/H,OAAOC,OAAO0H,EAASE,YAAcE,EAAW7H,OAAOD,OAAO0H,EAASE,WAE3F,OAAO,GAOf,OAAO,KACRT,2BAAAC,IAED,WACE,IACMK,EADOtK,KAAKsG,MAAMyB,MAAM,GACPI,MACjBoC,EAAWD,EAAUvB,MAAMuB,EAAUvB,MAAMpB,OAAS,GAG1D,OAAI4C,aAAoB5H,QAElB3C,KAAKsG,MAAMxF,aAAayB,SAAS2D,UAC7BlG,KAAKsG,MAAMyB,MAAM,GAAGI,MAAiDqC,WAAWtE,aAIpFoE,EAAUvB,MAAMpB,OAAS,GACzB2C,EAAUvB,MAAMuB,EAAUvB,MAAMpB,OAAS,aAAchF,QACtD2H,EAAUvB,MAAMuB,EAAUvB,MAAMpB,OAAS,GAAc+C,UAAUxE,UAClEqE,EAASE,UAAU5H,OAAO0H,EAASG,UAAUhI,UAU5C1C,KAAKsG,MAAMxF,aAAayB,SAAS2D,YACzC8D,+BAAAC,IAED,WACE,OAAOjK,KAAK4J,oBAAsB5J,KAAK2J,yQA0H3C,SAASpB,GACPzB,EAAqB8D,EAErBrD,EACAhB,EACAG,EACAY,OAJEa,EAAKyC,EAALzC,MAMI7B,EAAQ,IAAIuE,QAChB1C,EACAZ,GAAaC,YAAUC,YARLmD,EAAX/J,YAAyB+J,EAAZ9J,aASpByG,GAGEA,GAAaC,YAAUC,YACzBX,EAAQvG,WAAWjD,oBAAYyB,iBAAkB,CAE/CuI,EAAoBtB,GAAsBO,EAAQ7F,UAClD4F,EAAMU,gBAAgBT,EAAQU,mBAAmBC,SAAS9E,WAE1DkF,EAAoB,EAAIhB,EAAMwC,iBAAiBvC,EAAQU,mBAAmBC,SAAS9E,WACnF+F,EAAM2C,KAAKjJ,KAAI,SAACkJ,GAAK,OAAKA,EAAMrI,QAAQO,WACxCyD,IAEOa,GAAaC,YAAU4B,cAChCtC,EAAQvG,WAAWjD,oBAAY0B,kBAAmB,CAChDsI,EAAoBtB,GAAsBO,EAAQ7F,UAClD4F,EAAMwC,iBAAiBvC,EAAQU,mBAAmBC,SAAS9E,WAC3DkE,EAAMU,gBAAgBT,EAAQU,mBAAmBC,SAAS9E,WAC1D+F,EAAM2C,KAAKjJ,KAAI,SAACkJ,GAAK,OAAKA,EAAMrI,QAAQO,WACxCyD,IAMN,SAAS+B,GACP3B,EAAqBkE,EAErBzD,EACAhB,EACAG,EACAY,OAJEa,EAAK6C,EAAL7C,MAMI7B,EAAQ2E,QAAQC,qBAAqB,CACzC/C,MAAOA,EACPtH,YARkBmK,EAAXnK,YASPC,aATgCkK,EAAZlK,aAUpByG,UAAAA,IAGIuD,EAAOK,oBAAkBhD,EAAmC7B,EAAMiB,YAAcC,YAAU4B,cAC5F7B,GAAaC,YAAUC,YACzBX,EAAQvG,WAAWjD,oBAAYoB,iBAAkB,CAC/C4I,EAAoBtB,GAAsBO,EAAQ7F,UAClD4F,EAAMU,gBAAgBT,EAAQU,mBAAmBC,SAAS9E,WAC1DkF,EAAoB,EAAIhB,EAAMwC,iBAAiBvC,EAAQU,mBAAmBC,SAAS9E,WACnF0I,EACApE,IAEOa,GAAaC,YAAU4B,cAChCtC,EAAQvG,WAAWjD,oBAAYuB,kBAAmB,CAChDyI,EAAoBtB,GAAsBO,EAAQ7F,UAClD4F,EAAMwC,iBAAiBvC,EAAQU,mBAAmBC,SAAS9E,WAC3DkE,EAAMU,gBAAgBT,EAAQU,mBAAmBC,SAAS9E,WAC1D0I,EACApE,IAKN,SAASiC,GACP7B,EAAqBsE,EAErB7D,EACAhB,EACAG,EACAY,SAJEzG,EAAWuK,EAAXvK,YAAaC,EAAYsK,EAAZtK,aAOTiI,EAP4BqC,EAALjD,MAOTY,MAAMlH,KAAI,SAACwJ,GAAC,OAAKA,KAC/BC,EAAU,IAAIC,QAAQxC,EAAOlI,EAAY0B,SAAUzB,EAAayB,UAChE+D,EAAQkF,QAAQN,qBAAqB,CACzC/C,MAAOmD,EACPzK,YAAAA,EACAC,aAAAA,EACAyG,UAAAA,IAGIkE,EACJnE,GAAqBC,GAAaC,YAAUC,iBAAciE,EAAYnF,EAAQU,kBAE1E0E,EAAY,IAAIC,YACtBD,EAAUE,SAASvF,EAAOmF,GAC1BE,EAAUG,UAAUxF,EAAM6B,MAAMkC,UAAW3D,GAK3C,IAAIqF,EAAoBzF,EAAM6B,MAAMqC,WAChCD,EAAWe,EAAQvC,MAAMuC,EAAQvC,MAAMpB,OAAS,GAGpD,GAFkB4C,EAASE,UAAU5H,OAAO0H,EAASG,UAAUhI,UAE5C4I,EAAQvC,MAAMpB,OAAS,EAAG,CAC3C,IAAIgD,EAAaW,EAAQvC,MAAMuC,EAAQvC,MAAMpB,OAAS,GAClDoE,EAAkB7F,UAAYyE,EAAWD,UAAUxE,SACrD6F,EAAoBA,EAAkBrJ,QAErCqJ,EAAkB7F,WAClByE,EAAWD,UAAU7H,OAAO0H,EAASE,aAAcE,EAAWF,UAAU5H,OAAO0H,EAASE,aAEzFsB,EAAoBxB,EAASG,WAIjCiB,EAAUK,QACRD,EACAzE,EAAoBtB,UAAmBiG,EAAG1F,EAAQ7F,WAASuL,EAAIlG,IAEjEe,EAAQvG,WAAWjD,oBAAY2B,QAAS,CAAC0M,EAAUO,aAIrD,SAASrD,GACP/B,EACAmB,EACAV,EACAhB,EACAG,EACAY,SAEMa,EAAQF,EAAKE,MACbtH,EAAcoH,EAAKpH,YACnBC,EAAemH,EAAKnH,aACpBqL,EAAiB7E,EAAoBtB,UAAmBoG,EAAG7F,EAAQ7F,WAAS0L,EAAIrG,GAGtF,GAA2B,IAAvBoC,EAAMY,MAAMpB,OAAc,CAC5B,GAAIQ,EAAMY,MAAM,aAAcpG,OAC5B,OAAOgG,GAAU7B,EAASmB,EAAMV,EAAWhB,EAASG,EAAaY,GAC5D,GAAIa,EAAMY,MAAM,aAAcsD,OACnC,OAAO5D,GAAU3B,EAASmB,EAAMV,EAAWhB,EAASG,EAAaY,GAC5D,GAAIa,EAAMY,MAAM,aAAcuD,OACnC,OAAO/D,GAAUzB,EAASmB,EAAMV,EAAWhB,EAASG,EAAaY,GAEjE,MAAM,IAAIpF,MAAM,sBAyBpB,IArBA,IAAMoE,EAAQiG,kBAAgBrB,qBAAqB,CACjD/C,MAAOA,EACPtH,YAAAA,EACAC,aAAAA,EACAyG,UAAAA,IAGIiF,EAAWlG,EAAMU,gBAAgBT,EAAQU,kBAAmBpG,GAAaqG,SAAS9E,WAClFqK,EAAYnF,EACd,EACAhB,EAAMwC,iBAAiBvC,EAAQU,kBAAmBnG,GAAcoG,SAAS9E,WAIvEsK,EAAWC,gCAA8BxE,GACzCyE,EAAuB,SAACC,GAC5B,OAAOA,IAAMH,EAAS/E,OAAS,GAG7BhH,EAAawH,EAAMkC,UAEdwC,EAAI,EAAGA,EAAIH,EAAS/E,OAAQkF,IAAK,CACxC,IAAMC,EAAUJ,EAASG,GACnBE,EAAYD,EAAQ,GACpBlM,EAAcoM,mBAAiBF,EAASnM,GACxCsM,EAAW,IAAIC,aAAW,IAAIC,mBAAahL,OAAK2K,GAAUnM,EAAYC,IAExEwM,SACAC,SAEJ,GAAIT,EAAqBC,GACvBO,EAAiBxM,EACjByM,EAAgBlB,MACX,CACL,IAAMmB,EAAWZ,EAASG,EAAI,GAAG,GACjCO,EAAiB9K,EAAgB1B,EAAa0M,GAG9CD,EAD8BC,aAAoBhB,QAAQ1L,EAAYiC,OAAOuK,GACpCE,EAAkBC,eAAetK,QAAU+C,GAGtF,GAAI+G,aAAqBpK,OAAQ,CAC/B,IAAMgJ,EAAY,IAAIC,YAChB4B,EAAa,IAAIjC,QAAQuB,EAAqBG,EAASQ,MAAOR,EAASS,QAE7E/B,EAAUG,UAAUnL,EAAY+F,GAAqB,IAANmG,EAAe,GAALA,EAASL,EAAW9G,IAC7EiG,EAAUgC,UAAUC,UAAQC,cAAe,CACzC,CACEC,WAAYnN,EAAWuF,SAAWJ,GAAcnF,EAAWsC,QAC3D6H,KAAMiD,oBAAoBP,GAC1BhB,SAAU,EACVwB,iBAAmBpB,EAAqBC,GAASJ,EAAJ,KAKjD,IAAIwB,EAAqBrN,EACzB,GAAIgM,EAAqBC,GAAI,CAC3B,IAAItC,EAAWpC,EAAMY,MAAMZ,EAAMY,MAAMpB,OAAS,GAE5CuG,KADS3D,aAAoB5H,SACL4H,EAAoBE,UAAU5H,OAAQ0H,EAAoBG,UAAUhI,SAC5FiI,EAAaxC,EAAMY,MAAMZ,EAAMY,MAAMpB,OAAS,GAE9CuG,IACEtN,EAAYsF,UAAYyE,EAAW/H,OAAOsD,SAC5C+H,EAAqBrN,EAAY8B,QAEhC9B,EAAYsF,WACZyE,EAAW/H,OAAOC,OAAO0H,EAASzH,UAAW6H,EAAW7H,OAAOD,OAAO0H,EAASzH,UAEhFmL,EAAqB1D,EAAS3H,SAKpC+I,EAAUK,QAAQiC,EAAoBZ,GAEtCvG,EAAQvG,WAAWjD,oBAAY2B,QAAS,CAAC0M,EAAUO,kBAC9C,GAAIa,aAAqBV,OAC9BvF,EAAQvG,WAAWjD,oBAAYoB,iBAAkB,CAC/C2O,EACK,GAALR,EAASL,EAAW9G,GACnBkH,EAAqBC,GAASJ,EAAJ,EAC3B0B,yBAAuBlB,GACvBvG,GAAqB,IAANmG,QAEZ,CAAA,KAAIE,aAAqBT,QAS9B,MAAM,IAAIpK,MAAM,wBARhB4E,EAAQvG,WAAWjD,oBAAYyB,iBAAkB,CAC/CsO,EACM,IAANR,EAAUL,EAAW9G,GACpBkH,EAAqBC,GAASJ,EAAJ,EAC3BQ,EAASnC,KAAKjJ,KAAI,SAACkJ,GAAK,OAAKA,EAAMrI,QAAQO,WAC3CyD,GAAqB,IAANmG,IAOdD,EAAqBC,KACpBjM,EAAYsF,WAAakH,EAAelH,SAC1CY,EAAQvG,WAAWjD,oBAAY6B,SAAU,CAAC6G,GAAqBN,MACrD9E,EAAYsF,UAAYkH,EAAelH,UACjDY,EAAQvG,WAAWjD,oBAAY8B,YAAa,CAAC4G,GAAqB,KAItErF,EAAayM,YEphBDgB,GAAatH,EAAuBuH,GAClD,IAAIC,EAAYD,EAAQC,UAElB3G,EAAS4G,SAAOC,MAAMC,SAASJ,EAAQC,WAAW3G,OANjC,KAQnBA,GAP4B,KAOGA,IAEjC2G,EAAYC,SAAOC,MAAME,cAAcH,SAAOC,MAAMG,eAAeN,EAAQC,aAG7ExH,EAAQvG,WAAWjD,oBAAYe,eAAgB,CAACgQ,EAASC,ICtCpD,IAGMM,GAAyD,CACpEC,cAAe,CACb,CAAE1Q,KAAM,WAAYC,KAAM,SAC1B,CAAED,KAAM,SAAUC,KAAM,WACxB,CAAED,KAAM,SAAUC,KAAM,SACxB,CAAED,KAAM,OAAQC,KAAM,SACtB,CAAED,KAAM,SAAUC,KAAM,WACxB,CAAED,KAAM,QAASC,KAAM,WACvB,CAAED,KAAM,WAAYC,KAAM,aAKjB0Q,GAAmBnJ,YAAUC,KAAK,sEAK/C,SAAgBmJ,KAEd,IADA,IAAMC,EAAc,IAAIC,WAAW,IAC1BpC,EAAI,EAAGA,EAAI,GAAIA,IACtBmC,EAAYnC,GAAKqC,KAAKC,MAAsB,IAAhBD,KAAKE,UAEnC,OAAOzJ,YAAUC,KAAKoJ,GAAaK,uBAMrBC,GAAyB9J,EAAiB+J,GACxD,MAAO,CACLpR,KAlC8B,kBAmC9BoH,QAlCiC,IAmCjCC,QAAAA,EACAgK,kBAAmBD,GC0BvB,IAAsBE,cAAU,SAAAA,KAqN7B,OArN6BA,EAGhBC,mBAAP,SACLC,EACApJ,EACAqJ,GAGA,IAAM9I,EAAU,IAAI/G,EAEduG,EAAsB,IAAID,GAAasJ,EAAQpJ,GAE/CsJ,EAAgBvJ,EAAMA,MAAMzF,YAAY0B,SAClCsN,EAAc3J,UAAcK,EAAQuJ,kBAAhDC,MAEIxJ,EAAQuJ,kBACV1B,GAAatH,EAASP,EAAQuJ,kBAGhC,IAAME,EACFrK,YAAUC,KADciK,EAAc3J,SACvBI,EAAMA,MAAMU,gBAAgBT,EAAQU,mBAAmBC,SAAS9E,WAChE,GAQnB,OANAkE,EAAM1E,OAAOkF,EAAS,CAAEvF,aAAa,IAEjCqO,GACFA,EAAcK,SAAQ,SAACC,GAAM,OAAKpJ,EAAQtG,gBAAgB0P,MAGrDT,EAAWU,WAAWrJ,EAASkJ,EAAqB,CACzDI,SAAU7J,EAAQ8J,4BAA8B1K,YAAUC,KAAKW,EAAQ8J,kCAA+B3E,KAI1G+D,EAQca,4BAAP,SACL/J,EACAgK,GAEA,IAAMC,EAAiBjK,EAAQkK,eAAejO,KACxCkO,EAAWnK,EAAQoK,cAAcnO,KAAKI,OACtCgO,EAAWrK,EAAQoK,cAAcnO,KAAKM,OACtC+N,QACJN,EAAAA,EAA2BO,yBAAuBN,EAAOhL,SAAgCqL,yBAKvFL,EAAO9F,UAAUxE,SAEhBsK,EAAO9F,UAAUhI,QAAQG,OAAO6N,IAAaF,EAAO/F,UAAU5H,OAAO+N,IACnEJ,EAAO9F,UAAUhI,QAAQG,OAAO+N,IAAaJ,EAAO/F,UAAU5H,OAAO6N,IAF1EX,OAMUW,IAAaF,EAAO5N,QAA9BmN,MACUa,IAAaJ,EAAO1N,QAA9BiN,OAIAxJ,EAAQwK,yBAAyBC,oBAAoBC,QAAQ,IAAI7K,UAAQ,IAAK,OADhF2J,MAIwD,GAA9CxJ,EAAQwK,yBAAyBG,WAA3CnB,MAEExJ,EAAQwK,yBAAyBI,eAAezQ,YAAcmQ,GADhEd,OA5EJ,SAAgBxJ,GACd,OAAO6K,OAAOC,KAAK9K,GAAS+K,MAAK,SAACC,GAAC,MAAW,cAANA,KA+E5BC,CAAOjL,EAAQkL,wBAAzB1B,MACUxJ,EAAQkL,sBAAsBC,SAAxC3B,MAEA,IAAMjJ,EAAU,IAAI/G,EAGpB,GAAIwG,EAAQkL,sBAAsBE,WAAY,CAC5C,IAAMC,EAAmBjP,OAAOkP,WAC9BrB,EAAO9F,UACP8F,EAAO/F,UACP+F,EAAOhK,IACPgK,EAAOsB,YACPtB,EAAOuB,OAETjL,EAAQvG,WAAWjD,oBAAYmC,mBAAoB,CAACmS,EAASpB,EAAOwB,aAAa5P,oBAE1EmE,EAAQkL,sBAAsBE,WAInCpL,EAAQwK,yBAAyBkB,SAEJ3M,GAC7B5H,+BAAuB+F,KACvB8C,EAAQoK,cAAcnO,KAAKgD,UAEOe,EAAQwK,yBAAyBkB,OAAOC,SAA5EnC,MF5HN,SAAuCjJ,EAAuBmL,EAA0BE,GACtF,IAAMC,EAAWC,6BAA2BC,UAAUC,mBAAmB,SAAU,CACjFC,0BAAwBP,EAAOC,SAC/BC,EACAF,EAAO7B,SACP6B,EAAOQ,EACPR,EAAOS,EACPT,EAAOU,IAGT7L,EAAQvG,WAAWjD,oBAAYoC,2BAA4B,CAAC0S,IEoHxDQ,CAAuB9L,EAASP,EAAQwK,yBAAyBkB,OAAQ1L,EAAQwK,yBAAyBoB,gBAEnG5L,EAAQwK,yBAAyBkB,QAU1C,IANA,IAM4B5K,EANtBwL,EAAmCC,6BAAkBC,qBACzDxM,EAAQoK,cACRpK,EAAQwK,0BAIVlJ,EAAAC,EAF0BkL,YAAUC,gBAAgBJ,EAAeT,aAEvC/K,EAAAQ,KAAAG,MAAE,CAAA,IAAnBkL,EAAM7L,EAAAa,MAETiL,EAAWD,EAAOE,MAAM,EAAG,IAE/BD,GAAYL,6BAAkBR,UAAUe,WAAW,YACjDF,GAAYL,6BAAkBR,UAAUe,WAAW,sBACnDF,GAAYL,6BAAkBR,UAAUe,WAAW,SAHvDtD,MAMAjJ,EAAQvG,WAAWjD,oBAAYsC,yBAA0B,CAACsT,IAI5D,IAAMI,EAAcC,oBAAkBC,kBAAkBjN,EAAQkK,eAAgBlK,EAAQkL,uBAOxF,OALiB6B,EAAYlB,SAASgB,MAAM,EAAG,KACzBG,oBAAkBjB,UAAUe,WAAW,sBAA7DtD,MAEAjJ,EAAQvG,WAAWjD,oBAAYuC,yBAA0B,CAACyT,EAAYlB,WAE/D3C,EAAWU,WAAWrJ,EAASnB,YAAUC,KAAK,GAAI,CACvDwK,SAAUzK,YAAUC,KAAKW,EAAQkL,sBAAsBrB,aAE1DX,EAEMgE,wBAAP,SACErB,EACAsB,EACAtD,EACA5K,EACA+J,GAEA,IACMoE,EADQlE,EAAW6C,UACHsB,mBAAmB,UAAWxB,GAC9CnS,EAAW0T,EAAQ,GACnBzT,EAASyT,EAAQ,GACjBE,EAAQH,EAAcG,OAAS9E,KAErC,MAAO,CACL+E,OAFaxE,GAAyB9J,EAAS+J,GAG/CwE,MAAOnF,GACP1G,MAAO,CACLjI,SAAAA,EACAC,OAAAA,EACA8T,OAAQN,EAAcM,OACtBC,KAAMP,EAAcO,KACpBC,OAAQR,EAAcQ,OACtBL,MAAAA,EACAzD,SAAUA,EAAShO,cAGxBqN,EAEM0E,oBAAP,SACE/B,EACA9D,EACAoF,EACAtD,EACAJ,GAEA,IAAMoE,EAAQ3E,EAAW6C,UACnBqB,EAAUS,EAAMR,mBAAmB,UAAWxB,GAC9CnS,EAAW0T,EAAQ,GACnBzT,EAASyT,EAAQ,GACjBE,EAAQH,EAAcG,OAAS9E,KAWrC,MAAO,CACLqD,SAX4BgC,EAAM7B,mBAAmB,gBAAiB,CACtEtS,EACAC,EACAwT,EAAcM,OACdN,EAAcO,KACdP,EAAcQ,OACdL,EACAlO,YAAUC,KAAKwK,GAAUhO,WACzBkM,IAIApG,OAAQ8H,GAAuBrK,YAAUC,KAAK,IAAIyJ,gBAItDI,EAMeU,WAAP,SACNrJ,EACAkJ,EACAqE,YAAAA,IAAAA,EAA2B,IAE3B,IAAQpU,EAAqB6G,EAArB7G,SAAUC,EAAW4G,EAAX5G,OAIlB,MAAO,CAAEkS,SADQ3C,EAAW6C,UAAUC,mBAFV8B,EAAOjE,SAAW,iCAAmC,yBAC5DiE,EAAOjE,SAAW,CAACnQ,EAAUC,EAAQmU,EAAOjE,UAAY,CAACnQ,EAAUC,IAErEgI,MAAO8H,EAAoBX,gBAC/CI,KApNaA,aAAuB,IAAI6E,YAAUC,EAAgBzS,SCjDzD0S,GCXCC,cAMX,SAAAA,EAAYhL,EAAsBjE,EAAiB6I,GAL1CrO,eAA8BvC,yBAAiBgX,WAMtDzU,KAAK0U,YAAcjP,GAAaD,GAChCxF,KAAKyJ,OAASA,EAER4E,IAEFA,EAAQsG,QAAQ5J,MAAM6J,gBAAkB5U,KAAK0U,YAAYE,eAD3D7E,MAIU1B,EAAQsG,QAAQlL,QAAUA,GAApCsG,MACA/P,KAAK6U,YAAcxG,GAatB,OAXAoG,EAAArU,UAEDwB,OAAA,SAAOkF,EAAuBgO,aJmCQhO,EAAuBP,GAEvDA,EAAQwO,qBAAyBxO,EAAQyO,eACnCzO,EAAQwO,oBAAoBhK,QAAUxE,EAAQyO,cAAcL,QAAQ5J,OAA9EgF,MAGIxJ,EAAQyO,eACZ5G,GAAatH,EAASP,EAAQyO,eAG1BzO,EAAQwO,qBACZjO,EAAQvG,WAAWjD,oBAAYiB,sBAAuB,CACpDgI,EAAQwO,oBAAoBhK,MAC5BxE,EAAQwO,oBAAoBrU,UAAY6F,EAAQwO,oBAAoBrU,UAAYsF,GAChFO,EAAQwO,oBAAoBtL,SIhD9BwL,CAAwBnO,EAAS,CAC/BkO,cAAehV,KAAK6U,YACpBE,oBAAqB,CACnBhK,MAAO/K,KAAK0U,YACZjL,OAAQzJ,KAAKyJ,OAAOrH,cAGxB0E,EAAQvG,WAAWjD,oBAAY8B,YAAa,CAAC4G,GAAqBhG,KAAKyJ,UACxEgL,MDlBSD,GAAAA,mBAAAA,uCAEVA,oBACAA,wBAgEWU,GAAmB,SAACjS,GAAe,OAC9CA,EAAQ2R,gBAAkB9O,GAAY8O,eAAiB3R,EAAQ2R,gBRoYpC,6CQpYoEA,eAIpFO,cAAkB,SAAAA,KA0K5B,OAzKDA,EACOC,iBAAP,SAAwBC,GACtB,IAAQlN,EAA6BkN,EAA7BlN,MAAOmN,EAAsBD,EAAtBC,QAASC,EAAaF,EAAbE,SAExB,IAAKpN,EAAO,MAAM,IAAIjG,MAAM,gCAC5B,IAAKiG,EAAMR,OAAQ,MAAM,IAAIzF,MAAM,2CACnC,GAAIiG,EAAMmJ,MAAK,SAACoB,GAAC,OAAMA,EAAE/K,UAAS,MAAM,IAAIzF,MAAM,iDAClD,IAAMsT,EAAarN,EAAM,GAEnBsN,EAAcD,EAAW,GAAGF,QAC5BI,EAAeF,EAAWA,EAAW7N,OAAS,GAAG4N,SAEvD,IAAKE,IAAgBC,EAAc,MAAM,IAAIxT,MAAM,oDACnD,GAAIuT,EAAYjQ,UAAYkQ,EAAalQ,QACvC,MAAM,IAAItD,MAAM,yDAElB,IAAMyT,EAAmBR,EAAmBS,WAAWV,GAAiBI,GAAUG,GAC5EI,EAAoBV,EAAmBS,WAAWV,GAAiBK,GAAWG,GAE9EI,EAA6B3N,EAAMtG,KAAI,SAACoL,GAC5C,IAAM8I,EAAc9I,EAAS,GAAGT,SAC1BwJ,EAAe/I,EAASA,EAAStF,OAAS,GAAG8E,UAEnD,IAAKsJ,IAAgBC,EACnB,MAAM,IAAI9T,MAAM,8DAGlB,IAAMrB,EAAcoV,iBAAeC,cAAcP,EAAkBI,GAC7DjV,EAAemV,iBAAeC,cAAcL,EAAmBG,GAE/DG,EAAWhB,EAAmBiB,iBAAgC5B,iBAAS6B,OAAQpJ,GAC/EqJ,EAAWnB,EAAmBiB,iBAAgC5B,iBAASnI,OAAQY,GAC/EsJ,EAAWpB,EAAmBiB,iBAAgC5B,iBAAS7R,OAAQsK,GACrF,MAAO,CACLuJ,QAASD,EACL,IAAIhL,QACD0B,EAA6BpL,IAAIsT,EAAmBsB,UACrDd,EACAE,GAEF,KACJa,QAASJ,EACL,IAAIK,QACD1J,EAA6BpL,IAAIsT,EAAmByB,UACrDjB,EACAE,GAEF,KACJgB,QAASV,EACL,IAAIW,QACD7J,EAA6BpL,IAAIsT,EAAmB4B,QACrDpB,EACAE,GAEF,KACJmB,WACGT,GAAaD,GAAaH,EAEvB,KADA,IAAIhJ,gBAAcF,EAASpL,IAAIsT,EAAmB8B,cAAetB,EAAkBE,GAEzFhV,YAAAA,EACAC,aAAAA,MAIJ,OAAO,IAAIoW,QAAY,CACrBC,SAAUrB,EACPsB,QAAO,SAACjP,GAAK,OAAKA,EAAM0O,WACxBhV,KAAI,SAACsG,GAAK,MAAM,CACf0O,QAAS1O,EAAM0O,QACfhW,YAAasH,EAAMtH,YACnBC,aAAcqH,EAAMrH,iBAExBuW,SAAUvB,EACPsB,QAAO,SAACjP,GAAK,OAAKA,EAAMuO,WACxB7U,KAAI,SAACsG,GAAK,MAAM,CACfuO,QAASvO,EAAMuO,QACf7V,YAAasH,EAAMtH,YACnBC,aAAcqH,EAAMrH,iBAExBwW,SAAUxB,EACPsB,QAAO,SAACjP,GAAK,OAAKA,EAAMqO,WACxB3U,KAAI,SAACsG,GAAK,MAAM,CACfqO,QAASrO,EAAMqO,QACf3V,YAAasH,EAAMtH,YACnBC,aAAcqH,EAAMrH,iBAExByW,YAAazB,EACVsB,QAAO,SAACjP,GAAK,OAAKA,EAAM6O,cACxBnV,KAAI,SAACsG,GAAK,MAAM,CACf6O,WAAY7O,EAAM6O,WAClBnW,YAAasH,EAAMtH,YACnBC,aAAcqH,EAAMrH,iBAExByG,UAAW8N,EAAM9N,aAEpB4N,EAEcS,WAAP,SAAkB1P,EAAmB6E,GAC3C,OAAI7E,EACKsR,QAAMC,QAAQ1M,EAAMvF,SAEtBxF,KAAK0X,QAAQ3M,IACrBoK,EAecuC,QAAP,SAAe3M,GACrB,IAAoChI,EAAkCgI,EAAlChI,OAAQ4U,EAA0B5M,EAA1B4M,UAAWC,EAAe7M,EAAf6M,WACvD,OAAO,IAAIC,QAD2D9M,EAA9DvF,QAA8DuF,EAArD9H,QAIf6U,SAJoE/M,EAA5CgN,SAIN3V,YAClBW,OACW2I,GACX,EACAiM,EAAYhS,YAAUC,KAAK+R,QAAajM,EACxCkM,EAAajS,YAAUC,KAAKgS,QAAclM,IAE7CyJ,EAEcyB,SAAP,SAAehM,OAAGpE,EAAGoE,EAAHpE,IAAKwL,EAAYpH,EAAZoH,aAAcgG,EAASpN,EAAToN,UAAWC,EAAWrN,EAAXqN,YAAsB1C,EAAQ3K,EAAR2K,SAC5E,OAAO,IAAIlJ,OACT8I,EAAmBuC,QAFqD9M,EAAP0K,SAGjEH,EAAmBuC,QAAQnC,GAC3BuC,SAAStR,GACTwL,EACAgG,EACAF,SAASG,KAEZ9C,EAEcsB,SAAP,SAAgBjU,GACtB,IAAMmT,EAAmBR,EAAmBS,WAAWV,GAAiB1S,EAAK8S,QAAQrS,SAAUT,EAAK8S,SAC9FO,EAAoBV,EAAmBS,WAAWV,GAAiB1S,EAAK+S,SAAStS,SAAUT,EAAK+S,UACtG,OAAO,IAAI5S,OACTgT,EACAE,EACAiC,SAAStV,EAAKgE,KACdsR,SAAStV,EAAKsP,aACdtP,EAAKuP,MACLvP,EAAKwP,aACLxP,EAAKwV,UACLF,SAAStV,EAAKyV,eAEjB9C,EASciB,iBAAP,SACNhY,EACA+J,GAEA,OAAOA,EAAM+P,OAAM,SAAC1V,GAAI,OAAKA,EAAKpE,OAASA,MAC5C+W,KAjEcA,gBAAe,SAAC3S,GAC7B,OAAQA,EAAKpE,MACX,KAAKoW,iBAAS7R,OACZ,OAAOwS,GAAmBsB,SAASjU,GACrC,KAAKgS,iBAASnI,OACZ,OAAO8I,GAAmByB,SAASpU,GACrC,KAAKgS,iBAAS6B,OACZ,OAAOlB,GAAmB4B,OAAOvU,GACnC,QACE,MAAM,IAAIN,MAAM,uBA4CPiT,UAAS,SAAAnK,OAAGmN,EAAQnN,EAARmN,SAAUC,EAAQpN,EAARoN,SACnC,OAAO,IAAI9L,OACT2J,iBAAeC,cAAcf,GAAmBuC,QAAQS,EAASpN,OAAQoN,EAASjR,UAClF+O,iBAAeC,cAAcf,GAAmBuC,QAAQU,EAASrN,OAAQqN,EAASlR,YE3NxF,IAAsBmR,cAAa,SAAAA,KAQhC,OARgCA,EAGnBC,cAAP,SAAqBlG,GAC1B,IAAMmG,EAAgB,IAAIC,GAAqB1a,GAE/C2a,EADsBJ,EAAc/F,UAAUoG,iBAAiB,CAAEzE,KAAM7B,IAC5BuG,KAC3C,OAAOJ,EAAcK,MADLH,EAARxY,SAAgBwY,EAANvY,SAEnBmY,KAPaA,aAAuB,IAAI/D,YAAUC,EAAgBzS,KAWrE,IAAa0W,cACX,SAAAA,EAA6BK,GAAA7Y,uBAAA6Y,EAuE5B,OAvEqEL,EAAApY,UAE/DwY,MAAA,SAAM3Y,EAAkBC,cAG7B,MAAO,CACLD,SAHmBuY,EAAqBM,YAAY7Y,GAG7B4B,KAAI,SAACkX,EAA0BlM,GACpD,IAgHsBmM,EAhHhBvX,EAAawX,EAAKJ,kBAAkBE,GAE1C,GAAItX,EAAWzD,SAAWR,eAAO0B,UAAW,CAC1C,IAAAga,EAAoBC,sBAAoBb,cAAcpY,EAAO2M,IAC7D,MAAO,CACLuM,YAAa9b,oBAAYyb,GACzBA,YAAAA,EACA7a,QAyGkB8a,EA7GLE,EAAPF,QA8GTA,EAAQnX,KAAI,SAACwX,GAClB,MAAO,CACLlb,KAAMkb,EAAOC,WACbpR,MAAOmR,EAAOnb,OAAO2D,KAAI,SAAC0X,GACxB,MAAO,CACLpb,KAAMob,EAAMpb,KACZ+J,MAAOqR,EAAMrR,gBA9GR,GAAIzG,EAAWzD,SAAWR,eAAOS,IAAK,CAC3C,IAAMub,EAAS/X,EAAWvD,OAMpBA,EALYqQ,SAAOC,MAAM7M,gBAAgB8X,OAC7CD,EAAO3X,KAAI,SAACL,GAAO,OAAKA,EAAQpD,QAChC8B,EAAO2M,IAGgBhL,KAAI,SAAC0X,EAAYG,GACxC,OAAQF,EAAOE,GAAG/a,WAChB,KAAKpB,kBAAUqB,cACb,MAAO,CACLT,KAAMqb,EAAOE,GAAGvb,KAChB+J,MAAOyR,GAAmBJ,IAE9B,KAAKhc,kBAAUuB,eACb,MAAO,CACLX,KAAMqb,EAAOE,GAAGvb,KAChB+J,MAAO0R,GAAoBL,IAE/B,QACE,MAAO,CACLpb,KAAMqb,EAAOE,GAAGvb,KAChB+J,MAAOqR,OAIf,MAAO,CACLH,YAAa9b,oBAAYyb,GACzBA,YAAAA,EACA7a,OAAAA,GAEG,GAAIuD,EAAWzD,SAAWR,eAAOmC,UAEtC,MAAO,CACLyZ,YAAa9b,oBAAYyb,GACzBA,YAAAA,EACA7a,OAAQgC,EAAO2B,KAAI,SAAC4L,GAAK,MAAM,CAAEtP,KAAM,UAAW+J,MAAOuF,OAG3D,MAAM,IAAIvL,6BAA6BT,QAM/C+W,EACeM,YAAP,SAAmB7Y,GAGzB,IAFA,IAAM4Z,EAA8B,GAE3BhN,EAAI,EAAGA,EAAI5M,EAAS0H,OAAQkF,GAAK,EAAG,CAC3C,IAAMiN,EAAO7Z,EAAS8Z,UAAUlN,EAAGA,EAAI,GACvCgN,EAAa7X,KAAK8V,SAASgC,EAAM,KAGnC,OAAOD,GACRrB,cAGamB,GAAmB7O,GAKjC,IAJA,IAAMkP,EAAelP,EAAKmP,QAAQ,KAAM,IACpC3E,EAAU/G,SAAOC,MAAM0L,WAAWF,EAAaD,UAAU,EAAG,KAC5DI,EAAM,GACJC,EAAoB,GACnBD,EAAMH,EAAarS,QAAQ,CAChC,IAAM0S,EAAiBL,EAAaD,UAAUI,EAAKA,EAAM,IACnD3T,EAAMsR,SAASuC,EAAeN,UAAU,EAAG,GAAI,IAC/CxE,EAAWhH,SAAOC,MAAM0L,WAAWG,EAAeN,UAAU,EAAG,KAErEK,EAAIpY,KAAK,CACPsT,QAAAA,EACAC,SAAAA,EACA/O,IAAAA,IAEF8O,EAAUC,EACV4E,GAAO,GAGT,OAAOC,WAGOR,GAAoB9O,GAKlC,IAJA,IAAMkP,EAAelP,EAAKmP,QAAQ,KAAM,IACpC3E,EAAU/G,SAAOC,MAAM0L,WAAWF,EAAaD,UAAUC,EAAarS,OAAS,KAC/EwS,EAAMH,EAAarS,OAAS,GAC1ByS,EAAoB,GACnBD,GAAO,GAAG,CACf,IAAME,EAAiBL,EAAaD,UAAUI,EAAKA,EAAM,IACnD5E,EAAWhH,SAAOC,MAAM0L,WAAWG,EAAeN,UAAU,EAAG,KAC/DvT,EAAMsR,SAASuC,EAAeN,UAAU,GAAI,IAAK,IAEvDK,EAAIpY,KAAK,CACPsT,QAAAA,EACAC,SAAAA,EACA/O,IAAAA,IAEF8O,EAAUC,EAEV4E,GAAO,GAGT,OAAOC,sWV0SsC,SAAC7U,EAAiCC,GAC/E,KAAMA,KAAWrC,IAAgB,MAAM,IAAIjB,gDAAgDsD,GAC3F,OAAOrC,GAAcqC,GAASlC,cAAciC,GAASrC"}
\ No newline at end of file
diff --git a/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.esm.js b/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.esm.js
index 3c0458f..5f87110 100644
--- a/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.esm.js
+++ b/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.esm.js
@@ -94,6 +94,8 @@ var CommandType;
   CommandType[CommandType["V4_INITIALIZE_POOL"] = 19] = "V4_INITIALIZE_POOL";
   CommandType[CommandType["V4_POSITION_MANAGER_CALL"] = 20] = "V4_POSITION_MANAGER_CALL";
   CommandType[CommandType["EXECUTE_SUB_PLAN"] = 33] = "EXECUTE_SUB_PLAN";
+  // 3rd party integrations
+  CommandType[CommandType["ACROSS_V4_DEPOSIT_V3"] = 64] = "ACROSS_V4_DEPOSIT_V3";
 })(CommandType || (CommandType = {}));
 var Subparser;
 (function (Subparser) {
@@ -315,6 +317,48 @@ var COMMAND_DEFINITION = (_COMMAND_DEFINITION = {}, _COMMAND_DEFINITION[CommandT
   parser: Parser.V3Actions
 }, _COMMAND_DEFINITION[CommandType.V4_POSITION_MANAGER_CALL] = {
   parser: Parser.V4Actions
+}, _COMMAND_DEFINITION[CommandType.ACROSS_V4_DEPOSIT_V3] = {
+  parser: Parser.Abi,
+  params: [{
+    name: 'depositor',
+    type: 'address'
+  }, {
+    name: 'recipient',
+    type: 'address'
+  }, {
+    name: 'inputToken',
+    type: 'address'
+  }, {
+    name: 'outputToken',
+    type: 'address'
+  }, {
+    name: 'inputAmount',
+    type: 'uint256'
+  }, {
+    name: 'outputAmount',
+    type: 'uint256'
+  }, {
+    name: 'destinationChainId',
+    type: 'uint256'
+  }, {
+    name: 'exclusiveRelayer',
+    type: 'address'
+  }, {
+    name: 'quoteTimestamp',
+    type: 'uint32'
+  }, {
+    name: 'fillDeadline',
+    type: 'uint32'
+  }, {
+    name: 'exclusivityDeadline',
+    type: 'uint32'
+  }, {
+    name: 'message',
+    type: 'bytes'
+  }, {
+    name: 'useNative',
+    type: 'bool'
+  }]
 }, _COMMAND_DEFINITION);
 var RoutePlanner = /*#__PURE__*/function () {
   function RoutePlanner() {
@@ -326,6 +370,10 @@ var RoutePlanner = /*#__PURE__*/function () {
     this.addCommand(CommandType.EXECUTE_SUB_PLAN, [subplan.commands, subplan.inputs], true);
     return this;
   };
+  _proto.addAcrossBridge = function addAcrossBridge(params) {
+    this.addCommand(CommandType.ACROSS_V4_DEPOSIT_V3, [params.depositor, params.recipient, params.inputToken, params.outputToken, params.inputAmount, params.outputAmount, params.destinationChainId, params.exclusiveRelayer, params.quoteTimestamp, params.fillDeadline, params.exclusivityDeadline, params.message, params.useNative]);
+    return this;
+  };
   _proto.addCommand = function addCommand(type, parameters, allowRevert) {
     if (allowRevert === void 0) {
       allowRevert = false;
@@ -392,12 +440,17 @@ var RouterActionType;
   RouterActionType["UnwrapWETH"] = "UnwrapWETH";
 })(RouterActionType || (RouterActionType = {}));
 
-var _routerConfigs, _routerConfigs2, _routerConfigs3, _routerConfigs4, _routerConfigs5, _routerConfigs6, _routerConfigs7, _routerConfigs8, _routerConfigs9, _routerConfigs0, _routerConfigs1, _routerConfigs10, _routerConfigs11, _routerConfigs12, _routerConfigs13, _routerConfigs14, _routerConfigs15, _routerConfigs16, _routerConfigs17, _routerConfigs18, _routerConfigs19, _routerConfigs20, _routerConfigs21, _routerConfigs22, _routerConfigs23, _routerConfigs24, _CHAIN_CONFIGS;
+var _routerConfigs, _routerConfigs2, _routerConfigs3, _routerConfigs4, _routerConfigs5, _routerConfigs6, _routerConfigs7, _routerConfigs8, _routerConfigs9, _routerConfigs0, _routerConfigs1, _routerConfigs10, _routerConfigs11, _routerConfigs12, _routerConfigs13, _routerConfigs14, _routerConfigs15, _routerConfigs16, _routerConfigs17, _routerConfigs18, _routerConfigs19, _routerConfigs20, _routerConfigs21, _routerConfigs22, _routerConfigs23, _routerConfigs24, _routerConfigs25, _routerConfigs26, _CHAIN_CONFIGS;
 var UniversalRouterVersion;
 (function (UniversalRouterVersion) {
   UniversalRouterVersion["V1_2"] = "1.2";
   UniversalRouterVersion["V2_0"] = "2.0";
+  UniversalRouterVersion["V2_1"] = "2.1";
 })(UniversalRouterVersion || (UniversalRouterVersion = {}));
+var ZERO_ROUTER_CONFIG = {
+  address: '0x0000000000000000000000000000000000000000',
+  creationBlock: 1
+};
 var WETH_NOT_SUPPORTED_ON_CHAIN = '0x0000000000000000000000000000000000000000';
 // Todo: Change `CHAIN_CONFIGS` to pull the UR address with v4
 var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
@@ -407,7 +460,10 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
     creationBlock: 17143817
   }, _routerConfigs[UniversalRouterVersion.V2_0] = {
     address: '0x66a9893cc07d91d95644aedd05d03f95e1dba8af',
-    creationBlock: 1737658355
+    creationBlock: 21689092
+  }, _routerConfigs[UniversalRouterVersion.V2_1] = {
+    address: '0xd92a36b0000531ef3063ded4de20a0783308446c',
+    creationBlock: 23836348
   }, _routerConfigs)
 }, _CHAIN_CONFIGS[5] = {
   weth: '0xb4fbf271143f4fbf7b91a5ded31805e42b2208d6',
@@ -417,7 +473,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs2[UniversalRouterVersion.V2_0] = {
     address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',
     creationBlock: 8940568
-  }, _routerConfigs2)
+  }, _routerConfigs2[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs2)
 }, _CHAIN_CONFIGS[11155111] = {
   weth: '0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14',
   routerConfigs: (_routerConfigs3 = {}, _routerConfigs3[UniversalRouterVersion.V1_2] = {
@@ -426,6 +482,9 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs3[UniversalRouterVersion.V2_0] = {
     address: '0x3a9d48ab9751398bbfa63ad67599bb04e4bdf98b',
     creationBlock: 7259601
+  }, _routerConfigs3[UniversalRouterVersion.V2_1] = {
+    address: '0x470FFC67b1feEEC31D16C46AC7545C98716a194c',
+    creationBlock: 9664766
   }, _routerConfigs3)
 }, _CHAIN_CONFIGS[137] = {
   weth: '0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270',
@@ -434,7 +493,10 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
     creationBlock: 52210153
   }, _routerConfigs4[UniversalRouterVersion.V2_0] = {
     address: '0x1095692a6237d83c6a72f3f5efedb9a670c49223',
-    creationBlock: 1737492197
+    creationBlock: 66980401
+  }, _routerConfigs4[UniversalRouterVersion.V2_1] = {
+    address: '0xE27610fD9dD05FC061366bc9dA414CA6F948f204',
+    creationBlock: 79245524
   }, _routerConfigs4)
 }, _CHAIN_CONFIGS[80001] = {
   weth: '0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889',
@@ -444,7 +506,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs5[UniversalRouterVersion.V2_0] = {
     address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',
     creationBlock: 35176052
-  }, _routerConfigs5)
+  }, _routerConfigs5[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs5)
 }, _CHAIN_CONFIGS[10] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs6 = {}, _routerConfigs6[UniversalRouterVersion.V1_2] = {
@@ -452,7 +514,10 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
     creationBlock: 114702266
   }, _routerConfigs6[UniversalRouterVersion.V2_0] = {
     address: '0x851116d9223fabed8e56c0e6b8ad0c31d98b3507',
-    creationBlock: 1737494278
+    creationBlock: 129906462
+  }, _routerConfigs6[UniversalRouterVersion.V2_1] = {
+    address: '0xde20EEE5398D3790a4D356e8925bD21Ea65D99Af',
+    creationBlock: 134078764
   }, _routerConfigs6)
 }, _CHAIN_CONFIGS[420] = {
   weth: '0x4200000000000000000000000000000000000006',
@@ -462,7 +527,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs7[UniversalRouterVersion.V2_0] = {
     address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',
     creationBlock: 8887728
-  }, _routerConfigs7)
+  }, _routerConfigs7[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs7)
 }, _CHAIN_CONFIGS[42161] = {
   weth: '0x82aF49447D8a07e3bd95BD0d56f35241523fBab1',
   routerConfigs: (_routerConfigs8 = {}, _routerConfigs8[UniversalRouterVersion.V1_2] = {
@@ -470,7 +535,10 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
     creationBlock: 169472836
   }, _routerConfigs8[UniversalRouterVersion.V2_0] = {
     address: '0xa51afafe0263b40edaef0df8781ea9aa03e381a3',
-    creationBlock: 1737487458
+    creationBlock: 290124593
+  }, _routerConfigs8[UniversalRouterVersion.V2_1] = {
+    address: '0x96b2FD2F80e9428Daa65d859653117D453981AB4',
+    creationBlock: 329155034
   }, _routerConfigs8)
 }, _CHAIN_CONFIGS[421613] = {
   weth: '0xe39Ab88f8A4777030A534146A9Ca3B52bd5D43A3',
@@ -480,7 +548,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs9[UniversalRouterVersion.V2_0] = {
     address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',
     creationBlock: 18815277
-  }, _routerConfigs9)
+  }, _routerConfigs9[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs9)
 }, _CHAIN_CONFIGS[42220] = {
   weth: WETH_NOT_SUPPORTED_ON_CHAIN,
   routerConfigs: (_routerConfigs0 = {}, _routerConfigs0[UniversalRouterVersion.V1_2] = {
@@ -489,7 +557,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs0[UniversalRouterVersion.V2_0] = {
     address: '0xcb695bc5D3Aa22cAD1E6DF07801b061a05A0233A',
     creationBlock: 47387857
-  }, _routerConfigs0)
+  }, _routerConfigs0[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs0)
 }, _CHAIN_CONFIGS[44787] = {
   weth: WETH_NOT_SUPPORTED_ON_CHAIN,
   routerConfigs: (_routerConfigs1 = {}, _routerConfigs1[UniversalRouterVersion.V1_2] = {
@@ -498,7 +566,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs1[UniversalRouterVersion.V2_0] = {
     address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',
     creationBlock: 17566658
-  }, _routerConfigs1)
+  }, _routerConfigs1[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs1)
 }, _CHAIN_CONFIGS[56] = {
   weth: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c',
   routerConfigs: (_routerConfigs10 = {}, _routerConfigs10[UniversalRouterVersion.V1_2] = {
@@ -507,7 +575,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs10[UniversalRouterVersion.V2_0] = {
     address: '0x1906c1d672b88cd1b9ac7593301ca990f94eae07',
     creationBlock: 1737493275
-  }, _routerConfigs10)
+  }, _routerConfigs10[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs10)
 }, _CHAIN_CONFIGS[43114] = {
   weth: '0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7',
   routerConfigs: (_routerConfigs11 = {}, _routerConfigs11[UniversalRouterVersion.V1_2] = {
@@ -516,6 +584,9 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs11[UniversalRouterVersion.V2_0] = {
     address: '0x94b75331ae8d42c1b61065089b7d48fe14aa73b7',
     creationBlock: 1737558236
+  }, _routerConfigs11[UniversalRouterVersion.V2_1] = {
+    address: '0x0Cf1f86B331A03179646341D10A2A87515087221',
+    creationBlock: 58800800
   }, _routerConfigs11)
 }, _CHAIN_CONFIGS[84531] = {
   weth: '0x4200000000000000000000000000000000000006',
@@ -525,7 +596,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs12[UniversalRouterVersion.V2_0] = {
     address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',
     creationBlock: 6915289
-  }, _routerConfigs12)
+  }, _routerConfigs12[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs12)
 }, _CHAIN_CONFIGS[8453] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs13 = {}, _routerConfigs13[UniversalRouterVersion.V1_2] = {
@@ -534,6 +605,9 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs13[UniversalRouterVersion.V2_0] = {
     address: '0x6ff5693b99212da76ad316178a184ab56d299b43',
     creationBlock: 1737491485
+  }, _routerConfigs13[UniversalRouterVersion.V2_1] = {
+    address: '0xf3a4f4094bd2c6c06ca2f61789d8727b8d1e7259',
+    creationBlock: 28539210
   }, _routerConfigs13)
 }, _CHAIN_CONFIGS[81457] = {
   weth: '0x4300000000000000000000000000000000000004',
@@ -543,7 +617,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs14[UniversalRouterVersion.V2_0] = {
     address: '0xeabbcb3e8e415306207ef514f660a3f820025be3',
     creationBlock: 1737564586
-  }, _routerConfigs14)
+  }, _routerConfigs14[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs14)
 }, _CHAIN_CONFIGS[7777777] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs15 = {}, _routerConfigs15[UniversalRouterVersion.V1_2] = {
@@ -552,7 +626,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs15[UniversalRouterVersion.V2_0] = {
     address: '0x3315ef7ca28db74abadc6c44570efdf06b04b020',
     creationBlock: 1737562927
-  }, _routerConfigs15)
+  }, _routerConfigs15[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs15)
 }, _CHAIN_CONFIGS[324] = {
   weth: '0x5aea5775959fbc2557cc8789bc1bf90a239d9a91',
   routerConfigs: (_routerConfigs16 = {}, _routerConfigs16[UniversalRouterVersion.V1_2] = {
@@ -561,7 +635,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs16[UniversalRouterVersion.V2_0] = {
     address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',
     creationBlock: 12640979
-  }, _routerConfigs16)
+  }, _routerConfigs16[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs16)
 }, _CHAIN_CONFIGS[480] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs17 = {}, _routerConfigs17[UniversalRouterVersion.V1_2] = {
@@ -570,7 +644,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs17[UniversalRouterVersion.V2_0] = {
     address: '0x8ac7bee993bb44dab564ea4bc9ea67bf9eb5e743',
     creationBlock: 1737559557
-  }, _routerConfigs17)
+  }, _routerConfigs17[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs17)
 }, _CHAIN_CONFIGS[1301] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs18 = {}, _routerConfigs18[UniversalRouterVersion.V1_2] = {
@@ -579,7 +653,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs18[UniversalRouterVersion.V2_0] = {
     address: '0xf70536b3bcc1bd1a972dc186a2cf84cc6da6be5d',
     creationBlock: 7100543
-  }, _routerConfigs18)
+  }, _routerConfigs18[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs18)
 }, _CHAIN_CONFIGS[130] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs19 = {}, _routerConfigs19[UniversalRouterVersion.V1_2] = {
@@ -588,7 +662,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs19[UniversalRouterVersion.V2_0] = {
     address: '0xef740bf23acae26f6492b10de645d6b98dc8eaf3',
     creationBlock: 1737568156
-  }, _routerConfigs19)
+  }, _routerConfigs19[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs19)
 }, _CHAIN_CONFIGS[10143] = {
   weth: '0x760AfE86e5de5fa0Ee542fc7B7B713e1c5425701',
   routerConfigs: (_routerConfigs20 = {}, _routerConfigs20[UniversalRouterVersion.V1_2] = {
@@ -597,7 +671,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs20[UniversalRouterVersion.V2_0] = {
     address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',
     creationBlock: 23678
-  }, _routerConfigs20)
+  }, _routerConfigs20[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs20)
 }, _CHAIN_CONFIGS[84532] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs21 = {}, _routerConfigs21[UniversalRouterVersion.V1_2] = {
@@ -606,7 +680,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs21[UniversalRouterVersion.V2_0] = {
     address: '0x492e6456d9528771018deb9e87ef7750ef184104',
     creationBlock: 20216585
-  }, _routerConfigs21)
+  }, _routerConfigs21[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs21)
 }, _CHAIN_CONFIGS[1868] = {
   weth: '0x4200000000000000000000000000000000000006',
   routerConfigs: (_routerConfigs22 = {}, _routerConfigs22[UniversalRouterVersion.V1_2] = {
@@ -615,7 +689,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs22[UniversalRouterVersion.V2_0] = {
     address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',
     creationBlock: 3254782
-  }, _routerConfigs22)
+  }, _routerConfigs22[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs22)
 }, _CHAIN_CONFIGS[143] = {
   weth: '0x3bd359C1119dA7Da1D913D1C4D2B7c461115433A',
   routerConfigs: (_routerConfigs23 = {}, _routerConfigs23[UniversalRouterVersion.V1_2] = {
@@ -624,7 +698,7 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs23[UniversalRouterVersion.V2_0] = {
     address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',
     creationBlock: 29255937
-  }, _routerConfigs23)
+  }, _routerConfigs23[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs23)
 }, _CHAIN_CONFIGS[196] = {
   weth: '0xe538905cf8410324e03A5A23C1c177a474D59b2b',
   routerConfigs: (_routerConfigs24 = {}, _routerConfigs24[UniversalRouterVersion.V1_2] = {
@@ -633,7 +707,16 @@ var CHAIN_CONFIGS = (_CHAIN_CONFIGS = {}, _CHAIN_CONFIGS[1] = {
   }, _routerConfigs24[UniversalRouterVersion.V2_0] = {
     address: '0x5507749f2c558bb3e162c6e90c314c092e7372ff',
     creationBlock: 47680350
-  }, _routerConfigs24)
+  }, _routerConfigs24[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs24)
+}, _CHAIN_CONFIGS[30] = {
+  weth: WETH_NOT_SUPPORTED_ON_CHAIN,
+  routerConfigs: (_routerConfigs25 = {}, _routerConfigs25[UniversalRouterVersion.V1_2] = ZERO_ROUTER_CONFIG, _routerConfigs25[UniversalRouterVersion.V2_0] = ZERO_ROUTER_CONFIG, _routerConfigs25[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs25)
+}, _CHAIN_CONFIGS[111557560] = {
+  weth: '0x4200000000000000000000000000000000000006',
+  routerConfigs: (_routerConfigs26 = {}, _routerConfigs26[UniversalRouterVersion.V1_2] = ZERO_ROUTER_CONFIG, _routerConfigs26[UniversalRouterVersion.V2_0] = {
+    address: '0x2D094CE21AE3431909e373207a2fCef4ba8871a9',
+    creationBlock: 6183303
+  }, _routerConfigs26[UniversalRouterVersion.V2_1] = ZERO_ROUTER_CONFIG, _routerConfigs26)
 }, _CHAIN_CONFIGS);
 var UNIVERSAL_ROUTER_ADDRESS = function UNIVERSAL_ROUTER_ADDRESS(version, chainId) {
   if (!(chainId in CHAIN_CONFIGS)) throw new Error("Universal Router not deployed on chain " + chainId);
@@ -1084,6 +1167,56 @@ function encodeInputTokenOptions(planner, options) {
   }
 }
 
+var EIP712_DOMAIN_NAME = 'UniversalRouter';
+var EIP712_DOMAIN_VERSION = '2';
+var EXECUTE_SIGNED_TYPES = {
+  ExecuteSigned: [{
+    name: 'commands',
+    type: 'bytes'
+  }, {
+    name: 'inputs',
+    type: 'bytes[]'
+  }, {
+    name: 'intent',
+    type: 'bytes'
+  }, {
+    name: 'data',
+    type: 'bytes'
+  }, {
+    name: 'sender',
+    type: 'address'
+  }, {
+    name: 'nonce',
+    type: 'uint256'
+  }, {
+    name: 'deadline',
+    type: 'uint256'
+  }]
+};
+// When set as the nonce, the nonce check is skipped
+var NONCE_SKIP_CHECK = /*#__PURE__*/BigNumber.from('0x8000000000000000000000000000000000000000000000000000000000000000');
+/**
+ * Generate a random nonce for signed execution
+ */
+function generateNonce() {
+  var randomBytes = new Uint8Array(32);
+  for (var i = 0; i < 32; i++) {
+    randomBytes[i] = Math.floor(Math.random() * 256);
+  }
+  return BigNumber.from(randomBytes).toHexString();
+}
+/**
+ * Get the EIP712 domain for a Universal Router contract
+ */
+function getUniversalRouterDomain(chainId, routerAddress) {
+  return {
+    name: EIP712_DOMAIN_NAME,
+    version: EIP712_DOMAIN_VERSION,
+    chainId: chainId,
+    verifyingContract: routerAddress
+  };
+}
+
 function isMint(options) {
   return Object.keys(options).some(function (k) {
     return k === 'recipient';
@@ -1091,7 +1224,7 @@ function isMint(options) {
 }
 var SwapRouter = /*#__PURE__*/function () {
   function SwapRouter() {}
-  SwapRouter.swapCallParameters = function swapCallParameters(trades, options) {
+  SwapRouter.swapCallParameters = function swapCallParameters(trades, options, bridgeOptions) {
     // TODO: use permit if signature included in swapOptions
     var planner = new RoutePlanner();
     var trade = new UniswapTrade(trades, options);
@@ -1104,6 +1237,11 @@ var SwapRouter = /*#__PURE__*/function () {
     trade.encode(planner, {
       allowRevert: false
     });
+    if (bridgeOptions) {
+      bridgeOptions.forEach(function (bridge) {
+        return planner.addAcrossBridge(bridge);
+      });
+    }
     return SwapRouter.encodePlan(planner, nativeCurrencyValue, {
       deadline: options.deadlineOrPreviousBlockhash ? BigNumber.from(options.deadlineOrPreviousBlockhash) : undefined
     });
@@ -1171,6 +1309,39 @@ var SwapRouter = /*#__PURE__*/function () {
     return SwapRouter.encodePlan(planner, BigNumber.from(0), {
       deadline: BigNumber.from(options.v4AddLiquidityOptions.deadline)
     });
+  };
+  SwapRouter.getExecuteSignedPayload = function getExecuteSignedPayload(calldata, signedOptions, deadline, chainId, routerAddress) {
+    var iface = SwapRouter.INTERFACE;
+    var decoded = iface.decodeFunctionData('execute', calldata);
+    var commands = decoded[0];
+    var inputs = decoded[1];
+    var nonce = signedOptions.nonce || generateNonce();
+    var domain = getUniversalRouterDomain(chainId, routerAddress);
+    return {
+      domain: domain,
+      types: EXECUTE_SIGNED_TYPES,
+      value: {
+        commands: commands,
+        inputs: inputs,
+        intent: signedOptions.intent,
+        data: signedOptions.data,
+        sender: signedOptions.sender,
+        nonce: nonce,
+        deadline: deadline.toString()
+      }
+    };
+  };
+  SwapRouter.encodeExecuteSigned = function encodeExecuteSigned(calldata, signature, signedOptions, deadline, nativeCurrencyValue) {
+    var iface = SwapRouter.INTERFACE;
+    var decoded = iface.decodeFunctionData('execute', calldata);
+    var commands = decoded[0];
+    var inputs = decoded[1];
+    var nonce = signedOptions.nonce || generateNonce();
+    var executeSignedCalldata = iface.encodeFunctionData('executeSigned', [commands, inputs, signedOptions.intent, signedOptions.data, signedOptions.sender, nonce, BigNumber.from(deadline).toString(), signature]);
+    return {
+      calldata: executeSignedCalldata,
+      value: (nativeCurrencyValue || BigNumber.from(0)).toHexString()
+    };
   }
   /**
    * Encodes a planned route into a method name and parameters for the Router contract.
@@ -1512,5 +1683,5 @@ function v4RouterCallToParams(actions) {
   });
 }
 
-export { COMMAND_DEFINITION, CommandParser, CommandType, GenericCommandParser, Parser, PoolType, ROUTER_AS_RECIPIENT, RoutePlanner, RouterActionType, RouterTradeAdapter, Subparser, SwapRouter, UNIVERSAL_ROUTER_ADDRESS, UNIVERSAL_ROUTER_CREATION_BLOCK, UniswapTrade, UniversalRouterVersion, UnwrapWETH, WETH_ADDRESS, isNativeCurrency };
+export { COMMAND_DEFINITION, CONTRACT_BALANCE, CommandParser, CommandType, EXECUTE_SIGNED_TYPES, GenericCommandParser, NONCE_SKIP_CHECK, Parser, PoolType, ROUTER_AS_RECIPIENT, RoutePlanner, RouterActionType, RouterTradeAdapter, Subparser, SwapRouter, UNIVERSAL_ROUTER_ADDRESS, UNIVERSAL_ROUTER_CREATION_BLOCK, UniswapTrade, UniversalRouterVersion, UnwrapWETH, WETH_ADDRESS, generateNonce, getUniversalRouterDomain, isNativeCurrency };
 //# sourceMappingURL=universal-router-sdk.esm.js.map
diff --git a/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.esm.js.map b/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.esm.js.map
index 8f79623..d75ca37 100644
--- a/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.esm.js.map
+++ b/node_modules/@uniswap/universal-router-sdk/dist/universal-router-sdk.esm.js.map
@@ -1 +1 @@
-{"version":3,"file":"universal-router-sdk.esm.js","sources":["../src/utils/routerCommands.ts","../src/utils/pathCurrency.ts","../src/entities/Command.ts","../src/utils/constants.ts","../src/utils/getCurrencyAddress.ts","../src/utils/numbers.ts","../src/entities/actions/uniswap.ts","../src/utils/inputTokens.ts","../src/swapRouter.ts","../src/entities/actions/unwrapWETH.ts","../src/utils/routerTradeAdapter.ts","../src/utils/commandParser.ts"],"sourcesContent":["import { defaultAbiCoder } from 'ethers/lib/utils'\n\n/**\n * CommandTypes\n * @description Flags that modify a command's execution\n * @enum {number}\n */\nexport enum CommandType {\n  V3_SWAP_EXACT_IN = 0x00,\n  V3_SWAP_EXACT_OUT = 0x01,\n  PERMIT2_TRANSFER_FROM = 0x02,\n  PERMIT2_PERMIT_BATCH = 0x03,\n  SWEEP = 0x04,\n  TRANSFER = 0x05,\n  PAY_PORTION = 0x06,\n\n  V2_SWAP_EXACT_IN = 0x08,\n  V2_SWAP_EXACT_OUT = 0x09,\n  PERMIT2_PERMIT = 0x0a,\n  WRAP_ETH = 0x0b,\n  UNWRAP_WETH = 0x0c,\n  PERMIT2_TRANSFER_FROM_BATCH = 0x0d,\n  BALANCE_CHECK_ERC20 = 0x0e,\n\n  V4_SWAP = 0x10,\n  V3_POSITION_MANAGER_PERMIT = 0x11,\n  V3_POSITION_MANAGER_CALL = 0x12,\n  V4_INITIALIZE_POOL = 0x13,\n  V4_POSITION_MANAGER_CALL = 0x14,\n\n  EXECUTE_SUB_PLAN = 0x21,\n}\n\nexport enum Subparser {\n  V3PathExactIn,\n  V3PathExactOut,\n}\n\nexport enum Parser {\n  Abi,\n  V4Actions,\n  V3Actions,\n}\n\nexport type ParamType = {\n  readonly name: string\n  readonly type: string\n  readonly subparser?: Subparser\n}\n\nexport type CommandDefinition =\n  | {\n      parser: Parser.Abi\n      params: ParamType[]\n    }\n  | {\n      parser: Parser.V4Actions\n    }\n  | {\n      parser: Parser.V3Actions\n    }\n\nconst ALLOW_REVERT_FLAG = 0x80\nconst REVERTIBLE_COMMANDS = new Set<CommandType>([CommandType.EXECUTE_SUB_PLAN])\n\nconst PERMIT_STRUCT =\n  '((address token,uint160 amount,uint48 expiration,uint48 nonce) details,address spender,uint256 sigDeadline)'\n\nconst PERMIT_BATCH_STRUCT =\n  '((address token,uint160 amount,uint48 expiration,uint48 nonce)[] details,address spender,uint256 sigDeadline)'\n\nconst POOL_KEY_STRUCT = '(address currency0,address currency1,uint24 fee,int24 tickSpacing,address hooks)'\n\nconst PERMIT2_TRANSFER_FROM_STRUCT = '(address from,address to,uint160 amount,address token)'\nconst PERMIT2_TRANSFER_FROM_BATCH_STRUCT = PERMIT2_TRANSFER_FROM_STRUCT + '[]'\n\nexport const COMMAND_DEFINITION: { [key in CommandType]: CommandDefinition } = {\n  // Batch Reverts\n  [CommandType.EXECUTE_SUB_PLAN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'commands', type: 'bytes' },\n      { name: 'inputs', type: 'bytes[]' },\n    ],\n  },\n\n  // Permit2 Actions\n  [CommandType.PERMIT2_PERMIT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'permit', type: PERMIT_STRUCT },\n      { name: 'signature', type: 'bytes' },\n    ],\n  },\n  [CommandType.PERMIT2_PERMIT_BATCH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'permit', type: PERMIT_BATCH_STRUCT },\n      { name: 'signature', type: 'bytes' },\n    ],\n  },\n  [CommandType.PERMIT2_TRANSFER_FROM]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'amount', type: 'uint160' },\n    ],\n  },\n  [CommandType.PERMIT2_TRANSFER_FROM_BATCH]: {\n    parser: Parser.Abi,\n    params: [\n      {\n        name: 'transferFrom',\n        type: PERMIT2_TRANSFER_FROM_BATCH_STRUCT,\n      },\n    ],\n  },\n\n  // Uniswap Actions\n  [CommandType.V3_SWAP_EXACT_IN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountIn', type: 'uint256' },\n      { name: 'amountOutMin', type: 'uint256' },\n      { name: 'path', subparser: Subparser.V3PathExactIn, type: 'bytes' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V3_SWAP_EXACT_OUT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountOut', type: 'uint256' },\n      { name: 'amountInMax', type: 'uint256' },\n      { name: 'path', subparser: Subparser.V3PathExactOut, type: 'bytes' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V2_SWAP_EXACT_IN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountIn', type: 'uint256' },\n      { name: 'amountOutMin', type: 'uint256' },\n      { name: 'path', type: 'address[]' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V2_SWAP_EXACT_OUT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountOut', type: 'uint256' },\n      { name: 'amountInMax', type: 'uint256' },\n      { name: 'path', type: 'address[]' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V4_SWAP]: { parser: Parser.V4Actions },\n\n  // Token Actions and Checks\n  [CommandType.WRAP_ETH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amount', type: 'uint256' },\n    ],\n  },\n  [CommandType.UNWRAP_WETH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountMin', type: 'uint256' },\n    ],\n  },\n  [CommandType.SWEEP]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'amountMin', type: 'uint256' },\n    ],\n  },\n  [CommandType.TRANSFER]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'value', type: 'uint256' },\n    ],\n  },\n  [CommandType.PAY_PORTION]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'bips', type: 'uint256' },\n    ],\n  },\n  [CommandType.BALANCE_CHECK_ERC20]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'owner', type: 'address' },\n      { name: 'token', type: 'address' },\n      { name: 'minBalance', type: 'uint256' },\n    ],\n  },\n  [CommandType.V4_INITIALIZE_POOL]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'poolKey', type: POOL_KEY_STRUCT },\n      { name: 'sqrtPriceX96', type: 'uint160' },\n    ],\n  },\n\n  // Position Actions\n  [CommandType.V3_POSITION_MANAGER_PERMIT]: { parser: Parser.V3Actions },\n  [CommandType.V3_POSITION_MANAGER_CALL]: { parser: Parser.V3Actions },\n  [CommandType.V4_POSITION_MANAGER_CALL]: { parser: Parser.V4Actions },\n}\n\nexport class RoutePlanner {\n  commands: string\n  inputs: string[]\n\n  constructor() {\n    this.commands = '0x'\n    this.inputs = []\n  }\n\n  addSubPlan(subplan: RoutePlanner): RoutePlanner {\n    this.addCommand(CommandType.EXECUTE_SUB_PLAN, [subplan.commands, subplan.inputs], true)\n    return this\n  }\n\n  addCommand(type: CommandType, parameters: any[], allowRevert = false): RoutePlanner {\n    let command = createCommand(type, parameters)\n    this.inputs.push(command.encodedInput)\n    if (allowRevert) {\n      if (!REVERTIBLE_COMMANDS.has(command.type)) {\n        throw new Error(`command type: ${command.type} cannot be allowed to revert`)\n      }\n      command.type = command.type | ALLOW_REVERT_FLAG\n    }\n\n    this.commands = this.commands.concat(command.type.toString(16).padStart(2, '0'))\n    return this\n  }\n}\n\nexport type RouterCommand = {\n  type: CommandType\n  encodedInput: string\n}\n\nexport function createCommand(type: CommandType, parameters: any[]): RouterCommand {\n  const commandDef = COMMAND_DEFINITION[type]\n  switch (commandDef.parser) {\n    case Parser.Abi:\n      const encodedInput = defaultAbiCoder.encode(\n        commandDef.params.map((abi) => abi.type),\n        parameters\n      )\n      return { type, encodedInput }\n    case Parser.V4Actions:\n      // v4 swap data comes pre-encoded at index 0\n      return { type, encodedInput: parameters[0] }\n    case Parser.V3Actions:\n      // v4 swap data comes pre-encoded at index 0\n      return { type, encodedInput: parameters[0] }\n  }\n}\n","import { Currency, Token } from '@uniswap/sdk-core'\nimport { Pool as V4Pool } from '@uniswap/v4-sdk'\nimport { TPool } from '@uniswap/router-sdk'\n\nexport function getPathCurrency(currency: Currency, pool: TPool): Currency {\n  // return currency if the currency matches a currency of the pool\n  if (pool.involvesToken(currency as Token)) {\n    return currency\n\n    // return if currency.wrapped if pool involves wrapped currency\n  } else if (pool.involvesToken(currency.wrapped as Token)) {\n    return currency.wrapped\n\n    // return native currency if pool involves native version of wrapped currency (only applies to V4)\n  } else if (pool instanceof V4Pool && pool.token0.wrapped.equals(currency)) {\n    return pool.token0\n  } else if (pool instanceof V4Pool && pool.token1.wrapped.equals(currency)) {\n    return pool.token1\n  } else {\n    throw new Error(`Expected currency ${currency.symbol} to be either ${pool.token0.symbol} or ${pool.token1.symbol}`)\n  }\n\n  return currency // this line needed for typescript to compile\n}\n","import { RoutePlanner } from '../utils/routerCommands'\n\nexport type TradeConfig = {\n  allowRevert: boolean\n}\n\nexport enum RouterActionType {\n  UniswapTrade = 'UniswapTrade',\n  UnwrapWETH = 'UnwrapWETH',\n}\n\n// interface for entities that can be encoded as a Universal Router command\nexport interface Command {\n  tradeType: RouterActionType\n  encode(planner: RoutePlanner, config: TradeConfig): void\n}\n","import { BigNumber } from 'ethers'\n\nexport enum UniversalRouterVersion {\n  V1_2 = '1.2',\n  V2_0 = '2.0',\n}\n\nexport type RouterConfig = {\n  address: string\n  creationBlock: number\n}\n\ntype ChainConfig = {\n  weth: string\n  routerConfigs: { [key in UniversalRouterVersion]: RouterConfig }\n}\n\nconst WETH_NOT_SUPPORTED_ON_CHAIN = '0x0000000000000000000000000000000000000000'\n\n// Todo: Change `CHAIN_CONFIGS` to pull the UR address with v4\nexport const CHAIN_CONFIGS: { [key: number]: ChainConfig } = {\n  // mainnet\n  [1]: {\n    weth: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17143817,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x66a9893cc07d91d95644aedd05d03f95e1dba8af',\n        creationBlock: 1737658355,\n      },\n    },\n  },\n  // goerli\n  [5]: {\n    weth: '0xb4fbf271143f4fbf7b91a5ded31805e42b2208d6',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8940568,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8940568,\n      },\n    },\n  },\n  // sepolia\n  [11155111]: {\n    weth: '0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 3543575,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3a9d48ab9751398bbfa63ad67599bb04e4bdf98b', // only update here and creation block below\n        creationBlock: 7259601,\n      },\n    },\n  },\n  // polygon\n  [137]: {\n    weth: '0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xec7BE89e9d109e7e3Fec59c222CF297125FEFda2',\n        creationBlock: 52210153,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x1095692a6237d83c6a72f3f5efedb9a670c49223',\n        creationBlock: 1737492197,\n      },\n    },\n  },\n  //polygon mumbai\n  [80001]: {\n    weth: '0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 35176052,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 35176052,\n      },\n    },\n  },\n  //optimism\n  [10]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xCb1355ff08Ab38bBCE60111F1bb2B784bE25D7e8',\n        creationBlock: 114702266,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x851116d9223fabed8e56c0e6b8ad0c31d98b3507',\n        creationBlock: 1737494278,\n      },\n    },\n  },\n  // optimism goerli\n  [420]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8887728,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8887728,\n      },\n    },\n  },\n  // arbitrum\n  [42161]: {\n    weth: '0x82aF49447D8a07e3bd95BD0d56f35241523fBab1',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x5E325eDA8064b456f4781070C0738d849c824258',\n        creationBlock: 169472836,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xa51afafe0263b40edaef0df8781ea9aa03e381a3',\n        creationBlock: 1737487458,\n      },\n    },\n  },\n  // arbitrum goerli\n  [421613]: {\n    weth: '0xe39Ab88f8A4777030A534146A9Ca3B52bd5D43A3',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 18815277,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 18815277,\n      },\n    },\n  },\n  // celo\n  [42220]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x643770e279d5d0733f21d6dc03a8efbabf3255b4',\n        creationBlock: 21407637,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xcb695bc5D3Aa22cAD1E6DF07801b061a05A0233A',\n        creationBlock: 47387857,\n      },\n    },\n  },\n  // celo alfajores\n  [44787]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17566658,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17566658,\n      },\n    },\n  },\n  // binance smart chain\n  [56]: {\n    weth: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4Dae2f939ACf50408e13d58534Ff8c2776d45265',\n        creationBlock: 35160263,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x1906c1d672b88cd1b9ac7593301ca990f94eae07',\n        creationBlock: 1737493275,\n      },\n    },\n  },\n  // avalanche\n  [43114]: {\n    weth: '0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4Dae2f939ACf50408e13d58534Ff8c2776d45265',\n        creationBlock: 40237257,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x94b75331ae8d42c1b61065089b7d48fe14aa73b7',\n        creationBlock: 1737558236,\n      },\n    },\n  },\n  // base goerli\n  [84531]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',\n        creationBlock: 6915289,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',\n        creationBlock: 6915289,\n      },\n    },\n  },\n  // base mainnet\n  [8453]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 9107268,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x6ff5693b99212da76ad316178a184ab56d299b43',\n        creationBlock: 1737491485,\n      },\n    },\n  },\n  // blast\n  [81457]: {\n    weth: '0x4300000000000000000000000000000000000004',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x643770E279d5D0733F21d6DC03A8efbABf3255B4',\n        creationBlock: 1116444,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xeabbcb3e8e415306207ef514f660a3f820025be3',\n        creationBlock: 1737564586,\n      },\n    },\n  },\n  // zora\n  [7777777]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x2986d9721A49838ab4297b695858aF7F17f38014',\n        creationBlock: 11832155,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3315ef7ca28db74abadc6c44570efdf06b04b020',\n        creationBlock: 1737562927,\n      },\n    },\n  },\n  [324]: {\n    weth: '0x5aea5775959fbc2557cc8789bc1bf90a239d9a91',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',\n        creationBlock: 12640979,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',\n        creationBlock: 12640979,\n      },\n    },\n  },\n  // worldchain\n  [480]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D',\n        creationBlock: 4063979,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x8ac7bee993bb44dab564ea4bc9ea67bf9eb5e743',\n        creationBlock: 1737559557,\n      },\n    },\n  },\n  [1301]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x8909Dc15e40173Ff4699343b6eB8132c65e18eC6',\n        creationBlock: 1241811,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xf70536b3bcc1bd1a972dc186a2cf84cc6da6be5d',\n        creationBlock: 7100543,\n      },\n    },\n  },\n  // unichain mainnet\n  [130]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4D73A4411CA1c660035e4AECC8270E5DdDEC8C17',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xef740bf23acae26f6492b10de645d6b98dc8eaf3',\n        creationBlock: 1737568156,\n      },\n    },\n  },\n  [10143]: {\n    weth: '0x760AfE86e5de5fa0Ee542fc7B7B713e1c5425701',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',\n        creationBlock: 23678,\n      },\n    },\n  },\n  [84532]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x492e6456d9528771018deb9e87ef7750ef184104',\n        creationBlock: 20216585,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x492e6456d9528771018deb9e87ef7750ef184104',\n        creationBlock: 20216585,\n      },\n    },\n  },\n  [1868]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',\n        creationBlock: 3254782,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',\n        creationBlock: 3254782,\n      },\n    },\n  },\n  [143]: {\n    weth: '0x3bd359C1119dA7Da1D913D1C4D2B7c461115433A',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',\n        creationBlock: 29255937,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',\n        creationBlock: 29255937,\n      },\n    },\n  },\n  [196]: {\n    weth: '0xe538905cf8410324e03A5A23C1c177a474D59b2b',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0000000000000000000000000000000000000000',\n        creationBlock: 1,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x5507749f2c558bb3e162c6e90c314c092e7372ff',\n        creationBlock: 47680350,\n      },\n    },\n  },\n}\n\nexport const UNIVERSAL_ROUTER_ADDRESS = (version: UniversalRouterVersion, chainId: number): string => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n  return CHAIN_CONFIGS[chainId].routerConfigs[version].address\n}\n\nexport const UNIVERSAL_ROUTER_CREATION_BLOCK = (version: UniversalRouterVersion, chainId: number): number => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n  return CHAIN_CONFIGS[chainId].routerConfigs[version].creationBlock\n}\n\nexport const WETH_ADDRESS = (chainId: number): string => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n\n  if (CHAIN_CONFIGS[chainId].weth == WETH_NOT_SUPPORTED_ON_CHAIN) throw new Error(`Chain ${chainId} does not have WETH`)\n\n  return CHAIN_CONFIGS[chainId].weth\n}\n\nexport const CONTRACT_BALANCE = BigNumber.from(2).pow(255)\nexport const ETH_ADDRESS = '0x0000000000000000000000000000000000000000'\nexport const E_ETH_ADDRESS = '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee'\nexport const ZERO_ADDRESS = '0x0000000000000000000000000000000000000000'\nexport const MAX_UINT256 = BigNumber.from(2).pow(256).sub(1)\nexport const MAX_UINT160 = BigNumber.from(2).pow(160).sub(1)\n\nexport const SENDER_AS_RECIPIENT = '0x0000000000000000000000000000000000000001'\nexport const ROUTER_AS_RECIPIENT = '0x0000000000000000000000000000000000000002'\n","import { Currency } from '@uniswap/sdk-core'\nimport { ETH_ADDRESS } from './constants'\n\nexport function getCurrencyAddress(currency: Currency): string {\n  return currency.isNative ? ETH_ADDRESS : currency.wrapped.address\n}\n","import { BigNumber } from 'ethers'\nimport JSBI from 'jsbi'\nimport bn from 'bignumber.js'\nimport { Percent } from '@uniswap/sdk-core'\nimport { toHex } from '@uniswap/v3-sdk'\n\nexport function expandTo18DecimalsBN(n: number): BigNumber {\n  // use bn intermediately to allow decimals in intermediate calculations\n  return BigNumber.from(new bn(n).times(new bn(10).pow(18)).toFixed())\n}\n\nexport function expandTo18Decimals(n: number): JSBI {\n  return JSBI.BigInt(BigNumber.from(n).mul(BigNumber.from(10).pow(18)).toString())\n}\n\nexport function encodeFeeBips(fee: Percent): string {\n  return toHex(fee.multiply(10_000).quotient)\n}\n","import { RoutePlanner, CommandType } from '../../utils/routerCommands'\nimport { Trade as V2Trade, Pair } from '@uniswap/v2-sdk'\nimport { Trade as V3Trade, Pool as V3Pool, encodeRouteToPath } from '@uniswap/v3-sdk'\nimport {\n  Route as V4Route,\n  Trade as V4Trade,\n  Pool as V4Pool,\n  V4Planner,\n  encodeRouteToPath as encodeV4RouteToPath,\n  Actions,\n} from '@uniswap/v4-sdk'\nimport {\n  Trade as RouterTrade,\n  MixedRouteTrade,\n  Protocol,\n  IRoute,\n  RouteV2,\n  RouteV3,\n  MixedRouteSDK,\n  MixedRoute,\n  SwapOptions as RouterSwapOptions,\n  getOutputOfPools,\n  encodeMixedRouteToPath,\n  partitionMixedRouteByProtocol,\n} from '@uniswap/router-sdk'\nimport { Permit2Permit } from '../../utils/inputTokens'\nimport { getPathCurrency } from '../../utils/pathCurrency'\nimport { Currency, TradeType, Token, CurrencyAmount, Percent } from '@uniswap/sdk-core'\nimport { Command, RouterActionType, TradeConfig } from '../Command'\nimport { SENDER_AS_RECIPIENT, ROUTER_AS_RECIPIENT, CONTRACT_BALANCE, ETH_ADDRESS } from '../../utils/constants'\nimport { getCurrencyAddress } from '../../utils/getCurrencyAddress'\nimport { encodeFeeBips } from '../../utils/numbers'\nimport { BigNumber, BigNumberish } from 'ethers'\nimport { TPool } from '@uniswap/router-sdk'\n\nexport type FlatFeeOptions = {\n  amount: BigNumberish\n  recipient: string\n}\n\n// the existing router permit object doesn't include enough data for permit2\n// so we extend swap options with the permit2 permit\n// when safe mode is enabled, the SDK will add an extra ETH sweep for security\n// when useRouterBalance is enabled the SDK will use the balance in the router for the swap\nexport type SwapOptions = Omit<RouterSwapOptions, 'inputTokenPermit'> & {\n  useRouterBalance?: boolean\n  inputTokenPermit?: Permit2Permit\n  flatFee?: FlatFeeOptions\n  safeMode?: boolean\n}\n\nconst REFUND_ETH_PRICE_IMPACT_THRESHOLD = new Percent(50, 100)\n\ninterface Swap<TInput extends Currency, TOutput extends Currency> {\n  route: IRoute<TInput, TOutput, TPool>\n  inputAmount: CurrencyAmount<TInput>\n  outputAmount: CurrencyAmount<TOutput>\n}\n\n// Wrapper for uniswap router-sdk trade entity to encode swaps for Universal Router\n// also translates trade objects from previous (v2, v3) SDKs\nexport class UniswapTrade implements Command {\n  readonly tradeType: RouterActionType = RouterActionType.UniswapTrade\n  readonly payerIsUser: boolean\n\n  constructor(public trade: RouterTrade<Currency, Currency, TradeType>, public options: SwapOptions) {\n    if (!!options.fee && !!options.flatFee) throw new Error('Only one fee option permitted')\n\n    if (this.inputRequiresWrap || this.inputRequiresUnwrap || this.options.useRouterBalance) {\n      this.payerIsUser = false\n    } else {\n      this.payerIsUser = true\n    }\n  }\n\n  get isAllV4(): boolean {\n    let result = true\n    for (const swap of this.trade.swaps) {\n      result = result && swap.route.protocol == Protocol.V4\n    }\n    return result\n  }\n\n  // this.trade.swaps is an array of swaps / trades.\n  // we are iterating over one swap (trade) at a time so length is 1\n  // route is either v2, v3, v4, or mixed\n  // pathInput and pathOutput are the currencies of the input and output of the route\n  // this.trade.inputAmount is the input currency of the trade (could be different from pathInput)\n  // this.trade.outputAmount is the output currency of the trade (could be different from pathOutput)\n  // each route can have multiple pools\n  get inputRequiresWrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const route = swap.route\n    const firstPool = route.pools[0]\n\n    if (firstPool instanceof V4Pool) {\n      // If first pool is a v4 pool and input currency is native and the path input currency in the route is not native, we need to wrap.\n      return (\n        this.trade.inputAmount.currency.isNative &&\n        !(this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathInput.isNative\n      )\n    }\n    // If first pool is not a v4 pool and input currency is native, we need to wrap\n    return this.trade.inputAmount.currency.isNative\n  }\n\n  get inputRequiresUnwrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const route = swap.route\n    const firstPool = route.pools[0]\n\n    if (firstPool instanceof V4Pool) {\n      // If the first pool is a v4 pool and input currency is not native and the path input currency is native, we need to unwrap\n      return (\n        !this.trade.inputAmount.currency.isNative &&\n        (this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathInput.isNative\n      )\n    }\n    // If the first pool is not a v4 pool, we don't need to unwrap.\n    return false\n  }\n\n  get outputRequiresWrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const lastRoute = swap.route\n    const lastPool = lastRoute.pools[lastRoute.pools.length - 1]\n\n    // if last pool is v4:\n    if (lastPool instanceof V4Pool) {\n      // If output currency is not native but path currency output is native, we need to wrap\n      if (!this.trade.outputAmount.currency.isNative) {\n        if ((lastRoute as unknown as V4Route<Currency, Currency>).pathOutput.isNative) {\n          // this means path output is native and we need to wrap\n          return true\n        } else if (lastPool.currency1.equals(lastPool.currency0.wrapped) && lastRoute.pools.length > 1) {\n          let poolBefore = lastRoute.pools[lastRoute.pools.length - 2]\n          // this means last pool is eth-weth and pool before contains weth\n          if (\n            poolBefore instanceof V4Pool &&\n            (poolBefore.currency0.equals(lastPool.currency1) || poolBefore.currency1.equals(lastPool.currency1))\n          ) {\n            return true\n          } else if (poolBefore.token0.equals(lastPool.currency1) || poolBefore.token1.equals(lastPool.currency1)) {\n            // same for v2 and v3 pools\n            return true\n          }\n        }\n      }\n    }\n    // if last pool is not v4:\n    // we do not need to wrap because v2 and v3 pools already require wrapped tokens\n    return false\n  }\n\n  get outputRequiresUnwrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const lastRoute = swap.route\n    const lastPool = lastRoute.pools[lastRoute.pools.length - 1]\n\n    // if last pool is v4:\n    if (lastPool instanceof V4Pool) {\n      // If output currency is native and path currency output is not native, we need to unwrap\n      if (this.trade.outputAmount.currency.isNative) {\n        if (!(this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathOutput.isNative) {\n          // this means path output is weth and we need to unwrap\n          return true\n        } else if (\n          lastRoute.pools.length > 1 &&\n          lastRoute.pools[lastRoute.pools.length - 2] instanceof V4Pool &&\n          (lastRoute.pools[lastRoute.pools.length - 2] as V4Pool).currency0.isNative &&\n          lastPool.currency1.equals(lastPool.currency0.wrapped)\n        ) {\n          // this means last pool is eth-weth and we need to unwrap\n          return true\n        } else {\n          return false\n        }\n      }\n    }\n    // else: if path output currency is native, we need to unwrap because v2 and v3 pools already require wrapped tokens\n    return this.trade.outputAmount.currency.isNative\n  }\n\n  get outputRequiresTransition(): boolean {\n    return this.outputRequiresWrap || this.outputRequiresUnwrap\n  }\n\n  encode(planner: RoutePlanner, _config: TradeConfig): void {\n    // If the input currency is the native currency, we need to wrap it with the router as the recipient\n    if (this.inputRequiresWrap) {\n      // TODO: optimize if only one v2 pool we can directly send this to the pool\n      planner.addCommand(CommandType.WRAP_ETH, [\n        ROUTER_AS_RECIPIENT,\n        this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString(),\n      ])\n    } else if (this.inputRequiresUnwrap) {\n      // send wrapped token to router to unwrap\n      planner.addCommand(CommandType.PERMIT2_TRANSFER_FROM, [\n        (this.trade.inputAmount.currency as Token).address,\n        ROUTER_AS_RECIPIENT,\n        this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString(),\n      ])\n      planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, 0])\n    }\n    // The overall recipient at the end of the trade, SENDER_AS_RECIPIENT uses the msg.sender\n    this.options.recipient = this.options.recipient ?? SENDER_AS_RECIPIENT\n\n    // flag for whether we want to perform slippage check on aggregate output of multiple routes\n    //   1. when there are >2 exact input trades. this is only a heuristic,\n    //      as it's still more gas-expensive even in this case, but has benefits\n    //      in that the reversion probability is lower\n    const performAggregatedSlippageCheck =\n      this.trade.tradeType === TradeType.EXACT_INPUT && this.trade.routes.length > 2\n    const routerMustCustody =\n      performAggregatedSlippageCheck || this.outputRequiresTransition || hasFeeOption(this.options)\n\n    for (const swap of this.trade.swaps) {\n      switch (swap.route.protocol) {\n        case Protocol.V2:\n          addV2Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.V3:\n          addV3Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.V4:\n          addV4Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.MIXED:\n          addMixedSwap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        default:\n          throw new Error('UNSUPPORTED_TRADE_PROTOCOL')\n      }\n    }\n\n    let minimumAmountOut: BigNumber = BigNumber.from(\n      this.trade.minimumAmountOut(this.options.slippageTolerance).quotient.toString()\n    )\n    // The router custodies for 3 reasons: to unwrap, to take a fee, and/or to do a slippage check\n    if (routerMustCustody) {\n      const pools = this.trade.swaps[0].route.pools\n      const pathOutputCurrencyAddress = getCurrencyAddress(\n        getPathCurrency(this.trade.outputAmount.currency, pools[pools.length - 1])\n      )\n\n      // If there is a fee, that percentage is sent to the fee recipient\n      // In the case where ETH is the output currency, the fee is taken in WETH (for gas reasons)\n      if (!!this.options.fee) {\n        const feeBips = encodeFeeBips(this.options.fee.fee)\n        planner.addCommand(CommandType.PAY_PORTION, [pathOutputCurrencyAddress, this.options.fee.recipient, feeBips])\n\n        // If the trade is exact output, and a fee was taken, we must adjust the amount out to be the amount after the fee\n        // Otherwise we continue as expected with the trade's normal expected output\n        if (this.trade.tradeType === TradeType.EXACT_OUTPUT) {\n          minimumAmountOut = minimumAmountOut.sub(minimumAmountOut.mul(feeBips).div(10000))\n        }\n      }\n\n      // If there is a flat fee, that absolute amount is sent to the fee recipient\n      // In the case where ETH is the output currency, the fee is taken in WETH (for gas reasons)\n      if (!!this.options.flatFee) {\n        const feeAmount = this.options.flatFee.amount\n        if (minimumAmountOut.lt(feeAmount)) throw new Error('Flat fee amount greater than minimumAmountOut')\n\n        planner.addCommand(CommandType.TRANSFER, [pathOutputCurrencyAddress, this.options.flatFee.recipient, feeAmount])\n\n        // If the trade is exact output, and a fee was taken, we must adjust the amount out to be the amount after the fee\n        // Otherwise we continue as expected with the trade's normal expected output\n        if (this.trade.tradeType === TradeType.EXACT_OUTPUT) {\n          minimumAmountOut = minimumAmountOut.sub(feeAmount)\n        }\n      }\n\n      // The remaining tokens that need to be sent to the user after the fee is taken will be caught\n      // by this if-else clause.\n      if (this.outputRequiresUnwrap) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [this.options.recipient, minimumAmountOut])\n      } else if (this.outputRequiresWrap) {\n        planner.addCommand(CommandType.WRAP_ETH, [this.options.recipient, CONTRACT_BALANCE])\n      } else {\n        planner.addCommand(CommandType.SWEEP, [\n          getCurrencyAddress(this.trade.outputAmount.currency),\n          this.options.recipient,\n          minimumAmountOut,\n        ])\n      }\n    }\n\n    // for exactOutput swaps with native input or that perform an inputToken transition (wrap or unwrap)\n    // we need to send back the change to the user\n    if (this.trade.tradeType === TradeType.EXACT_OUTPUT || riskOfPartialFill(this.trade)) {\n      if (this.inputRequiresWrap) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [this.options.recipient, 0])\n      } else if (this.inputRequiresUnwrap) {\n        planner.addCommand(CommandType.WRAP_ETH, [this.options.recipient, CONTRACT_BALANCE])\n      } else if (this.trade.inputAmount.currency.isNative) {\n        // must refund extra native currency sent along for native v4 trades (no input transition)\n        planner.addCommand(CommandType.SWEEP, [ETH_ADDRESS, this.options.recipient, 0])\n      }\n    }\n\n    if (this.options.safeMode) planner.addCommand(CommandType.SWEEP, [ETH_ADDRESS, this.options.recipient, 0])\n  }\n}\n\n// encode a uniswap v2 swap\nfunction addV2Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { route, inputAmount, outputAmount }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const trade = new V2Trade(\n    route as RouteV2<TInput, TOutput>,\n    tradeType == TradeType.EXACT_INPUT ? inputAmount : outputAmount,\n    tradeType\n  )\n\n  if (tradeType == TradeType.EXACT_INPUT) {\n    planner.addCommand(CommandType.V2_SWAP_EXACT_IN, [\n      // if native, we have to unwrap so keep in the router for now\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      // if router will custody funds, we do aggregated slippage check from router\n      routerMustCustody ? 0 : trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      route.path.map((token) => token.wrapped.address),\n      payerIsUser,\n    ])\n  } else if (tradeType == TradeType.EXACT_OUTPUT) {\n    planner.addCommand(CommandType.V2_SWAP_EXACT_OUT, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      route.path.map((token) => token.wrapped.address),\n      payerIsUser,\n    ])\n  }\n}\n\n// encode a uniswap v3 swap\nfunction addV3Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { route, inputAmount, outputAmount }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const trade = V3Trade.createUncheckedTrade({\n    route: route as RouteV3<TInput, TOutput>,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const path = encodeRouteToPath(route as RouteV3<TInput, TOutput>, trade.tradeType === TradeType.EXACT_OUTPUT)\n  if (tradeType == TradeType.EXACT_INPUT) {\n    planner.addCommand(CommandType.V3_SWAP_EXACT_IN, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      routerMustCustody ? 0 : trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      path,\n      payerIsUser,\n    ])\n  } else if (tradeType == TradeType.EXACT_OUTPUT) {\n    planner.addCommand(CommandType.V3_SWAP_EXACT_OUT, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      path,\n      payerIsUser,\n    ])\n  }\n}\n\nfunction addV4Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { inputAmount, outputAmount, route }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  // create a deep copy of pools since v4Planner encoding tampers with array\n  const pools = route.pools.map((p) => p) as V4Pool[]\n  const v4Route = new V4Route(pools, inputAmount.currency, outputAmount.currency)\n  const trade = V4Trade.createUncheckedTrade({\n    route: v4Route,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const slippageToleranceOnSwap =\n    routerMustCustody && tradeType == TradeType.EXACT_INPUT ? undefined : options.slippageTolerance\n\n  const v4Planner = new V4Planner()\n  v4Planner.addTrade(trade, slippageToleranceOnSwap)\n  v4Planner.addSettle(trade.route.pathInput, payerIsUser)\n\n  // Handle split route output consistency:\n  // - If output is ETH and some routes output WETH: force all to output WETH, then unwrap\n  // - If output is WETH and some routes output ETH: force all to output ETH, then wrap\n  let pathOutputForTake = trade.route.pathOutput\n  let lastPool = v4Route.pools[v4Route.pools.length - 1]\n  let ethWethPool = lastPool.currency1.equals(lastPool.currency0.wrapped)\n\n  if (ethWethPool && v4Route.pools.length > 1) {\n    let poolBefore = v4Route.pools[v4Route.pools.length - 2]\n    if (pathOutputForTake.isNative && poolBefore.currency0.isNative) {\n      pathOutputForTake = pathOutputForTake.wrapped\n    } else if (\n      !pathOutputForTake.isNative &&\n      (poolBefore.currency0.equals(lastPool.currency1) || poolBefore.currency1.equals(lastPool.currency1))\n    ) {\n      pathOutputForTake = lastPool.currency0\n    }\n  }\n\n  v4Planner.addTake(\n    pathOutputForTake,\n    routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient ?? SENDER_AS_RECIPIENT\n  )\n  planner.addCommand(CommandType.V4_SWAP, [v4Planner.finalize()])\n}\n\n// encode a mixed route swap, i.e. including both v2 and v3 pools\nfunction addMixedSwap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  swap: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const route = swap.route as MixedRoute<TInput, TOutput>\n  const inputAmount = swap.inputAmount\n  const outputAmount = swap.outputAmount\n  const tradeRecipient = routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient ?? SENDER_AS_RECIPIENT\n\n  // single hop, so it can be reduced to plain swap logic for one protocol version\n  if (route.pools.length === 1) {\n    if (route.pools[0] instanceof V4Pool) {\n      return addV4Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else if (route.pools[0] instanceof V3Pool) {\n      return addV3Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else if (route.pools[0] instanceof Pair) {\n      return addV2Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else {\n      throw new Error('Invalid route type')\n    }\n  }\n\n  const trade = MixedRouteTrade.createUncheckedTrade({\n    route: route as MixedRoute<TInput, TOutput>,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const amountIn = trade.maximumAmountIn(options.slippageTolerance, inputAmount).quotient.toString()\n  const amountOut = routerMustCustody\n    ? 0\n    : trade.minimumAmountOut(options.slippageTolerance, outputAmount).quotient.toString()\n\n  // logic from\n  // https://github.com/Uniswap/router-sdk/blob/d8eed164e6c79519983844ca8b6a3fc24ebcb8f8/src/swapRouter.ts#L276\n  const sections = partitionMixedRouteByProtocol(route as MixedRoute<TInput, TOutput>)\n  const isLastSectionInRoute = (i: number) => {\n    return i === sections.length - 1\n  }\n\n  let inputToken = route.pathInput\n\n  for (let i = 0; i < sections.length; i++) {\n    const section = sections[i]\n    const routePool = section[0]\n    const outputToken = getOutputOfPools(section, inputToken)\n    const subRoute = new MixedRoute(new MixedRouteSDK([...section], inputToken, outputToken))\n\n    let nextInputToken\n    let swapRecipient\n\n    if (isLastSectionInRoute(i)) {\n      nextInputToken = outputToken\n      swapRecipient = tradeRecipient\n    } else {\n      const nextPool = sections[i + 1][0]\n      nextInputToken = getPathCurrency(outputToken, nextPool)\n\n      const v2PoolIsSwapRecipient = nextPool instanceof Pair && outputToken.equals(nextInputToken)\n      swapRecipient = v2PoolIsSwapRecipient ? (nextPool as Pair).liquidityToken.address : ROUTER_AS_RECIPIENT\n    }\n\n    if (routePool instanceof V4Pool) {\n      const v4Planner = new V4Planner()\n      const v4SubRoute = new V4Route(section as V4Pool[], subRoute.input, subRoute.output)\n\n      v4Planner.addSettle(inputToken, payerIsUser && i === 0, (i == 0 ? amountIn : CONTRACT_BALANCE) as BigNumber)\n      v4Planner.addAction(Actions.SWAP_EXACT_IN, [\n        {\n          currencyIn: inputToken.isNative ? ETH_ADDRESS : inputToken.address,\n          path: encodeV4RouteToPath(v4SubRoute),\n          amountIn: 0, // denotes open delta, amount set in v4Planner.addSettle()\n          amountOutMinimum: !isLastSectionInRoute(i) ? 0 : amountOut,\n        },\n      ])\n\n      // Handle split route output consistency for V4 sections in mixed routes\n      let outputTokenForTake = outputToken\n      if (isLastSectionInRoute(i)) {\n        let lastPool = route.pools[route.pools.length - 1]\n        let v4Pool = lastPool instanceof V4Pool\n        let ethWethPool = v4Pool ? (lastPool as V4Pool).currency1.equals((lastPool as V4Pool).currency0.wrapped) : false\n        let poolBefore = route.pools[route.pools.length - 2]\n\n        if (ethWethPool) {\n          if (outputToken.isNative && poolBefore.token0.isNative) {\n            outputTokenForTake = outputToken.wrapped\n          } else if (\n            !outputToken.isNative &&\n            (poolBefore.token0.equals(lastPool.token1) || poolBefore.token1.equals(lastPool.token1))\n          ) {\n            outputTokenForTake = lastPool.token0\n          }\n        }\n      }\n\n      v4Planner.addTake(outputTokenForTake, swapRecipient)\n\n      planner.addCommand(CommandType.V4_SWAP, [v4Planner.finalize()])\n    } else if (routePool instanceof V3Pool) {\n      planner.addCommand(CommandType.V3_SWAP_EXACT_IN, [\n        swapRecipient, // recipient\n        i == 0 ? amountIn : CONTRACT_BALANCE, // amountIn\n        !isLastSectionInRoute(i) ? 0 : amountOut, // amountOut\n        encodeMixedRouteToPath(subRoute), // path\n        payerIsUser && i === 0, // payerIsUser\n      ])\n    } else if (routePool instanceof Pair) {\n      planner.addCommand(CommandType.V2_SWAP_EXACT_IN, [\n        swapRecipient, // recipient\n        i === 0 ? amountIn : CONTRACT_BALANCE, // amountIn\n        !isLastSectionInRoute(i) ? 0 : amountOut, // amountOutMin\n        subRoute.path.map((token) => token.wrapped.address), // path\n        payerIsUser && i === 0,\n      ])\n    } else {\n      throw new Error('Unexpected Pool Type')\n    }\n\n    // perform a token transition (wrap/unwrap if necessary)\n    if (!isLastSectionInRoute(i)) {\n      if (outputToken.isNative && !nextInputToken.isNative) {\n        planner.addCommand(CommandType.WRAP_ETH, [ROUTER_AS_RECIPIENT, CONTRACT_BALANCE])\n      } else if (!outputToken.isNative && nextInputToken.isNative) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, 0])\n      }\n    }\n\n    inputToken = nextInputToken\n  }\n}\n\n// if price impact is very high, there's a chance of hitting max/min prices resulting in a partial fill of the swap\nfunction riskOfPartialFill(trade: RouterTrade<Currency, Currency, TradeType>): boolean {\n  return trade.priceImpact.greaterThan(REFUND_ETH_PRICE_IMPACT_THRESHOLD)\n}\n\nfunction hasFeeOption(swapOptions: SwapOptions): boolean {\n  return !!swapOptions.fee || !!swapOptions.flatFee\n}\n","import invariant from 'tiny-invariant'\nimport { ethers } from 'ethers'\nimport { validateAndParseAddress, BigintIsh } from '@uniswap/sdk-core'\nimport { NFTPermitOptions, NonfungiblePositionManager } from '@uniswap/v3-sdk'\nimport { PermitSingle } from '@uniswap/permit2-sdk'\nimport { CommandType, RoutePlanner } from './routerCommands'\nimport { ROUTER_AS_RECIPIENT } from './constants'\n\nexport interface Permit2Permit extends PermitSingle {\n  signature: string\n}\n\nexport type ApproveProtocol = {\n  token: string\n  protocol: string\n}\n\nexport type Permit2TransferFrom = {\n  token: string\n  amount: string\n  recipient?: string\n}\n\nexport type InputTokenOptions = {\n  permit2Permit?: Permit2Permit\n  permit2TransferFrom?: Permit2TransferFrom\n}\n\nconst SIGNATURE_LENGTH = 65\nconst EIP_2098_SIGNATURE_LENGTH = 64\n\nexport function encodePermit(planner: RoutePlanner, permit2: Permit2Permit): void {\n  let signature = permit2.signature\n\n  const length = ethers.utils.arrayify(permit2.signature).length\n  // signature data provided for EIP-1271 may have length different from ECDSA signature\n  if (length === SIGNATURE_LENGTH || length === EIP_2098_SIGNATURE_LENGTH) {\n    // sanitizes signature to cover edge cases of malformed EIP-2098 sigs and v used as recovery id\n    signature = ethers.utils.joinSignature(ethers.utils.splitSignature(permit2.signature))\n  }\n\n  planner.addCommand(CommandType.PERMIT2_PERMIT, [permit2, signature])\n}\n\nexport function encodeV3PositionPermit(planner: RoutePlanner, permit: NFTPermitOptions, tokenId: BigintIsh): void {\n  const calldata = NonfungiblePositionManager.INTERFACE.encodeFunctionData('permit', [\n    validateAndParseAddress(permit.spender),\n    tokenId,\n    permit.deadline,\n    permit.v,\n    permit.r,\n    permit.s,\n  ])\n\n  planner.addCommand(CommandType.V3_POSITION_MANAGER_PERMIT, [calldata])\n}\n\n// Handles the encoding of commands needed to gather input tokens for a trade\n// Approval: The router approving another address to take tokens.\n//   note: Only seaport and sudoswap support this action. Approvals are left open.\n// Permit: A Permit2 signature-based Permit to allow the router to access a user's tokens\n// Transfer: A Permit2 TransferFrom of tokens from a user to either the router or another address\nexport function encodeInputTokenOptions(planner: RoutePlanner, options: InputTokenOptions) {\n  // first ensure that all tokens provided for encoding are the same\n  if (!!options.permit2TransferFrom && !!options.permit2Permit)\n    invariant(options.permit2TransferFrom.token === options.permit2Permit.details.token, `inconsistent token`)\n\n  // if this order has a options.permit2Permit, encode it\n  if (!!options.permit2Permit) {\n    encodePermit(planner, options.permit2Permit)\n  }\n\n  if (!!options.permit2TransferFrom) {\n    planner.addCommand(CommandType.PERMIT2_TRANSFER_FROM, [\n      options.permit2TransferFrom.token,\n      options.permit2TransferFrom.recipient ? options.permit2TransferFrom.recipient : ROUTER_AS_RECIPIENT,\n      options.permit2TransferFrom.amount,\n    ])\n  }\n}\n","import invariant from 'tiny-invariant'\nimport UniversalRouter from '@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json'\nimport { Interface } from '@ethersproject/abi'\nimport { BigNumber, BigNumberish } from 'ethers'\nimport {\n  MethodParameters,\n  Multicall,\n  Position as V3Position,\n  NonfungiblePositionManager as V3PositionManager,\n  RemoveLiquidityOptions as V3RemoveLiquidityOptions,\n} from '@uniswap/v3-sdk'\nimport {\n  Position as V4Position,\n  V4PositionManager,\n  AddLiquidityOptions as V4AddLiquidityOptions,\n  MintOptions,\n  Pool as V4Pool,\n  PoolKey,\n} from '@uniswap/v4-sdk'\nimport { Trade as RouterTrade } from '@uniswap/router-sdk'\nimport { Currency, TradeType, Percent, CHAIN_TO_ADDRESSES_MAP, SupportedChainsType } from '@uniswap/sdk-core'\nimport { UniswapTrade, SwapOptions } from './entities/actions/uniswap'\nimport { RoutePlanner, CommandType } from './utils/routerCommands'\nimport { encodePermit, encodeV3PositionPermit } from './utils/inputTokens'\nimport { UNIVERSAL_ROUTER_ADDRESS, UniversalRouterVersion } from './utils/constants'\n\nexport type SwapRouterConfig = {\n  sender?: string // address\n  deadline?: BigNumberish\n}\n\nexport interface MigrateV3ToV4Options {\n  inputPosition: V3Position\n  outputPosition: V4Position\n  v3RemoveLiquidityOptions: V3RemoveLiquidityOptions\n  v4AddLiquidityOptions: V4AddLiquidityOptions\n}\n\nfunction isMint(options: V4AddLiquidityOptions): options is MintOptions {\n  return Object.keys(options).some((k) => k === 'recipient')\n}\n\nexport abstract class SwapRouter {\n  public static INTERFACE: Interface = new Interface(UniversalRouter.abi)\n\n  public static swapCallParameters(\n    trades: RouterTrade<Currency, Currency, TradeType>,\n    options: SwapOptions\n  ): MethodParameters {\n    // TODO: use permit if signature included in swapOptions\n    const planner = new RoutePlanner()\n\n    const trade: UniswapTrade = new UniswapTrade(trades, options)\n\n    const inputCurrency = trade.trade.inputAmount.currency\n    invariant(!(inputCurrency.isNative && !!options.inputTokenPermit), 'NATIVE_INPUT_PERMIT')\n\n    if (options.inputTokenPermit) {\n      encodePermit(planner, options.inputTokenPermit)\n    }\n\n    const nativeCurrencyValue = inputCurrency.isNative\n      ? BigNumber.from(trade.trade.maximumAmountIn(options.slippageTolerance).quotient.toString())\n      : BigNumber.from(0)\n\n    trade.encode(planner, { allowRevert: false })\n    return SwapRouter.encodePlan(planner, nativeCurrencyValue, {\n      deadline: options.deadlineOrPreviousBlockhash ? BigNumber.from(options.deadlineOrPreviousBlockhash) : undefined,\n    })\n  }\n\n  /**\n   * Builds the call parameters for a migration from a V3 position to a V4 position.\n   * Some requirements of the parameters:\n   *   - v3RemoveLiquidityOptions.collectOptions.recipient must equal v4PositionManager\n   *   - v3RemoveLiquidityOptions.liquidityPercentage must be 100%\n   *   - input pool and output pool must have the same tokens\n   *   - V3 NFT must be approved, or valid inputV3NFTPermit must be provided with UR as spender\n   */\n  public static migrateV3ToV4CallParameters(\n    options: MigrateV3ToV4Options,\n    positionManagerOverride?: string\n  ): MethodParameters {\n    const v4Pool: V4Pool = options.outputPosition.pool\n    const v3Token0 = options.inputPosition.pool.token0\n    const v3Token1 = options.inputPosition.pool.token1\n    const v4PositionManagerAddress =\n      positionManagerOverride ?? CHAIN_TO_ADDRESSES_MAP[v4Pool.chainId as SupportedChainsType].v4PositionManagerAddress\n\n    // owner of the v3 nft must be the receiver of the v4 nft\n\n    // validate the parameters\n    if (v4Pool.currency0.isNative) {\n      invariant(\n        (v4Pool.currency0.wrapped.equals(v3Token0) && v4Pool.currency1.equals(v3Token1)) ||\n          (v4Pool.currency0.wrapped.equals(v3Token1) && v4Pool.currency1.equals(v3Token0)),\n        'TOKEN_MISMATCH'\n      )\n    } else {\n      invariant(v3Token0 === v4Pool.token0, 'TOKEN0_MISMATCH')\n      invariant(v3Token1 === v4Pool.token1, 'TOKEN1_MISMATCH')\n    }\n\n    invariant(\n      options.v3RemoveLiquidityOptions.liquidityPercentage.equalTo(new Percent(100, 100)),\n      'FULL_REMOVAL_REQUIRED'\n    )\n    invariant(options.v3RemoveLiquidityOptions.burnToken == true, 'BURN_TOKEN_REQUIRED')\n    invariant(\n      options.v3RemoveLiquidityOptions.collectOptions.recipient === v4PositionManagerAddress,\n      'RECIPIENT_NOT_POSITION_MANAGER'\n    )\n    invariant(isMint(options.v4AddLiquidityOptions), 'MINT_REQUIRED')\n    invariant(options.v4AddLiquidityOptions.migrate, 'MIGRATE_REQUIRED')\n\n    const planner = new RoutePlanner()\n\n    // to prevent reentrancy by the pool hook, we initialize the v4 pool before moving funds\n    if (options.v4AddLiquidityOptions.createPool) {\n      const poolKey: PoolKey = V4Pool.getPoolKey(\n        v4Pool.currency0,\n        v4Pool.currency1,\n        v4Pool.fee,\n        v4Pool.tickSpacing,\n        v4Pool.hooks\n      )\n      planner.addCommand(CommandType.V4_INITIALIZE_POOL, [poolKey, v4Pool.sqrtRatioX96.toString()])\n      // remove createPool setting, so that it doesnt get encoded again later\n      delete options.v4AddLiquidityOptions.createPool\n    }\n\n    // add position permit to the universal router planner\n    if (options.v3RemoveLiquidityOptions.permit) {\n      // permit spender should be UR\n      const universalRouterAddress = UNIVERSAL_ROUTER_ADDRESS(\n        UniversalRouterVersion.V2_0,\n        options.inputPosition.pool.chainId as SupportedChainsType\n      )\n      invariant(universalRouterAddress == options.v3RemoveLiquidityOptions.permit.spender, 'INVALID_SPENDER')\n      // don't need to transfer it because v3posm uses isApprovedOrOwner()\n      encodeV3PositionPermit(planner, options.v3RemoveLiquidityOptions.permit, options.v3RemoveLiquidityOptions.tokenId)\n      // remove permit so that multicall doesnt add it again\n      delete options.v3RemoveLiquidityOptions.permit\n    }\n\n    // encode v3 withdraw\n    const v3RemoveParams: MethodParameters = V3PositionManager.removeCallParameters(\n      options.inputPosition,\n      options.v3RemoveLiquidityOptions\n    )\n    const v3Calls: string[] = Multicall.decodeMulticall(v3RemoveParams.calldata)\n\n    for (const v3Call of v3Calls) {\n      // slice selector - 0x + 4 bytes = 10 characters\n      const selector = v3Call.slice(0, 10)\n      invariant(\n        selector == V3PositionManager.INTERFACE.getSighash('collect') ||\n          selector == V3PositionManager.INTERFACE.getSighash('decreaseLiquidity') ||\n          selector == V3PositionManager.INTERFACE.getSighash('burn'),\n        'INVALID_V3_CALL: ' + selector\n      )\n      planner.addCommand(CommandType.V3_POSITION_MANAGER_CALL, [v3Call])\n    }\n\n    // encode v4 mint\n    const v4AddParams = V4PositionManager.addCallParameters(options.outputPosition, options.v4AddLiquidityOptions)\n    // only modifyLiquidities can be called by the UniversalRouter\n    const selector = v4AddParams.calldata.slice(0, 10)\n    invariant(selector == V4PositionManager.INTERFACE.getSighash('modifyLiquidities'), 'INVALID_V4_CALL: ' + selector)\n\n    planner.addCommand(CommandType.V4_POSITION_MANAGER_CALL, [v4AddParams.calldata])\n\n    return SwapRouter.encodePlan(planner, BigNumber.from(0), {\n      deadline: BigNumber.from(options.v4AddLiquidityOptions.deadline),\n    })\n  }\n\n  /**\n   * Encodes a planned route into a method name and parameters for the Router contract.\n   * @param planner the planned route\n   * @param nativeCurrencyValue the native currency value of the planned route\n   * @param config the router config\n   */\n  private static encodePlan(\n    planner: RoutePlanner,\n    nativeCurrencyValue: BigNumber,\n    config: SwapRouterConfig = {}\n  ): MethodParameters {\n    const { commands, inputs } = planner\n    const functionSignature = !!config.deadline ? 'execute(bytes,bytes[],uint256)' : 'execute(bytes,bytes[])'\n    const parameters = !!config.deadline ? [commands, inputs, config.deadline] : [commands, inputs]\n    const calldata = SwapRouter.INTERFACE.encodeFunctionData(functionSignature, parameters)\n    return { calldata, value: nativeCurrencyValue.toHexString() }\n  }\n}\n","import invariant from 'tiny-invariant'\nimport { BigNumberish } from 'ethers'\nimport { RoutePlanner, CommandType } from '../../utils/routerCommands'\nimport { encodeInputTokenOptions, Permit2Permit } from '../../utils/inputTokens'\nimport { Command, RouterActionType, TradeConfig } from '../Command'\nimport { ROUTER_AS_RECIPIENT, WETH_ADDRESS } from '../../utils/constants'\n\nexport class UnwrapWETH implements Command {\n  readonly tradeType: RouterActionType = RouterActionType.UnwrapWETH\n  readonly permit2Data?: Permit2Permit\n  readonly wethAddress: string\n  readonly amount: BigNumberish\n\n  constructor(amount: BigNumberish, chainId: number, permit2?: Permit2Permit) {\n    this.wethAddress = WETH_ADDRESS(chainId)\n    this.amount = amount\n\n    if (!!permit2) {\n      invariant(\n        permit2.details.token.toLowerCase() === this.wethAddress.toLowerCase(),\n        `must be permitting WETH address: ${this.wethAddress}`\n      )\n      invariant(permit2.details.amount >= amount, `Did not permit enough WETH for unwrapWETH transaction`)\n      this.permit2Data = permit2\n    }\n  }\n\n  encode(planner: RoutePlanner, _: TradeConfig): void {\n    encodeInputTokenOptions(planner, {\n      permit2Permit: this.permit2Data,\n      permit2TransferFrom: {\n        token: this.wethAddress,\n        amount: this.amount.toString(),\n      },\n    })\n    planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, this.amount])\n  }\n}\n","import { MixedRouteSDK, Trade as RouterTrade } from '@uniswap/router-sdk'\nimport { Currency, CurrencyAmount, Ether, Token, TradeType } from '@uniswap/sdk-core'\nimport { Pair, Route as V2Route } from '@uniswap/v2-sdk'\nimport { Pool as V3Pool, Route as V3Route, FeeAmount } from '@uniswap/v3-sdk'\nimport { Pool as V4Pool, Route as V4Route } from '@uniswap/v4-sdk'\nimport { BigNumber } from 'ethers'\nimport { ETH_ADDRESS, E_ETH_ADDRESS } from './constants'\n\nexport type TokenInRoute = {\n  address: string\n  chainId: number\n  symbol: string\n  decimals: string\n  name?: string\n  buyFeeBps?: string\n  sellFeeBps?: string\n}\n\nexport enum PoolType {\n  V2Pool = 'v2-pool',\n  V3Pool = 'v3-pool',\n  V4Pool = 'v4-pool',\n}\n\nexport type V2Reserve = {\n  token: TokenInRoute\n  quotient: string\n}\n\nexport type V2PoolInRoute = {\n  type: PoolType.V2Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  reserve0: V2Reserve\n  reserve1: V2Reserve\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type V3PoolInRoute = {\n  type: PoolType.V3Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  sqrtRatioX96: string\n  liquidity: string\n  tickCurrent: string\n  fee: string\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type V4PoolInRoute = {\n  type: PoolType.V4Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  fee: string\n  tickSpacing: string\n  hooks: string\n  liquidity: string\n  sqrtRatioX96: string\n  tickCurrent: string\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type PartialClassicQuote = {\n  // We need tokenIn/Out to support native currency\n  tokenIn: string\n  tokenOut: string\n  tradeType: TradeType\n  route: Array<(V4PoolInRoute | V3PoolInRoute | V2PoolInRoute)[]>\n}\n\ninterface RouteResult {\n  routev4: V4Route<Currency, Currency> | null\n  routev3: V3Route<Currency, Currency> | null\n  routev2: V2Route<Currency, Currency> | null\n  mixedRoute: MixedRouteSDK<Currency, Currency> | null\n  inputAmount: CurrencyAmount<Currency>\n  outputAmount: CurrencyAmount<Currency>\n}\n\nexport const isNativeCurrency = (address: string) =>\n  address.toLowerCase() === ETH_ADDRESS.toLowerCase() || address.toLowerCase() === E_ETH_ADDRESS.toLowerCase()\n\n// Helper class to convert routing-specific quote entities to RouterTrade entities\n// the returned RouterTrade can then be used to build the UniswapTrade entity in this package\nexport class RouterTradeAdapter {\n  // Generate a RouterTrade using fields from a classic quote response\n  static fromClassicQuote(quote: PartialClassicQuote) {\n    const { route, tokenIn, tokenOut } = quote\n\n    if (!route) throw new Error('Expected route to be present')\n    if (!route.length) throw new Error('Expected there to be at least one route')\n    if (route.some((r) => !r.length)) throw new Error('Expected all routes to have at least one pool')\n    const firstRoute = route[0]\n\n    const tokenInData = firstRoute[0].tokenIn\n    const tokenOutData = firstRoute[firstRoute.length - 1].tokenOut\n\n    if (!tokenInData || !tokenOutData) throw new Error('Expected both tokenIn and tokenOut to be present')\n    if (tokenInData.chainId !== tokenOutData.chainId)\n      throw new Error('Expected tokenIn and tokenOut to be have same chainId')\n\n    const parsedCurrencyIn = RouterTradeAdapter.toCurrency(isNativeCurrency(tokenIn), tokenInData)\n    const parsedCurrencyOut = RouterTradeAdapter.toCurrency(isNativeCurrency(tokenOut), tokenOutData)\n\n    const typedRoutes: RouteResult[] = route.map((subRoute) => {\n      const rawAmountIn = subRoute[0].amountIn\n      const rawAmountOut = subRoute[subRoute.length - 1].amountOut\n\n      if (!rawAmountIn || !rawAmountOut) {\n        throw new Error('Expected both raw amountIn and raw amountOut to be present')\n      }\n\n      const inputAmount = CurrencyAmount.fromRawAmount(parsedCurrencyIn, rawAmountIn)\n      const outputAmount = CurrencyAmount.fromRawAmount(parsedCurrencyOut, rawAmountOut)\n\n      const isOnlyV2 = RouterTradeAdapter.isVersionedRoute<V2PoolInRoute>(PoolType.V2Pool, subRoute)\n      const isOnlyV3 = RouterTradeAdapter.isVersionedRoute<V3PoolInRoute>(PoolType.V3Pool, subRoute)\n      const isOnlyV4 = RouterTradeAdapter.isVersionedRoute<V4PoolInRoute>(PoolType.V4Pool, subRoute)\n      return {\n        routev4: isOnlyV4\n          ? new V4Route(\n              (subRoute as V4PoolInRoute[]).map(RouterTradeAdapter.toV4Pool),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        routev3: isOnlyV3\n          ? new V3Route(\n              (subRoute as V3PoolInRoute[]).map(RouterTradeAdapter.toV3Pool),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        routev2: isOnlyV2\n          ? new V2Route(\n              (subRoute as V2PoolInRoute[]).map(RouterTradeAdapter.toPair),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        mixedRoute:\n          !isOnlyV4 && !isOnlyV3 && !isOnlyV2\n            ? new MixedRouteSDK(subRoute.map(RouterTradeAdapter.toPoolOrPair), parsedCurrencyIn, parsedCurrencyOut)\n            : null,\n        inputAmount,\n        outputAmount,\n      }\n    })\n\n    return new RouterTrade({\n      v2Routes: typedRoutes\n        .filter((route) => route.routev2)\n        .map((route) => ({\n          routev2: route.routev2 as V2Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      v3Routes: typedRoutes\n        .filter((route) => route.routev3)\n        .map((route) => ({\n          routev3: route.routev3 as V3Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      v4Routes: typedRoutes\n        .filter((route) => route.routev4)\n        .map((route) => ({\n          routev4: route.routev4 as V4Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      mixedRoutes: typedRoutes\n        .filter((route) => route.mixedRoute)\n        .map((route) => ({\n          mixedRoute: route.mixedRoute as MixedRouteSDK<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      tradeType: quote.tradeType,\n    })\n  }\n\n  private static toCurrency(isNative: boolean, token: TokenInRoute): Currency {\n    if (isNative) {\n      return Ether.onChain(token.chainId)\n    }\n    return this.toToken(token)\n  }\n\n  private static toPoolOrPair = (pool: V4PoolInRoute | V3PoolInRoute | V2PoolInRoute): V4Pool | V3Pool | Pair => {\n    switch (pool.type) {\n      case PoolType.V4Pool:\n        return RouterTradeAdapter.toV4Pool(pool)\n      case PoolType.V3Pool:\n        return RouterTradeAdapter.toV3Pool(pool)\n      case PoolType.V2Pool:\n        return RouterTradeAdapter.toPair(pool)\n      default:\n        throw new Error('Invalid pool type')\n    }\n  }\n\n  private static toToken(token: TokenInRoute): Token {\n    const { chainId, address, decimals, symbol, buyFeeBps, sellFeeBps } = token\n    return new Token(\n      chainId,\n      address,\n      parseInt(decimals.toString()),\n      symbol,\n      /* name */ undefined,\n      false,\n      buyFeeBps ? BigNumber.from(buyFeeBps) : undefined,\n      sellFeeBps ? BigNumber.from(sellFeeBps) : undefined\n    )\n  }\n\n  private static toV3Pool({ fee, sqrtRatioX96, liquidity, tickCurrent, tokenIn, tokenOut }: V3PoolInRoute): V3Pool {\n    return new V3Pool(\n      RouterTradeAdapter.toToken(tokenIn),\n      RouterTradeAdapter.toToken(tokenOut),\n      parseInt(fee) as FeeAmount,\n      sqrtRatioX96,\n      liquidity,\n      parseInt(tickCurrent)\n    )\n  }\n\n  private static toV4Pool(pool: V4PoolInRoute): V4Pool {\n    const parsedCurrencyIn = RouterTradeAdapter.toCurrency(isNativeCurrency(pool.tokenIn.address), pool.tokenIn)\n    const parsedCurrencyOut = RouterTradeAdapter.toCurrency(isNativeCurrency(pool.tokenOut.address), pool.tokenOut)\n    return new V4Pool(\n      parsedCurrencyIn,\n      parsedCurrencyOut,\n      parseInt(pool.fee) as FeeAmount,\n      parseInt(pool.tickSpacing),\n      pool.hooks,\n      pool.sqrtRatioX96,\n      pool.liquidity,\n      parseInt(pool.tickCurrent)\n    )\n  }\n\n  private static toPair = ({ reserve0, reserve1 }: V2PoolInRoute): Pair => {\n    return new Pair(\n      CurrencyAmount.fromRawAmount(RouterTradeAdapter.toToken(reserve0.token), reserve0.quotient),\n      CurrencyAmount.fromRawAmount(RouterTradeAdapter.toToken(reserve1.token), reserve1.quotient)\n    )\n  }\n\n  private static isVersionedRoute<T extends V2PoolInRoute | V3PoolInRoute | V4PoolInRoute>(\n    type: PoolType,\n    route: (V3PoolInRoute | V2PoolInRoute | V4PoolInRoute)[]\n  ): route is T[] {\n    return route.every((pool) => pool.type === type)\n  }\n}\n","import { ethers } from 'ethers'\nimport UniversalRouter from '@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json'\nimport { Interface } from '@ethersproject/abi'\nimport { V4BaseActionsParser, V4RouterAction } from '@uniswap/v4-sdk'\nimport { CommandType, CommandDefinition, COMMAND_DEFINITION, Subparser, Parser } from '../utils/routerCommands'\n\nexport type Param = {\n  readonly name: string\n  readonly value: any\n}\n\nexport type UniversalRouterCommand = {\n  readonly commandName: string\n  readonly commandType: CommandType\n  readonly params: readonly Param[]\n}\n\nexport type UniversalRouterCall = {\n  readonly commands: readonly UniversalRouterCommand[]\n}\n\nexport type V3PathItem = {\n  readonly tokenIn: string\n  readonly tokenOut: string\n  readonly fee: number\n}\n\nexport interface CommandsDefinition {\n  [key: number]: CommandDefinition\n}\n\n// Parses UniversalRouter V2 commands\nexport abstract class CommandParser {\n  public static INTERFACE: Interface = new Interface(UniversalRouter.abi)\n\n  public static parseCalldata(calldata: string): UniversalRouterCall {\n    const genericParser = new GenericCommandParser(COMMAND_DEFINITION)\n    const txDescription = CommandParser.INTERFACE.parseTransaction({ data: calldata })\n    const { commands, inputs } = txDescription.args\n    return genericParser.parse(commands, inputs)\n  }\n}\n\n// Parses commands based on given command definition\nexport class GenericCommandParser {\n  constructor(private readonly commandDefinition: CommandsDefinition) {}\n\n  public parse(commands: string, inputs: string[]): UniversalRouterCall {\n    const commandTypes = GenericCommandParser.getCommands(commands)\n\n    return {\n      commands: commandTypes.map((commandType: CommandType, i: number) => {\n        const commandDef = this.commandDefinition[commandType]\n\n        if (commandDef.parser === Parser.V4Actions) {\n          const { actions } = V4BaseActionsParser.parseCalldata(inputs[i])\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params: v4RouterCallToParams(actions),\n          }\n        } else if (commandDef.parser === Parser.Abi) {\n          const abiDef = commandDef.params\n          const rawParams = ethers.utils.defaultAbiCoder.decode(\n            abiDef.map((command) => command.type),\n            inputs[i]\n          )\n\n          const params = rawParams.map((param: any, j: number) => {\n            switch (abiDef[j].subparser) {\n              case Subparser.V3PathExactIn:\n                return {\n                  name: abiDef[j].name,\n                  value: parseV3PathExactIn(param),\n                }\n              case Subparser.V3PathExactOut:\n                return {\n                  name: abiDef[j].name,\n                  value: parseV3PathExactOut(param),\n                }\n              default:\n                return {\n                  name: abiDef[j].name,\n                  value: param,\n                }\n            }\n          })\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params,\n          }\n        } else if (commandDef.parser === Parser.V3Actions) {\n          // TODO: implement better parsing here\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params: inputs.map((input) => ({ name: 'command', value: input })),\n          }\n        } else {\n          throw new Error(`Unsupported parser: ${commandDef}`)\n        }\n      }),\n    }\n  }\n\n  // parse command types from bytes string\n  private static getCommands(commands: string): CommandType[] {\n    const commandTypes: CommandType[] = []\n\n    for (let i = 2; i < commands.length; i += 2) {\n      const byte = commands.substring(i, i + 2)\n      commandTypes.push(parseInt(byte, 16) as CommandType)\n    }\n\n    return commandTypes\n  }\n}\n\nexport function parseV3PathExactIn(path: string): readonly V3PathItem[] {\n  const strippedPath = path.replace('0x', '')\n  let tokenIn = ethers.utils.getAddress(strippedPath.substring(0, 40))\n  let loc = 40\n  const res: V3PathItem[] = []\n  while (loc < strippedPath.length) {\n    const feeAndTokenOut = strippedPath.substring(loc, loc + 46)\n    const fee = parseInt(feeAndTokenOut.substring(0, 6), 16)\n    const tokenOut = ethers.utils.getAddress(feeAndTokenOut.substring(6, 46))\n\n    res.push({\n      tokenIn,\n      tokenOut,\n      fee,\n    })\n    tokenIn = tokenOut\n    loc += 46\n  }\n\n  return res\n}\n\nexport function parseV3PathExactOut(path: string): readonly V3PathItem[] {\n  const strippedPath = path.replace('0x', '')\n  let tokenIn = ethers.utils.getAddress(strippedPath.substring(strippedPath.length - 40))\n  let loc = strippedPath.length - 86 // 86 = (20 addr + 3 fee + 20 addr) * 2 (for hex characters)\n  const res: V3PathItem[] = []\n  while (loc >= 0) {\n    const feeAndTokenOut = strippedPath.substring(loc, loc + 46)\n    const tokenOut = ethers.utils.getAddress(feeAndTokenOut.substring(0, 40))\n    const fee = parseInt(feeAndTokenOut.substring(40, 46), 16)\n\n    res.push({\n      tokenIn,\n      tokenOut,\n      fee,\n    })\n    tokenIn = tokenOut\n\n    loc -= 46\n  }\n\n  return res\n}\n\nfunction v4RouterCallToParams(actions: readonly V4RouterAction[]): readonly Param[] {\n  return actions.map((action) => {\n    return {\n      name: action.actionName,\n      value: action.params.map((param) => {\n        return {\n          name: param.name,\n          value: param.value,\n        }\n      }),\n    }\n  })\n}\n"],"names":["CommandType","Subparser","Parser","ALLOW_REVERT_FLAG","REVERTIBLE_COMMANDS","Set","EXECUTE_SUB_PLAN","PERMIT_STRUCT","PERMIT_BATCH_STRUCT","POOL_KEY_STRUCT","PERMIT2_TRANSFER_FROM_STRUCT","PERMIT2_TRANSFER_FROM_BATCH_STRUCT","COMMAND_DEFINITION","_COMMAND_DEFINITION","parser","Abi","params","name","type","PERMIT2_PERMIT","PERMIT2_PERMIT_BATCH","PERMIT2_TRANSFER_FROM","PERMIT2_TRANSFER_FROM_BATCH","V3_SWAP_EXACT_IN","subparser","V3PathExactIn","V3_SWAP_EXACT_OUT","V3PathExactOut","V2_SWAP_EXACT_IN","V2_SWAP_EXACT_OUT","V4_SWAP","V4Actions","WRAP_ETH","UNWRAP_WETH","SWEEP","TRANSFER","PAY_PORTION","BALANCE_CHECK_ERC20","V4_INITIALIZE_POOL","V3_POSITION_MANAGER_PERMIT","V3Actions","V3_POSITION_MANAGER_CALL","V4_POSITION_MANAGER_CALL","RoutePlanner","commands","inputs","_proto","prototype","addSubPlan","subplan","addCommand","parameters","allowRevert","command","createCommand","push","encodedInput","has","Error","concat","toString","padStart","commandDef","defaultAbiCoder","encode","map","abi","getPathCurrency","currency","pool","involvesToken","wrapped","V4Pool","token0","equals","token1","symbol","RouterActionType","UniversalRouterVersion","WETH_NOT_SUPPORTED_ON_CHAIN","CHAIN_CONFIGS","_CHAIN_CONFIGS","weth","routerConfigs","_routerConfigs","V1_2","address","creationBlock","V2_0","_routerConfigs2","_routerConfigs3","_routerConfigs4","_routerConfigs5","_routerConfigs6","_routerConfigs7","_routerConfigs8","_routerConfigs9","_routerConfigs0","_routerConfigs1","_routerConfigs10","_routerConfigs11","_routerConfigs12","_routerConfigs13","_routerConfigs14","_routerConfigs15","_routerConfigs16","_routerConfigs17","_routerConfigs18","_routerConfigs19","_routerConfigs20","_routerConfigs21","_routerConfigs22","_routerConfigs23","_routerConfigs24","UNIVERSAL_ROUTER_ADDRESS","version","chainId","UNIVERSAL_ROUTER_CREATION_BLOCK","WETH_ADDRESS","CONTRACT_BALANCE","BigNumber","from","pow","ETH_ADDRESS","E_ETH_ADDRESS","SENDER_AS_RECIPIENT","ROUTER_AS_RECIPIENT","getCurrencyAddress","isNative","encodeFeeBips","fee","toHex","multiply","quotient","REFUND_ETH_PRICE_IMPACT_THRESHOLD","Percent","UniswapTrade","trade","options","flatFee","inputRequiresWrap","inputRequiresUnwrap","useRouterBalance","payerIsUser","planner","_config","maximumAmountIn","slippageTolerance","inputAmount","recipient","_this$options$recipie","performAggregatedSlippageCheck","tradeType","TradeType","EXACT_INPUT","routes","length","routerMustCustody","outputRequiresTransition","hasFeeOption","_iterator","_createForOfIteratorHelperLoose","swaps","_step","done","swap","value","route","protocol","Protocol","V2","addV2Swap","V3","addV3Swap","V4","addV4Swap","MIXED","addMixedSwap","minimumAmountOut","pools","pathOutputCurrencyAddress","outputAmount","feeBips","EXACT_OUTPUT","sub","mul","div","feeAmount","amount","lt","outputRequiresUnwrap","outputRequiresWrap","riskOfPartialFill","safeMode","_createClass","key","get","result","_iterator2","_step2","firstPool","pathInput","lastRoute","lastPool","pathOutput","currency1","currency0","poolBefore","_ref","V2Trade","path","token","_ref2","V3Trade","createUncheckedTrade","encodeRouteToPath","_ref3","p","v4Route","V4Route","V4Trade","slippageToleranceOnSwap","undefined","v4Planner","V4Planner","addTrade","addSettle","pathOutputForTake","ethWethPool","addTake","_options$recipient","finalize","tradeRecipient","_options$recipient2","V3Pool","Pair","MixedRouteTrade","amountIn","amountOut","sections","partitionMixedRouteByProtocol","isLastSectionInRoute","i","inputToken","section","routePool","outputToken","getOutputOfPools","subRoute","MixedRoute","MixedRouteSDK","nextInputToken","swapRecipient","nextPool","v2PoolIsSwapRecipient","liquidityToken","v4SubRoute","input","output","addAction","Actions","SWAP_EXACT_IN","currencyIn","encodeV4RouteToPath","amountOutMinimum","outputTokenForTake","v4Pool","encodeMixedRouteToPath","priceImpact","greaterThan","swapOptions","SIGNATURE_LENGTH","EIP_2098_SIGNATURE_LENGTH","encodePermit","permit2","signature","ethers","utils","arrayify","joinSignature","splitSignature","encodeV3PositionPermit","permit","tokenId","calldata","NonfungiblePositionManager","INTERFACE","encodeFunctionData","validateAndParseAddress","spender","deadline","v","r","s","encodeInputTokenOptions","permit2TransferFrom","permit2Permit","details","process","env","NODE_ENV","invariant","isMint","Object","keys","some","k","SwapRouter","swapCallParameters","trades","inputCurrency","inputTokenPermit","nativeCurrencyValue","encodePlan","deadlineOrPreviousBlockhash","migrateV3ToV4CallParameters","positionManagerOverride","outputPosition","v3Token0","inputPosition","v3Token1","v4PositionManagerAddress","CHAIN_TO_ADDRESSES_MAP","v3RemoveLiquidityOptions","liquidityPercentage","equalTo","burnToken","collectOptions","v4AddLiquidityOptions","migrate","createPool","poolKey","getPoolKey","tickSpacing","hooks","sqrtRatioX96","universalRouterAddress","v3RemoveParams","V3PositionManager","removeCallParameters","v3Calls","Multicall","decodeMulticall","v3Call","selector","slice","getSighash","v4AddParams","V4PositionManager","addCallParameters","config","functionSignature","toHexString","Interface","UniversalRouter","UnwrapWETH","wethAddress","toLowerCase","permit2Data","_","PoolType","isNativeCurrency","RouterTradeAdapter","fromClassicQuote","quote","tokenIn","tokenOut","firstRoute","tokenInData","tokenOutData","parsedCurrencyIn","toCurrency","parsedCurrencyOut","typedRoutes","rawAmountIn","rawAmountOut","CurrencyAmount","fromRawAmount","isOnlyV2","isVersionedRoute","V2Pool","isOnlyV3","isOnlyV4","routev4","toV4Pool","routev3","V3Route","toV3Pool","routev2","V2Route","toPair","mixedRoute","toPoolOrPair","RouterTrade","v2Routes","filter","v3Routes","v4Routes","mixedRoutes","Ether","onChain","toToken","decimals","buyFeeBps","sellFeeBps","Token","parseInt","liquidity","tickCurrent","every","reserve0","reserve1","CommandParser","parseCalldata","genericParser","GenericCommandParser","txDescription","parseTransaction","data","_txDescription$args","args","parse","commandDefinition","commandTypes","getCommands","commandType","_this","_V4BaseActionsParser$","V4BaseActionsParser","actions","commandName","v4RouterCallToParams","abiDef","rawParams","decode","param","j","parseV3PathExactIn","parseV3PathExactOut","byte","substring","strippedPath","replace","getAddress","loc","res","feeAndTokenOut","action","actionName"],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"universal-router-sdk.esm.js","sources":["../src/utils/routerCommands.ts","../src/utils/pathCurrency.ts","../src/entities/Command.ts","../src/utils/constants.ts","../src/utils/getCurrencyAddress.ts","../src/utils/numbers.ts","../src/entities/actions/uniswap.ts","../src/utils/inputTokens.ts","../src/utils/eip712.ts","../src/swapRouter.ts","../src/entities/actions/unwrapWETH.ts","../src/utils/routerTradeAdapter.ts","../src/utils/commandParser.ts"],"sourcesContent":["import { defaultAbiCoder } from 'ethers/lib/utils'\nimport { AcrossV4DepositV3Params } from '../entities/actions/across'\n\n/**\n * CommandTypes\n * @description Flags that modify a command's execution\n * @enum {number}\n */\nexport enum CommandType {\n  V3_SWAP_EXACT_IN = 0x00,\n  V3_SWAP_EXACT_OUT = 0x01,\n  PERMIT2_TRANSFER_FROM = 0x02,\n  PERMIT2_PERMIT_BATCH = 0x03,\n  SWEEP = 0x04,\n  TRANSFER = 0x05,\n  PAY_PORTION = 0x06,\n\n  V2_SWAP_EXACT_IN = 0x08,\n  V2_SWAP_EXACT_OUT = 0x09,\n  PERMIT2_PERMIT = 0x0a,\n  WRAP_ETH = 0x0b,\n  UNWRAP_WETH = 0x0c,\n  PERMIT2_TRANSFER_FROM_BATCH = 0x0d,\n  BALANCE_CHECK_ERC20 = 0x0e,\n\n  V4_SWAP = 0x10,\n  V3_POSITION_MANAGER_PERMIT = 0x11,\n  V3_POSITION_MANAGER_CALL = 0x12,\n  V4_INITIALIZE_POOL = 0x13,\n  V4_POSITION_MANAGER_CALL = 0x14,\n\n  EXECUTE_SUB_PLAN = 0x21,\n\n  // 3rd party integrations\n  ACROSS_V4_DEPOSIT_V3 = 0x40,\n}\n\nexport enum Subparser {\n  V3PathExactIn,\n  V3PathExactOut,\n}\n\nexport enum Parser {\n  Abi,\n  V4Actions,\n  V3Actions,\n}\n\nexport type ParamType = {\n  readonly name: string\n  readonly type: string\n  readonly subparser?: Subparser\n}\n\nexport type CommandDefinition =\n  | {\n      parser: Parser.Abi\n      params: ParamType[]\n    }\n  | {\n      parser: Parser.V4Actions\n    }\n  | {\n      parser: Parser.V3Actions\n    }\n\nconst ALLOW_REVERT_FLAG = 0x80\nconst REVERTIBLE_COMMANDS = new Set<CommandType>([CommandType.EXECUTE_SUB_PLAN])\n\nconst PERMIT_STRUCT =\n  '((address token,uint160 amount,uint48 expiration,uint48 nonce) details,address spender,uint256 sigDeadline)'\n\nconst PERMIT_BATCH_STRUCT =\n  '((address token,uint160 amount,uint48 expiration,uint48 nonce)[] details,address spender,uint256 sigDeadline)'\n\nconst POOL_KEY_STRUCT = '(address currency0,address currency1,uint24 fee,int24 tickSpacing,address hooks)'\n\nconst PERMIT2_TRANSFER_FROM_STRUCT = '(address from,address to,uint160 amount,address token)'\nconst PERMIT2_TRANSFER_FROM_BATCH_STRUCT = PERMIT2_TRANSFER_FROM_STRUCT + '[]'\n\nexport const COMMAND_DEFINITION: { [key in CommandType]: CommandDefinition } = {\n  // Batch Reverts\n  [CommandType.EXECUTE_SUB_PLAN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'commands', type: 'bytes' },\n      { name: 'inputs', type: 'bytes[]' },\n    ],\n  },\n\n  // Permit2 Actions\n  [CommandType.PERMIT2_PERMIT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'permit', type: PERMIT_STRUCT },\n      { name: 'signature', type: 'bytes' },\n    ],\n  },\n  [CommandType.PERMIT2_PERMIT_BATCH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'permit', type: PERMIT_BATCH_STRUCT },\n      { name: 'signature', type: 'bytes' },\n    ],\n  },\n  [CommandType.PERMIT2_TRANSFER_FROM]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'amount', type: 'uint160' },\n    ],\n  },\n  [CommandType.PERMIT2_TRANSFER_FROM_BATCH]: {\n    parser: Parser.Abi,\n    params: [\n      {\n        name: 'transferFrom',\n        type: PERMIT2_TRANSFER_FROM_BATCH_STRUCT,\n      },\n    ],\n  },\n\n  // Uniswap Actions\n  [CommandType.V3_SWAP_EXACT_IN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountIn', type: 'uint256' },\n      { name: 'amountOutMin', type: 'uint256' },\n      { name: 'path', subparser: Subparser.V3PathExactIn, type: 'bytes' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V3_SWAP_EXACT_OUT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountOut', type: 'uint256' },\n      { name: 'amountInMax', type: 'uint256' },\n      { name: 'path', subparser: Subparser.V3PathExactOut, type: 'bytes' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V2_SWAP_EXACT_IN]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountIn', type: 'uint256' },\n      { name: 'amountOutMin', type: 'uint256' },\n      { name: 'path', type: 'address[]' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V2_SWAP_EXACT_OUT]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountOut', type: 'uint256' },\n      { name: 'amountInMax', type: 'uint256' },\n      { name: 'path', type: 'address[]' },\n      { name: 'payerIsUser', type: 'bool' },\n    ],\n  },\n  [CommandType.V4_SWAP]: { parser: Parser.V4Actions },\n\n  // Token Actions and Checks\n  [CommandType.WRAP_ETH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amount', type: 'uint256' },\n    ],\n  },\n  [CommandType.UNWRAP_WETH]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'recipient', type: 'address' },\n      { name: 'amountMin', type: 'uint256' },\n    ],\n  },\n  [CommandType.SWEEP]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'amountMin', type: 'uint256' },\n    ],\n  },\n  [CommandType.TRANSFER]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'value', type: 'uint256' },\n    ],\n  },\n  [CommandType.PAY_PORTION]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'token', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'bips', type: 'uint256' },\n    ],\n  },\n  [CommandType.BALANCE_CHECK_ERC20]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'owner', type: 'address' },\n      { name: 'token', type: 'address' },\n      { name: 'minBalance', type: 'uint256' },\n    ],\n  },\n  [CommandType.V4_INITIALIZE_POOL]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'poolKey', type: POOL_KEY_STRUCT },\n      { name: 'sqrtPriceX96', type: 'uint160' },\n    ],\n  },\n\n  // Position Actions\n  [CommandType.V3_POSITION_MANAGER_PERMIT]: { parser: Parser.V3Actions },\n  [CommandType.V3_POSITION_MANAGER_CALL]: { parser: Parser.V3Actions },\n  [CommandType.V4_POSITION_MANAGER_CALL]: { parser: Parser.V4Actions },\n\n  // 3rd party integrations\n  [CommandType.ACROSS_V4_DEPOSIT_V3]: {\n    parser: Parser.Abi,\n    params: [\n      { name: 'depositor', type: 'address' },\n      { name: 'recipient', type: 'address' },\n      { name: 'inputToken', type: 'address' },\n      { name: 'outputToken', type: 'address' },\n      { name: 'inputAmount', type: 'uint256' },\n      { name: 'outputAmount', type: 'uint256' },\n      { name: 'destinationChainId', type: 'uint256' },\n      { name: 'exclusiveRelayer', type: 'address' },\n      { name: 'quoteTimestamp', type: 'uint32' },\n      { name: 'fillDeadline', type: 'uint32' },\n      { name: 'exclusivityDeadline', type: 'uint32' },\n      { name: 'message', type: 'bytes' },\n      { name: 'useNative', type: 'bool' },\n    ],\n  },\n}\n\nexport class RoutePlanner {\n  commands: string\n  inputs: string[]\n\n  constructor() {\n    this.commands = '0x'\n    this.inputs = []\n  }\n\n  addSubPlan(subplan: RoutePlanner): RoutePlanner {\n    this.addCommand(CommandType.EXECUTE_SUB_PLAN, [subplan.commands, subplan.inputs], true)\n    return this\n  }\n\n  addAcrossBridge(params: AcrossV4DepositV3Params): RoutePlanner {\n    this.addCommand(CommandType.ACROSS_V4_DEPOSIT_V3, [\n      params.depositor,\n      params.recipient,\n      params.inputToken,\n      params.outputToken,\n      params.inputAmount,\n      params.outputAmount,\n      params.destinationChainId,\n      params.exclusiveRelayer,\n      params.quoteTimestamp,\n      params.fillDeadline,\n      params.exclusivityDeadline,\n      params.message,\n      params.useNative,\n    ])\n    return this\n  }\n\n  addCommand(type: CommandType, parameters: any[], allowRevert = false): RoutePlanner {\n    let command = createCommand(type, parameters)\n    this.inputs.push(command.encodedInput)\n    if (allowRevert) {\n      if (!REVERTIBLE_COMMANDS.has(command.type)) {\n        throw new Error(`command type: ${command.type} cannot be allowed to revert`)\n      }\n      command.type = command.type | ALLOW_REVERT_FLAG\n    }\n\n    this.commands = this.commands.concat(command.type.toString(16).padStart(2, '0'))\n    return this\n  }\n}\n\nexport type RouterCommand = {\n  type: CommandType\n  encodedInput: string\n}\n\nexport function createCommand(type: CommandType, parameters: any[]): RouterCommand {\n  const commandDef = COMMAND_DEFINITION[type]\n  switch (commandDef.parser) {\n    case Parser.Abi:\n      const encodedInput = defaultAbiCoder.encode(\n        commandDef.params.map((abi) => abi.type),\n        parameters\n      )\n      return { type, encodedInput }\n    case Parser.V4Actions:\n      // v4 swap data comes pre-encoded at index 0\n      return { type, encodedInput: parameters[0] }\n    case Parser.V3Actions:\n      // v4 swap data comes pre-encoded at index 0\n      return { type, encodedInput: parameters[0] }\n  }\n}\n","import { Currency, Token } from '@uniswap/sdk-core'\nimport { Pool as V4Pool } from '@uniswap/v4-sdk'\nimport { TPool } from '@uniswap/router-sdk'\n\nexport function getPathCurrency(currency: Currency, pool: TPool): Currency {\n  // return currency if the currency matches a currency of the pool\n  if (pool.involvesToken(currency as Token)) {\n    return currency\n\n    // return if currency.wrapped if pool involves wrapped currency\n  } else if (pool.involvesToken(currency.wrapped as Token)) {\n    return currency.wrapped\n\n    // return native currency if pool involves native version of wrapped currency (only applies to V4)\n  } else if (pool instanceof V4Pool && pool.token0.wrapped.equals(currency)) {\n    return pool.token0\n  } else if (pool instanceof V4Pool && pool.token1.wrapped.equals(currency)) {\n    return pool.token1\n  } else {\n    throw new Error(`Expected currency ${currency.symbol} to be either ${pool.token0.symbol} or ${pool.token1.symbol}`)\n  }\n\n  return currency // this line needed for typescript to compile\n}\n","import { RoutePlanner } from '../utils/routerCommands'\n\nexport type TradeConfig = {\n  allowRevert: boolean\n}\n\nexport enum RouterActionType {\n  UniswapTrade = 'UniswapTrade',\n  UnwrapWETH = 'UnwrapWETH',\n}\n\n// interface for entities that can be encoded as a Universal Router command\nexport interface Command {\n  tradeType: RouterActionType\n  encode(planner: RoutePlanner, config: TradeConfig): void\n}\n","import { BigNumber } from 'ethers'\n\nexport enum UniversalRouterVersion {\n  V1_2 = '1.2',\n  V2_0 = '2.0',\n  V2_1 = '2.1',\n}\n\nexport type RouterConfig = {\n  address: string\n  creationBlock: number\n}\n\ntype ChainConfig = {\n  weth: string\n  routerConfigs: { [key in UniversalRouterVersion]: RouterConfig }\n}\n\nconst ZERO_ROUTER_CONFIG: RouterConfig = {\n  address: '0x0000000000000000000000000000000000000000',\n  creationBlock: 1,\n}\n\nconst WETH_NOT_SUPPORTED_ON_CHAIN = '0x0000000000000000000000000000000000000000'\n\n// Todo: Change `CHAIN_CONFIGS` to pull the UR address with v4\nexport const CHAIN_CONFIGS: { [key: number]: ChainConfig } = {\n  // mainnet\n  [1]: {\n    weth: '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17143817,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x66a9893cc07d91d95644aedd05d03f95e1dba8af',\n        creationBlock: 21689092,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0xd92a36b0000531ef3063ded4de20a0783308446c',\n        creationBlock: 23836348,\n      },\n    },\n  },\n  // goerli\n  [5]: {\n    weth: '0xb4fbf271143f4fbf7b91a5ded31805e42b2208d6',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8940568,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8940568,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // sepolia\n  [11155111]: {\n    weth: '0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 3543575,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3a9d48ab9751398bbfa63ad67599bb04e4bdf98b', // only update here and creation block below\n        creationBlock: 7259601,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0x470FFC67b1feEEC31D16C46AC7545C98716a194c',\n        creationBlock: 9664766,\n      },\n    },\n  },\n  // polygon\n  [137]: {\n    weth: '0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xec7BE89e9d109e7e3Fec59c222CF297125FEFda2',\n        creationBlock: 52210153,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x1095692a6237d83c6a72f3f5efedb9a670c49223',\n        creationBlock: 66980401,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0xE27610fD9dD05FC061366bc9dA414CA6F948f204',\n        creationBlock: 79245524,\n      },\n    },\n  },\n  //polygon mumbai\n  [80001]: {\n    weth: '0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 35176052,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 35176052,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  //optimism\n  [10]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xCb1355ff08Ab38bBCE60111F1bb2B784bE25D7e8',\n        creationBlock: 114702266,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x851116d9223fabed8e56c0e6b8ad0c31d98b3507',\n        creationBlock: 129906462,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0xde20EEE5398D3790a4D356e8925bD21Ea65D99Af',\n        creationBlock: 134078764,\n      },\n    },\n  },\n  // optimism goerli\n  [420]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8887728,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 8887728,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // arbitrum\n  [42161]: {\n    weth: '0x82aF49447D8a07e3bd95BD0d56f35241523fBab1',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x5E325eDA8064b456f4781070C0738d849c824258',\n        creationBlock: 169472836,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xa51afafe0263b40edaef0df8781ea9aa03e381a3',\n        creationBlock: 290124593,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0x96b2FD2F80e9428Daa65d859653117D453981AB4',\n        creationBlock: 329155034,\n      },\n    },\n  },\n  // arbitrum goerli\n  [421613]: {\n    weth: '0xe39Ab88f8A4777030A534146A9Ca3B52bd5D43A3',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 18815277,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 18815277,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // celo\n  [42220]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x643770e279d5d0733f21d6dc03a8efbabf3255b4',\n        creationBlock: 21407637,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xcb695bc5D3Aa22cAD1E6DF07801b061a05A0233A',\n        creationBlock: 47387857,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // celo alfajores\n  [44787]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17566658,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 17566658,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // binance smart chain\n  [56]: {\n    weth: '0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4Dae2f939ACf50408e13d58534Ff8c2776d45265',\n        creationBlock: 35160263,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x1906c1d672b88cd1b9ac7593301ca990f94eae07',\n        creationBlock: 1737493275,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // avalanche\n  [43114]: {\n    weth: '0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4Dae2f939ACf50408e13d58534Ff8c2776d45265',\n        creationBlock: 40237257,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x94b75331ae8d42c1b61065089b7d48fe14aa73b7',\n        creationBlock: 1737558236,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0x0Cf1f86B331A03179646341D10A2A87515087221',\n        creationBlock: 58800800,\n      },\n    },\n  },\n  // base goerli\n  [84531]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',\n        creationBlock: 6915289,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xd0872d928672ae2ff74bdb2f5130ac12229cafaf',\n        creationBlock: 6915289,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // base mainnet\n  [8453]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD',\n        creationBlock: 9107268,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x6ff5693b99212da76ad316178a184ab56d299b43',\n        creationBlock: 1737491485,\n      },\n      [UniversalRouterVersion.V2_1]: {\n        address: '0xf3a4f4094bd2c6c06ca2f61789d8727b8d1e7259',\n        creationBlock: 28539210,\n      },\n    },\n  },\n  // blast\n  [81457]: {\n    weth: '0x4300000000000000000000000000000000000004',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x643770E279d5D0733F21d6DC03A8efbABf3255B4',\n        creationBlock: 1116444,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xeabbcb3e8e415306207ef514f660a3f820025be3',\n        creationBlock: 1737564586,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // zora\n  [7777777]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x2986d9721A49838ab4297b695858aF7F17f38014',\n        creationBlock: 11832155,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3315ef7ca28db74abadc6c44570efdf06b04b020',\n        creationBlock: 1737562927,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [324]: {\n    weth: '0x5aea5775959fbc2557cc8789bc1bf90a239d9a91',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',\n        creationBlock: 12640979,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x28731BCC616B5f51dD52CF2e4dF0E78dD1136C06',\n        creationBlock: 12640979,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // worldchain\n  [480]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D',\n        creationBlock: 4063979,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x8ac7bee993bb44dab564ea4bc9ea67bf9eb5e743',\n        creationBlock: 1737559557,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [1301]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x8909Dc15e40173Ff4699343b6eB8132c65e18eC6',\n        creationBlock: 1241811,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xf70536b3bcc1bd1a972dc186a2cf84cc6da6be5d',\n        creationBlock: 7100543,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // unichain mainnet\n  [130]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x4D73A4411CA1c660035e4AECC8270E5DdDEC8C17',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0xef740bf23acae26f6492b10de645d6b98dc8eaf3',\n        creationBlock: 1737568156,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [10143]: {\n    weth: '0x760AfE86e5de5fa0Ee542fc7B7B713e1c5425701',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x3ae6d8a282d67893e17aa70ebffb33ee5aa65893',\n        creationBlock: 23678,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [84532]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x492e6456d9528771018deb9e87ef7750ef184104',\n        creationBlock: 20216585,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x492e6456d9528771018deb9e87ef7750ef184104',\n        creationBlock: 20216585,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [1868]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',\n        creationBlock: 3254782,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x0e2850543f69f678257266e0907ff9a58b3f13de',\n        creationBlock: 3254782,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [143]: {\n    weth: '0x3bd359C1119dA7Da1D913D1C4D2B7c461115433A',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',\n        creationBlock: 29255937,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x0d97dc33264bfc1c226207428a79b26757fb9dc3',\n        creationBlock: 29255937,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  [196]: {\n    weth: '0xe538905cf8410324e03A5A23C1c177a474D59b2b',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: {\n        address: '0x0000000000000000000000000000000000000000',\n        creationBlock: 1,\n      },\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x5507749f2c558bb3e162c6e90c314c092e7372ff',\n        creationBlock: 47680350,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // rootstock\n  [30]: {\n    weth: WETH_NOT_SUPPORTED_ON_CHAIN,\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: ZERO_ROUTER_CONFIG,\n      [UniversalRouterVersion.V2_0]: ZERO_ROUTER_CONFIG,\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n  // cyber testnet\n  [111557560]: {\n    weth: '0x4200000000000000000000000000000000000006',\n    routerConfigs: {\n      [UniversalRouterVersion.V1_2]: ZERO_ROUTER_CONFIG,\n      [UniversalRouterVersion.V2_0]: {\n        address: '0x2D094CE21AE3431909e373207a2fCef4ba8871a9',\n        creationBlock: 6183303,\n      },\n      [UniversalRouterVersion.V2_1]: ZERO_ROUTER_CONFIG,\n    },\n  },\n}\n\nexport const UNIVERSAL_ROUTER_ADDRESS = (version: UniversalRouterVersion, chainId: number): string => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n  return CHAIN_CONFIGS[chainId].routerConfigs[version].address\n}\n\nexport const UNIVERSAL_ROUTER_CREATION_BLOCK = (version: UniversalRouterVersion, chainId: number): number => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n  return CHAIN_CONFIGS[chainId].routerConfigs[version].creationBlock\n}\n\nexport const WETH_ADDRESS = (chainId: number): string => {\n  if (!(chainId in CHAIN_CONFIGS)) throw new Error(`Universal Router not deployed on chain ${chainId}`)\n\n  if (CHAIN_CONFIGS[chainId].weth == WETH_NOT_SUPPORTED_ON_CHAIN) throw new Error(`Chain ${chainId} does not have WETH`)\n\n  return CHAIN_CONFIGS[chainId].weth\n}\n\nexport const CONTRACT_BALANCE = BigNumber.from(2).pow(255)\nexport const ETH_ADDRESS = '0x0000000000000000000000000000000000000000'\nexport const E_ETH_ADDRESS = '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee'\nexport const ZERO_ADDRESS = '0x0000000000000000000000000000000000000000'\nexport const MAX_UINT256 = BigNumber.from(2).pow(256).sub(1)\nexport const MAX_UINT160 = BigNumber.from(2).pow(160).sub(1)\n\nexport const SENDER_AS_RECIPIENT = '0x0000000000000000000000000000000000000001'\nexport const ROUTER_AS_RECIPIENT = '0x0000000000000000000000000000000000000002'\n","import { Currency } from '@uniswap/sdk-core'\nimport { ETH_ADDRESS } from './constants'\n\nexport function getCurrencyAddress(currency: Currency): string {\n  return currency.isNative ? ETH_ADDRESS : currency.wrapped.address\n}\n","import { BigNumber } from 'ethers'\nimport JSBI from 'jsbi'\nimport bn from 'bignumber.js'\nimport { Percent } from '@uniswap/sdk-core'\nimport { toHex } from '@uniswap/v3-sdk'\n\nexport function expandTo18DecimalsBN(n: number): BigNumber {\n  // use bn intermediately to allow decimals in intermediate calculations\n  return BigNumber.from(new bn(n).times(new bn(10).pow(18)).toFixed())\n}\n\nexport function expandTo18Decimals(n: number): JSBI {\n  return JSBI.BigInt(BigNumber.from(n).mul(BigNumber.from(10).pow(18)).toString())\n}\n\nexport function encodeFeeBips(fee: Percent): string {\n  return toHex(fee.multiply(10_000).quotient)\n}\n","import { RoutePlanner, CommandType } from '../../utils/routerCommands'\nimport { Trade as V2Trade, Pair } from '@uniswap/v2-sdk'\nimport { Trade as V3Trade, Pool as V3Pool, encodeRouteToPath } from '@uniswap/v3-sdk'\nimport {\n  Route as V4Route,\n  Trade as V4Trade,\n  Pool as V4Pool,\n  V4Planner,\n  encodeRouteToPath as encodeV4RouteToPath,\n  Actions,\n} from '@uniswap/v4-sdk'\nimport {\n  Trade as RouterTrade,\n  MixedRouteTrade,\n  Protocol,\n  IRoute,\n  RouteV2,\n  RouteV3,\n  MixedRouteSDK,\n  MixedRoute,\n  SwapOptions as RouterSwapOptions,\n  getOutputOfPools,\n  encodeMixedRouteToPath,\n  partitionMixedRouteByProtocol,\n} from '@uniswap/router-sdk'\nimport { Permit2Permit } from '../../utils/inputTokens'\nimport { getPathCurrency } from '../../utils/pathCurrency'\nimport { Currency, TradeType, Token, CurrencyAmount, Percent } from '@uniswap/sdk-core'\nimport { Command, RouterActionType, TradeConfig } from '../Command'\nimport { SENDER_AS_RECIPIENT, ROUTER_AS_RECIPIENT, CONTRACT_BALANCE, ETH_ADDRESS } from '../../utils/constants'\nimport { getCurrencyAddress } from '../../utils/getCurrencyAddress'\nimport { encodeFeeBips } from '../../utils/numbers'\nimport { BigNumber, BigNumberish } from 'ethers'\nimport { TPool } from '@uniswap/router-sdk'\n\nexport type FlatFeeOptions = {\n  amount: BigNumberish\n  recipient: string\n}\n\n// the existing router permit object doesn't include enough data for permit2\n// so we extend swap options with the permit2 permit\n// when safe mode is enabled, the SDK will add an extra ETH sweep for security\n// when useRouterBalance is enabled the SDK will use the balance in the router for the swap\nexport type SwapOptions = Omit<RouterSwapOptions, 'inputTokenPermit'> & {\n  useRouterBalance?: boolean\n  inputTokenPermit?: Permit2Permit\n  flatFee?: FlatFeeOptions\n  safeMode?: boolean\n  maxHopSlippage?: BigNumber[]\n}\n\nconst REFUND_ETH_PRICE_IMPACT_THRESHOLD = new Percent(50, 100)\n\ninterface Swap<TInput extends Currency, TOutput extends Currency> {\n  route: IRoute<TInput, TOutput, TPool>\n  inputAmount: CurrencyAmount<TInput>\n  outputAmount: CurrencyAmount<TOutput>\n}\n\n// Wrapper for uniswap router-sdk trade entity to encode swaps for Universal Router\n// also translates trade objects from previous (v2, v3) SDKs\nexport class UniswapTrade implements Command {\n  readonly tradeType: RouterActionType = RouterActionType.UniswapTrade\n  readonly payerIsUser: boolean\n\n  constructor(public trade: RouterTrade<Currency, Currency, TradeType>, public options: SwapOptions) {\n    if (!!options.fee && !!options.flatFee) throw new Error('Only one fee option permitted')\n\n    if (this.inputRequiresWrap || this.inputRequiresUnwrap || this.options.useRouterBalance) {\n      this.payerIsUser = false\n    } else {\n      this.payerIsUser = true\n    }\n  }\n\n  get isAllV4(): boolean {\n    let result = true\n    for (const swap of this.trade.swaps) {\n      result = result && swap.route.protocol == Protocol.V4\n    }\n    return result\n  }\n\n  // this.trade.swaps is an array of swaps / trades.\n  // we are iterating over one swap (trade) at a time so length is 1\n  // route is either v2, v3, v4, or mixed\n  // pathInput and pathOutput are the currencies of the input and output of the route\n  // this.trade.inputAmount is the input currency of the trade (could be different from pathInput)\n  // this.trade.outputAmount is the output currency of the trade (could be different from pathOutput)\n  // each route can have multiple pools\n  get inputRequiresWrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const route = swap.route\n    const firstPool = route.pools[0]\n\n    if (firstPool instanceof V4Pool) {\n      // If first pool is a v4 pool and input currency is native and the path input currency in the route is not native, we need to wrap.\n      return (\n        this.trade.inputAmount.currency.isNative &&\n        !(this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathInput.isNative\n      )\n    }\n    // If first pool is not a v4 pool and input currency is native, we need to wrap\n    return this.trade.inputAmount.currency.isNative\n  }\n\n  get inputRequiresUnwrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const route = swap.route\n    const firstPool = route.pools[0]\n\n    if (firstPool instanceof V4Pool) {\n      // If the first pool is a v4 pool and input currency is not native and the path input currency is native, we need to unwrap\n      return (\n        !this.trade.inputAmount.currency.isNative &&\n        (this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathInput.isNative\n      )\n    }\n    // If the first pool is not a v4 pool, we don't need to unwrap.\n    return false\n  }\n\n  get outputRequiresWrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const lastRoute = swap.route\n    const lastPool = lastRoute.pools[lastRoute.pools.length - 1]\n\n    // if last pool is v4:\n    if (lastPool instanceof V4Pool) {\n      // If output currency is not native but path currency output is native, we need to wrap\n      if (!this.trade.outputAmount.currency.isNative) {\n        if ((lastRoute as unknown as V4Route<Currency, Currency>).pathOutput.isNative) {\n          // this means path output is native and we need to wrap\n          return true\n        } else if (lastPool.currency1.equals(lastPool.currency0.wrapped) && lastRoute.pools.length > 1) {\n          let poolBefore = lastRoute.pools[lastRoute.pools.length - 2]\n          // this means last pool is eth-weth and pool before contains weth\n          if (\n            poolBefore instanceof V4Pool &&\n            (poolBefore.currency0.equals(lastPool.currency1) || poolBefore.currency1.equals(lastPool.currency1))\n          ) {\n            return true\n          } else if (poolBefore.token0.equals(lastPool.currency1) || poolBefore.token1.equals(lastPool.currency1)) {\n            // same for v2 and v3 pools\n            return true\n          }\n        }\n      }\n    }\n    // if last pool is not v4:\n    // we do not need to wrap because v2 and v3 pools already require wrapped tokens\n    return false\n  }\n\n  get outputRequiresUnwrap(): boolean {\n    const swap = this.trade.swaps[0]\n    const lastRoute = swap.route\n    const lastPool = lastRoute.pools[lastRoute.pools.length - 1]\n\n    // if last pool is v4:\n    if (lastPool instanceof V4Pool) {\n      // If output currency is native and path currency output is not native, we need to unwrap\n      if (this.trade.outputAmount.currency.isNative) {\n        if (!(this.trade.swaps[0].route as unknown as V4Route<Currency, Currency>).pathOutput.isNative) {\n          // this means path output is weth and we need to unwrap\n          return true\n        } else if (\n          lastRoute.pools.length > 1 &&\n          lastRoute.pools[lastRoute.pools.length - 2] instanceof V4Pool &&\n          (lastRoute.pools[lastRoute.pools.length - 2] as V4Pool).currency0.isNative &&\n          lastPool.currency1.equals(lastPool.currency0.wrapped)\n        ) {\n          // this means last pool is eth-weth and we need to unwrap\n          return true\n        } else {\n          return false\n        }\n      }\n    }\n    // else: if path output currency is native, we need to unwrap because v2 and v3 pools already require wrapped tokens\n    return this.trade.outputAmount.currency.isNative\n  }\n\n  get outputRequiresTransition(): boolean {\n    return this.outputRequiresWrap || this.outputRequiresUnwrap\n  }\n\n  encode(planner: RoutePlanner, _config: TradeConfig): void {\n    // If the input currency is the native currency, we need to wrap it with the router as the recipient\n    if (this.inputRequiresWrap) {\n      // TODO: optimize if only one v2 pool we can directly send this to the pool\n      planner.addCommand(CommandType.WRAP_ETH, [\n        ROUTER_AS_RECIPIENT,\n        this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString(),\n      ])\n    } else if (this.inputRequiresUnwrap) {\n      // send wrapped token to router to unwrap\n      planner.addCommand(CommandType.PERMIT2_TRANSFER_FROM, [\n        (this.trade.inputAmount.currency as Token).address,\n        ROUTER_AS_RECIPIENT,\n        this.trade.maximumAmountIn(this.options.slippageTolerance).quotient.toString(),\n      ])\n      planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, 0])\n    }\n    // The overall recipient at the end of the trade, SENDER_AS_RECIPIENT uses the msg.sender\n    this.options.recipient = this.options.recipient ?? SENDER_AS_RECIPIENT\n\n    // flag for whether we want to perform slippage check on aggregate output of multiple routes\n    //   1. when there are >2 exact input trades. this is only a heuristic,\n    //      as it's still more gas-expensive even in this case, but has benefits\n    //      in that the reversion probability is lower\n    const performAggregatedSlippageCheck =\n      this.trade.tradeType === TradeType.EXACT_INPUT && this.trade.routes.length > 2\n    const routerMustCustody =\n      performAggregatedSlippageCheck || this.outputRequiresTransition || hasFeeOption(this.options)\n\n    for (const swap of this.trade.swaps) {\n      switch (swap.route.protocol) {\n        case Protocol.V2:\n          addV2Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.V3:\n          addV3Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.V4:\n          addV4Swap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        case Protocol.MIXED:\n          addMixedSwap(planner, swap, this.trade.tradeType, this.options, this.payerIsUser, routerMustCustody)\n          break\n        default:\n          throw new Error('UNSUPPORTED_TRADE_PROTOCOL')\n      }\n    }\n\n    let minimumAmountOut: BigNumber = BigNumber.from(\n      this.trade.minimumAmountOut(this.options.slippageTolerance).quotient.toString()\n    )\n    // The router custodies for 3 reasons: to unwrap, to take a fee, and/or to do a slippage check\n    if (routerMustCustody) {\n      const pools = this.trade.swaps[0].route.pools\n      const pathOutputCurrencyAddress = getCurrencyAddress(\n        getPathCurrency(this.trade.outputAmount.currency, pools[pools.length - 1])\n      )\n\n      // If there is a fee, that percentage is sent to the fee recipient\n      // In the case where ETH is the output currency, the fee is taken in WETH (for gas reasons)\n      if (!!this.options.fee) {\n        const feeBips = encodeFeeBips(this.options.fee.fee)\n        planner.addCommand(CommandType.PAY_PORTION, [pathOutputCurrencyAddress, this.options.fee.recipient, feeBips])\n\n        // If the trade is exact output, and a fee was taken, we must adjust the amount out to be the amount after the fee\n        // Otherwise we continue as expected with the trade's normal expected output\n        if (this.trade.tradeType === TradeType.EXACT_OUTPUT) {\n          minimumAmountOut = minimumAmountOut.sub(minimumAmountOut.mul(feeBips).div(10000))\n        }\n      }\n\n      // If there is a flat fee, that absolute amount is sent to the fee recipient\n      // In the case where ETH is the output currency, the fee is taken in WETH (for gas reasons)\n      if (!!this.options.flatFee) {\n        const feeAmount = this.options.flatFee.amount\n        if (minimumAmountOut.lt(feeAmount)) throw new Error('Flat fee amount greater than minimumAmountOut')\n\n        planner.addCommand(CommandType.TRANSFER, [pathOutputCurrencyAddress, this.options.flatFee.recipient, feeAmount])\n\n        // If the trade is exact output, and a fee was taken, we must adjust the amount out to be the amount after the fee\n        // Otherwise we continue as expected with the trade's normal expected output\n        if (this.trade.tradeType === TradeType.EXACT_OUTPUT) {\n          minimumAmountOut = minimumAmountOut.sub(feeAmount)\n        }\n      }\n\n      // The remaining tokens that need to be sent to the user after the fee is taken will be caught\n      // by this if-else clause.\n      if (this.outputRequiresUnwrap) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [this.options.recipient, minimumAmountOut])\n      } else if (this.outputRequiresWrap) {\n        planner.addCommand(CommandType.WRAP_ETH, [this.options.recipient, CONTRACT_BALANCE])\n      } else {\n        planner.addCommand(CommandType.SWEEP, [\n          getCurrencyAddress(this.trade.outputAmount.currency),\n          this.options.recipient,\n          minimumAmountOut,\n        ])\n      }\n    }\n\n    // for exactOutput swaps with native input or that perform an inputToken transition (wrap or unwrap)\n    // we need to send back the change to the user\n    if (this.trade.tradeType === TradeType.EXACT_OUTPUT || riskOfPartialFill(this.trade)) {\n      if (this.inputRequiresWrap) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [this.options.recipient, 0])\n      } else if (this.inputRequiresUnwrap) {\n        planner.addCommand(CommandType.WRAP_ETH, [this.options.recipient, CONTRACT_BALANCE])\n      } else if (this.trade.inputAmount.currency.isNative) {\n        // must refund extra native currency sent along for native v4 trades (no input transition)\n        planner.addCommand(CommandType.SWEEP, [ETH_ADDRESS, this.options.recipient, 0])\n      }\n    }\n\n    if (this.options.safeMode) planner.addCommand(CommandType.SWEEP, [ETH_ADDRESS, this.options.recipient, 0])\n  }\n}\n\n// encode a uniswap v2 swap\nfunction addV2Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { route, inputAmount, outputAmount }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const trade = new V2Trade(\n    route as RouteV2<TInput, TOutput>,\n    tradeType == TradeType.EXACT_INPUT ? inputAmount : outputAmount,\n    tradeType\n  )\n\n  if (tradeType == TradeType.EXACT_INPUT) {\n    planner.addCommand(CommandType.V2_SWAP_EXACT_IN, [\n      // if native, we have to unwrap so keep in the router for now\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      // if router will custody funds, we do aggregated slippage check from router\n      routerMustCustody ? 0 : trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      route.path.map((token) => token.wrapped.address),\n      payerIsUser,\n    ])\n  } else if (tradeType == TradeType.EXACT_OUTPUT) {\n    planner.addCommand(CommandType.V2_SWAP_EXACT_OUT, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      route.path.map((token) => token.wrapped.address),\n      payerIsUser,\n    ])\n  }\n}\n\n// encode a uniswap v3 swap\nfunction addV3Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { route, inputAmount, outputAmount }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const trade = V3Trade.createUncheckedTrade({\n    route: route as RouteV3<TInput, TOutput>,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const path = encodeRouteToPath(route as RouteV3<TInput, TOutput>, trade.tradeType === TradeType.EXACT_OUTPUT)\n  if (tradeType == TradeType.EXACT_INPUT) {\n    planner.addCommand(CommandType.V3_SWAP_EXACT_IN, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      routerMustCustody ? 0 : trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      path,\n      payerIsUser,\n    ])\n  } else if (tradeType == TradeType.EXACT_OUTPUT) {\n    planner.addCommand(CommandType.V3_SWAP_EXACT_OUT, [\n      routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient,\n      trade.minimumAmountOut(options.slippageTolerance).quotient.toString(),\n      trade.maximumAmountIn(options.slippageTolerance).quotient.toString(),\n      path,\n      payerIsUser,\n    ])\n  }\n}\n\nfunction addV4Swap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  { inputAmount, outputAmount, route }: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  // create a deep copy of pools since v4Planner encoding tampers with array\n  const pools = route.pools.map((p) => p) as V4Pool[]\n  const v4Route = new V4Route(pools, inputAmount.currency, outputAmount.currency)\n  const trade = V4Trade.createUncheckedTrade({\n    route: v4Route,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const slippageToleranceOnSwap =\n    routerMustCustody && tradeType == TradeType.EXACT_INPUT ? undefined : options.slippageTolerance\n\n  const v4Planner = new V4Planner()\n  v4Planner.addTrade(trade, slippageToleranceOnSwap)\n  v4Planner.addSettle(trade.route.pathInput, payerIsUser)\n\n  // Handle split route output consistency:\n  // - If output is ETH and some routes output WETH: force all to output WETH, then unwrap\n  // - If output is WETH and some routes output ETH: force all to output ETH, then wrap\n  let pathOutputForTake = trade.route.pathOutput\n  let lastPool = v4Route.pools[v4Route.pools.length - 1]\n  let ethWethPool = lastPool.currency1.equals(lastPool.currency0.wrapped)\n\n  if (ethWethPool && v4Route.pools.length > 1) {\n    let poolBefore = v4Route.pools[v4Route.pools.length - 2]\n    if (pathOutputForTake.isNative && poolBefore.currency0.isNative) {\n      pathOutputForTake = pathOutputForTake.wrapped\n    } else if (\n      !pathOutputForTake.isNative &&\n      (poolBefore.currency0.equals(lastPool.currency1) || poolBefore.currency1.equals(lastPool.currency1))\n    ) {\n      pathOutputForTake = lastPool.currency0\n    }\n  }\n\n  v4Planner.addTake(\n    pathOutputForTake,\n    routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient ?? SENDER_AS_RECIPIENT\n  )\n  planner.addCommand(CommandType.V4_SWAP, [v4Planner.finalize()])\n}\n\n// encode a mixed route swap, i.e. including both v2 and v3 pools\nfunction addMixedSwap<TInput extends Currency, TOutput extends Currency>(\n  planner: RoutePlanner,\n  swap: Swap<TInput, TOutput>,\n  tradeType: TradeType,\n  options: SwapOptions,\n  payerIsUser: boolean,\n  routerMustCustody: boolean\n): void {\n  const route = swap.route as MixedRoute<TInput, TOutput>\n  const inputAmount = swap.inputAmount\n  const outputAmount = swap.outputAmount\n  const tradeRecipient = routerMustCustody ? ROUTER_AS_RECIPIENT : options.recipient ?? SENDER_AS_RECIPIENT\n\n  // single hop, so it can be reduced to plain swap logic for one protocol version\n  if (route.pools.length === 1) {\n    if (route.pools[0] instanceof V4Pool) {\n      return addV4Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else if (route.pools[0] instanceof V3Pool) {\n      return addV3Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else if (route.pools[0] instanceof Pair) {\n      return addV2Swap(planner, swap, tradeType, options, payerIsUser, routerMustCustody)\n    } else {\n      throw new Error('Invalid route type')\n    }\n  }\n\n  const trade = MixedRouteTrade.createUncheckedTrade({\n    route: route as MixedRoute<TInput, TOutput>,\n    inputAmount,\n    outputAmount,\n    tradeType,\n  })\n\n  const amountIn = trade.maximumAmountIn(options.slippageTolerance, inputAmount).quotient.toString()\n  const amountOut = routerMustCustody\n    ? 0\n    : trade.minimumAmountOut(options.slippageTolerance, outputAmount).quotient.toString()\n\n  // logic from\n  // https://github.com/Uniswap/router-sdk/blob/d8eed164e6c79519983844ca8b6a3fc24ebcb8f8/src/swapRouter.ts#L276\n  const sections = partitionMixedRouteByProtocol(route as MixedRoute<TInput, TOutput>)\n  const isLastSectionInRoute = (i: number) => {\n    return i === sections.length - 1\n  }\n\n  let inputToken = route.pathInput\n\n  for (let i = 0; i < sections.length; i++) {\n    const section = sections[i]\n    const routePool = section[0]\n    const outputToken = getOutputOfPools(section, inputToken)\n    const subRoute = new MixedRoute(new MixedRouteSDK([...section], inputToken, outputToken))\n\n    let nextInputToken\n    let swapRecipient\n\n    if (isLastSectionInRoute(i)) {\n      nextInputToken = outputToken\n      swapRecipient = tradeRecipient\n    } else {\n      const nextPool = sections[i + 1][0]\n      nextInputToken = getPathCurrency(outputToken, nextPool)\n\n      const v2PoolIsSwapRecipient = nextPool instanceof Pair && outputToken.equals(nextInputToken)\n      swapRecipient = v2PoolIsSwapRecipient ? (nextPool as Pair).liquidityToken.address : ROUTER_AS_RECIPIENT\n    }\n\n    if (routePool instanceof V4Pool) {\n      const v4Planner = new V4Planner()\n      const v4SubRoute = new V4Route(section as V4Pool[], subRoute.input, subRoute.output)\n\n      v4Planner.addSettle(inputToken, payerIsUser && i === 0, (i == 0 ? amountIn : CONTRACT_BALANCE) as BigNumber)\n      v4Planner.addAction(Actions.SWAP_EXACT_IN, [\n        {\n          currencyIn: inputToken.isNative ? ETH_ADDRESS : inputToken.address,\n          path: encodeV4RouteToPath(v4SubRoute),\n          amountIn: 0, // denotes open delta, amount set in v4Planner.addSettle()\n          amountOutMinimum: !isLastSectionInRoute(i) ? 0 : amountOut,\n        },\n      ])\n\n      // Handle split route output consistency for V4 sections in mixed routes\n      let outputTokenForTake = outputToken\n      if (isLastSectionInRoute(i)) {\n        let lastPool = route.pools[route.pools.length - 1]\n        let v4Pool = lastPool instanceof V4Pool\n        let ethWethPool = v4Pool ? (lastPool as V4Pool).currency1.equals((lastPool as V4Pool).currency0.wrapped) : false\n        let poolBefore = route.pools[route.pools.length - 2]\n\n        if (ethWethPool) {\n          if (outputToken.isNative && poolBefore.token0.isNative) {\n            outputTokenForTake = outputToken.wrapped\n          } else if (\n            !outputToken.isNative &&\n            (poolBefore.token0.equals(lastPool.token1) || poolBefore.token1.equals(lastPool.token1))\n          ) {\n            outputTokenForTake = lastPool.token0\n          }\n        }\n      }\n\n      v4Planner.addTake(outputTokenForTake, swapRecipient)\n\n      planner.addCommand(CommandType.V4_SWAP, [v4Planner.finalize()])\n    } else if (routePool instanceof V3Pool) {\n      planner.addCommand(CommandType.V3_SWAP_EXACT_IN, [\n        swapRecipient, // recipient\n        i == 0 ? amountIn : CONTRACT_BALANCE, // amountIn\n        !isLastSectionInRoute(i) ? 0 : amountOut, // amountOut\n        encodeMixedRouteToPath(subRoute), // path\n        payerIsUser && i === 0, // payerIsUser\n      ])\n    } else if (routePool instanceof Pair) {\n      planner.addCommand(CommandType.V2_SWAP_EXACT_IN, [\n        swapRecipient, // recipient\n        i === 0 ? amountIn : CONTRACT_BALANCE, // amountIn\n        !isLastSectionInRoute(i) ? 0 : amountOut, // amountOutMin\n        subRoute.path.map((token) => token.wrapped.address), // path\n        payerIsUser && i === 0,\n      ])\n    } else {\n      throw new Error('Unexpected Pool Type')\n    }\n\n    // perform a token transition (wrap/unwrap if necessary)\n    if (!isLastSectionInRoute(i)) {\n      if (outputToken.isNative && !nextInputToken.isNative) {\n        planner.addCommand(CommandType.WRAP_ETH, [ROUTER_AS_RECIPIENT, CONTRACT_BALANCE])\n      } else if (!outputToken.isNative && nextInputToken.isNative) {\n        planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, 0])\n      }\n    }\n\n    inputToken = nextInputToken\n  }\n}\n\n// if price impact is very high, there's a chance of hitting max/min prices resulting in a partial fill of the swap\nfunction riskOfPartialFill(trade: RouterTrade<Currency, Currency, TradeType>): boolean {\n  return trade.priceImpact.greaterThan(REFUND_ETH_PRICE_IMPACT_THRESHOLD)\n}\n\nfunction hasFeeOption(swapOptions: SwapOptions): boolean {\n  return !!swapOptions.fee || !!swapOptions.flatFee\n}\n","import invariant from 'tiny-invariant'\nimport { ethers } from 'ethers'\nimport { validateAndParseAddress, BigintIsh } from '@uniswap/sdk-core'\nimport { NFTPermitOptions, NonfungiblePositionManager } from '@uniswap/v3-sdk'\nimport { PermitSingle } from '@uniswap/permit2-sdk'\nimport { CommandType, RoutePlanner } from './routerCommands'\nimport { ROUTER_AS_RECIPIENT } from './constants'\n\nexport interface Permit2Permit extends PermitSingle {\n  signature: string\n}\n\nexport type ApproveProtocol = {\n  token: string\n  protocol: string\n}\n\nexport type Permit2TransferFrom = {\n  token: string\n  amount: string\n  recipient?: string\n}\n\nexport type InputTokenOptions = {\n  permit2Permit?: Permit2Permit\n  permit2TransferFrom?: Permit2TransferFrom\n}\n\nconst SIGNATURE_LENGTH = 65\nconst EIP_2098_SIGNATURE_LENGTH = 64\n\nexport function encodePermit(planner: RoutePlanner, permit2: Permit2Permit): void {\n  let signature = permit2.signature\n\n  const length = ethers.utils.arrayify(permit2.signature).length\n  // signature data provided for EIP-1271 may have length different from ECDSA signature\n  if (length === SIGNATURE_LENGTH || length === EIP_2098_SIGNATURE_LENGTH) {\n    // sanitizes signature to cover edge cases of malformed EIP-2098 sigs and v used as recovery id\n    signature = ethers.utils.joinSignature(ethers.utils.splitSignature(permit2.signature))\n  }\n\n  planner.addCommand(CommandType.PERMIT2_PERMIT, [permit2, signature])\n}\n\nexport function encodeV3PositionPermit(planner: RoutePlanner, permit: NFTPermitOptions, tokenId: BigintIsh): void {\n  const calldata = NonfungiblePositionManager.INTERFACE.encodeFunctionData('permit', [\n    validateAndParseAddress(permit.spender),\n    tokenId,\n    permit.deadline,\n    permit.v,\n    permit.r,\n    permit.s,\n  ])\n\n  planner.addCommand(CommandType.V3_POSITION_MANAGER_PERMIT, [calldata])\n}\n\n// Handles the encoding of commands needed to gather input tokens for a trade\n// Approval: The router approving another address to take tokens.\n//   note: Only seaport and sudoswap support this action. Approvals are left open.\n// Permit: A Permit2 signature-based Permit to allow the router to access a user's tokens\n// Transfer: A Permit2 TransferFrom of tokens from a user to either the router or another address\nexport function encodeInputTokenOptions(planner: RoutePlanner, options: InputTokenOptions) {\n  // first ensure that all tokens provided for encoding are the same\n  if (!!options.permit2TransferFrom && !!options.permit2Permit)\n    invariant(options.permit2TransferFrom.token === options.permit2Permit.details.token, `inconsistent token`)\n\n  // if this order has a options.permit2Permit, encode it\n  if (!!options.permit2Permit) {\n    encodePermit(planner, options.permit2Permit)\n  }\n\n  if (!!options.permit2TransferFrom) {\n    planner.addCommand(CommandType.PERMIT2_TRANSFER_FROM, [\n      options.permit2TransferFrom.token,\n      options.permit2TransferFrom.recipient ? options.permit2TransferFrom.recipient : ROUTER_AS_RECIPIENT,\n      options.permit2TransferFrom.amount,\n    ])\n  }\n}\n","import { TypedDataDomain, TypedDataField } from '@ethersproject/abstract-signer'\nimport { BigNumber } from 'ethers'\n\nexport const EIP712_DOMAIN_NAME = 'UniversalRouter'\nexport const EIP712_DOMAIN_VERSION = '2'\n\nexport const EXECUTE_SIGNED_TYPES: Record<string, TypedDataField[]> = {\n  ExecuteSigned: [\n    { name: 'commands', type: 'bytes' },\n    { name: 'inputs', type: 'bytes[]' },\n    { name: 'intent', type: 'bytes' },\n    { name: 'data', type: 'bytes' },\n    { name: 'sender', type: 'address' },\n    { name: 'nonce', type: 'uint256' },\n    { name: 'deadline', type: 'uint256' },\n  ],\n}\n\n// When set as the nonce, the nonce check is skipped\nexport const NONCE_SKIP_CHECK = BigNumber.from('0x8000000000000000000000000000000000000000000000000000000000000000')\n\n/**\n * Generate a random nonce for signed execution\n */\nexport function generateNonce(): string {\n  const randomBytes = new Uint8Array(32)\n  for (let i = 0; i < 32; i++) {\n    randomBytes[i] = Math.floor(Math.random() * 256)\n  }\n  return BigNumber.from(randomBytes).toHexString()\n}\n\n/**\n * Get the EIP712 domain for a Universal Router contract\n */\nexport function getUniversalRouterDomain(chainId: number, routerAddress: string): TypedDataDomain {\n  return {\n    name: EIP712_DOMAIN_NAME,\n    version: EIP712_DOMAIN_VERSION,\n    chainId,\n    verifyingContract: routerAddress,\n  }\n}\n","import invariant from 'tiny-invariant'\nimport UniversalRouter from '@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json'\nimport { Interface } from '@ethersproject/abi'\nimport { TypedDataDomain, TypedDataField } from '@ethersproject/abstract-signer'\nimport { BigNumber, BigNumberish } from 'ethers'\nimport {\n  MethodParameters,\n  Multicall,\n  Position as V3Position,\n  NonfungiblePositionManager as V3PositionManager,\n  RemoveLiquidityOptions as V3RemoveLiquidityOptions,\n} from '@uniswap/v3-sdk'\nimport {\n  Position as V4Position,\n  V4PositionManager,\n  AddLiquidityOptions as V4AddLiquidityOptions,\n  MintOptions,\n  Pool as V4Pool,\n  PoolKey,\n} from '@uniswap/v4-sdk'\nimport { Trade as RouterTrade } from '@uniswap/router-sdk'\nimport { Currency, TradeType, Percent, CHAIN_TO_ADDRESSES_MAP, SupportedChainsType } from '@uniswap/sdk-core'\nimport { UniswapTrade, SwapOptions } from './entities/actions/uniswap'\nimport { AcrossV4DepositV3Params } from './entities/actions/across'\nimport { RoutePlanner, CommandType } from './utils/routerCommands'\nimport { encodePermit, encodeV3PositionPermit } from './utils/inputTokens'\nimport { UNIVERSAL_ROUTER_ADDRESS, UniversalRouterVersion } from './utils/constants'\nimport { generateNonce, getUniversalRouterDomain, EXECUTE_SIGNED_TYPES } from './utils/eip712'\n\nexport type SwapRouterConfig = {\n  sender?: string // address\n  deadline?: BigNumberish\n}\n\nexport type SignedRouteOptions = {\n  intent: string\n  data: string\n  sender: string\n  nonce?: string\n}\n\nexport type EIP712Payload = {\n  domain: TypedDataDomain\n  types: Record<string, TypedDataField[]>\n  value: {\n    commands: string\n    inputs: string[]\n    intent: string\n    data: string\n    sender: string\n    nonce: string\n    deadline: string\n  }\n}\n\nexport interface MigrateV3ToV4Options {\n  inputPosition: V3Position\n  outputPosition: V4Position\n  v3RemoveLiquidityOptions: V3RemoveLiquidityOptions\n  v4AddLiquidityOptions: V4AddLiquidityOptions\n}\n\nfunction isMint(options: V4AddLiquidityOptions): options is MintOptions {\n  return Object.keys(options).some((k) => k === 'recipient')\n}\n\nexport abstract class SwapRouter {\n  public static INTERFACE: Interface = new Interface(UniversalRouter.abi)\n\n  public static swapCallParameters(\n    trades: RouterTrade<Currency, Currency, TradeType>,\n    options: SwapOptions,\n    bridgeOptions?: AcrossV4DepositV3Params[]\n  ): MethodParameters {\n    // TODO: use permit if signature included in swapOptions\n    const planner = new RoutePlanner()\n\n    const trade: UniswapTrade = new UniswapTrade(trades, options)\n\n    const inputCurrency = trade.trade.inputAmount.currency\n    invariant(!(inputCurrency.isNative && !!options.inputTokenPermit), 'NATIVE_INPUT_PERMIT')\n\n    if (options.inputTokenPermit) {\n      encodePermit(planner, options.inputTokenPermit)\n    }\n\n    const nativeCurrencyValue = inputCurrency.isNative\n      ? BigNumber.from(trade.trade.maximumAmountIn(options.slippageTolerance).quotient.toString())\n      : BigNumber.from(0)\n\n    trade.encode(planner, { allowRevert: false })\n\n    if (bridgeOptions) {\n      bridgeOptions.forEach((bridge) => planner.addAcrossBridge(bridge))\n    }\n\n    return SwapRouter.encodePlan(planner, nativeCurrencyValue, {\n      deadline: options.deadlineOrPreviousBlockhash ? BigNumber.from(options.deadlineOrPreviousBlockhash) : undefined,\n    })\n  }\n\n  /**\n   * Builds the call parameters for a migration from a V3 position to a V4 position.\n   * Some requirements of the parameters:\n   *   - v3RemoveLiquidityOptions.collectOptions.recipient must equal v4PositionManager\n   *   - v3RemoveLiquidityOptions.liquidityPercentage must be 100%\n   *   - input pool and output pool must have the same tokens\n   *   - V3 NFT must be approved, or valid inputV3NFTPermit must be provided with UR as spender\n   */\n  public static migrateV3ToV4CallParameters(\n    options: MigrateV3ToV4Options,\n    positionManagerOverride?: string\n  ): MethodParameters {\n    const v4Pool: V4Pool = options.outputPosition.pool\n    const v3Token0 = options.inputPosition.pool.token0\n    const v3Token1 = options.inputPosition.pool.token1\n    const v4PositionManagerAddress =\n      positionManagerOverride ?? CHAIN_TO_ADDRESSES_MAP[v4Pool.chainId as SupportedChainsType].v4PositionManagerAddress\n\n    // owner of the v3 nft must be the receiver of the v4 nft\n\n    // validate the parameters\n    if (v4Pool.currency0.isNative) {\n      invariant(\n        (v4Pool.currency0.wrapped.equals(v3Token0) && v4Pool.currency1.equals(v3Token1)) ||\n          (v4Pool.currency0.wrapped.equals(v3Token1) && v4Pool.currency1.equals(v3Token0)),\n        'TOKEN_MISMATCH'\n      )\n    } else {\n      invariant(v3Token0 === v4Pool.token0, 'TOKEN0_MISMATCH')\n      invariant(v3Token1 === v4Pool.token1, 'TOKEN1_MISMATCH')\n    }\n\n    invariant(\n      options.v3RemoveLiquidityOptions.liquidityPercentage.equalTo(new Percent(100, 100)),\n      'FULL_REMOVAL_REQUIRED'\n    )\n    invariant(options.v3RemoveLiquidityOptions.burnToken == true, 'BURN_TOKEN_REQUIRED')\n    invariant(\n      options.v3RemoveLiquidityOptions.collectOptions.recipient === v4PositionManagerAddress,\n      'RECIPIENT_NOT_POSITION_MANAGER'\n    )\n    invariant(isMint(options.v4AddLiquidityOptions), 'MINT_REQUIRED')\n    invariant(options.v4AddLiquidityOptions.migrate, 'MIGRATE_REQUIRED')\n\n    const planner = new RoutePlanner()\n\n    // to prevent reentrancy by the pool hook, we initialize the v4 pool before moving funds\n    if (options.v4AddLiquidityOptions.createPool) {\n      const poolKey: PoolKey = V4Pool.getPoolKey(\n        v4Pool.currency0,\n        v4Pool.currency1,\n        v4Pool.fee,\n        v4Pool.tickSpacing,\n        v4Pool.hooks\n      )\n      planner.addCommand(CommandType.V4_INITIALIZE_POOL, [poolKey, v4Pool.sqrtRatioX96.toString()])\n      // remove createPool setting, so that it doesnt get encoded again later\n      delete options.v4AddLiquidityOptions.createPool\n    }\n\n    // add position permit to the universal router planner\n    if (options.v3RemoveLiquidityOptions.permit) {\n      // permit spender should be UR\n      const universalRouterAddress = UNIVERSAL_ROUTER_ADDRESS(\n        UniversalRouterVersion.V2_0,\n        options.inputPosition.pool.chainId as SupportedChainsType\n      )\n      invariant(universalRouterAddress == options.v3RemoveLiquidityOptions.permit.spender, 'INVALID_SPENDER')\n      // don't need to transfer it because v3posm uses isApprovedOrOwner()\n      encodeV3PositionPermit(planner, options.v3RemoveLiquidityOptions.permit, options.v3RemoveLiquidityOptions.tokenId)\n      // remove permit so that multicall doesnt add it again\n      delete options.v3RemoveLiquidityOptions.permit\n    }\n\n    // encode v3 withdraw\n    const v3RemoveParams: MethodParameters = V3PositionManager.removeCallParameters(\n      options.inputPosition,\n      options.v3RemoveLiquidityOptions\n    )\n    const v3Calls: string[] = Multicall.decodeMulticall(v3RemoveParams.calldata)\n\n    for (const v3Call of v3Calls) {\n      // slice selector - 0x + 4 bytes = 10 characters\n      const selector = v3Call.slice(0, 10)\n      invariant(\n        selector == V3PositionManager.INTERFACE.getSighash('collect') ||\n          selector == V3PositionManager.INTERFACE.getSighash('decreaseLiquidity') ||\n          selector == V3PositionManager.INTERFACE.getSighash('burn'),\n        'INVALID_V3_CALL: ' + selector\n      )\n      planner.addCommand(CommandType.V3_POSITION_MANAGER_CALL, [v3Call])\n    }\n\n    // encode v4 mint\n    const v4AddParams = V4PositionManager.addCallParameters(options.outputPosition, options.v4AddLiquidityOptions)\n    // only modifyLiquidities can be called by the UniversalRouter\n    const selector = v4AddParams.calldata.slice(0, 10)\n    invariant(selector == V4PositionManager.INTERFACE.getSighash('modifyLiquidities'), 'INVALID_V4_CALL: ' + selector)\n\n    planner.addCommand(CommandType.V4_POSITION_MANAGER_CALL, [v4AddParams.calldata])\n\n    return SwapRouter.encodePlan(planner, BigNumber.from(0), {\n      deadline: BigNumber.from(options.v4AddLiquidityOptions.deadline),\n    })\n  }\n\n  static getExecuteSignedPayload(\n    calldata: string,\n    signedOptions: SignedRouteOptions,\n    deadline: BigNumberish,\n    chainId: number,\n    routerAddress: string\n  ): EIP712Payload {\n    const iface = SwapRouter.INTERFACE\n    const decoded = iface.decodeFunctionData('execute', calldata)\n    const commands = decoded[0]\n    const inputs = decoded[1]\n    const nonce = signedOptions.nonce || generateNonce()\n    const domain = getUniversalRouterDomain(chainId, routerAddress)\n    return {\n      domain,\n      types: EXECUTE_SIGNED_TYPES,\n      value: {\n        commands,\n        inputs,\n        intent: signedOptions.intent,\n        data: signedOptions.data,\n        sender: signedOptions.sender,\n        nonce,\n        deadline: deadline.toString(),\n      },\n    }\n  }\n\n  static encodeExecuteSigned(\n    calldata: string,\n    signature: string,\n    signedOptions: SignedRouteOptions,\n    deadline: BigNumberish,\n    nativeCurrencyValue?: BigNumber\n  ): MethodParameters {\n    const iface = SwapRouter.INTERFACE\n    const decoded = iface.decodeFunctionData('execute', calldata)\n    const commands = decoded[0]\n    const inputs = decoded[1]\n    const nonce = signedOptions.nonce || generateNonce()\n    const executeSignedCalldata = iface.encodeFunctionData('executeSigned', [\n      commands,\n      inputs,\n      signedOptions.intent,\n      signedOptions.data,\n      signedOptions.sender,\n      nonce,\n      BigNumber.from(deadline).toString(),\n      signature,\n    ])\n    return {\n      calldata: executeSignedCalldata,\n      value: (nativeCurrencyValue || BigNumber.from(0)).toHexString(),\n    }\n  }\n\n  /**\n   * Encodes a planned route into a method name and parameters for the Router contract.\n   * @param planner the planned route\n   * @param nativeCurrencyValue the native currency value of the planned route\n   * @param config the router config\n   */\n  private static encodePlan(\n    planner: RoutePlanner,\n    nativeCurrencyValue: BigNumber,\n    config: SwapRouterConfig = {}\n  ): MethodParameters {\n    const { commands, inputs } = planner\n    const functionSignature = !!config.deadline ? 'execute(bytes,bytes[],uint256)' : 'execute(bytes,bytes[])'\n    const parameters = !!config.deadline ? [commands, inputs, config.deadline] : [commands, inputs]\n    const calldata = SwapRouter.INTERFACE.encodeFunctionData(functionSignature, parameters)\n    return { calldata, value: nativeCurrencyValue.toHexString() }\n  }\n}\n","import invariant from 'tiny-invariant'\nimport { BigNumberish } from 'ethers'\nimport { RoutePlanner, CommandType } from '../../utils/routerCommands'\nimport { encodeInputTokenOptions, Permit2Permit } from '../../utils/inputTokens'\nimport { Command, RouterActionType, TradeConfig } from '../Command'\nimport { ROUTER_AS_RECIPIENT, WETH_ADDRESS } from '../../utils/constants'\n\nexport class UnwrapWETH implements Command {\n  readonly tradeType: RouterActionType = RouterActionType.UnwrapWETH\n  readonly permit2Data?: Permit2Permit\n  readonly wethAddress: string\n  readonly amount: BigNumberish\n\n  constructor(amount: BigNumberish, chainId: number, permit2?: Permit2Permit) {\n    this.wethAddress = WETH_ADDRESS(chainId)\n    this.amount = amount\n\n    if (!!permit2) {\n      invariant(\n        permit2.details.token.toLowerCase() === this.wethAddress.toLowerCase(),\n        `must be permitting WETH address: ${this.wethAddress}`\n      )\n      invariant(permit2.details.amount >= amount, `Did not permit enough WETH for unwrapWETH transaction`)\n      this.permit2Data = permit2\n    }\n  }\n\n  encode(planner: RoutePlanner, _: TradeConfig): void {\n    encodeInputTokenOptions(planner, {\n      permit2Permit: this.permit2Data,\n      permit2TransferFrom: {\n        token: this.wethAddress,\n        amount: this.amount.toString(),\n      },\n    })\n    planner.addCommand(CommandType.UNWRAP_WETH, [ROUTER_AS_RECIPIENT, this.amount])\n  }\n}\n","import { MixedRouteSDK, Trade as RouterTrade } from '@uniswap/router-sdk'\nimport { Currency, CurrencyAmount, Ether, Token, TradeType } from '@uniswap/sdk-core'\nimport { Pair, Route as V2Route } from '@uniswap/v2-sdk'\nimport { Pool as V3Pool, Route as V3Route, FeeAmount } from '@uniswap/v3-sdk'\nimport { Pool as V4Pool, Route as V4Route } from '@uniswap/v4-sdk'\nimport { BigNumber } from 'ethers'\nimport { ETH_ADDRESS, E_ETH_ADDRESS } from './constants'\n\nexport type TokenInRoute = {\n  address: string\n  chainId: number\n  symbol: string\n  decimals: string\n  name?: string\n  buyFeeBps?: string\n  sellFeeBps?: string\n}\n\nexport enum PoolType {\n  V2Pool = 'v2-pool',\n  V3Pool = 'v3-pool',\n  V4Pool = 'v4-pool',\n}\n\nexport type V2Reserve = {\n  token: TokenInRoute\n  quotient: string\n}\n\nexport type V2PoolInRoute = {\n  type: PoolType.V2Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  reserve0: V2Reserve\n  reserve1: V2Reserve\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type V3PoolInRoute = {\n  type: PoolType.V3Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  sqrtRatioX96: string\n  liquidity: string\n  tickCurrent: string\n  fee: string\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type V4PoolInRoute = {\n  type: PoolType.V4Pool\n  address?: string\n  tokenIn: TokenInRoute\n  tokenOut: TokenInRoute\n  fee: string\n  tickSpacing: string\n  hooks: string\n  liquidity: string\n  sqrtRatioX96: string\n  tickCurrent: string\n  amountIn?: string\n  amountOut?: string\n}\n\nexport type PartialClassicQuote = {\n  // We need tokenIn/Out to support native currency\n  tokenIn: string\n  tokenOut: string\n  tradeType: TradeType\n  route: Array<(V4PoolInRoute | V3PoolInRoute | V2PoolInRoute)[]>\n}\n\ninterface RouteResult {\n  routev4: V4Route<Currency, Currency> | null\n  routev3: V3Route<Currency, Currency> | null\n  routev2: V2Route<Currency, Currency> | null\n  mixedRoute: MixedRouteSDK<Currency, Currency> | null\n  inputAmount: CurrencyAmount<Currency>\n  outputAmount: CurrencyAmount<Currency>\n}\n\nexport const isNativeCurrency = (address: string) =>\n  address.toLowerCase() === ETH_ADDRESS.toLowerCase() || address.toLowerCase() === E_ETH_ADDRESS.toLowerCase()\n\n// Helper class to convert routing-specific quote entities to RouterTrade entities\n// the returned RouterTrade can then be used to build the UniswapTrade entity in this package\nexport class RouterTradeAdapter {\n  // Generate a RouterTrade using fields from a classic quote response\n  static fromClassicQuote(quote: PartialClassicQuote) {\n    const { route, tokenIn, tokenOut } = quote\n\n    if (!route) throw new Error('Expected route to be present')\n    if (!route.length) throw new Error('Expected there to be at least one route')\n    if (route.some((r) => !r.length)) throw new Error('Expected all routes to have at least one pool')\n    const firstRoute = route[0]\n\n    const tokenInData = firstRoute[0].tokenIn\n    const tokenOutData = firstRoute[firstRoute.length - 1].tokenOut\n\n    if (!tokenInData || !tokenOutData) throw new Error('Expected both tokenIn and tokenOut to be present')\n    if (tokenInData.chainId !== tokenOutData.chainId)\n      throw new Error('Expected tokenIn and tokenOut to be have same chainId')\n\n    const parsedCurrencyIn = RouterTradeAdapter.toCurrency(isNativeCurrency(tokenIn), tokenInData)\n    const parsedCurrencyOut = RouterTradeAdapter.toCurrency(isNativeCurrency(tokenOut), tokenOutData)\n\n    const typedRoutes: RouteResult[] = route.map((subRoute) => {\n      const rawAmountIn = subRoute[0].amountIn\n      const rawAmountOut = subRoute[subRoute.length - 1].amountOut\n\n      if (!rawAmountIn || !rawAmountOut) {\n        throw new Error('Expected both raw amountIn and raw amountOut to be present')\n      }\n\n      const inputAmount = CurrencyAmount.fromRawAmount(parsedCurrencyIn, rawAmountIn)\n      const outputAmount = CurrencyAmount.fromRawAmount(parsedCurrencyOut, rawAmountOut)\n\n      const isOnlyV2 = RouterTradeAdapter.isVersionedRoute<V2PoolInRoute>(PoolType.V2Pool, subRoute)\n      const isOnlyV3 = RouterTradeAdapter.isVersionedRoute<V3PoolInRoute>(PoolType.V3Pool, subRoute)\n      const isOnlyV4 = RouterTradeAdapter.isVersionedRoute<V4PoolInRoute>(PoolType.V4Pool, subRoute)\n      return {\n        routev4: isOnlyV4\n          ? new V4Route(\n              (subRoute as V4PoolInRoute[]).map(RouterTradeAdapter.toV4Pool),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        routev3: isOnlyV3\n          ? new V3Route(\n              (subRoute as V3PoolInRoute[]).map(RouterTradeAdapter.toV3Pool),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        routev2: isOnlyV2\n          ? new V2Route(\n              (subRoute as V2PoolInRoute[]).map(RouterTradeAdapter.toPair),\n              parsedCurrencyIn,\n              parsedCurrencyOut\n            )\n          : null,\n        mixedRoute:\n          !isOnlyV4 && !isOnlyV3 && !isOnlyV2\n            ? new MixedRouteSDK(subRoute.map(RouterTradeAdapter.toPoolOrPair), parsedCurrencyIn, parsedCurrencyOut)\n            : null,\n        inputAmount,\n        outputAmount,\n      }\n    })\n\n    return new RouterTrade({\n      v2Routes: typedRoutes\n        .filter((route) => route.routev2)\n        .map((route) => ({\n          routev2: route.routev2 as V2Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      v3Routes: typedRoutes\n        .filter((route) => route.routev3)\n        .map((route) => ({\n          routev3: route.routev3 as V3Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      v4Routes: typedRoutes\n        .filter((route) => route.routev4)\n        .map((route) => ({\n          routev4: route.routev4 as V4Route<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      mixedRoutes: typedRoutes\n        .filter((route) => route.mixedRoute)\n        .map((route) => ({\n          mixedRoute: route.mixedRoute as MixedRouteSDK<Currency, Currency>,\n          inputAmount: route.inputAmount,\n          outputAmount: route.outputAmount,\n        })),\n      tradeType: quote.tradeType,\n    })\n  }\n\n  private static toCurrency(isNative: boolean, token: TokenInRoute): Currency {\n    if (isNative) {\n      return Ether.onChain(token.chainId)\n    }\n    return this.toToken(token)\n  }\n\n  private static toPoolOrPair = (pool: V4PoolInRoute | V3PoolInRoute | V2PoolInRoute): V4Pool | V3Pool | Pair => {\n    switch (pool.type) {\n      case PoolType.V4Pool:\n        return RouterTradeAdapter.toV4Pool(pool)\n      case PoolType.V3Pool:\n        return RouterTradeAdapter.toV3Pool(pool)\n      case PoolType.V2Pool:\n        return RouterTradeAdapter.toPair(pool)\n      default:\n        throw new Error('Invalid pool type')\n    }\n  }\n\n  private static toToken(token: TokenInRoute): Token {\n    const { chainId, address, decimals, symbol, buyFeeBps, sellFeeBps } = token\n    return new Token(\n      chainId,\n      address,\n      parseInt(decimals.toString()),\n      symbol,\n      /* name */ undefined,\n      false,\n      buyFeeBps ? BigNumber.from(buyFeeBps) : undefined,\n      sellFeeBps ? BigNumber.from(sellFeeBps) : undefined\n    )\n  }\n\n  private static toV3Pool({ fee, sqrtRatioX96, liquidity, tickCurrent, tokenIn, tokenOut }: V3PoolInRoute): V3Pool {\n    return new V3Pool(\n      RouterTradeAdapter.toToken(tokenIn),\n      RouterTradeAdapter.toToken(tokenOut),\n      parseInt(fee) as FeeAmount,\n      sqrtRatioX96,\n      liquidity,\n      parseInt(tickCurrent)\n    )\n  }\n\n  private static toV4Pool(pool: V4PoolInRoute): V4Pool {\n    const parsedCurrencyIn = RouterTradeAdapter.toCurrency(isNativeCurrency(pool.tokenIn.address), pool.tokenIn)\n    const parsedCurrencyOut = RouterTradeAdapter.toCurrency(isNativeCurrency(pool.tokenOut.address), pool.tokenOut)\n    return new V4Pool(\n      parsedCurrencyIn,\n      parsedCurrencyOut,\n      parseInt(pool.fee) as FeeAmount,\n      parseInt(pool.tickSpacing),\n      pool.hooks,\n      pool.sqrtRatioX96,\n      pool.liquidity,\n      parseInt(pool.tickCurrent)\n    )\n  }\n\n  private static toPair = ({ reserve0, reserve1 }: V2PoolInRoute): Pair => {\n    return new Pair(\n      CurrencyAmount.fromRawAmount(RouterTradeAdapter.toToken(reserve0.token), reserve0.quotient),\n      CurrencyAmount.fromRawAmount(RouterTradeAdapter.toToken(reserve1.token), reserve1.quotient)\n    )\n  }\n\n  private static isVersionedRoute<T extends V2PoolInRoute | V3PoolInRoute | V4PoolInRoute>(\n    type: PoolType,\n    route: (V3PoolInRoute | V2PoolInRoute | V4PoolInRoute)[]\n  ): route is T[] {\n    return route.every((pool) => pool.type === type)\n  }\n}\n","import { ethers } from 'ethers'\nimport UniversalRouter from '@uniswap/universal-router/artifacts/contracts/UniversalRouter.sol/UniversalRouter.json'\nimport { Interface } from '@ethersproject/abi'\nimport { V4BaseActionsParser, V4RouterAction } from '@uniswap/v4-sdk'\nimport { CommandType, CommandDefinition, COMMAND_DEFINITION, Subparser, Parser } from '../utils/routerCommands'\n\nexport type Param = {\n  readonly name: string\n  readonly value: any\n}\n\nexport type UniversalRouterCommand = {\n  readonly commandName: string\n  readonly commandType: CommandType\n  readonly params: readonly Param[]\n}\n\nexport type UniversalRouterCall = {\n  readonly commands: readonly UniversalRouterCommand[]\n}\n\nexport type V3PathItem = {\n  readonly tokenIn: string\n  readonly tokenOut: string\n  readonly fee: number\n}\n\nexport interface CommandsDefinition {\n  [key: number]: CommandDefinition\n}\n\n// Parses UniversalRouter V2 commands\nexport abstract class CommandParser {\n  public static INTERFACE: Interface = new Interface(UniversalRouter.abi)\n\n  public static parseCalldata(calldata: string): UniversalRouterCall {\n    const genericParser = new GenericCommandParser(COMMAND_DEFINITION)\n    const txDescription = CommandParser.INTERFACE.parseTransaction({ data: calldata })\n    const { commands, inputs } = txDescription.args\n    return genericParser.parse(commands, inputs)\n  }\n}\n\n// Parses commands based on given command definition\nexport class GenericCommandParser {\n  constructor(private readonly commandDefinition: CommandsDefinition) {}\n\n  public parse(commands: string, inputs: string[]): UniversalRouterCall {\n    const commandTypes = GenericCommandParser.getCommands(commands)\n\n    return {\n      commands: commandTypes.map((commandType: CommandType, i: number) => {\n        const commandDef = this.commandDefinition[commandType]\n\n        if (commandDef.parser === Parser.V4Actions) {\n          const { actions } = V4BaseActionsParser.parseCalldata(inputs[i])\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params: v4RouterCallToParams(actions),\n          }\n        } else if (commandDef.parser === Parser.Abi) {\n          const abiDef = commandDef.params\n          const rawParams = ethers.utils.defaultAbiCoder.decode(\n            abiDef.map((command) => command.type),\n            inputs[i]\n          )\n\n          const params = rawParams.map((param: any, j: number) => {\n            switch (abiDef[j].subparser) {\n              case Subparser.V3PathExactIn:\n                return {\n                  name: abiDef[j].name,\n                  value: parseV3PathExactIn(param),\n                }\n              case Subparser.V3PathExactOut:\n                return {\n                  name: abiDef[j].name,\n                  value: parseV3PathExactOut(param),\n                }\n              default:\n                return {\n                  name: abiDef[j].name,\n                  value: param,\n                }\n            }\n          })\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params,\n          }\n        } else if (commandDef.parser === Parser.V3Actions) {\n          // TODO: implement better parsing here\n          return {\n            commandName: CommandType[commandType],\n            commandType,\n            params: inputs.map((input) => ({ name: 'command', value: input })),\n          }\n        } else {\n          throw new Error(`Unsupported parser: ${commandDef}`)\n        }\n      }),\n    }\n  }\n\n  // parse command types from bytes string\n  private static getCommands(commands: string): CommandType[] {\n    const commandTypes: CommandType[] = []\n\n    for (let i = 2; i < commands.length; i += 2) {\n      const byte = commands.substring(i, i + 2)\n      commandTypes.push(parseInt(byte, 16) as CommandType)\n    }\n\n    return commandTypes\n  }\n}\n\nexport function parseV3PathExactIn(path: string): readonly V3PathItem[] {\n  const strippedPath = path.replace('0x', '')\n  let tokenIn = ethers.utils.getAddress(strippedPath.substring(0, 40))\n  let loc = 40\n  const res: V3PathItem[] = []\n  while (loc < strippedPath.length) {\n    const feeAndTokenOut = strippedPath.substring(loc, loc + 46)\n    const fee = parseInt(feeAndTokenOut.substring(0, 6), 16)\n    const tokenOut = ethers.utils.getAddress(feeAndTokenOut.substring(6, 46))\n\n    res.push({\n      tokenIn,\n      tokenOut,\n      fee,\n    })\n    tokenIn = tokenOut\n    loc += 46\n  }\n\n  return res\n}\n\nexport function parseV3PathExactOut(path: string): readonly V3PathItem[] {\n  const strippedPath = path.replace('0x', '')\n  let tokenIn = ethers.utils.getAddress(strippedPath.substring(strippedPath.length - 40))\n  let loc = strippedPath.length - 86 // 86 = (20 addr + 3 fee + 20 addr) * 2 (for hex characters)\n  const res: V3PathItem[] = []\n  while (loc >= 0) {\n    const feeAndTokenOut = strippedPath.substring(loc, loc + 46)\n    const tokenOut = ethers.utils.getAddress(feeAndTokenOut.substring(0, 40))\n    const fee = parseInt(feeAndTokenOut.substring(40, 46), 16)\n\n    res.push({\n      tokenIn,\n      tokenOut,\n      fee,\n    })\n    tokenIn = tokenOut\n\n    loc -= 46\n  }\n\n  return res\n}\n\nfunction v4RouterCallToParams(actions: readonly V4RouterAction[]): readonly Param[] {\n  return actions.map((action) => {\n    return {\n      name: action.actionName,\n      value: action.params.map((param) => {\n        return {\n          name: param.name,\n          value: param.value,\n        }\n      }),\n    }\n  })\n}\n"],"names":["CommandType","Subparser","Parser","ALLOW_REVERT_FLAG","REVERTIBLE_COMMANDS","Set","EXECUTE_SUB_PLAN","PERMIT_STRUCT","PERMIT_BATCH_STRUCT","POOL_KEY_STRUCT","PERMIT2_TRANSFER_FROM_STRUCT","PERMIT2_TRANSFER_FROM_BATCH_STRUCT","COMMAND_DEFINITION","_COMMAND_DEFINITION","parser","Abi","params","name","type","PERMIT2_PERMIT","PERMIT2_PERMIT_BATCH","PERMIT2_TRANSFER_FROM","PERMIT2_TRANSFER_FROM_BATCH","V3_SWAP_EXACT_IN","subparser","V3PathExactIn","V3_SWAP_EXACT_OUT","V3PathExactOut","V2_SWAP_EXACT_IN","V2_SWAP_EXACT_OUT","V4_SWAP","V4Actions","WRAP_ETH","UNWRAP_WETH","SWEEP","TRANSFER","PAY_PORTION","BALANCE_CHECK_ERC20","V4_INITIALIZE_POOL","V3_POSITION_MANAGER_PERMIT","V3Actions","V3_POSITION_MANAGER_CALL","V4_POSITION_MANAGER_CALL","ACROSS_V4_DEPOSIT_V3","RoutePlanner","commands","inputs","_proto","prototype","addSubPlan","subplan","addCommand","addAcrossBridge","depositor","recipient","inputToken","outputToken","inputAmount","outputAmount","destinationChainId","exclusiveRelayer","quoteTimestamp","fillDeadline","exclusivityDeadline","message","useNative","parameters","allowRevert","command","createCommand","push","encodedInput","has","Error","concat","toString","padStart","commandDef","defaultAbiCoder","encode","map","abi","getPathCurrency","currency","pool","involvesToken","wrapped","V4Pool","token0","equals","token1","symbol","RouterActionType","UniversalRouterVersion","ZERO_ROUTER_CONFIG","address","creationBlock","WETH_NOT_SUPPORTED_ON_CHAIN","CHAIN_CONFIGS","_CHAIN_CONFIGS","weth","routerConfigs","_routerConfigs","V1_2","V2_0","V2_1","_routerConfigs2","_routerConfigs3","_routerConfigs4","_routerConfigs5","_routerConfigs6","_routerConfigs7","_routerConfigs8","_routerConfigs9","_routerConfigs0","_routerConfigs1","_routerConfigs10","_routerConfigs11","_routerConfigs12","_routerConfigs13","_routerConfigs14","_routerConfigs15","_routerConfigs16","_routerConfigs17","_routerConfigs18","_routerConfigs19","_routerConfigs20","_routerConfigs21","_routerConfigs22","_routerConfigs23","_routerConfigs24","_routerConfigs25","_routerConfigs26","UNIVERSAL_ROUTER_ADDRESS","version","chainId","UNIVERSAL_ROUTER_CREATION_BLOCK","WETH_ADDRESS","CONTRACT_BALANCE","BigNumber","from","pow","ETH_ADDRESS","E_ETH_ADDRESS","SENDER_AS_RECIPIENT","ROUTER_AS_RECIPIENT","getCurrencyAddress","isNative","encodeFeeBips","fee","toHex","multiply","quotient","REFUND_ETH_PRICE_IMPACT_THRESHOLD","Percent","UniswapTrade","trade","options","flatFee","inputRequiresWrap","inputRequiresUnwrap","useRouterBalance","payerIsUser","planner","_config","maximumAmountIn","slippageTolerance","_this$options$recipie","performAggregatedSlippageCheck","tradeType","TradeType","EXACT_INPUT","routes","length","routerMustCustody","outputRequiresTransition","hasFeeOption","_iterator","_createForOfIteratorHelperLoose","swaps","_step","done","swap","value","route","protocol","Protocol","V2","addV2Swap","V3","addV3Swap","V4","addV4Swap","MIXED","addMixedSwap","minimumAmountOut","pools","pathOutputCurrencyAddress","feeBips","EXACT_OUTPUT","sub","mul","div","feeAmount","amount","lt","outputRequiresUnwrap","outputRequiresWrap","riskOfPartialFill","safeMode","_createClass","key","get","result","_iterator2","_step2","firstPool","pathInput","lastRoute","lastPool","pathOutput","currency1","currency0","poolBefore","_ref","V2Trade","path","token","_ref2","V3Trade","createUncheckedTrade","encodeRouteToPath","_ref3","p","v4Route","V4Route","V4Trade","slippageToleranceOnSwap","undefined","v4Planner","V4Planner","addTrade","addSettle","pathOutputForTake","ethWethPool","addTake","_options$recipient","finalize","tradeRecipient","_options$recipient2","V3Pool","Pair","MixedRouteTrade","amountIn","amountOut","sections","partitionMixedRouteByProtocol","isLastSectionInRoute","i","section","routePool","getOutputOfPools","subRoute","MixedRoute","MixedRouteSDK","nextInputToken","swapRecipient","nextPool","v2PoolIsSwapRecipient","liquidityToken","v4SubRoute","input","output","addAction","Actions","SWAP_EXACT_IN","currencyIn","encodeV4RouteToPath","amountOutMinimum","outputTokenForTake","v4Pool","encodeMixedRouteToPath","priceImpact","greaterThan","swapOptions","SIGNATURE_LENGTH","EIP_2098_SIGNATURE_LENGTH","encodePermit","permit2","signature","ethers","utils","arrayify","joinSignature","splitSignature","encodeV3PositionPermit","permit","tokenId","calldata","NonfungiblePositionManager","INTERFACE","encodeFunctionData","validateAndParseAddress","spender","deadline","v","r","s","encodeInputTokenOptions","permit2TransferFrom","permit2Permit","details","process","env","NODE_ENV","invariant","EIP712_DOMAIN_NAME","EIP712_DOMAIN_VERSION","EXECUTE_SIGNED_TYPES","ExecuteSigned","NONCE_SKIP_CHECK","generateNonce","randomBytes","Uint8Array","Math","floor","random","toHexString","getUniversalRouterDomain","routerAddress","verifyingContract","isMint","Object","keys","some","k","SwapRouter","swapCallParameters","trades","bridgeOptions","inputCurrency","inputTokenPermit","nativeCurrencyValue","forEach","bridge","encodePlan","deadlineOrPreviousBlockhash","migrateV3ToV4CallParameters","positionManagerOverride","outputPosition","v3Token0","inputPosition","v3Token1","v4PositionManagerAddress","CHAIN_TO_ADDRESSES_MAP","v3RemoveLiquidityOptions","liquidityPercentage","equalTo","burnToken","collectOptions","v4AddLiquidityOptions","migrate","createPool","poolKey","getPoolKey","tickSpacing","hooks","sqrtRatioX96","universalRouterAddress","v3RemoveParams","V3PositionManager","removeCallParameters","v3Calls","Multicall","decodeMulticall","v3Call","selector","slice","getSighash","v4AddParams","V4PositionManager","addCallParameters","getExecuteSignedPayload","signedOptions","iface","decoded","decodeFunctionData","nonce","domain","types","intent","data","sender","encodeExecuteSigned","executeSignedCalldata","config","functionSignature","Interface","UniversalRouter","UnwrapWETH","wethAddress","toLowerCase","permit2Data","_","PoolType","isNativeCurrency","RouterTradeAdapter","fromClassicQuote","quote","tokenIn","tokenOut","firstRoute","tokenInData","tokenOutData","parsedCurrencyIn","toCurrency","parsedCurrencyOut","typedRoutes","rawAmountIn","rawAmountOut","CurrencyAmount","fromRawAmount","isOnlyV2","isVersionedRoute","V2Pool","isOnlyV3","isOnlyV4","routev4","toV4Pool","routev3","V3Route","toV3Pool","routev2","V2Route","toPair","mixedRoute","toPoolOrPair","RouterTrade","v2Routes","filter","v3Routes","v4Routes","mixedRoutes","Ether","onChain","toToken","decimals","buyFeeBps","sellFeeBps","Token","parseInt","liquidity","tickCurrent","every","reserve0","reserve1","CommandParser","parseCalldata","genericParser","GenericCommandParser","txDescription","parseTransaction","_txDescription$args","args","parse","commandDefinition","commandTypes","getCommands","commandType","_this","_V4BaseActionsParser$","V4BaseActionsParser","actions","commandName","v4RouterCallToParams","abiDef","rawParams","decode","param","j","parseV3PathExactIn","parseV3PathExactOut","byte","substring","strippedPath","replace","getAddress","loc","res","feeAndTokenOut","action","actionName"],"mappings":"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"}
\ No newline at end of file
diff --git a/node_modules/@uniswap/universal-router-sdk/dist/utils/constants.d.ts b/node_modules/@uniswap/universal-router-sdk/dist/utils/constants.d.ts
index 77de580..aa462f7 100644
--- a/node_modules/@uniswap/universal-router-sdk/dist/utils/constants.d.ts
+++ b/node_modules/@uniswap/universal-router-sdk/dist/utils/constants.d.ts
@@ -1,7 +1,8 @@
 import { BigNumber } from 'ethers';
 export declare enum UniversalRouterVersion {
     V1_2 = "1.2",
-    V2_0 = "2.0"
+    V2_0 = "2.0",
+    V2_1 = "2.1"
 }
 export declare type RouterConfig = {
     address: string;
diff --git a/node_modules/@uniswap/universal-router-sdk/dist/utils/eip712.d.ts b/node_modules/@uniswap/universal-router-sdk/dist/utils/eip712.d.ts
new file mode 100644
index 0000000..4d0515c
--- /dev/null
+++ b/node_modules/@uniswap/universal-router-sdk/dist/utils/eip712.d.ts
@@ -0,0 +1,14 @@
+import { TypedDataDomain, TypedDataField } from '@ethersproject/abstract-signer';
+import { BigNumber } from 'ethers';
+export declare const EIP712_DOMAIN_NAME = "UniversalRouter";
+export declare const EIP712_DOMAIN_VERSION = "2";
+export declare const EXECUTE_SIGNED_TYPES: Record<string, TypedDataField[]>;
+export declare const NONCE_SKIP_CHECK: BigNumber;
+/**
+ * Generate a random nonce for signed execution
+ */
+export declare function generateNonce(): string;
+/**
+ * Get the EIP712 domain for a Universal Router contract
+ */
+export declare function getUniversalRouterDomain(chainId: number, routerAddress: string): TypedDataDomain;
diff --git a/node_modules/@uniswap/universal-router-sdk/dist/utils/routerCommands.d.ts b/node_modules/@uniswap/universal-router-sdk/dist/utils/routerCommands.d.ts
index ea92618..cd92f2d 100644
--- a/node_modules/@uniswap/universal-router-sdk/dist/utils/routerCommands.d.ts
+++ b/node_modules/@uniswap/universal-router-sdk/dist/utils/routerCommands.d.ts
@@ -1,3 +1,4 @@
+import { AcrossV4DepositV3Params } from '../entities/actions/across';
 /**
  * CommandTypes
  * @description Flags that modify a command's execution
@@ -23,7 +24,8 @@ export declare enum CommandType {
     V3_POSITION_MANAGER_CALL = 18,
     V4_INITIALIZE_POOL = 19,
     V4_POSITION_MANAGER_CALL = 20,
-    EXECUTE_SUB_PLAN = 33
+    EXECUTE_SUB_PLAN = 33,
+    ACROSS_V4_DEPOSIT_V3 = 64
 }
 export declare enum Subparser {
     V3PathExactIn = 0,
@@ -55,6 +57,7 @@ export declare class RoutePlanner {
     inputs: string[];
     constructor();
     addSubPlan(subplan: RoutePlanner): RoutePlanner;
+    addAcrossBridge(params: AcrossV4DepositV3Params): RoutePlanner;
     addCommand(type: CommandType, parameters: any[], allowRevert?: boolean): RoutePlanner;
 }
 export declare type RouterCommand = {
